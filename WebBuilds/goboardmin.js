function CGoBoardApi(){}CGoBoardApi.prototype.Create_GameTree=function(){return new CGameTree};CGoBoardApi.prototype.Create_SimpleBoard=function(a,b){(new CDrawing(a)).Create_SimpleBoard(b)};CGoBoardApi.prototype.Create_Viewer=function(a,b,c){a=new CDrawing(a);!0===c?a.Create_ViewerForBooklet(b):a.Create_Viewer(b)};CGoBoardApi.prototype.Create_EditorVer=function(a,b){(new CDrawing(a)).Create_VerticalFullTemplate(b)};CGoBoardApi.prototype.Create_EditorHor=function(a,b){(new CDrawing(a)).Create_HorizontalFullTemplate(b)};
CGoBoardApi.prototype.Create_BoardWithNavigateButtons=function(a,b){(new CDrawing(a)).Create_BoardWithNavigateButtons(b)};CGoBoardApi.prototype.Create_BoardCommentsButtonsNavigator=function(a,b){(new CDrawing(a)).Create_MixedFullTemplate(b)};CGoBoardApi.prototype.Create_Presentation=function(a,b,c){(new CPresentation(a)).Init(b,c)};
CGoBoardApi.prototype.Create_Problems=function(a,b,c){(new CDrawing(a)).Create_Problems(b);b=.3;c.TutorTime&&(b=parseFloat(c.TutorTime));c.TutorColor&&"Black"===c.TutorColor?a.Set_TutorMode(!1,BOARD_BLACK,b):c.TutorColor&&"White"===c.TutorColor?a.Set_TutorMode(!1,BOARD_WHITE,b):a.Set_TutorMode(!0,BOARD_EMPTY,b);a.Forbid_All();void 0!==c.NewNode&&(a.Set_EditingFlags({NewNode:!0}),a.Set_TutorNewNodeText(c.NewNode));a.Set_TutorCallbacks(void 0!==c.RightCallback?c.RightCallback:null,void 0!==c.WrongCallback?
c.WrongCallback:null,void 0!==c.ResetCallback?c.ResetCallback:null)};CGoBoardApi.prototype.Find_ProblemRightVariant=function(a){return a.Find_ProblemRightVariant()};CGoBoardApi.prototype.Start_AutoPlay=function(a){a.Start_AutoPlay(!0)};CGoBoardApi.prototype.Stop_AutoPlay=function(a){a.Stop_AutoPlay()};
CGoBoardApi.prototype.Set_Permissions=function(a,b){var c={};c.NewNode=b.NewNode;c.RemoveNodes=b.RemoveNodes;c.Move=b.Move;c.ChangeBoardMode=b.ChangeBoardMode;c.LoadFile=b.LoadFile;c.GameInfo=b.GameInfo;c.ViewPort=b.ViewPort;a.Set_EditingFlags(c)};
CGoBoardApi.prototype.Load_Sgf=function(a,b,c,d,e){var f={};c&&!0===c.Auto?f.Auto=!0:c&&void 0!==c.X0&&void 0!==c.X1&&void 0!==c.Y0&&void 0!==c.Y1?(f.Auto=!1,f.X0=c.X0,f.X1=c.X1,f.Y0=c.Y0,f.Y1=c.Y1):f=null;c=a.m_nEditingFlags;a.Reset_EditingFlags();a.Load_Sgf(b,f,d,e);a.m_nEditingFlags=c};CGoBoardApi.prototype.Save_Sgf=function(a){return a.Save_Sgf()};CGoBoardApi.prototype.Get_MoveReference=function(a,b,c){c=1===c?a.Get_StartNode():a.Get_CurNode();return a.Get_NodeReference(b,c)};
CGoBoardApi.prototype.Set_StartNodeByReference=function(a,b){if(a&&b){var c=a.Get_CurNode();a.GoTo_MoveReference(b);a.Set_StartNode(a.Get_CurNode());a.GoTo_Node(c,!0)}};CGoBoardApi.prototype.Is_Modified=function(a){return a.Is_Modified()};CGoBoardApi.prototype.Update_Size=function(a){a.Update_Size()};CGoBoardApi.prototype.Get_MatchName=function(a){return a?a.Get_MatchName():"White vs. Black"};CGoBoardApi.prototype.Set_Sound=function(a,b){a.Set_Sound(b)};
CGoBoardApi.prototype.Focus=function(a){a&&a.Focus()};CGoBoardApi.prototype.Get_Version=function(){return this.Version};CGoBoardApi.prototype.Toggle_Rulers=function(a){a&&a.Toggle_Rulers()};CGoBoardApi.prototype.Set_GameTreeHandler=function(a,b){a&&b&&a.Set_Handler(b)};CGoBoardApi.prototype.GoTo_Node=function(a,b){a&&a.GoTo_NodeById(b)};CGoBoardApi.prototype.GoTo_NodeByMoveNumber=function(a,b){a&&a.GoTo_NodeByMoveNumber(b)};
CGoBoardApi.prototype.Set_ShowTarget=function(a,b){a&&a.Set_ShowTarget(b,!0)};CGoBoardApi.prototype.Set_BoardTheme=function(a,b){if(a){var c=null;"TrueColor"===b?c=EColorScheme.TrueColor:"BookStyle"===b?c=EColorScheme.BookStyle:"Simple"===b?c=EColorScheme.SimpleColor:"Dark"===b&&(c=EColorScheme.Dark);c&&a.Set_LocalColorScheme(c)}};CGoBoardApi.prototype.Get_DivHeightByWidth=function(a,b){if(a)return a.Get_DivHeightByWidth(b)};
CGoBoardApi.prototype.Embed=function(a,b){function c(a){a=decodeURIComponent(a);var b=new XMLHttpRequest;b.open("GET",a+"?_="+(new Date).getTime(),!0);b.onreadystatechange=function(){4!==b.readyState||200!==b.status&&0!=b.status||(g=b.responseText,d())};b.send(null)}function d(){var c=document.getElementById(a);if(c){var d={LoadFile:!1,GameInfo:!1,ChangeBoardMode:!1,NewNode:!1,Move:!1,ViewPort:!1};m.Set_BoardTheme(p,l);var r=400;"image"===h?(m.Create_SimpleBoard(p,a),m.Set_ShowTarget(p,!1),r=600):
"viewer"==h?(m.Create_Viewer(p,a,n),d.Move=!0,r=600):"vereditor"===h?(m.Create_EditorVer(p,a),d.ChangeBoardMode=!0,d.NewNode=!0,d.Move=!0,r=600):"horeditor"===h?(m.Create_EditorHor(p,a),d.ChangeBoardMode=!0,d.NewNode=!0,d.Move=!0,r=900):"problems"==h&&(d={},b.problemsTime&&(d.TutorTime=b.problemsTime),b.problemsColor&&(d.TutorColor=b.problemsColor),b.problemsNewNode&&(d.NewNode=b.problemsNewNode),m.Create_Problems(p,a,d),d=null,r=400,null===f&&(f={Auto:!0}));m.Load_Sgf(p,g,f);null!==k&&(r=k);var A=
m.Get_DivHeightByWidth(p,r);c.style.width=r+"px";c.style.height=A+"px";-1!==e?m.GoTo_NodeByMoveNumber(p,e):m.GoTo_NodeByMoveNumber(p,0);m.Update_Size(p);d&&m.Set_Permissions(p,d)}}var e=-1,f=null,g=null,h=null,k=null,l="TrueColor",m=this,n=!1,p=this.Create_GameTree();p.Get_LocalSettings().Set_Embedding(!0);b.viewPort&&(f={},"auto"===b.viewPort?f.Auto=!0:(f.Auto=!1,f.X0=parseInt(b.viewPort.X0),f.X1=parseInt(b.viewPort.X1),f.Y0=parseInt(b.viewPort.Y0),f.Y1=parseInt(b.viewPort.Y1)));b.moveNumber&&(e=
parseInt(b.moveNumber));h=b.boardMode?b.boardMode:"viewer";b.width&&(k=b.width);b.boardTheme&&(l=b.boardTheme);!0===b.booklet&&(n=!0);null!=b.sgfUrl?c(b.sgfUrl):(g=null!==b.sgfData?b.sgfData:"(;FF[4]GM[1]SZ[19])",d());return p};window.GoBoardApi=new CGoBoardApi;CGoBoardApi.prototype.Embed=CGoBoardApi.prototype.Embed;CGoBoardApi.prototype.Create_GameTree=CGoBoardApi.prototype.Create_GameTree;CGoBoardApi.prototype.Create_SimpleBoard=CGoBoardApi.prototype.Create_SimpleBoard;
CGoBoardApi.prototype.Create_Viewer=CGoBoardApi.prototype.Create_Viewer;CGoBoardApi.prototype.Create_EditorHor=CGoBoardApi.prototype.Create_EditorHor;CGoBoardApi.prototype.Create_EditorVer=CGoBoardApi.prototype.Create_EditorVer;CGoBoardApi.prototype.Create_BoardWithNavigateButtons=CGoBoardApi.prototype.Create_BoardWithNavigateButtons;CGoBoardApi.prototype.Create_BoardCommentsButtonsNavigator=CGoBoardApi.prototype.Create_BoardCommentsButtonsNavigator;CGoBoardApi.prototype.Create_Presentation=CGoBoardApi.prototype.Create_Presentation;
CGoBoardApi.prototype.Create_Problems=CGoBoardApi.prototype.Create_Problems;CGoBoardApi.prototype.Set_Permissions=CGoBoardApi.prototype.Set_Permissions;CGoBoardApi.prototype.Load_Sgf=CGoBoardApi.prototype.Load_Sgf;CGoBoardApi.prototype.Save_Sgf=CGoBoardApi.prototype.Save_Sgf;CGoBoardApi.prototype.Get_MoveReference=CGoBoardApi.prototype.Get_MoveReference;CGoBoardApi.prototype.Set_StartNodeByReference=CGoBoardApi.prototype.Set_StartNodeByReference;CGoBoardApi.prototype.Is_Modified=CGoBoardApi.prototype.Is_Modified;
CGoBoardApi.prototype.Update_Size=CGoBoardApi.prototype.Update_Size;CGoBoardApi.prototype.Set_Sound=CGoBoardApi.prototype.Set_Sound;CGoBoardApi.prototype.Find_ProblemRightVariant=CGoBoardApi.prototype.Find_ProblemRightVariant;CGoBoardApi.prototype.Start_AutoPlay=CGoBoardApi.prototype.Start_AutoPlay;CGoBoardApi.prototype.Stop_AutoPlay=CGoBoardApi.prototype.Stop_AutoPlay;CGoBoardApi.prototype.Focus=CGoBoardApi.prototype.Focus;CGoBoardApi.prototype.Get_MatchName=CGoBoardApi.prototype.Get_MatchName;
CGoBoardApi.prototype.Get_Version=CGoBoardApi.prototype.Get_Version;CGoBoardApi.prototype.Toggle_Rulers=CGoBoardApi.prototype.Toggle_Rulers;CGoBoardApi.prototype.Set_GameTreeHandler=CGoBoardApi.prototype.Set_GameTreeHandler;CGoBoardApi.prototype.GoTo_Node=CGoBoardApi.prototype.GoTo_Node;CGoBoardApi.prototype.GoTo_NodeByMoveNumber=CGoBoardApi.prototype.GoTo_NodeByMoveNumber;CGoBoardApi.prototype.Set_ShowTarget=CGoBoardApi.prototype.Set_ShowTarget;CGoBoardApi.prototype.Get_DivHeightByWidth=CGoBoardApi.prototype.Get_DivHeightByWidth;
CGoBoardApi.prototype.Set_BoardTheme=CGoBoardApi.prototype.Set_BoardTheme;var ECommand={Unknown:0,B:1,W:2,MN:3,AB:257,AW:258,AE:259,PL:260,RM:513,CR:529,MA:530,SQ:531,TR:532,LB:533,BL:769,WL:770,OB:771,OW:772,CT:4353,CM:4354};function CCommand(a,b,c){this.m_nType=void 0===a?ECommand.Unknown:a;this.m_oValue=void 0===b?null:b;this.m_nCount=void 0===c?0:c}CCommand.prototype.Get_Type=function(){return this.m_nType};CCommand.prototype.Get_Value=function(){return this.m_oValue};CCommand.prototype.Get_Count=function(){return this.m_nCount};
CCommand.prototype.Set_Type=function(a){this.m_nType=a};CCommand.prototype.Set_Value=function(a){this.m_oValue=a};CCommand.prototype.Set_Count=function(a){this.m_nCount=a};CCommand.prototype.To_String=function(){return JSON.stringify({Type:this.m_nType,Value:this.m_oValue,Count:this.m_nCount})};CCommand.prototype.From_String=function(a){a=JSON.parse(a);this.m_nType=a.Type;this.m_oValue=a.Value;this.m_nCount=a.m_nCount};
CCommand.prototype.Copy=function(){return new CCommand(this.m_nType,this.m_oValue,this.m_nCount)};function CPos(){Y=X=0}function CColor(a,b,c,d){this.r=a;this.g=b;this.b=c;this.a="undefined"===typeof d?255:d}CColor.prototype.ToString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"};CColor.prototype.Compare=function(a){return this.r!==a.r||this.g!==a.g||this.b!==a.b||this.a!==a.a?!1:!0};CColor.prototype.Copy=function(){return new CColor(this.r,this.g,this.b,this.a)};
CColor.prototype.ToLong=function(){return this.r<<24&4278190080|this.g<<16&16711680|this.b<<8&65280|this.a&255};CColor.prototype.FromLong=function(a){this.r=a>>24&255;this.g=a>>16&255;this.b=a>>8&255;this.a=a&255};CColor.prototype.Set=function(a,b,c){this.r=a;this.g=b;this.b=c};function Common_ValuetoXY(a){var b=new CPos;b.X=a&255;b.Y=a>>8&255;return b}function Common_XYtoValue(a,b){return(b<<8)+a}function Common_CopyArray(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b}
function Common_FindPosition(a){if("undefined"!=typeof a.offsetParent){for(var b=0,c=0;a;a=a.offsetParent)b+=a.offsetLeft,c+=a.offsetTop;return{X:b,Y:c}}return{X:a.x,Y:a.y}}function Common_PosValueToString(a,b,c){a=Common_ValuetoXY(a);return Common_XYtoString(a.X,a.Y,b,c)}function Common_XYtoString(a,b,c,d){return Common_X_to_String(a,c)+(d+1-b)}
function Common_X_to_String(a,b){var c=Math.max(0,Math.min(a-1,b-1));return 8>c?String.fromCharCode(65+c):24>=c?String.fromCharCode(65+c+1):33>c?String.fromCharCode(65+c-25,65+c-25):50>c?String.fromCharCode(65+c-24,65+c-24):String.fromCharCode(65+c-50,65+c-50,65+c-50)}
function Common_StringToXY(a,b,c){if(!a||!a.IsLatinLetter)return null;a=a.toUpperCase();var d=a.length;if(3<=d&&a.IsLatinLetter(0)&&a.charAt(0)===a.charAt(1)&&a.charAt(0)===a.charAt(2))d=a.substr(3),a=a.charCodeAt(0)-65+50;else if(2<=d&&a.IsLatinLetter(0)&&a.charAt(0)===a.charAt(1))d=a.substr(2),a=73<a.charCodeAt(0)?a.charCodeAt(0)-65+24:a.charCodeAt(0)-65+25;else if(1<=d&&a.IsLatinLetter(0))d=a.substr(1),a=73<a.charCodeAt(0)?a.charCodeAt(0)-65-1:a.charCodeAt(0)-65;else return null;d=parseInt(d);
isNaN(d)&&(d=1);d=c-d;return d>=c||0>d||0>a||a>=b?null:{X:a,Y:d}}function Common_IsInt(a){if("string"!=typeof a)return!1;for(var b=0;b<a.length;b++){var c=a.charCodeAt(b);if(48>c||57<c)return!1}return!0}function Common_SortIncrease(a,b){return a>b?1:b>a?-1:0}
function Common_UTF8_Decode(a){for(var b="",c=0,d,e,f,g=a.length;c<g;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|e&63),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(e&63)<<6|f&63),c+=3);return b}
function Common_UTF8_Encode(a){for(var b="",c=0,d,e,f,g=a.length;c<g;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|e&63),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(e&63)<<6|f&63),c+=3);return b}function Common_EncodeString(a,b){for(var c=Encodings[b],d=a.length,e="",f=0;f<d;f++)for(var g=0;256>g;g++)if(c.charCodeAt(g)===a.charCodeAt(f)){e+=String.fromCharCode(g);break}return e}
var Common_DragHandler={Obj:null,Init:function(a,b,c,d,e,f,g,h,k,l){a.onmousedown=Common_DragHandler.Start;a.hmode=g?!1:!0;a.vmode=h?!1:!0;a.root=b&&null!=b?b:a;a.hmode&&isNaN(parseInt(a.root.style.left))&&(a.root.style.left="0px");a.vmode&&isNaN(parseInt(a.root.style.top))&&(a.root.style.top="350px");!a.hmode&&isNaN(parseInt(a.root.style.right))&&(a.root.style.right="0px");!a.vmode&&isNaN(parseInt(a.root.style.bottom))&&(a.root.style.bottom="0px");a.minX="undefined"!=typeof c?c:null;a.minY="undefined"!=
typeof e?e:null;a.maxX="undefined"!=typeof d?d:null;a.maxY="undefined"!=typeof f?f:null;a.xMapper=k?k:null;a.yMapper=l?l:null;a.root.onDragStart=function(){};a.root.onDragEnd=function(){};a.root.onDrag=function(){}},Start:function(a){var b=Common_DragHandler.Obj=this;a=Common_DragHandler.FixE(a);var c=parseInt(b.vmode?b.root.style.top:b.root.style.bottom),d=parseInt(b.hmode?b.root.style.left:b.root.style.right);b.root.onDragStart(d,c);b.lastMouseX=a.clientX;b.lastMouseY=a.clientY;b.hmode?(null!=b.minX&&
(b.minMouseX=a.clientX-d+b.minX),null!=b.maxX&&(b.maxMouseX=b.minMouseX+b.maxX-b.minX)):(null!=b.minX&&(b.maxMouseX=-b.minX+a.clientX+d),null!=b.maxX&&(b.minMouseX=-b.maxX+a.clientX+d));b.vmode?(null!=b.minY&&(b.minMouseY=a.clientY-c+b.minY),null!=b.maxY&&(b.maxMouseY=b.minMouseY+b.maxY-b.minY)):(null!=b.minY&&(b.maxMouseY=-b.minY+a.clientY+c),null!=b.maxY&&(b.minMouseY=-b.maxY+a.clientY+c));document.onmousemove=Common_DragHandler.Drag;document.onmouseup=Common_DragHandler.End;return!1},Drag:function(a){check_MouseMoveEvent(a);
a=Common_DragHandler.FixE(a);var b=Common_DragHandler.Obj,c=a.clientY;a=a.clientX;var d=parseInt(b.vmode?b.root.style.top:b.root.style.bottom),e=parseInt(b.hmode?b.root.style.left:b.root.style.right);null!=b.minX&&(a=b.hmode?Math.max(a,b.minMouseX):Math.min(a,b.maxMouseX));null!=b.maxX&&(a=b.hmode?Math.min(a,b.maxMouseX):Math.max(a,b.minMouseX));null!=b.minY&&(c=b.vmode?Math.max(c,b.minMouseY):Math.min(c,b.maxMouseY));null!=b.maxY&&(c=b.vmode?Math.min(c,b.maxMouseY):Math.max(c,b.minMouseY));var f=
e+(a-b.lastMouseX)*(b.hmode?1:-1);var g=d+(c-b.lastMouseY)*(b.vmode?1:-1);b.xMapper?f=b.xMapper(d):b.yMapper&&(g=b.yMapper(e));null!=b.minX&&(f=Math.max(f,b.minX));null!=b.maxX&&(f=Math.min(f,b.maxX));null!=b.minY&&(g=Math.max(g,b.minY));null!=b.maxY&&(g=Math.min(g,b.maxY));Common_DragHandler.Obj.root.style[b.hmode?"left":"right"]=f+"px";Common_DragHandler.Obj.root.style[b.vmode?"top":"bottom"]=g+"px";Common_DragHandler.Obj.lastMouseX=a;Common_DragHandler.Obj.lastMouseY=c;Common_DragHandler.Obj.root.onDrag(f,
g);return!1},End:function(){document.onmousemove=null;document.onmouseup=null;Common_DragHandler.Obj.root.onDragEnd(parseInt(Common_DragHandler.Obj.root.style[Common_DragHandler.Obj.hmode?"left":"right"]),parseInt(Common_DragHandler.Obj.root.style[Common_DragHandler.Obj.vmode?"top":"bottom"]));Common_DragHandler.Obj=null},FixE:function(a){"undefined"==typeof a&&(a=window.event);"undefined"==typeof a.layerX&&(a.layerX=a.offsetX);"undefined"==typeof a.layerY&&(a.layerY=a.offsetY);return a}};
function CommonExtend(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superclass=b.prototype}
var Common_RequestAnimationFrame=window.requestAnimationFrame?window.requestAnimationFrame:function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)}}(),Common_CancelAnimationFrame=window.cancelAnimationFrame?window.cancelAnimationFrame:function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||
function(a){window.clearTimeout(a)}}();function CCommon(){}CCommon.prototype.Get_Browser=function(){var a="",b=navigator.userAgent;-1!=b.indexOf("Opera")?a="Opera":-1!=b.indexOf("Chrome")?a="Chrome":-1!=b.indexOf("MSIE")?a="IE":-1!=b.indexOf("Safari")?a="Safari":-1!=b.indexOf("Mozilla")&&(a="Mozilla");return a};
CCommon.prototype.SaveAs=function(a,b,c){if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(a,b);var d=document.createElementNS("http://www.w3.org/1999/xhtml","a");a=(window.URL||window.webkitURL||window).createObjectURL(a);d.href=a;d.download=b;c&&(d.type=c);this.Click(d)};
CCommon.prototype.OpenFileDialog=function(a){var b=document.getElementsByTagName("body");if(0<b.length){b=b[0];var c=document.createElement("input");b.appendChild(c);c.type="file";c.multiple=!1;c.accept=".sgf,.gib,.ngf";c.style.display="none";c.addEventListener("change",function(b){b=b.target.files;if(0<b.length){b=b[0];var c=b.name.split(".").pop().toLowerCase(),d=new FileReader;d.onload=function(b){a.Load_Sgf(b.target.result,null,null,c);a.Focus()};d.readAsText(b);a.Focus()}},!1);this.Click(c);
b.removeChild(c)}};CCommon.prototype.Click=function(a){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)};CCommon.prototype.Get_LocalStorageItem=function(a){return void 0!==window.localStorage?localStorage.getItem("HTMLGoBoard"+a):""};CCommon.prototype.Set_LocalStorageItem=function(a,b){void 0!==window.localStorage&&localStorage.setItem("HTMLGoBoard"+a,b)};
CCommon.prototype.Encode_Base64=function(a){var b="",c=0;do{var d=a[c++];var e=a[c++];var f=a[c++];var g=d>>2;d=(d&3)<<4|e>>4;var h=(e&15)<<2|f>>6;var k=f&63;isNaN(e)?h=k=64:isNaN(f)&&(k=64);b=b+g_oBase64String.charAt(g)+g_oBase64String.charAt(d)+g_oBase64String.charAt(h)+g_oBase64String.charAt(k)}while(c<a.length);return b};
CCommon.prototype.Decode_Base64=function(a){var b=0,c=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),d=[];do{var e=g_oBase64String.indexOf(c.charAt(b++));var f=g_oBase64String.indexOf(c.charAt(b++));a=g_oBase64String.indexOf(c.charAt(b++));var g=g_oBase64String.indexOf(c.charAt(b++));e=e<<2|f>>4;f=(f&15)<<4|a>>2;var h=(a&3)<<6|g;d.push(e);64!=a&&d.push(f);64!=g&&d.push(h)}while(b<c.length);return d};
CCommon.prototype.Encode_Base64_UrlSafe=function(a){a=this.Encode_Base64(a);a=a.replace(RegExp("\\+","g"),"~");a=a.replace(RegExp("\\/","g"),"-");return a=a.replace(RegExp("=","g"),"_")};CCommon.prototype.Decode_Base64_UrlSafe=function(a){a=a.replace(RegExp("~","g"),"+");a=a.replace(RegExp("-","g"),"/");a=a.replace(RegExp("_","g"),"=");return this.Decode_Base64(a)};CCommon.prototype.Set_InnerTextToElement=function(a,b){a.innerText?a.innerText=b:a.textContent=b};
CCommon.prototype.Is_NodeDescendant=function(a,b,c){if(!a||!b)return!1;c=c?c:0;for(b=b.parentNode;null!=b;){if(b==a)return!0;c--;if(0>c)break;b=b.parentNode}return!1};CCommon.prototype.Create_DivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CCommon.prototype.Compare_Strings=function(a,b){if(!a)return-1;if(!b)return 1;var c=a.toLowerCase(),d=b.toLowerCase();return c<d?-1:c>d?1:a<b?-1:a>b?1:0};CCommon.prototype.ClearNode=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};var g_oBase64String="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Common=new CCommon;var BOARD_EMPTY=0,BOARD_BLACK=1,BOARD_WHITE=2,BOARD_DRAW=3,EShowVariants={Next:0,Curr:1,None:2,Min:0,Max:2},g_dBoard_H=460,g_dBoard_W=g_dBoard_H,g_dVerOff_2_Cell_H=17.51/23.61,g_dHorOff_2_Cell_W=g_dVerOff_2_Cell_H,g_dBoardCellW=23.61,g_dBoardHorOffset=17.51,g_dBoardCellW_2=g_dBoardCellW/2,g_sBackground="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAg3SURBVHhe7ZpLltw2DEVdNfPQ83gLnmYp3kLWkiwkC0syztAzd54ICgJBEPxXVef0PXJZLeL7SH1aXbdf//ztU+DHX/8e/93w743+84EF7Kp8/uVL3EOKv0OK1cgUoDeL1UhyjOPf6T/w+Ws4dNjcLstLtFS+tzyBgWpD/biEPGZvFqsRQylwiQWEXidhP+jUIk6CWfRavUrRVmVRce5q0Ua9UgydbhXtnHI3daIbmc6Sxz9Wlq1XRY30rEzJ0yzvREHxVZYZzJm4ffvjO/2sh3G9Z0Eg3M3o0CzOTEM4Q73IUCqOM0RUGynVefv2+3cWRRudeuXRFRyulIbxDcxEfpB8FJQMzPgMWToVXiuL8MM5IKiTRmKaVfNyNGlZSgGUWTW+iYqvxQJjcRVOG2BZinB9KFHKktdmWuZmp1hp1slmfKWIxk48M7oFlcUCyl0Gh5+6h0ljo4U3fs5yU3bRohSAmbLMjwD74D84EiruKTuJYz1USwNjkm7pQylRmsxG2t0rMynQoz/xL2vWFU5HKBj7eqVi5WoPUwvVrhSRtIEnQcRXDWcZOUVLfMYxTsWyHqYGiEHapG/vJLEsraOF851hnIZroGZQulX98JSwXjoCZzlFHFtWRCnLNrEA6mbJCgx0YoD4vNDKuSaI0bdds5iaXrNIpYDcX0asXop125Npp1775sDiFOvoZ2fmHXpRtE0TbBHEQr4HTJGl1/CVPvJApcBdKbXkilsMcuo1nOW6x9FfDMqU7mgtlO6k90esKUm2vtqb0ZaPXVbAeHSYXFzRHXK8He2p7RgKTc5kOXxPpVR8bHFApJAHZzDEQjfDnVz1ff1ivs5X/RDmQUmXlzh+rT3T0oQtcxGy91mIH86R9ugK5Gj0NS1VicNlmOT9K4pKQRM8WSViTSv1LnAkk43Ht+pBJi3WKdSIUpR+WGKUZZ6zkpkU8B10lHpd16zzZZgKijS0xZ8z/NEWqCB8luJwiuHJgGNjkaoM9S4oea2cKxX3TEjdM9BwJyAmEmUlwek47q211efD7eSlHhMGRDppw47Xrzt9SgFubDnpNBCTSknQ2rXRUkIuVip8HgdPWJkoVrdSBBKE6PlcdXG40/IBtEP7hNxfCOkCsMMb5coyUoOHWINK7UO1MT0ZxBWE4xM0N7SxXpkOcL/PKnWGnoXiUBsqpuptBhkfn0IaM7VSI3mCf/6aylHCTeJIU0gkNUnEeiaoXjbAP+JzrV4IeO94zSnPvESsJZeGKVQPa2UiEPMnzUMdJUj2ZbYn6sXS8Gpavqx6yK/mx8qa12vyYkcP8RESKJVpMj7RFSRXCp/xNGzRCwfVFgfWcYT9GoKfn3HgsajWWJz46w7NZclIHVccZmEh+GYlyN3XhSoZi8847fAQKIkAglhizQ8XhKCTzWzl6Ln/t0upFAin4YqrwysrBVDepFIgffl3knfuiPjiMuWUepGNmDb1h1K4OUoBNVq1B/GVyH66aquWHcR6w0XLpupPSDOan1JZxysR+aCwExQwvOpNx/QCn97UGpViDEdx6zg4J2X+mYAVz7vi7HKovRfHq34ajqOUYpYuK/SjtjggMA+WcIy1WMPLCrBLPtsSf7SR6tpckyUNkoq1cM7zZVVaaJuZmXXFttPQVOpJeq1i5zWLgEDEO1cKnGJxS8shgfD5zpUC4StH77+NxxC+zAZOvRrvaCbs4l9TB664OUeQtrNhphGFuGbtOxM34Z4Qy6ZEYFzg2aJrTrqMl3RCIK/a4sAoToTK3bAxtzSTQlD1cosDc1CKUkA+PjDr0jKfUVss1XDcK2Aa4GDX8S5agiibRpe4V8B+nwVyz1zpavQHMFBVu4uybH359wqgdFlY3jOj6leOXcgsxmk4EBcRndJ9Gh1//FVrWNzNVT1wbM2SNSKT6pWlClIp496JE7ed1hTpnxtU6hIyILmUivR7odFELNOikVIRLehE/EuF+O2C43dVBeYdCbhfp+GMUovhp03sPO9RWSkAfaJYk0op914896AXGwxMIbsMFKnSHWJNKrUXcSY+BanG9Df/dvPUM1GRPDq8nFLEU1eWXEzGc9YHJRKxBi6B/2+kIDjtXumbf2W4yIHy2KX3IqOUwuexsub16q1D0eX+mOnMlQLXE7wqoqrgvMSMDOWUwUMqtYOM1vIXfyLxEkPXNavkgJ08Oigd74XzmgFLB+OeizQ7soSvcZi+8rj2ElR+kX5lVCeK+Uby+Mb7rFIa6fw6muYtVWtrcTFnwnjOyu1wRB3MjxDmwbWoFOhTbXEgkNczU3b9odQJpIboR3xWc5NN1axEo+Nhlv6q5Di2xKychi0hHHs1z0Aa5KON+EHM0ZZGgNML8FZWYwLHDENqiwPrUPGxxYEyziT57lqs4dkm2t1nEtV9w9nHZkoCXxEezbMUV1bLFDFdxo9gz4uK+gX+A+ZDrA4+xOrgQ6wOimJ13a0Gbm0z94RGX+e+5lC6hwIt1uR9bdL96fiyeqfhwHrpYkzZLi82bulF2phZDLGkXVeO3uZ3T4YC6ZyMLcXMXuBljq7mu4wlk1lMd9ss+3tl6/usfNWYZqBlfUlf2JdCOfRmGUNl2fKm1O9EKUU71by5psuzkJmTJRHLtGtJAJwcEmmW25i5pNmmLMqmlOUSy6+jmgB0RcjdG6nGmU0UvopiBoli7e5kVXzCiTaeKGgkyUMdd8OFnShfirwwPmFmkTtEXyJSStwB8yzrv3JU6oSYj0/kWdYkgmSkV/hUQZLnrE2dMKviE060qUSsV0CGusTa3cna+IQZc0Ei6IXtTmfmGfDTp/8Aysg4kH9KLq0AAAAASUVORK5CYII=",
g_sLogo100="data:image/png;base64,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";var EDITINGFLAGS_MASK=4294967295,EDITINGFLAGS_NEWNODE=1,EDITINGFLAGS_MOVE=2,EDITINGFLAGS_BOARDMODE=4,EDITINGFLAGS_LOADFILE=8,EDITINGFLAGS_GAMEINFO=16,EDITINGFLAGS_VIEWPORT=32,EDITINGFLAGS_REMOVE=64,EDITINGFLAGS_ESTIMATE=128,EDITINGFLAGS_NEWNODE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_NEWNODE,EDITINGFLAGS_MOVE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_MOVE,EDITINGFLAGS_BOARDMODE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_BOARDMODE,EDITINGFLAGS_LOADFILE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_LOADFILE,EDITINGFLAGS_GAMEINFO_NON=
EDITINGFLAGS_MASK^EDITINGFLAGS_GAMEINFO,EDITINGFLAGS_VIEWPORT_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_VIEWPORT,EDITINGFLAGS_REMOVE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_REMOVE,EDITINGFLAGS_ESTIMATE_NON=EDITINGFLAGS_MASK^EDITINGFLAGS_ESTIMATE;
function CGameTree(a){this.m_oSettings=new CLocalSetting(this);this.m_oSound=new CBoardSound;this.m_oDrawing=a;this.m_oInterfaceState=new CInterfaceState;this.m_oBoard=new CLogicBoard;this.m_oDrawingNavigator=this.m_oDrawingBoard=null;this.m_oStartNode=this.m_oCurNode=this.m_oFirstNode=new CNode(this);this.m_oGameCurNode=null;this.m_nWhiteCapt=this.m_nBlackCapt=0;this.m_nNextMove=BOARD_BLACK;this.m_nCurNodeDepth=this.m_nMovesCount=this.m_nWhiteScores=this.m_nBlackScores=this.m_nHandicap=this.m_nKomi=
0;this.m_sOverTime=this.m_sGameFuseki=this.m_sGameInfo=this.m_sGameName=this.m_sGameEvent=this.m_sDateTime=this.m_sCopyright=this.m_sBlackTeam=this.m_sBlackRating=this.m_sGameAnnotator=this.m_sCharset=this.m_sApplication="";this.m_sBlack="Black";this.m_sGamePlace="";this.m_sWhite="White";this.m_sGameSource=this.m_sRules=this.m_sGameRound=this.m_sResult="";this.m_nTimeLimit=0;this.m_sWhiteTeam=this.m_sWhiteRating=this.m_sGameTranscriber="";this.m_bEventEnable=!0;this.m_eShowVariants=EShowVariants.Next;
this.m_nEditingFlags=4294967295;this.m_nAutoPlayTimer=null;this.m_dAutoPlaySpeed=.75;this.m_nAutoPlayOldTime=-1;this.m_bTutorModeAuto=!1;this.m_nTutorMode=BOARD_EMPTY;this.m_nTutorInterval=300;this.m_sTutorText="";this.m_oHandler=this.m_nGifId=this.m_pTutorResetCallback=this.m_pTutorWrongCallback=this.m_pTutorRightCallback=this.m_nTutorId=null;this.m_bKifuMode=this.m_bModified=!1;this.m_nKifuEditFlags=0}
CGameTree.prototype.Copy_ForScoreEstimate=function(){var a=new CGameTree;a.m_oBoard=this.m_oBoard.Copy();a.m_oFirstNode=this.m_oFirstNode.Copy_CurrentVariant(this.m_oCurNode);a.m_oCurNode=a.m_oFirstNode;a.m_nKomi=this.m_nKomi;a.Step_ForwardToEnd();return a};CGameTree.prototype.Set_TutorMode=function(a,b,c){!0===a?(this.m_bTutorModeAuto=!0,this.m_nTutorMode=BOARD_EMPTY):(this.m_bTutorModeAuto=!1,this.m_nTutorMode=b);void 0!==c&&(this.m_nTutorInterval=1E3*c)};
CGameTree.prototype.Set_TutorNewNodeText=function(a){a&&""!==a||(a="Wrong.\nOut of variants.");this.m_sTutorText=a};CGameTree.prototype.Set_TutorCallbacks=function(a,b,c){this.m_pTutorRightCallback=a;this.m_pTutorWrongCallback=b;this.m_pTutorResetCallback=c};CGameTree.prototype.Find_ProblemRightVariant=function(){var a=[];this.m_oFirstNode.Find_RightNodes(a);return 0<a.length?(a[Math.max(0,Math.min(a.length-1,Math.floor(Math.random()*a.length)))].Make_ThisNodeCurrent(),!0):!1};
CGameTree.prototype.Start_AutoPlay=function(a){if(EDITINGFLAGS_MOVE&this.m_nEditingFlags||!0===a){this.Stop_AutoPlay();this.m_oDrawing&&this.m_oDrawing.On_StartAutoPlay();var b=this,c=function(){0<b.Get_CurNode().Get_NextsCount()&&(b.m_nAutoPlayTimer=0,b.Step_Forward(1,a));0<b.Get_CurNode().Get_NextsCount()?(b.m_nAutoPlayOldTime=(new Date).getTime(),b.m_nAutoPlayTimer=setTimeout(c,b.Get_AutoPlayInterval())):(b.m_nAutoPlayTimer=null,b.m_oDrawing&&b.m_oDrawing.On_StopAutoPlay())},d=(new Date).getTime()-
this.m_nAutoPlayOldTime;d=this.Get_AutoPlayInterval()-d;0>=d?c():this.m_nAutoPlayTimer=setTimeout(c,d)}};CGameTree.prototype.Get_AutoPlayInterval=function(){return 100+6900*(1-this.m_dAutoPlaySpeed)};CGameTree.prototype.Stop_AutoPlay=function(){this.m_oDrawing&&this.m_oDrawing.On_StopAutoPlay();null!==this.m_nAutoPlayTimer&&(clearTimeout(this.m_nAutoPlayTimer),this.m_nAutoPlayTimer=null)};CGameTree.prototype.Is_AutoPlay=function(){return null!==this.m_nAutoPlayTimer?!0:!1};
CGameTree.prototype.Set_AutoPlaySpeed=function(a){this.m_dAutoPlaySpeed=a;this.m_oDrawing&&this.m_oDrawing.Update_AutoPlaySpeed(a);null!==this.m_nAutoPlayTimer&&this.Start_AutoPlay()};CGameTree.prototype.GoTo_NodeByTimeLine=function(a){var b=this.private_GetMovesCountInCurVariant();a*=b-1;for(b=this.m_oFirstNode;0<b.Get_NextsCount()&&0<a;)a--,b=b.Get_Next();this.GoTo_Node(b)};
CGameTree.prototype.private_GetTimeLinePos=function(){for(var a=this.m_oFirstNode,b=1,c=1;0<a.Get_NextsCount();)b++,a=a.Get_Next(),a===this.m_oCurNode&&(c=b);return 0<b?(c-1)/(b-1):1};CGameTree.prototype.private_GetMovesCountInCurVariant=function(){for(var a=this.m_oFirstNode,b=1;0<a.Get_NextsCount();)b++,a=a.Get_Next();return b};
CGameTree.prototype.On_EndLoadDrawing=function(){this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Create_FromGameTree();this.m_oDrawing&&(this.Update_InterfaceState(),this.m_oDrawing.Update_AutoPlaySpeed(this.m_dAutoPlaySpeed))};CGameTree.prototype.Set_DrawingNavigator=function(a){this.m_oDrawingNavigator=a};CGameTree.prototype.Set_Drawing=function(a){this.m_oDrawing=a};CGameTree.prototype.Update_Size=function(){this.m_oDrawing&&this.m_oDrawing.Update_Size()};CGameTree.prototype.Get_Drawing=function(){return this.m_oDrawing};
CGameTree.prototype.Get_DrawingBoard=function(){return this.m_oDrawingBoard};CGameTree.prototype.Get_DrawingNavigator=function(){return this.m_oDrawingNavigator};CGameTree.prototype.Focus=function(){this.m_oDrawingBoard&&this.m_oDrawingBoard.Focus()};
CGameTree.prototype.Load_Sgf=function(a,b,c,d){if(this.m_nEditingFlags&EDITINGFLAGS_LOADFILE){g_oIdCounter.Reset();var e=this.m_nEditingFlags;this.Reset_EditingFlags();d="gib"===d?new CGibReader(this):"ngf"===d?new CNgfReader(this):new CSgfReader(this);d.Load(a);this.m_bTutorModeAuto&&(this.m_nTutorMode=this.Get_NextMove()===BOARD_BLACK?BOARD_WHITE:BOARD_BLACK);a=this.m_oBoard.Get_Size().X;var f=this.m_oBoard.Get_Size().Y;this.m_oDrawingBoard&&b?!0===b.Auto?this.m_oDrawingBoard.Set_ViewPort(4>=d.m_oViewPort.X0?
0:d.m_oViewPort.X0-2,4>=d.m_oViewPort.Y0?0:d.m_oViewPort.Y0-2,3>=a-d.m_oViewPort.X1?a-1:d.m_oViewPort.X1,3>=f-d.m_oViewPort.Y1?f-1:d.m_oViewPort.Y1):void 0!==b.X0&&void 0!==b.X1&&void 0!==b.Y0&&void 0!==b.Y1&&this.m_oDrawingBoard.Set_ViewPort(b.X0,b.Y0,b.X1,b.Y1):this.m_oDrawingBoard&&this.m_oDrawingBoard.Set_ViewPort(0,0,a-1,f-1);this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update());c?this.GoTo_MoveReference(c):(this.m_oStartNode=b=this.Is_LoadUnfinishedFilesOnLastNode()&&
this.Is_Unfinished()?this.m_oFirstNode.Get_LastNodeInMainVariant():this.m_oFirstNode,this.GoTo_Node(b));b=this.Get_LoadShowVariants();ESettingsLoadShowVariants.FromFile!==this.Get_LoadShowVariants()&&(this.m_eShowVariants=b);this.m_nEditingFlags=e;this.m_oDrawingBoard&&this.m_oDrawingBoard.On_EndLoadSgf();this.m_oDrawing&&this.m_oDrawing.Update_Size(!0);this.Set_Modified(!1)}};CGameTree.prototype.Save_Sgf=function(){var a=new CSgfWriter;a.Write(this);return a.m_sFile};
CGameTree.prototype.Set_DrawingBoard=function(a){this.m_oDrawingBoard=a};
CGameTree.prototype.Reset=function(){this.m_oFirstNode=new CNode(this);this.Set_GameName("");this.Set_Result("");this.Set_Rules("");this.Set_Komi(0);this.Set_Handicap("0");this.Set_TimeLimit("");this.Set_OverTime("");this.Set_Black("Black");this.Set_BlackRating("");this.Set_White("White");this.Set_WhiteRating("");this.Set_Copyright("");this.Set_GameInfo("");this.Set_DateTime("");this.Set_GameEvent("");this.Set_GameRound("");this.Set_GamePlace("");this.Set_GameAnnotator("");this.Set_GameFuseki("");
this.Set_GameSource("");this.Set_GameTranscriber("");this.m_eShowVariants=EShowVariants.None;this.Init_Match()};CGameTree.prototype.GoTo_StartNode=function(){this.GoTo_Node(this.m_oStartNode)};CGameTree.prototype.Step_BackwardToStart=function(){var a=this.m_nEditingFlags;BOARD_EMPTY!==this.m_nTutorMode&&this.Set_EditingFlags({Move:!0});this.GoTo_Node(this.m_oFirstNode);this.m_nEditingFlags=a;BOARD_EMPTY!==this.m_nTutorMode&&this.m_pTutorResetCallback&&this.private_SendCallback(this.m_pTutorResetCallback)};
CGameTree.prototype.Step_Backward=function(a){for(var b=this.Get_CurNode();null!=b.Get_Prev()&&0<a&&!(b=b.Get_Prev(),a--,1<b.Get_NextsCount()););this.GoTo_Node(b)};
CGameTree.prototype.Step_Forward=function(a,b){var c=this.m_oCurNode,d=this.m_nCurNodeDepth;if(1===a)this.GoTo_Next(b)&&(this.m_oHandler&&this.m_oHandler.GoToNode?(this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=d,this.m_oCurNode=c):this.Execute_CurNodeCommands());else{for(var e=0;e<a&&!(this.GoTo_Next(),1<this.Get_CurNode().Get_NextsCount());e++);this.m_oHandler&&this.m_oHandler.GoToNode?(this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=d,this.m_oCurNode=c):this.GoTo_Node(this.Get_CurNode())}};
CGameTree.prototype.Step_ForwardToEnd=function(){for(var a=this.m_oCurNode,b=this.m_nCurNodeDepth;this.GoTo_Next(););this.m_oHandler&&this.m_oHandler.GoToNode?(this.m_oHandler.GoToNode(this.Get_CurNode()),this.m_nCurNodeDepth=b,this.m_oCurNode=a):this.GoTo_Node(this.Get_CurNode())};CGameTree.prototype.Pass=function(){this.m_oHandler&&this.m_oHandler.Pass?this.m_oHandler.Pass(this.m_nNextMove):!0===this.Add_NewNodeByPos(0,0,this.m_nNextMove)&&this.Execute_CurNodeCommands()};
CGameTree.prototype.GoTo_PrevVariant=function(){var a=this.m_oCurNode.Get_Prev();if(null!==a){var b=a.Get_NextCur(),c=a.Get_NextsCount();1<c&&(this.Is_CycleThroughVariants()?(a=0<b?a.Get_Next(b-1):a.Get_Next(c-1),this.GoTo_Node(a)):0<b&&(a=a.Get_Next(b-1),this.GoTo_Node(a)))}};
CGameTree.prototype.GoTo_NextVariant=function(){var a=this.m_oCurNode.Get_Prev();if(null!==a){var b=a.Get_NextCur(),c=a.Get_NextsCount();1<c&&(this.Is_CycleThroughVariants()?(a=b<c-1?a.Get_Next(b+1):a.Get_Next(0),this.GoTo_Node(a)):b<c-1&&(a=a.Get_Next(b+1),this.GoTo_Node(a)))}};
CGameTree.prototype.GoTo_MainVariant=function(){for(var a=this.m_oCurNode;!a.Is_OnMainVariant();){var b=a.Get_Prev();if(null===b&&a!==this.m_oFirstNode)return;a=b}a.GoTo_MainVariant();this.GoTo_Node(a);this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update()};
CGameTree.prototype.GoTo_NodeByXY=function(a,b){this.m_oSound&&this.m_oSound.Off();var c=this.m_oCurNode,d=this.Get_Handler();this.Set_Handler(null);this.Step_BackwardToStart();for(var e=0;1E3>e&&BOARD_EMPTY===this.m_oBoard.Get(a,b);)this.Step_Forward(1),e++;d&&d.GoToNode?(d.GoToNode(this.Get_CurNode()),this.GoTo_Node(c),this.Set_Handler(d)):(BOARD_EMPTY===this.m_oBoard.Get(a,b)&&this.GoTo_Node(c),this.m_oSound&&this.m_oSound.On())};
CGameTree.prototype.Set_NextMove=function(a){this.m_nNextMove=a;this.m_oCurNode.Set_NextMove(a)};CGameTree.prototype.Get_FirstNode=function(){return this.m_oFirstNode};CGameTree.prototype.Get_CurNode=function(){return this.m_oCurNode};CGameTree.prototype.Set_CurNode=function(a){this.m_oCurNode=a};CGameTree.prototype.Set_GameCurNode=function(a){this.m_oGameCurNode=a};CGameTree.prototype.Get_GameCurNode=function(){return this.m_oGameCurNode};
CGameTree.prototype.Add_Move=function(a,b,c){this.m_oCurNode.Add_Move(a,b,c)};CGameTree.prototype.Add_NewNode=function(a,b){if(!(this.m_nEditingFlags&EDITINGFLAGS_NEWNODE))return!1;var c=new CNode(this);this.m_oCurNode.Add_Next(c,b);this.Set_CurNode(c);this.m_nCurNodeDepth++;!0===a&&this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update());return!0};
CGameTree.prototype.Add_NewNodeByPos=function(a,b,c){for(var d=Common_XYtoValue(a,b),e=0,f=this.m_oCurNode.Get_NextsCount();e<f;e++){var g=this.m_oCurNode.Get_Next(e),h=g.Get_Move(),k=h.Get_Type();if(!0===this.Is_KifuMode()&&0!==e)return!1;if(d===h.Get_Value()&&c===k&&(BOARD_BLACK===c||BOARD_WHITE===c))return a=this.m_oCurNode.Get_NextCur(),this.m_oCurNode.Set_NextCur(e),this.Set_CurNode(g),this.m_nCurNodeDepth++,this.m_oDrawingNavigator&&a!==e&&this.m_oDrawingNavigator.Update(),!0}if(!(this.m_nEditingFlags&
EDITINGFLAGS_NEWNODE))return!1;this.Add_NewNode(!1,!0);this.m_oCurNode.Add_Move(a,b,c);this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update());BOARD_EMPTY!==this.m_nTutorMode&&""!==this.m_sTutorText&&this.m_oCurNode.Set_Comment(this.m_sTutorText);return!0};CGameTree.prototype.Add_MoveNumber=function(a){this.m_oCurNode.Add_MoveNumber(a)};CGameTree.prototype.AddOrRemove_Stones=function(a,b){this.m_oCurNode.AddOrRemove_Stones(a,b)};
CGameTree.prototype.Add_Comment=function(a){var b=this.m_oCurNode.Get_Comment();this.m_oCurNode.Add_Comment(a);this.m_oDrawing&&this.m_oDrawing.Update_Comments(this.m_oCurNode.Get_Comment());this.m_oDrawingNavigator&&""===b&&""!==a&&this.m_oDrawingNavigator.Update()};CGameTree.prototype.Set_Comment=function(a){var b=this.m_oCurNode.Get_Comment();this.m_oCurNode.Set_Comment(a);this.m_oDrawingNavigator&&(""===b&&""!==a||""!==b&&""===a)&&this.m_oDrawingNavigator.Update()};
CGameTree.prototype.Add_Mark=function(a,b){this.m_oCurNode.Add_Mark(a,b)};CGameTree.prototype.Remove_Mark=function(a){this.m_oCurNode.Add_Mark(ECommand.RM,a)};CGameTree.prototype.Add_TextMark=function(a,b){this.m_oCurNode.Add_TextMark(a,b)};CGameTree.prototype.Add_TerritoryPoint=function(a,b){this.m_oCurNode.Is_TerritoryUse()||this.m_oCurNode.Set_TerritoryUse(!0);for(var c=0,d=b.length;c<d;c++)this.m_oCurNode.Add_TerritoryPoint(b[c],a)};CGameTree.prototype.Add_BlackTimeLeft=function(a){this.m_oCurNode.Add_BlackTimeLeft(a)};
CGameTree.prototype.Add_WhiteTimeLeft=function(a){this.m_oCurNode.Add_WhiteTimeLeft(a)};CGameTree.prototype.Update_TerritoryMarks=function(){this.m_oCurNode.Is_TerritoryUse()||this.m_oCurNode.Set_TerritoryUse(!0);this.m_oCurNode.Fill_TerritoryFromLogicBoard(this.m_oBoard)};
CGameTree.prototype.Clear_TerritoryPoints=function(){this.m_oBoard.Clear_Scores();!0===this.m_oCurNode.Is_TerritoryUse()&&(this.m_oCurNode.Set_TerritoryUse(!1),this.m_oCurNode.Clear_TerritoryPoints());if(this.m_oDrawingBoard){this.m_oDrawingBoard.Remove_AllMarks();for(var a=0,b=this.m_oCurNode.Get_CommandsCount();a<b;a++){var c=this.m_oCurNode.Get_Command(a),d=c.Get_Type(),e=c.Get_Value();c=c.Get_Count();switch(d){case ECommand.CR:for(d=0;d<c;d++){var f=Common_ValuetoXY(e[d]);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(f.X,
f.Y,EDrawingMark.Cr,""))}break;case ECommand.MA:for(d=0;d<c;d++)f=Common_ValuetoXY(e[d]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(f.X,f.Y,EDrawingMark.X,""));break;case ECommand.SQ:for(d=0;d<c;d++)f=Common_ValuetoXY(e[d]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(f.X,f.Y,EDrawingMark.Sq,""));break;case ECommand.TR:for(d=0;d<c;d++)f=Common_ValuetoXY(e[d]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(f.X,f.Y,EDrawingMark.Tr,""));break;case ECommand.LB:f=Common_ValuetoXY(e.Pos);this.m_oDrawingBoard.Add_Mark(new CDrawingMark(f.X,
f.Y,EDrawingMark.Tx,e.Text));break;case ECommand.RM:for(d=0;d<c;d++)f=Common_ValuetoXY(e[d]),this.m_oDrawingBoard.Remove_Mark(f.X,f.Y)}}this.m_oCurNode.Have_Move()?(b=this.m_oCurNode.Get_Move(),a=b.Get_X(),b=b.Get_Y(),this.m_oDrawingBoard.Set_LastMoveMark(a,b)):this.m_oDrawingBoard.Set_LastMoveMark(-1,-1);this.m_oDrawingBoard.Draw_Marks()}};
CGameTree.prototype.Remove_CurNode=function(){if(!(this.m_nEditingFlags&EDITINGFLAGS_REMOVE))return!1;var a=this.m_oCurNode.Get_Prev();if(null===a)this.m_oCurNode.Clear(),this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update()),this.GoTo_Node(this.m_oCurNode);else for(var b=0,c=a.Get_NextsCount();b<c;b++)if(this.m_oCurNode===a.Get_Next(b)){a.Remove_Next(b);this.Set_CurNode(a);this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),
this.m_oDrawingNavigator.Update());this.GoTo_Node(a);break}};CGameTree.prototype.Have_Move=function(){return this.m_oCurNode.Have_Move()};CGameTree.prototype.Is_CurNodeLast=function(){return 0===this.m_oCurNode.Get_NextsCount()?!0:!1};
CGameTree.prototype.Execute_CurNodeCommands=function(){this.m_oBoard.Clear_Scores();this.m_oDrawingBoard&&(EBoardMode.CountScores===this.m_oDrawingBoard.Get_Mode()&&this.m_oDrawingBoard.Set_Mode(EBoardMode.Move),this.m_oDrawingBoard.Remove_AllMarks(),this.Show_Variants(),this.m_oCurNode.Is_TerritoryForceUse()&&this.m_oBoard.Init_CountScores(!0));for(var a=0,b=this.m_oCurNode.Get_CommandsCount();a<b;a++){var c=this.m_oCurNode.Get_Command(a),d=c.Get_Type(),e=c.Get_Value();c=c.Get_Count();switch(d){case ECommand.B:d=
Common_ValuetoXY(e);this.Execute_Move(d.X,d.Y,BOARD_BLACK,!1);break;case ECommand.W:d=Common_ValuetoXY(e);this.Execute_Move(d.X,d.Y,BOARD_WHITE,!1);break;case ECommand.AB:for(var f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.private_SetBoardPoint(d.X,d.Y,BOARD_BLACK,-1);break;case ECommand.AW:for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.private_SetBoardPoint(d.X,d.Y,BOARD_WHITE,-1);break;case ECommand.AE:for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.private_SetBoardPoint(d.X,d.Y,BOARD_EMPTY,-1);break;
case ECommand.PL:this.private_SetNextMove(e);break;case ECommand.CR:if(this.m_oDrawingBoard)for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(d.X,d.Y,EDrawingMark.Cr,""));break;case ECommand.MA:if(this.m_oDrawingBoard)for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(d.X,d.Y,EDrawingMark.X,""));break;case ECommand.SQ:if(this.m_oDrawingBoard)for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(d.X,
d.Y,EDrawingMark.Sq,""));break;case ECommand.TR:if(this.m_oDrawingBoard)for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(d.X,d.Y,EDrawingMark.Tr,""));break;case ECommand.LB:this.m_oDrawingBoard&&(d=Common_ValuetoXY(e.Pos),this.m_oDrawingBoard.Add_Mark(new CDrawingMark(d.X,d.Y,EDrawingMark.Tx,e.Text)));break;case ECommand.RM:if(this.m_oDrawingBoard)for(f=0;f<c;f++)d=Common_ValuetoXY(e[f]),this.m_oDrawingBoard.Remove_Mark(d.X,d.Y)}}this.m_oDrawingBoard&&(this.m_oCurNode.Have_Move()?
(b=this.m_oCurNode.Get_Move(),a=b.Get_X(),b=b.Get_Y(),this.m_oDrawingBoard.Set_LastMoveMark(a,b)):this.m_oDrawingBoard.Set_LastMoveMark(-1,-1),this.m_oCurNode.Is_TerritoryForceUse()?(this.m_oCurNode.Fill_TerritoryToLogicBoard(this.m_oBoard),this.Count_Scores(),this.m_oDrawing.m_eMode=EBoardMode.CountScores,this.Update_InterfaceState()):this.m_oCurNode.Is_TerritoryUse()&&this.m_oDrawingBoard.Set_Mode(EBoardMode.CountScores),this.m_oDrawingBoard.Draw_Marks(),this.m_oCurNode.Draw_ColorMap(this.m_oDrawingBoard));
this.m_oDrawing&&(a=this.m_oCurNode.Get_Comment(),b=!0,BOARD_EMPTY!==this.m_nTutorMode?(-1!==a.indexOf("CHOICE")&&(a=a.replace("CHOICE","")),0>=this.m_oCurNode.Get_NextsCount()&&(-1!==a.indexOf("RIGHT")&&null!==this.m_pTutorRightCallback?(this.m_oDrawing.Update_Comments(a.replace("RIGHT","")),this.private_SendCallback(this.m_pTutorRightCallback),b=!1):-1===a.indexOf("RIGHT")&&null!==this.m_pTutorWrongCallback&&(this.m_oDrawing.Update_Comments(a),this.private_SendCallback(this.m_pTutorWrongCallback),
b=!1)),b&&this.m_oDrawing.Update_Comments(a)):this.m_oDrawing.Update_Comments(a));this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update_Current(!0);this.Update_InterfaceState();if(this.m_nNextMove===this.m_nTutorMode&&null===this.m_nTutorId&&null===this.m_nAutoPlayTimer&&null===this.m_nGifId&&0<=this.m_oCurNode.Get_NextsCount()){var g=this.m_nEditingFlags,h=this;this.m_nTutorId=setTimeout(function(){h.Reset_EditingFlags();for(var a=h.Get_CurNode(),b=[],c=0,d=a.Get_NextsCount();c<d;c++)-1!==a.Get_Next(c).Get_Comment().indexOf("CHOICE")&&
b.push(c);0<b.length?a.Set_NextCur(b[Math.max(0,Math.min(b.length-1,Math.floor(Math.random()*b.length)))]):0<a.Get_NextsCount()&&a.Set_NextCur(0);h.Step_Forward(1);h.m_nEditingFlags=g;h.m_nTutorId=null},this.m_nTutorInterval);this.Forbid_All()}};
CGameTree.prototype.Execute_Move=function(a,b,c,d){if(0!=a||0!=b){this.m_oSound&&!0!==d&&this.m_oSound.Play_PlaceStone();this.private_SetBoardPoint(a,b,c,this.m_nMovesCount+1,d);var e=null;if(null!==(e=this.m_oBoard.Check_Kill(a,b,c,!1))&&0<e.Get_Size()){a=e.Get_Size();for(b=0;b<a;b++){var f=Common_ValuetoXY(e.Get_Value(b));this.private_SetBoardPoint(f.X,f.Y,BOARD_EMPTY,-1)}this.m_oSound&&!0!==d&&this.m_oSound.Play_CaptureStones(e.Get_Size());BOARD_BLACK===c?this.m_nBlackCapt+=a:this.m_nWhiteCapt+=
a}else if(null!==(e=this.m_oBoard.Check_Dead(a,b,c,!1))&&0<e.Get_Size()){a=e.Get_Size();for(b=0;b<a;b++)f=Common_ValuetoXY(e.Get_Value(b)),this.private_SetBoardPoint(f.X,f.Y,BOARD_EMPTY,-1);this.m_oSound&&!0!==d&&this.m_oSound.Play_CaptureStones(e.Get_Size());BOARD_BLACK===c?this.m_nWhiteCapt+=a:this.m_nBlackCapt+=a}else this.m_oBoard.Reset_Ko()}this.private_UpdateNextMove(c)};
CGameTree.prototype.GoTo_Next=function(a){if(!(this.m_nEditingFlags&EDITINGFLAGS_MOVE)&&!0!==a||!0===this.Is_KifuMode()&&!0!==a||0===this.m_oCurNode.Get_NextsCount()||-1===this.m_oCurNode.Get_NextCur())return!1;this.Set_CurNode(this.m_oCurNode.Get_Next(this.m_oCurNode.Get_NextCur()));this.m_nCurNodeDepth++;return!0};CGameTree.prototype.Show_Variants=function(){this.m_oDrawingBoard&&this.m_oCurNode.Show_Variants(this.m_eShowVariants,this.m_oDrawingBoard)};
CGameTree.prototype.Count_Scores=function(){if(this.m_oDrawingBoard){var a=this.m_oBoard.Count_Scores(this.m_oDrawingBoard);this.m_oDrawingBoard.Draw_Marks();this.Update_TerritoryMarks();this.m_nBlackScores=a.Black+this.m_nBlackCapt;this.m_nWhiteScores=a.White+this.m_nWhiteCapt+this.m_nKomi;this.Update_InterfaceState()}};CGameTree.prototype.Set_Sound=function(a){this.m_oSound.Init(a)};CGameTree.prototype.Set_SoundClass=function(a){this.m_oSound=a};
CGameTree.prototype.GoTo_Node=function(a,b){if((this.m_nEditingFlags&EDITINGFLAGS_MOVE||!0===b)&&!0!==this.Is_KifuMode())if(this.m_oHandler&&this.m_oHandler.GoToNode)this.m_oHandler.GoToNode(a);else{this.Stop_AutoPlay();this.Init_Match();this.m_oBoard.Clear();this.m_oSound&&this.m_oSound.Off();var c=a.Make_ThisNodeCurrent();for(this.Set_CurNode(this.m_oFirstNode);this.m_oCurNode!=a&&0<this.m_oCurNode.Get_NextsCount();){for(var d=this.m_oCurNode.Get_CommandsCount(),e=0;e<d;e++){var f=this.m_oCurNode.Get_Command(e),
g=f.Get_Type(),h=f.Get_Value();f=f.Get_Count();switch(g){case ECommand.B:g=Common_ValuetoXY(h);this.Execute_Move(g.X,g.Y,BOARD_BLACK,!0);break;case ECommand.W:g=Common_ValuetoXY(h);this.Execute_Move(g.X,g.Y,BOARD_WHITE,!0);break;case ECommand.AB:for(var k=0;k<f;k++)g=Common_ValuetoXY(h[k]),this.m_oBoard.Set(g.X,g.Y,BOARD_BLACK,-1);break;case ECommand.AW:for(k=0;k<f;k++)g=Common_ValuetoXY(h[k]),this.m_oBoard.Set(g.X,g.Y,BOARD_WHITE,-1);break;case ECommand.AE:for(k=0;k<f;k++)g=Common_ValuetoXY(h[k]),
this.m_oBoard.Set(g.X,g.Y,BOARD_EMPTY,-1)}}if(!this.GoTo_Next(b))break}this.m_oDrawingBoard&&this.m_oDrawingBoard.Draw_AllStones();this.Execute_CurNodeCommands();this.m_oDrawingNavigator&&!0===c&&this.m_oDrawingNavigator.Update();this.m_oSound&&this.m_oSound.On()}};CGameTree.prototype.Get_BlackName=function(){return this.m_sBlack};CGameTree.prototype.Get_BlackRating=function(){return this.m_sBlackRating};CGameTree.prototype.Get_WhiteName=function(){return this.m_sWhite};
CGameTree.prototype.Get_WhiteRating=function(){return this.m_sWhiteRating};CGameTree.prototype.Get_Board=function(){return this.m_oBoard};CGameTree.prototype.Get_NextMove=function(){return this.m_nNextMove};CGameTree.prototype.Get_MovesCount=function(){return this.m_nMovesCount};CGameTree.prototype.Get_BlackCapt=function(){return this.m_nBlackCapt};CGameTree.prototype.Get_WhiteCapt=function(){return this.m_nWhiteCapt};
CGameTree.prototype.Get_BlackScores=function(){return this.m_oHandler&&this.m_oHandler.GetBlackScores?this.m_oHandler.GetBlackScores():this.m_nBlackScores};CGameTree.prototype.Get_WhiteScores=function(){return this.m_oHandler&&this.m_oHandler.GetWhiteScores?this.m_oHandler.GetWhiteScores:this.m_nWhiteScores};CGameTree.prototype.Get_CurNodeDepth=function(){return this.m_nCurNodeDepth};CGameTree.prototype.Get_Komi=function(){return this.m_nKomi};
CGameTree.prototype.Set_Komi=function(a){this.m_nKomi=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Handicap=function(){return this.m_nHandicap};CGameTree.prototype.Set_Handicap=function(a){this.m_nHandicap=a;this.Set_Modified(!0)};CGameTree.prototype.Set_Application=function(a){this.m_sApplication=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Application=function(){return this.m_sApplication};CGameTree.prototype.Set_Author=function(a){this.m_sAuthor=a;this.Set_Modified(!0)};
CGameTree.prototype.Set_Charset=function(a){this.m_sCharset=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Charset=function(){return this.m_sCharset};CGameTree.prototype.Set_ShowVariants=function(a){a!==this.m_eShowVariants&&(this.m_eShowVariants=a,this.Show_Variants())};CGameTree.prototype.Get_ShowVariants=function(){return this.m_eShowVariants};CGameTree.prototype.Set_GameAnnotator=function(a){this.m_sGameAnnotator=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameAnnotator=function(){return this.m_sGameAnnotator};
CGameTree.prototype.Set_BlackRating=function(a){this.m_sBlackRating=a;this.m_oDrawing&&this.m_oDrawing.Update_BlackRank(this.m_sBlackRating);this.Set_Modified(!0)};CGameTree.prototype.Set_BlackTeam=function(a){this.m_sBlackTeam=a;this.Set_Modified(!0)};CGameTree.prototype.Get_BlackTeam=function(){return this.m_sBlackTeam};CGameTree.prototype.Set_Copyright=function(a){this.m_sCopyright=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Copyright=function(){return this.m_sCopyright};
CGameTree.prototype.Set_DateTime=function(a){this.m_sDateTime=a;this.Set_Modified(!0)};CGameTree.prototype.Get_DateTime=function(){return this.m_sDateTime};CGameTree.prototype.Set_GameEvent=function(a){this.m_sGameEvent=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameEvent=function(){return this.m_sGameEvent};CGameTree.prototype.Set_GameName=function(a){this.m_sGameName=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameName=function(){return this.m_sGameName};
CGameTree.prototype.Get_MatchName=function(){var a=this.Get_GameName();""===a&&(a=this.Get_WhiteName()+" vs. "+this.Get_BlackName());""===a&&(a="White vs. Black");return a};CGameTree.prototype.Set_GameInfo=function(a){this.m_sGameInfo=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameInfo=function(){return this.m_sGameInfo};CGameTree.prototype.Set_GameFuseki=function(a){this.m_sGameFuseki=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameFuseki=function(){return this.m_sGameFuseki};
CGameTree.prototype.Set_OverTime=function(a){this.m_sOverTime=a;this.Set_Modified(!0)};CGameTree.prototype.Get_OverTime=function(){return this.m_sOverTime};CGameTree.prototype.Set_Black=function(a){this.m_sBlack=a;this.m_oDrawing&&this.m_oDrawing.Update_BlackName(this.m_sBlack);this.Set_Modified(!0)};CGameTree.prototype.Set_GamePlace=function(a){this.m_sGamePlace=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GamePlace=function(){return this.m_sGamePlace};
CGameTree.prototype.Set_White=function(a){this.m_sWhite=a;this.m_oDrawing&&this.m_oDrawing.Update_WhiteName(this.m_sWhite);this.Set_Modified(!0)};CGameTree.prototype.Set_Result=function(a){this.m_sResult=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Result=function(){return this.m_sResult};CGameTree.prototype.Set_GameRound=function(a){this.m_sGameRound=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameRound=function(){return this.m_sGameRound};
CGameTree.prototype.Set_Rules=function(a){this.m_sRules=a;this.Set_Modified(!0)};CGameTree.prototype.Get_Rules=function(){return this.m_sRules};CGameTree.prototype.Set_GameSource=function(a){this.m_sGameSource=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameSource=function(){return this.m_sGameSource};CGameTree.prototype.Set_TimeLimit=function(a){this.m_nTimeLimit=a;this.Set_Modified(!0)};CGameTree.prototype.Get_TimeLimit=function(){return this.m_nTimeLimit};
CGameTree.prototype.Set_GameTranscriber=function(a){this.m_sGameTranscriber=a;this.Set_Modified(!0)};CGameTree.prototype.Get_GameTranscriber=function(){return this.m_sGameTranscriber};CGameTree.prototype.Set_WhiteRating=function(a){this.m_sWhiteRating=a;this.m_oDrawing&&this.m_oDrawing.Update_WhiteRank(this.m_sWhiteRating);this.Set_Modified(!0)};CGameTree.prototype.Set_WhiteTeam=function(a){this.m_sWhiteTeam=a;this.Set_Modified(!0)};CGameTree.prototype.Get_WhiteTeam=function(){return this.m_sWhiteTeam};
CGameTree.prototype.Set_BoardSize=function(a,b){var c=Math.min(52,Math.max(a,2)),d=Math.min(52,Math.max(b,2)),e=this.m_oBoard.Get_Size();if(c!==e.X||d!==e.Y)this.m_oBoard.Reset_Size(c,d),this.m_oDrawingBoard&&this.m_oDrawingBoard.On_Resize(!0)};CGameTree.prototype.Init_Match=function(){this.Set_CurNode(this.m_oFirstNode);this.m_nCurNodeDepth=this.m_nMovesCount=this.m_nWhiteCapt=this.m_nBlackCapt=0;this.m_nNextMove=BOARD_BLACK};
CGameTree.prototype.private_UpdateNextMove=function(a){BOARD_BLACK===a?this.private_SetNextMove(BOARD_WHITE):this.private_SetNextMove(BOARD_BLACK);this.m_nMovesCount++};CGameTree.prototype.private_SetBoardPoint=function(a,b,c,d,e){this.m_oBoard.Set(a,b,c,d);this.m_oDrawingBoard&&!0!==e&&this.m_oDrawingBoard.Draw_Sector(a,b,c)};CGameTree.prototype.private_SetNextMove=function(a){this.m_nNextMove=a};
CGameTree.prototype.Update_InterfaceState=function(a){if(this.m_oDrawing){var b=this.m_oInterfaceState,c=this.m_oCurNode.Get_Prev();b.Backward=null===this.m_oCurNode.Get_Prev()?!1:!0;b.Forward=0>=this.m_oCurNode.Get_NextsCount()?!1:!0;if(null!==c){var d=c.Get_NextCur();c=c.Get_NextsCount();this.Is_CycleThroughVariants()?(b.NextVariant=1<c?!0:!1,b.PrevVariant=1<c?!0:!1):(b.NextVariant=d<c-1?!0:!1,b.PrevVariant=0<d?!0:!1)}else b.NextVariant=!1,b.PrevVariant=!1;this.m_oDrawingBoard&&(b.BoardMode=this.m_oDrawingBoard.Get_Mode());
b.TimelinePos=this.private_GetTimeLinePos();this.m_oDrawing.Update_InterfaceState(b);this.m_oDrawingBoard&&EBoardMode.CountScores===this.m_oDrawingBoard.Get_Mode()?this.m_oDrawing.Update_Scores(this.Get_BlackScores(),this.Get_WhiteScores()):this.m_oDrawing.Update_Captured(this.Get_BlackCapt(),this.Get_WhiteCapt());a&&(this.m_oDrawing.Update_BlackRank(this.m_sBlackRating),this.m_oDrawing.Update_WhiteRank(this.m_sWhiteRating),this.m_oDrawing.Update_BlackName(this.m_sBlack),this.m_oDrawing.Update_WhiteName(this.m_sWhite))}};
CGameTree.prototype.Set_EditingFlags=function(a){a&&(!0===a.NewNode?this.m_nEditingFlags|=EDITINGFLAGS_NEWNODE:!1===a.NewNode&&(this.m_nEditingFlags&=EDITINGFLAGS_NEWNODE_NON),!0===a.Move?this.m_nEditingFlags|=EDITINGFLAGS_MOVE:!1===a.Move&&(this.m_nEditingFlags&=EDITINGFLAGS_MOVE_NON),!0===a.ChangeBoardMode?this.m_nEditingFlags|=EDITINGFLAGS_BOARDMODE:!1===a.ChangeBoardMode&&(this.m_nEditingFlags&=EDITINGFLAGS_BOARDMODE_NON),!0===a.LoadFile?this.m_nEditingFlags|=EDITINGFLAGS_LOADFILE:!1===a.LoadFile&&
(this.m_nEditingFlags&=EDITINGFLAGS_LOADFILE_NON),!0===a.GameInfo?this.m_nEditingFlags|=EDITINGFLAGS_GAMEINFO:!1===a.GameInfo&&(this.m_nEditingFlags&=EDITINGFLAGS_GAMEINFO_NON),!0===a.ViewPort?this.m_nEditingFlags|=EDITINGFLAGS_VIEWPORT:!1===a.ViewPort&&(this.m_nEditingFlags&=EDITINGFLAGS_VIEWPORT_NON),!0===a.RemoveNodes?this.m_nEditingFlags|=EDITINGFLAGS_REMOVE:!1===a.RemoveNodes&&(this.m_nEditingFlags&=EDITINGFLAGS_REMOVE_NON),!0===a.ScoreEstimate?this.m_nEditingFlags|=EDITINGFLAGS_ESTIMATE:!1===
a.ScoreEstimate&&(this.m_nEditingFlags&=EDITINGFLAGS_ESTIMATE_NON))};CGameTree.prototype.Reset_EditingFlags=function(){this.m_nEditingFlags=EDITINGFLAGS_MASK};CGameTree.prototype.Forbid_All=function(){this.m_nEditingFlags=0};CGameTree.prototype.Can_EditGameInfo=function(){return this.m_nEditingFlags&EDITINGFLAGS_GAMEINFO?!0:!1};
CGameTree.prototype.Download_PngBoardScreenShot=function(){var a=this.Get_DrawingBoard();if(a){a=a.Get_FullImage(!0).toDataURL("image/png");var b=document.createElement("a");b.download="BoardShot.png";b.href="data:image/png;base64"+a;Common.Click(b)}};CGameTree.prototype.Download_GifForCurVariant=function(){var a=[],b=this.m_oFirstNode;for(a.push(b);0<b.Get_NextsCount();)b=b.Get_Next(b.Get_NextCur()),a.push(b);this.private_DownloadGif(a)};
CGameTree.prototype.Download_GifForProblem=function(){var a=[],b=[];this.m_oFirstNode.Find_RightNodes(b);for(var c=0,d=b.length;c<d;c++){var e=b[c];e.Make_ThisNodeCurrent();var f=this.m_oFirstNode;for(a.push(f);f!==e&&0<f.Get_NextsCount();)f=f.Get_Next(f.Get_NextCur()),a.push(f)}this.private_DownloadGif(a)};CGameTree.prototype.Download_GifBoardScreenShot=function(){this.private_DownloadGif([this.m_oCurNode])};CGameTree.prototype.Abort_DownloadGid=function(){this.m_nGifId=null};
CGameTree.prototype.private_DownloadGif=function(a){var b=this.Get_DrawingBoard();if(b){var c=this.m_oCurNode,d=b.m_oImageData.W,e=b.m_oImageData.H,f=a.length,g=Math.max(1,Math.ceil(2E6/d/e)),h=0,k=null,l=null,m=5<Math.ceil(f/g)?!0:!1,n=!0===m?CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.GifWriter,{Drawing:this.m_oDrawing,GameTree:this}):null;b.Set_BlackWhiteLastMark(!0);var p=new CGifWriter;p.Set_Delay(1500);p.Start();e=d=0;null!==n&&n.On_Start();var q=this;this.m_nGifId=!0;var t=function(){if(null===
q.m_nGifId)b.Set_BlackWhiteLastMark(!1),q.GoTo_Node(c,!0);else{for(var r=Math.min(h+g,f);h<r;h++){q.GoTo_Node(a[h],!0);oCanvas=b.Get_FullImage(!1);oContext=oCanvas.getContext("2d");var A=b.Get_BoardState(),y=A.Stones,w=A.Marks;if(0===d||0===e)d=oCanvas.width,e=oCanvas.height;if(null===k||null===l)p.Add_ContextFrame(oContext,0,0,d,e,[{X0:0,Y0:0,X1:d,Y1:e}]);else{var x={},v;for(v in w)x[v]=w[v];for(v in l)x[v]=void 0===x[v]||!1!==x[v]&&!1!==l[v]?l[v]:!1;for(v in k)k[v]!==y[v]&&!1!==x[v]&&(x[v]=!0);
y=[];for(v in x)w=Common_ValuetoXY(v),w=b.Get_BoardAreaByPosition(w.X,w.Y,b.private_GetSettings_Shadows(),x[v]),null!==w&&y.push(w);if(0<y.length){x=d;for(var B=e,L=0,E=0,H=0,I=y.length;H<I;H++)w=y[H],w.X0<x&&(x=w.X0),w.Y0<B&&(B=w.Y0),w.X1>L&&(L=w.X1),w.Y1>E&&(E=w.Y1);p.Add_ContextFrame(oContext,x,B,L-x,E-B,y)}else p.Add_ContextFrame(oContext,0,0,d,e,[])}k=A.Stones;l=A.Marks}null!==n&&n.On_Progress(Math.min(100,h/f*100));h<f?!0===m?setTimeout(t,10):t():(n&&n.On_End(),p.Finish(),r=q.Get_GameName(),
""===r&&(r=q.Get_WhiteName()+" vs. "+q.Get_BlackName()),""===r&&(r="download"),r+=".gif",A=new Blob([p.Get_Stream().Get_Bytes()],{type:"image/gif"}),Common.SaveAs(A,r),q.m_nGifId=null,b.Set_BlackWhiteLastMark(!1),q.GoTo_Node(c,!0))}};!0===m?setTimeout(t,10):t()}};CGameTree.prototype.private_SendCallback=function(a){null===this.m_nGifId&&a&&a()};CGameTree.prototype.Toggle_Sound=function(a,b){g_oGlobalSettings.Set_Sound(a)};CGameTree.prototype.Is_SoundOn=function(){return g_oGlobalSettings.Is_SoundOn()};
CGameTree.prototype.Set_LoadUnfinishedFilesOnLastNode=function(a){g_oGlobalSettings.Set_LoadUnfinishedFilesOnLastNode(a)};CGameTree.prototype.Is_LoadUnfinishedFilesOnLastNode=function(){return this.m_oDrawing&&EDrawingTemplate.Problems===this.m_oDrawing.Get_TemplateType()?!1:g_oGlobalSettings.Is_LoadUnfinishedFilesOnLastNode()};CGameTree.prototype.Is_ShowTarget=function(){return g_oGlobalSettings.Is_ShowTarget()};
CGameTree.prototype.Set_ShowTarget=function(a,b){!0===b?this.m_oSettings.Set_ShowTarget(a):g_oGlobalSettings.Set_ShowTarget(a);this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Target()};CGameTree.prototype.Is_CycleThroughVariants=function(){return g_oGlobalSettings.Is_CycleThroughVariants()};CGameTree.prototype.Set_CycleThroughVariants=function(a){g_oGlobalSettings.Set_CycleThroughVariants(a);this.Update_InterfaceState()};CGameTree.prototype.Get_NavigatorLabel=function(){return g_oGlobalSettings.Get_NavigatorLabel()};
CGameTree.prototype.Set_NavigatorLabel=function(a){a!==this.Get_NavigatorLabel()&&(g_oGlobalSettings.Set_NavigatorLabel(a),this.m_oDrawingNavigator&&this.m_oDrawingNavigator.Update())};CGameTree.prototype.Get_LoadShowVariants=function(){return g_oGlobalSettings.Get_LoadShowVariants()};CGameTree.prototype.Set_LoadShowVariants=function(a){a!==this.Get_LoadShowVariants()&&g_oGlobalSettings.Set_LoadShowVariants(a)};
CGameTree.prototype.Is_Unfinished=function(){return""===this.m_sResult||null===this.m_sResult||void 0===this.m_sResult?!0:!1};CGameTree.prototype.Add_ColorMark=function(a,b,c){this.m_oCurNode.Add_ColorMark(a,b,c);this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()};CGameTree.prototype.Remove_ColorMark=function(a,b){this.m_oCurNode.Remove_ColorMark(a,b);this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()};
CGameTree.prototype.Remove_AllColorMarks=function(){this.m_oCurNode.Remove_AllColorMarks();this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()};CGameTree.prototype.Copy_ColorMapFromPrevNode=function(){this.m_oCurNode.Copy_ColorMapFromPrevNode();this.m_oDrawingBoard&&this.m_oCurNode.Draw_ColorMap(this.m_oDrawingBoard);this.m_oDrawing&&this.m_oDrawing.Update_ColorsCounter()};CGameTree.prototype.Get_StartNode=function(){return this.m_oStartNode};
CGameTree.prototype.GoTo_MoveReference=function(a){var b=this.Get_FirstNode();a=Common.Decode_Base64_UrlSafe(a);a=new CStreamReader(a,a.length);if("GBMR"!==a.Get_String(4))return this.GoTo_Node(b);var c=a.Get_Short();if(1===c){c=a.Get_String2();var d=b.Get_NodeById(c);if(null!==d){b=a.Get_Byte();this.Set_CurNode(d);if(1===b)for(c=a.Get_Long(),b=0;b<c&&1===a.Get_Short();b++){this.Add_NewNode(!1,!1);d=a.Get_Long();for(var e=0;e<d;e++){var f=a.Get_Short(),g=a.Get_Long();switch(f){case 16:g=Common_ValuetoXY(a.Get_Long());
this.Add_Move(g.X,g.Y,BOARD_BLACK);break;case 17:g=Common_ValuetoXY(a.Get_Long());this.Add_Move(g.X,g.Y,BOARD_WHITE);break;case 32:case 33:case 34:g=BOARD_BLACK;switch(f){case 32:g=BOARD_BLACK;break;case 33:g=BOARD_WHITE;break;case 34:g=BOARD_EMPTY}f=a.Get_Long();for(var h=[],k=0;k<f;k++)h.push(a.Get_Long());this.AddOrRemove_Stones(g,h);break;default:a.Skip(g)}}a.Get_Short();d=this.Get_CurNode();this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update())}this.GoTo_Node(d,
!0)}else this.GoTo_Node(b,!0)}else if(2===c){c=a.Get_Long();d=b;for(b=0;b<c;b++){e=a.Get_Long();if(0>e||e>=d.Get_NextsCount()||0>=d.Get_NextsCount())break;d=d.Get_Next(e)}this.GoTo_Node(d,!0)}};CGameTree.prototype.Make_CurrentVariantMainly=function(){this.m_oFirstNode.Make_CurrentVariantMainly();this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update(),this.m_oDrawingNavigator.Update_Current(!0))};
CGameTree.prototype.Move_Variant=function(a){this.m_oCurNode.Move_Variant(a);this.m_oDrawingNavigator&&(this.m_oDrawingNavigator.Create_FromGameTree(),this.m_oDrawingNavigator.Update(),this.m_oDrawingNavigator.Update_Current(!0))};CGameTree.prototype.Toggle_Rulers=function(){this.m_oDrawingBoard&&this.m_oDrawingBoard.Set_Rulers(!this.m_oDrawingBoard.Get_Rulers())};CGameTree.prototype.Set_Handler=function(a){this.m_oHandler=a};CGameTree.prototype.Get_Handler=function(){return this.m_oHandler};
CGameTree.prototype.GoTo_NodeById=function(a){a=this.Get_FirstNode().Get_NodeById(a);null!==a&&this.GoTo_Node(a)};CGameTree.prototype.GoTo_NodeByMoveNumber=function(a){a=this.Get_FirstNode().Get_NodeByMoveNumber(a);null!==a&&this.GoTo_Node(a)};CGameTree.prototype.Get_DivHeightByWidth=function(a){return this.m_oDrawing?this.m_oDrawing.Get_DivHeightByWidth(a):0};CGameTree.prototype.Set_Modified=function(a){this.m_bModified=a};CGameTree.prototype.Is_Modified=function(){return this.m_bModified};
CGameTree.prototype.Get_LocalSettings=function(){return this.m_oSettings};CGameTree.prototype.Set_LocalColorScheme=function(a){a=this.m_oSettings.Set_ColorScheme(a);!0===a.Board&&this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Size(!0);this.m_oDrawingNavigator&&!0===a.Navigator&&this.m_oDrawingNavigator.Update_All()};
CGameTree.prototype.Get_LogicBoardForKifu=function(){var a=this.m_bKifuMode;!0===a&&(this.m_bKifuMode=!1);var b=this.Get_CurNode(),c=this.Get_FirstNode();this.GoTo_Node(c);var d=new CKifuLogicBoard;d.Load_FromNode(this.Get_Board(),c);this.GoTo_Node(b);!0===a&&(this.m_bKifuMode=!0);return d};
CGameTree.prototype.Start_KifuMode=function(){this.m_nKifuEditFlags=this.m_nEditingFlags;this.Forbid_All();this.Set_EditingFlags({Move:!0});this.Set_ShowVariants(EShowVariants.None);this.GoTo_MainVariant();this.m_bKifuMode=!0;this.m_oDrawing&&this.m_oDrawing.Update_KifuMode()};CGameTree.prototype.Stop_KifuMode=function(){this.m_nEditingFlags=this.m_nKifuEditFlags;this.m_bKifuMode=!1;this.m_oDrawing&&this.m_oDrawing.Update_KifuMode()};CGameTree.prototype.Is_KifuMode=function(){return this.m_bKifuMode};
CGameTree.prototype.Set_StartNode=function(a){this.m_oStartNode=a};CGameTree.prototype.Get_NodeReference=function(a,b){var c=this.Get_CurNode();b.Make_ThisNodeCurrent();var d=b.Get_Reference(a);c.Make_CurrentVariantMainly();return d};CGameTree.prototype.Is_CurrentMovePass=function(){return this.Get_CurNode().Get_Move().Is_Pass()};function CGifWriter(){this.m_pStream=null;this.m_bFirstFrame=!0;this.m_pColorTable=this.m_pPixels=null;this.m_oColorMap={};this.m_nTranspIndex=0;this.m_sComment=String.fromCharCode(71,101,110,101,114,97,116,101,100,32,98,121,32,103,111,98,97,110,46,111,114,103);this.m_nDelay=0;this.m_pIndexedPixels=null;this.m_nFrameIndex=this.m_nRepeat=this.m_nH=this.m_nW=0}
CGifWriter.prototype.Add_ContextFrame=function(a,b,c,d,e,f){this.m_bFirstFrame&&(this.m_nW=a.canvas.width,this.m_nH=a.canvas.height);this.m_pPixels=a.getImageData(0,0,a.canvas.width,a.canvas.height).data;this.private_IndexPixels(b,c,d,e,f);this.m_bFirstFrame&&(this.private_WriteLogicalScreenDescriptor(),this.private_WriteColorTable(),this.private_WriteAppExt(),this.private_WriteCommentExt());this.private_WriteGraphicControlExt();this.private_WriteImageDescriptor(b,c,d,e);this.private_WriteFrame();
this.m_bFirstFrame=!1;console.log("Frame "+this.m_nFrameIndex);this.m_nFrameIndex++};CGifWriter.prototype.Set_Delay=function(a){this.m_nDelay=Math.floor(a/10)};CGifWriter.prototype.Start=function(){this.m_pStream=new CStreamWriter;this.m_pStream.Write_String("GIF89a")};CGifWriter.prototype.Finish=function(){this.m_pStream.Write_Byte(59)};CGifWriter.prototype.Get_Stream=function(){return this.m_pStream};
CGifWriter.prototype.private_IndexPixels=function(a,b,c,d,e){this.m_bFirstFrame&&this.private_LoadColorTableFromString("ff0000e0b65ce0b65ce0b65ce0b65ce0b75ce0b75ce1b75ce0b75ce0b75de1b75de1b75de1b85de2b85de2b85de2b85de2b85de3b85de3b85de3b95de3b95de3b95de3b95ee3b95ee3b95ee4b95ee4ba5ee4ba5ee4ba5ee4ba5ee5ba5ee5ba5ee5ba5ee5ba5ee5bb5ee5bb5ee5ba5ee5bb5ee5bb5ee5ba5ee5ba5fe1bc6dddbc75e1bb6ae4bb64e5bb5fe6bb5fe6bb5fe6bb5ee6bb5ee6bb5fe6bb5edeb65cdeb55cdfb55cdeb55cdeb55bdeb45bddb45bddb45bddb45bddb35bddb35bdcb35bdcb35bdbb35ddcb35adcb35adbb35adbb25adbb25adab25adab25adab15ad9b15ad9b15adab159d9b159d9b159d9b059d9b059d8b059d8b059d8af58d8b059d7b059d7af59d7af58d7af58d7ae58d6af58d6ae58d6ae58d5ae58d5ae58d5ae58d4ae5ad4ad58d5ad57d5ad57d4ad57d4ad57d4ac57d3ac57d4ac57d4ac57d3ac57d3ac57d3ac57d2ac57d2ac57d3ab56d2ab56d2ab56d2ab56d2ab56d2aa56d1aa56d1aa56d1aa56d1aa55d0aa55cfa956d0a955cfa855cfa855cba554c9a65bbea87ac5b38cd5c197cdc4b0e2d0aaead6abeed9adf1dcaef3ddaff3ddaffaf0dbfefefefdfdfdfafafaf8f8f8f5f5f5f1f1f1eeeeeeebebebe8e8e8e4e4e4e1e1e1dedededadadad6d6d6d3d3d3d0d0d0d0d0d0cfcfcfcecececececdcdcdcdcdcdcccfccc5cccbcbcacacacacac9c8c8c8cac8c3c7c7c7c6c6c5c4c4c4c3c3c2c2c1c1c0c0c0bfbebebdbdbdbbbbbab3b3b2bcb6a9b4ad9da7a49d9c9c9c9494948e8e8e8888888282827c7c7c7474746e6e6e6767677b756aa39370b99a59c29e50c09c4ebc994db9964bb6944ab29149af8e48ac8b47a88945a68744a28443a082429d7f40997c3f967a3d91753b876e387a6434735d2f6f5b2e6b572c64522a6359435e5e5e5757575050504a4a4a404040363636413c31524324423821352d1a2c2c2c2725212222221f1d191c171016161413131212121112111111111111111011101010101010100f0f0f0f0f0f0f0f0e0e0e0e0d0d0d0d0d0d0d0c0c0b0b0b0a0909090d0a07640909ef02023e0000000000000000000000000000");this.m_pIndexedPixels=
[];for(var f=this.m_oColorMap,g=this.m_pPixels,h=b;h<b+d;h++)for(var k=a;k<a+c;k++){var l=k-a+(h-b)*c;if(!0===this.private_IsPointInFrameAreas(k,h,e)){var m=4*(k+h*this.m_nW),n=g[m+0]&255,p=g[m+1]&255;m=g[m+2]&255;var q=n<<16|p<<8|m;void 0===f[q]&&(f[q]=this.private_FindBestColorIndex(n,p,m));this.m_pIndexedPixels[l]=f[q]}else this.m_pIndexedPixels[l]=this.m_nTranspIndex}};
CGifWriter.prototype.private_IsPointInFrameAreas=function(a,b,c){for(var d=0,e=c.length;d<e;d++){var f=c[d];if(a>=f.X0&&a<=f.X1&&b>=f.Y0&&b<=f.Y1)return!0}return!1};CGifWriter.prototype.private_FindBestColorIndex=function(a,b,c){for(var d=this.m_pColorTable,e=0,f=16777216,g=1;256>g;g++){var h=3*g,k=a-(d[h+0]&255),l=b-(d[h+1]&255);h=c-(d[h+2]&255);k=k*k+l*l+h*h;k<f&&(f=k,e=g)}return e};
CGifWriter.prototype.private_WriteLogicalScreenDescriptor=function(){this.m_pStream.Write_Short(this.m_nW);this.m_pStream.Write_Short(this.m_nH);this.m_pStream.Write_Byte(247);this.m_pStream.Write_Byte(0);this.m_pStream.Write_Byte(0)};CGifWriter.prototype.private_WriteColorTable=function(){this.m_pStream.Write_Bytes(this.m_pColorTable);for(var a=768-this.m_pColorTable.length,b=0;b<a;b++)this.m_pStream.Write_Byte(0)};
CGifWriter.prototype.private_WriteAppExt=function(){this.m_pStream.Write_Byte(33);this.m_pStream.Write_Byte(255);this.m_pStream.Write_Byte(11);this.m_pStream.Write_String("NETSCAPE2.0");this.m_pStream.Write_Byte(3);this.m_pStream.Write_Byte(1);this.m_pStream.Write_Short(this.m_nRepeat);this.m_pStream.Write_Byte(0)};
CGifWriter.prototype.private_WriteGraphicControlExt=function(){this.m_pStream.Write_Byte(33);this.m_pStream.Write_Byte(249);this.m_pStream.Write_Byte(4);this.m_pStream.Write_Byte(5);this.m_pStream.Write_Short(this.m_nDelay);this.m_pStream.Write_Byte(this.m_nTranspIndex);this.m_pStream.Write_Byte(0)};
CGifWriter.prototype.private_WriteCommentExt=function(){this.m_pStream.Write_Byte(33);this.m_pStream.Write_Byte(254);this.m_pStream.Write_Byte(this.m_sComment.length);this.m_pStream.Write_String(this.m_sComment);this.m_pStream.Write_Byte(0)};
CGifWriter.prototype.private_WriteImageDescriptor=function(a,b,c,d){this.m_pStream.Write_Byte(44);this.m_pStream.Write_Short(void 0!==a?a:0);this.m_pStream.Write_Short(void 0!==b?b:0);this.m_pStream.Write_Short(void 0!==c?c:this.m_nW);this.m_pStream.Write_Short(void 0!==d?d:this.m_nH);this.m_pStream.Write_Byte(0)};CGifWriter.prototype.private_WriteFrame=function(){(new CLZWEncoder(this.m_nW,this.m_nH,this.m_pIndexedPixels,8)).Encode(this.m_pStream)};
CGifWriter.prototype.private_LoadColorTableFromString=function(a){if(1536===a.length){this.m_pColorTable=Array(768);for(var b=0,c=0;768>b;b+=3,c+=6)this.m_pColorTable[b+0]=parseInt(a[c+0]+a[c+1],16),this.m_pColorTable[b+1]=parseInt(a[c+2]+a[c+3],16),this.m_pColorTable[b+2]=parseInt(a[c+4]+a[c+5],16)}};var LZW_EOF=-1,LZW_HASHSIZE=5003,LZW_BITS=12,LZW_MAXBITS=LZW_BITS,LZW_MAXCODE=1<<LZW_BITS;
function CLZWEncoder(a,b,c,d){this.m_nW=a;this.m_nH=b;this.m_pData=c;this.m_nInitCodeSize=Math.max(2,d);this.m_nCurPixel=this.m_nRemaining=0;this.m_aHashTable=[];this.m_nInitBits=0;this.m_bClear=!1;this.m_nCurBits=this.m_nCurAccum=this.m_nFreeEntry=this.m_nEofCode=this.m_nMaxCode=this.m_nBits=0;this.m_aMasks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];this.m_nCount=0;this.m_aAccum=[]}
CLZWEncoder.prototype.Encode=function(a){a.Write_Byte(this.m_nInitCodeSize);this.m_nRemaining=this.m_nW*this.m_nH;this.m_nCurPixel=0;this.private_Compress(this.m_nInitCodeSize+1,a);a.Write_Byte(0)};
CLZWEncoder.prototype.private_Compress=function(a,b){this.m_nInitBits=a;this.m_bClear=!1;this.m_nBits=a;this.m_nMaxCode=this.private_MaxCode(this.m_nBits);var c=1<<a-1;this.m_nEofCode=c+1;this.m_nFreeEntry=c+2;this.m_nCount=0;var d=this.private_GetNextPixel(),e=0,f;for(f=LZW_HASHSIZE;65536>f;f*=2)++e;e=8-e;var g=LZW_HASHSIZE;this.private_ClearHash(g);this.private_Output(c,b);for(var h,k=[];LZW_EOF!==(h=this.private_GetNextPixel());){f=(h<<LZW_MAXBITS)+d;var l=h<<e^d;if(f===this.m_aHashTable[l])d=
k[l];else{if(0<=this.m_aHashTable[l]){var m=g-l,n=!1;0===l&&(m=1);do if(0>(l-=m)&&(l+=g),f===this.m_aHashTable[l]){d=k[l];n=!0;break}while(0<=this.m_aHashTable[l]);if(n)continue}this.private_Output(d,b);d=h;this.m_nFreeEntry<LZW_MAXCODE?(k[l]=this.m_nFreeEntry++,this.m_aHashTable[l]=f):(this.private_ClearHash(LZW_HASHSIZE),this.m_nFreeEntry=c+2,this.m_bClear=!0,this.private_Output(c,b))}}this.private_Output(d,b);this.private_Output(this.m_nEofCode,b)};
CLZWEncoder.prototype.private_MaxCode=function(a){return(1<<a)-1};CLZWEncoder.prototype.private_GetNextPixel=function(){if(0===this.m_nRemaining)return LZW_EOF;--this.m_nRemaining;return this.m_pData[this.m_nCurPixel++]&255};CLZWEncoder.prototype.private_ClearHash=function(a){for(var b=0;b<a;b++)this.m_aHashTable[b]=-1};
CLZWEncoder.prototype.private_Output=function(a,b){this.m_nCurAccum&=this.m_aMasks[this.m_nCurBits];this.m_nCurAccum=0<this.m_nCurBits?this.m_nCurAccum|a<<this.m_nCurBits:a;for(this.m_nCurBits+=this.m_nBits;8<=this.m_nCurBits;)this.private_CharOut(this.m_nCurAccum&255,b),this.m_nCurAccum>>=8,this.m_nCurBits-=8;if(this.m_nFreeEntry>this.m_nMaxCode||this.m_bClear)this.m_bClear?(this.m_nBits=this.m_nInitBits,this.m_nMaxCode=this.private_MaxCode(this.m_nBits),this.m_bClear=!1):(this.m_nBits++,this.m_nMaxCode=
this.m_nBits==LZW_MAXBITS?LZW_MAXCODE:this.private_MaxCode(this.m_nBits));if(a===this.m_nEofCode){for(;0<this.m_nCurBits;)this.private_CharOut(this.m_nCurAccum&255,b),this.m_nCurAccum>>=8,this.m_nCurBits-=8;this.private_FlushChar(b)}};CLZWEncoder.prototype.private_CharOut=function(a,b){this.m_aAccum[this.m_nCount++]=a;254<=this.m_nCount&&this.private_FlushChar(b)};
CLZWEncoder.prototype.private_FlushChar=function(a){0<this.m_nCount&&(a.Write_Byte(this.m_nCount),a.Write_Bytes(this.m_aAccum,0,this.m_nCount),this.m_nCount=0)};"use strict;";function CBoardKo(){this.m_nCaptured=this.m_nMove=0}CBoardKo.prototype.Reset=function(){this.m_nCaptured=this.m_nMove=0};CBoardKo.prototype.Copy=function(){var a=new CBoardKo;a.CopyFrom(this);return a};CBoardKo.prototype.CopyFrom=function(a){this.m_nMove=a.m_nMove;this.m_nCaptured=a.m_nCaptured};CBoardKo.prototype.Check=function(a,b){return b===this.m_nMove&&a===this.m_nCaptured?!0:!1};CBoardKo.prototype.Set=function(a,b){this.m_nMove=a;this.m_nCaptured=b};
function CBoardPoint(a,b){this.m_eValue=void 0===a?BOARD_EMPTY:a;this.m_nNum=void 0===b?-1:b}CBoardPoint.prototype.CopyFrom=function(a){this.m_eValue=a.m_eValue;this.m_nNum=a.m_nNum};CBoardPoint.prototype.Clear=function(){this.m_eValue=BOARD_EMPTY;this.m_nNum=-1};CBoardPoint.prototype.Set_Value=function(a){this.m_eValue=a};CBoardPoint.prototype.Set_Num=function(a){this.m_nNum=a};CBoardPoint.prototype.Get_Value=function(){return this.m_eValue};CBoardPoint.prototype.Get_Num=function(){return this.m_nNum};
function CDeadGroupChecker(){this.m_aCurrentGroup=[];this.m_aSavedGroup=[]}CDeadGroupChecker.prototype.Reset_Current=function(){this.m_aCurrentGroup=[]};CDeadGroupChecker.prototype.Save_Current=function(){this.m_aSavedGroup=this.m_aSavedGroup.concat(this.m_aCurrentGroup);this.m_aCurrentGroup=[]};CDeadGroupChecker.prototype.Get_Size=function(){return this.m_aSavedGroup.length};CDeadGroupChecker.prototype.Get_Value=function(a){return this.m_aSavedGroup[a]};
CDeadGroupChecker.prototype.Is_StoneInCurrentGroup=function(a,b){for(var c=Common_XYtoValue(a,b),d=0,e=this.m_aCurrentGroup.length;d<e;d++)if(this.m_aCurrentGroup[d]==c)return!0;this.m_aCurrentGroup.push(c);return!1};CDeadGroupChecker.prototype.Is_StoneInSavedGroup=function(a,b){for(var c=Common_XYtoValue(a,b),d=0,e=this.m_aSavedGroup.length;d<e;d++)if(this.m_aSavedGroup[d]==c)return!0;return!1};function CBoundaryScoreCounter(){this.m_aPoints={}}
CBoundaryScoreCounter.prototype.Clear=function(){this.m_aPoints={}};CBoundaryScoreCounter.prototype.Is_PointIn=function(a,b){var c=Common_XYtoValue(a,b);if(void 0!==this.m_aPoints[c])return!0;this.m_aPoints[c]=1;return!1};CBoundaryScoreCounter.prototype.Remove=function(a,b){var c=Common_XYtoValue(a,b);void 0!==this.m_aPoints[c]&&delete this.m_aPoints[c]};function CLogicGroup(){this.m_oStones={};this.m_nValue=null}
CLogicGroup.prototype.Is_PointIn=function(a,b,c){if(BOARD_EMPTY===c)return null;a=Common_XYtoValue(a,b);if(null===this.m_nValue)return this.m_nValue=c,this.m_oStones[a]=1,!1;if(c!==this.m_nValue)return null;if(void 0!==this.m_oStones[a])return!0;this.m_oStones[a]=1;return!1};CLogicGroup.prototype.Get_PointsArray=function(){var a=[],b;for(b in this.m_oStones)a.push(b);return a};CLogicGroup.prototype.Get_Value=function(){return this.m_nValue};
function CAreaScoreCounter(){this.m_oArea={};this.m_nOwner=BOARD_EMPTY}CAreaScoreCounter.prototype.Clear=function(){this.m_oArea={};this.m_nOwner=BOARD_EMPTY};CAreaScoreCounter.prototype.Is_PointIn=function(a,b){var c=Common_XYtoValue(a,b);if(void 0!==this.m_oArea[c])return!0;this.m_oArea[c]=1;return!1};CAreaScoreCounter.prototype.Set_Owner=function(a){this.m_nOwner=a};CAreaScoreCounter.prototype.Get_Owner=function(){return this.m_nOwner};
CAreaScoreCounter.prototype.Update_Board=function(a,b){var c=void 0===b?this.m_nOwner:b,d;for(d in this.m_oArea){var e=Common_ValuetoXY(d|0);a.Set_ScorePoint(e.X,e.Y,c)}};function CLogicBoard(a,b){this.m_nW=void 0===a?19:a;this.m_nH=void 0===b?19:b;this.m_aBoard=null;this.private_InitBoard();this.m_oKo=new CBoardKo;this.m_aBoardScores=[];this.m_oArea=new CAreaScoreCounter;this.m_oBoundary=new CBoundaryScoreCounter}
CLogicBoard.prototype.Copy=function(){for(var a=new CLogicBoard(this.m_nW,this.m_nH),b=0,c=this.m_aBoard.length;b<c;b++)a.m_aBoard[b].CopyFrom(this.m_aBoard[b]);a.m_oKo.CopyFrom(this.m_oKo);return a};CLogicBoard.prototype.Clear=function(){for(var a=this.m_nW*this.m_nH,b=0;b<a;b++)this.m_aBoard[b].Clear()};CLogicBoard.prototype.Get_Ko=function(){return this.m_oKo.Copy()};CLogicBoard.prototype.Set_Ko=function(a){this.m_oKo.CopyFrom(a)};CLogicBoard.prototype.Reset_Ko=function(){this.m_oKo.Reset()};
CLogicBoard.prototype.Reset_Size=function(a,b){this.m_nW=a;this.m_nH=b;this.private_InitBoard();this.m_oKo.Reset()};CLogicBoard.prototype.Get_Size=function(){return{X:this.m_nW,Y:this.m_nH}};CLogicBoard.prototype.Set=function(a,b,c,d){a=this.private_GetPos(a,b);this.m_aBoard[a].Set_Value(c);void 0!==d&&null!==d&&-1!==d&&this.m_aBoard[a].Set_Num(d)};CLogicBoard.prototype.Get=function(a,b){return this.m_aBoard[this.private_GetPos(a,b)].Get_Value()};
CLogicBoard.prototype.Get_Num=function(a,b){return this.m_aBoard[this.private_GetPos(a,b)].Get_Num()};CLogicBoard.prototype.Get_HandiPoints=function(){for(var a=[],b=this.private_GetLineHandiPoints(this.m_nW),c=this.private_GetLineHandiPoints(this.m_nH),d=0;d<b.length;d++)for(var e=0;e<c.length;e++)a.push([b[d],c[e]]);(9!=this.m_nW&&11!=this.m_nW||1!=this.m_nH%2)&&(9!=this.m_nH&&11!=this.m_nH||1!=this.m_nW%2)||a.push([(this.m_nW-1)/2,(this.m_nH-1)/2]);return a};
CLogicBoard.prototype.private_GetLineHandiPoints=function(a){var b=[];5==a?b=[2]:7==a?b=[3]:8==a?b=[2,5]:9==a?b=[2,6]:10==a?b=[3,6]:11==a?b=[3,7]:12<=a&&(b=1==a%2?[3,(a-1)/2,a-4]:[3,a-4]);return b};CLogicBoard.prototype.Is_HandiPoint=function(a,b){if(this.m_nW===this.m_nH)for(var c=this.Get_HandiPoints(),d=0,e=c.length;d<e;d++)if(a-1===c[d][0]&&b-1===c[d][1])return!0;return!1};
CLogicBoard.prototype.Check_Dead=function(a,b,c){var d=new CDeadGroupChecker;this.private_CheckDead(a,b,c,d);return 0<d.Get_Size()?d:null};
CLogicBoard.prototype.Check_Kill=function(a,b,c,d){switch(c){case BOARD_BLACK:var e=BOARD_WHITE;break;case BOARD_WHITE:e=BOARD_BLACK;break;default:return null}c=new CDeadGroupChecker;!0!==c.Is_StoneInSavedGroup(a+1,b)&&this.private_CheckDead(a+1,b,e,c);!0!==c.Is_StoneInSavedGroup(a-1,b)&&this.private_CheckDead(a-1,b,e,c);!0!==c.Is_StoneInSavedGroup(a,b+1)&&this.private_CheckDead(a,b+1,e,c);!0!==c.Is_StoneInSavedGroup(a,b-1)&&this.private_CheckDead(a,b-1,e,c);e=c.Get_Size();if(1==e){a=Common_XYtoValue(a,
b);b=c.Get_Value(0);if(this.m_oKo.Check(a,b)&&1==d)return null;this.m_oKo.Set(a,b)}else if(1<e)this.m_oKo.Reset();else if(0>=e)return null;return c};CLogicBoard.prototype.private_InitBoard=function(){var a=this.m_nW*this.m_nH;this.m_aBoard=Array(a);for(var b=0;b<a;b++)this.m_aBoard[b]=new CBoardPoint};CLogicBoard.prototype.private_GetPos=function(a,b){return(b-1)*this.m_nW+(a-1)};
CLogicBoard.prototype.private_IsDame=function(a,b,c,d){if(a>this.m_nW||1>a||b>this.m_nH||1>b)return!1;var e=this.Get(a,b);return BOARD_EMPTY===e?!0:c===e?this.private_CheckDame(a,b,c,d):!1};CLogicBoard.prototype.private_CheckDame=function(a,b,c,d){return!0===d.Is_StoneInCurrentGroup(a,b)?!1:!0===this.private_IsDame(a+1,b,c,d)||!0===this.private_IsDame(a-1,b,c,d)||!0===this.private_IsDame(a,b+1,c,d)||!0===this.private_IsDame(a,b-1,c,d)?!0:!1};
CLogicBoard.prototype.private_CheckDead=function(a,b,c,d){if(a>this.m_nW||1>a||b>this.m_nH||1>b||c!==this.Get(a,b))return 0;if(!0===this.private_CheckDame(a,b,c,d))return d.Reset_Current(),!1;d.Save_Current();return!0};CLogicBoard.prototype.Clear_Scores=function(){this.m_aBoardScores=[]};CLogicBoard.prototype.Init_CountScores=function(a){this.m_aBoardScores=[];for(var b=1;b<=this.m_nH;b++)for(var c=1;c<=this.m_nW;c++)this.m_aBoardScores[this.private_GetPos(c,b)]=BOARD_EMPTY;!0!==a&&this.private_CheckAllEmptyAreas(!1)};
CLogicBoard.prototype.Set_ScorePoint=function(a,b,c){this.m_aBoardScores[this.private_GetPos(a,b)]=c};CLogicBoard.prototype.Get_ScorePoint=function(a,b){return this.m_aBoardScores[this.private_GetPos(a,b)]};
CLogicBoard.prototype.Count_Scores=function(a){for(var b=0,c=0,d=1;d<=this.m_nH;d++)for(var e=1;e<=this.m_nW;e++){var f=null,g=this.Get_ScorePoint(e,d);BOARD_BLACK===g?(f=new CDrawingMark(e,d,EDrawingMark.Tb,""),BOARD_WHITE===this.Get(e,d)?b+=2:b++):BOARD_WHITE===g&&(f=new CDrawingMark(e,d,EDrawingMark.Tw,""),BOARD_BLACK===this.Get(e,d)?c+=2:c++);null===f?a.Remove_Mark(e,d):a.Add_Mark(f)}return{Black:b,White:c}};
CLogicBoard.prototype.Select_DeadGroup=function(a,b){var c=this.Get(a,b);if(BOARD_EMPTY!==c){this.m_oBoundary.Clear();var d=this.Get_ScorePoint(a,b);if(BOARD_BLACK!==d&&BOARD_WHITE!==d){this.m_oArea.Clear();this.private_CheckBoundary(a,b,c);for(var e in this.m_oBoundary.m_aPoints)d=Common_ValuetoXY(e|0),this.m_oArea.Clear(),this.private_CheckEmptyAreaByXYAndValue(d.X,d.Y,BOARD_DRAW-c),this.m_oArea.Update_Board(this,BOARD_DRAW);this.private_CheckAllEmptyAreas(!0);this.m_oArea.Clear();this.private_CheckBoundary(a,
b,c);this.m_oArea.Update_Board(this,BOARD_DRAW-c)}else this.m_oArea.Clear(),this.private_CheckBoundary(a,b,c),this.m_oArea.Update_Board(this,BOARD_DRAW),this.private_CheckAllEmptyAreas(!0)}};
CLogicBoard.prototype.private_CheckEmptyAreaByXY=function(a,b){if(!(a>this.m_nW||1>a||b>this.m_nH||1>b)){var c=this.Get(a,b);if(BOARD_EMPTY!==this.Get(a,b)){var d=this.m_oArea.Get_Owner();switch(d){case BOARD_EMPTY:this.m_oArea.Set_Owner(c);break;case BOARD_BLACK:case BOARD_WHITE:d!==c&&this.m_oArea.Set_Owner(BOARD_DRAW)}}else!1===this.m_oArea.Is_PointIn(a,b)&&(this.private_CheckEmptyAreaByXY(a+1,b),this.private_CheckEmptyAreaByXY(a-1,b),this.private_CheckEmptyAreaByXY(a,b+1),this.private_CheckEmptyAreaByXY(a,
b-1))}};CLogicBoard.prototype.private_CheckBoundary=function(a,b,c){a>this.m_nW||1>a||b>this.m_nH||1>b||(BOARD_DRAW-c===this.Get(a,b)?c===this.Get_ScorePoint(a,b)&&this.m_oBoundary.Is_PointIn(a,b):!0!==this.m_oArea.Is_PointIn(a,b)&&(this.private_CheckBoundary(a+1,b,c),this.private_CheckBoundary(a-1,b,c),this.private_CheckBoundary(a,b+1,c),this.private_CheckBoundary(a,b-1,c)))};
CLogicBoard.prototype.private_CheckEmptyAreaByXYAndValue=function(a,b,c){a>this.m_nW||1>a||b>this.m_nH||1>b||BOARD_DRAW-c===this.Get(a,b)||(c===this.Get(a,b)&&this.m_oBoundary.Remove(a,b),!0!==this.m_oArea.Is_PointIn(a,b)&&(this.private_CheckEmptyAreaByXYAndValue(a+1,b,c),this.private_CheckEmptyAreaByXYAndValue(a-1,b,c),this.private_CheckEmptyAreaByXYAndValue(a,b+1,c),this.private_CheckEmptyAreaByXYAndValue(a,b-1,c)))};
CLogicBoard.prototype.private_CheckAllEmptyAreas=function(a){for(var b=1;b<=this.m_nH;b++)for(var c=1;c<=this.m_nW;c++)BOARD_EMPTY===this.Get(c,b)&&(BOARD_EMPTY===this.Get_ScorePoint(c,b)||!0===a&&BOARD_DRAW===this.Get_ScorePoint(c,b))&&(this.m_oArea.Clear(),this.private_CheckEmptyAreaByXY(c,b),this.m_oArea.Update_Board(this))};CLogicBoard.prototype.Init_ScoreEstimate=function(){this.private_InitScoreEstimate()};
CLogicBoard.prototype.Estimate_Scores=function(a){this.private_EstimateScores();for(var b=0;5>b;b++)this.private_MakeDilation();for(b=0;3>b;b++)this.private_MakeErosion();var c=0,d=0;for(b=1;b<=this.m_nH;b++)for(var e=1;e<=this.m_nW;e++){var f=null,g=this.m_aScoreEstimate[b][e];0<g&&BOARD_BLACK!==this.Get(e,b)?(f=new CDrawingMark(e,b,EDrawingMark.Tb,""),BOARD_WHITE===this.Get(e,b)?c+=2:c++):0>g&&BOARD_WHITE!==this.Get(e,b)&&(f=new CDrawingMark(e,b,EDrawingMark.Tw,""),BOARD_BLACK===this.Get(e,b)?d+=
2:d++);null===f?a.Remove_Mark(e,b):a.Add_Mark(f)}for(b=0;23>b;b++)this.private_MakeErosion();var h=0,k=0;for(b=1;b<=this.m_nH;b++)for(e=1;e<=this.m_nW;e++)f=null,g=this.m_aScoreEstimate[b][e],0<g&&BOARD_BLACK!==this.Get(e,b)?(f=new CDrawingMark(e,b,EDrawingMark.Tb2,""),BOARD_WHITE===this.Get(e,b)?h+=2:h++):0>g&&BOARD_WHITE!==this.Get(e,b)&&(f=new CDrawingMark(e,b,EDrawingMark.Tw2,""),BOARD_BLACK===this.Get(e,b)?k+=2:k++),null!==f&&a.Add_Mark(f);return{BlackReal:h,BlackPotential:c,WhiteReal:k,WhitePotential:d}};
CLogicBoard.prototype.private_GetGroup=function(a,b){var c=new CLogicGroup;this.private_GetGroupIteration(a,b,c);return c};
CLogicBoard.prototype.private_GetGroupIteration=function(a,b,c){1>a||a>this.m_nW||1>b||b>this.m_nH||!1!==c.Is_PointIn(a,b,this.Get(a,b))||(this.private_GetGroupIteration(a+1,b,c),this.private_GetGroupIteration(a-1,b,c),this.private_GetGroupIteration(a,b+1,c),this.private_GetGroupIteration(a,b-1,c),1<a&&1<b&&BOARD_EMPTY===this.Get(a-1,b)&&BOARD_EMPTY===this.Get(a,b-1)&&this.private_GetGroupIteration(a-1,b-1,c),a<this.m_nW&&1<b&&BOARD_EMPTY===this.Get(a+1,b)&&BOARD_EMPTY===this.Get(a,b-1)&&this.private_GetGroupIteration(a+
1,b-1,c),a<this.m_nW&&b<this.m_nH&&BOARD_EMPTY===this.Get(a+1,b)&&BOARD_EMPTY===this.Get(a,b+1)&&this.private_GetGroupIteration(a+1,b+1,c),1<a&&b<this.m_nH&&BOARD_EMPTY===this.Get(a-1,b)&&BOARD_EMPTY===this.Get(a,b+1)&&this.private_GetGroupIteration(a-1,b+1,c))};
CLogicBoard.prototype.Mark_DeadGroupForEstimate=function(a,b){var c=this.Get(a,b);if(BOARD_EMPTY!==c){var d=this.private_GetGroup(a,b).Get_PointsArray();c=this.Get_SE(a,b)!==c?c:BOARD_BLACK===c?BOARD_WHITE:BOARD_BLACK;for(var e=0,f=d.length;e<f;e++){var g=Common_ValuetoXY(d[e]);this.Set_SE(g.X,g.Y,c)}}};CLogicBoard.prototype.Get_SE=function(a,b){return void 0===this.m_aBoardSE||void 0===this.m_aBoardSE[b]||void 0===this.m_aBoardSE[b][a]?BOARD_EMPTY:this.m_aBoardSE[b][a]};
CLogicBoard.prototype.Set_SE=function(a,b,c){void 0===this.m_aBoardSE&&(this.m_aBoardSE=[]);void 0===this.m_aBoardSE[b]&&(this.m_aBoardSE[b]=[]);this.m_aBoardSE[b][a]=c};CLogicBoard.prototype.private_InitScoreEstimate=function(){for(var a=1;a<=this.m_nH;a++)for(var b=1;b<=this.m_nW;b++)this.Set_SE(b,a,this.Get(b,a))};
CLogicBoard.prototype.private_EstimateScores=function(){this.m_aScoreEstimate=[];for(var a=0;a<=this.m_nH+1;a++){this.m_aScoreEstimate[a]=[];for(var b=0;b<=this.m_nW+1;b++)if(0===b||this.m_nW+1===b||0===a||this.m_nH+1===a){this.m_aScoreEstimate[a][b]=0;var c=this.private_GetNearestStones(b,a),d=c.Stones.length;if(0<d){for(var e=!1,f=!1,g=0;g<d;g++)BOARD_BLACK===c.Stones[g].Value&&(f=!0),BOARD_WHITE===c.Stones[g].Value&&(e=!0);if(!0!==e||!0!==f)this.m_aScoreEstimate[a][b]=e?-128:128}}else c=this.Get_SE(b,
a),this.m_aScoreEstimate[a][b]=BOARD_BLACK===c?128:BOARD_WHITE===c?-128:0}};CLogicBoard.prototype.private_GetNearestStones=function(a,b){for(var c=100,d=[],e=a-4;e<=a+4;e++)for(var f=b-4;f<=b+4;f++)if(!(1>e||e>this.m_nW||1>f||f>this.m_nH||4<Math.abs(a-e)+Math.abs(b-f))){var g=this.Get_SE(e,f);if(BOARD_EMPTY!==g){var h=Math.abs(a-e)+Math.abs(b-f);h<c?(c=h,d=[],d.push({X:e,Y:f,Value:g})):h===c&&d.push({X:e,Y:f,Value:g})}}return{Stones:d,Diff:c}};
CLogicBoard.prototype.private_MakeDilation=function(){for(var a=[],b=0;b<=this.m_nH+1;b++){a[b]=[];for(var c=0;c<=this.m_nW+1;c++){var d=[];d[0]=0<c?this.m_aScoreEstimate[b][c-1]:0;d[1]=c<this.m_nW+1?this.m_aScoreEstimate[b][c+1]:0;d[2]=0<b?this.m_aScoreEstimate[b-1][c]:0;d[3]=b<this.m_nH+1?this.m_aScoreEstimate[b+1][c]:0;for(var e=0,f=!1,g=!1,h=0;4>h;h++)0<d[h]?(f=!0,e++):0>d[h]&&(g=!0,e--);d=this.m_aScoreEstimate[b][c];a[b][c]=0<=d&&!1===g||0>=d&&!1===f?d+e:d}}this.m_aScoreEstimate=a};
CLogicBoard.prototype.private_MakeErosion=function(){for(var a=[],b=0;b<=this.m_nH+1;b++){a[b]=[];for(var c=0;c<=this.m_nW+1;c++){var d=[];d[0]=0<c?this.m_aScoreEstimate[b][c-1]:null;d[1]=c<this.m_nW+1?this.m_aScoreEstimate[b][c+1]:null;d[2]=0<b?this.m_aScoreEstimate[b-1][c]:null;d[3]=b<this.m_nH+1?this.m_aScoreEstimate[b+1][c]:null;for(var e=0,f=0,g=0;4>g;g++)null!==d[g]&&(0<=d[g]&&e++,0>=d[g]&&f--);d=this.m_aScoreEstimate[b][c];a[b][c]=0<d&&0!==f?Math.max(d+f,0):0>d&&0!==e?Math.min(d+e,0):d}}this.m_aScoreEstimate=
a};function CKifuLogicBoard(){CKifuLogicBoard.superclass.constructor.call(this,1,1);this.m_aRepetitions=null}CommonExtend(CKifuLogicBoard,CLogicBoard);
CKifuLogicBoard.prototype.Load_FromNode=function(a,b){this.m_nW=a.m_nW;this.m_nH=a.m_nH;this.m_aBoard=null;this.private_InitBoard();for(var c=0,d=0,e=this.m_aBoard.length;d<e;d++)this.m_aBoard[d].CopyFrom(a.m_aBoard[d]),c<this.m_aBoard[d].Get_Num()&&(c=this.m_aBoard[d].Get_Num()),this.m_aBoard[d].Set_Num(-1);for(;0<b.Get_NextsCount();){b=b.Get_Next(b.Get_NextCur());e=b.Get_CommandsCount();for(var f=0;f<e;f++){var g=b.Get_Command(f);d=g.Get_Type();var h=g.Get_Value();g=g.Get_Count();switch(d){case ECommand.B:this.Add_ToKifu(h,
BOARD_BLACK,++c);break;case ECommand.W:this.Add_ToKifu(h,BOARD_WHITE,++c);break;case ECommand.AB:for(d=0;d<g;d++)this.Add_ToKifu(h[d],BOARD_BLACK,-1);break;case ECommand.AW:for(d=0;d<g;d++)this.Add_ToKifu(h[d],BOARD_WHITE,-1);break;case ECommand.AE:for(d=0;d<g;d++)this.Add_ToKifu(h[d],BOARD_EMPTY,-1)}}}};
CKifuLogicBoard.prototype.Add_ToKifu=function(a,b,c){if(!(0>=a)){a=Common_ValuetoXY(a);var d=this.Get(a.X,a.Y);if(BOARD_EMPTY!==d){if(-1!==c){var e=this.private_GetPos(a.X,a.Y);this.m_aRepetitions&&void 0!==this.m_aRepetitions.length||(this.m_aRepetitions=[]);for(var f=0,g=this.m_aRepetitions.length;f<g;++f)if(e===this.m_aRepetitions[f].nPosValue){this.m_aRepetitions[f].aReps.push({nValue:b,nMoveNumber:c});return}this.m_aRepetitions.push({nPosValue:e,nValue:d,nMoveNumber:this.Get_Num(a.X,a.Y),aReps:[{nValue:b,
nMoveNumber:c}]})}}else this.Set(a.X,a.Y,b,c)}};function CStreamWriter(){this.m_pImageData=this.m_pData=null;this.m_nPos=this.m_nLength=0;this.Init()}CStreamWriter.prototype.Init=function(){var a=document.createElement("canvas").getContext("2d");this.m_nLength=5242880;this.m_pImageData=a.createImageData(this.m_nLength/4,1);this.m_pData=this.m_pImageData.data;this.m_nPos=0};
CStreamWriter.prototype.private_CheckSize=function(a){if(this.m_nPos+a>=this.m_nLength){var b=document.createElement("canvas").getContext("2d");a=this.m_pData;this.m_nLength*=2;this.m_pImageData=b.createImageData(this.m_nLength/4,1);b=this.m_pData=this.m_pImageData.data;for(var c=0;c<this.m_pPos;c++)b[c]=a[c]}};CStreamWriter.prototype.Get_Bytes=function(){for(var a=new Uint8Array(this.m_nPos),b=0;b<this.m_nPos;b++)a[b]=this.m_pData[b];return a};CStreamWriter.prototype.Get_CurPosition=function(){return this.m_nPos};
CStreamWriter.prototype.Seek=function(a){this.m_nPos=a};CStreamWriter.prototype.Skip=function(a){this.m_nPos+=a};CStreamWriter.prototype.Write_Byte=function(a){this.private_CheckSize(1);this.m_pData[this.m_nPos++]=a};CStreamWriter.prototype.Write_String=function(a){var b=a.length;this.private_CheckSize(b);for(var c=0;c<b;c++)this.m_pData[this.m_nPos++]=a.charCodeAt(c)};CStreamWriter.prototype.Write_String2=function(a){this.Write_Long(a.length);this.Write_String(a)};
CStreamWriter.prototype.Write_Bytes=function(a,b,c){b=b||0;c=c||a.length;for(this.private_CheckSize(c-b);b<c;b++)this.m_pData[this.m_nPos++]=a[b]};CStreamWriter.prototype.Write_Short=function(a){this.private_CheckSize(2);this.m_pData[this.m_nPos++]=a&255;this.m_pData[this.m_nPos++]=a>>8&255};
CStreamWriter.prototype.Write_Long=function(a){this.private_CheckSize(4);this.m_pData[this.m_nPos++]=a&255;this.m_pData[this.m_nPos++]=a>>8&255;this.m_pData[this.m_nPos++]=a>>16&255;this.m_pData[this.m_nPos++]=a>>24&255};function CStreamReader(a,b){this.m_pData=a;this.m_nSize=b;this.m_nPos=0}CStreamReader.prototype.Is_EOF=function(){return this.m_nPos<this.m_nSize?!1:!0};CStreamReader.prototype.Get_Byte=function(){return this.m_nPos>=this.m_nSize?0:this.m_pData[this.m_nPos++]};
CStreamReader.prototype.Get_Short=function(){return this.m_nPos+1>=this.m_nSize?0:this.m_pData[this.m_nPos++]|this.m_pData[this.m_nPos++]<<8};CStreamReader.prototype.Get_Long=function(){return this.m_nPos+3>=this.m_nSize?0:this.m_pData[this.m_nPos++]|this.m_pData[this.m_nPos++]<<8|this.m_pData[this.m_nPos++]<<16|this.m_pData[this.m_nPos++]<<24};
CStreamReader.prototype.Get_String=function(a){if(this.m_nPos+a>this.m_nSize)return"";for(var b=[],c=0;c<a;c++)b.push(String.fromCharCode(this.m_pData[this.m_nPos+c]));this.m_nPos+=a;return b.join("")};CStreamReader.prototype.Get_String2=function(){var a=this.Get_Long();return this.Get_String(a)};function CMove(a,b){this.m_nValue=a;this.m_nType=b}CMove.prototype.Get_X=function(){return Common_ValuetoXY(this.m_nValue).X};CMove.prototype.Get_Y=function(){return Common_ValuetoXY(this.m_nValue).Y};CMove.prototype.Get_Value=function(){return this.m_nValue};CMove.prototype.Get_Type=function(){return this.m_nType};CMove.prototype.Set_Value=function(a){this.m_nValue=a};CMove.prototype.Set_Type=function(a){this.m_nType=a};CMove.prototype.Copy=function(){return new CMove(this.m_nValue,this.m_nType)};
CMove.prototype.Is_Pass=function(){return BOARD_EMPTY!==this.m_nType&&0===this.m_nValue?!0:!1};function CNodeIdCounter(){this.m_nCounter=0}CNodeIdCounter.prototype.Get_NextId=function(){return++this.m_nCounter+""};CNodeIdCounter.prototype.Reset=function(){this.m_nCounter=0};var g_oIdCounter=new CNodeIdCounter;
function CNode(a){this.m_sId=g_oIdCounter.Get_NextId();this.m_oHandler=(this.m_oGameTree=a)?a.Get_Handler():null;this.m_aNext=[];this.m_nNextCur=-1;this.m_oPrev=null;this.m_aCommands=[];this.m_oMove=new CMove(0,BOARD_EMPTY);this.m_sComment="";this.m_oTerritory=new CTerritory(!1,{});this.m_oNavInfo={X:-1,Y:-1,Num:-1};this.m_bLoaded=!1;this.m_oColorMap={};this.m_nMoveNumber=-1;this.m_bOrigin=!1}CNode.prototype.Get_Id=function(){return this.m_sId};CNode.prototype.Is_FromFile=function(){return this.m_bLoaded};
CNode.prototype.Set_Origin=function(a){this.m_bOrigin=a};CNode.prototype.Is_Origin=function(){return this.m_bOrigin};
CNode.prototype.Reset_ToOrigin=function(a){if(!0===this.m_bOrigin){for(var b=0;b<this.m_aNext.length;++b)!0!==this.m_aNext[b].m_bOrigin&&(this.m_aNext.splice(b,1),b--,this.m_nNextCur>=b&&this.m_nNextCur--);this.m_sComment=a.m_sComment;this.m_nMoveNumber=a.m_nMoveNumber;this.m_aCommands=[];b=0;for(var c=a.m_aCommands.length;b<c;++b)this.m_aCommands.push(a.m_aCommands[b].Copy());this.m_oTerritory.CopyFrom(a.m_oTerritory);this.m_oMove=a.m_oMove.Copy()}};
CNode.prototype.Get_NodeById=function(a){if(a===this.m_sId)return this;for(var b=0,c=this.Get_NextsCount();b<c;b++){var d=this.m_aNext[b].Get_NodeById(a);if(null!==d)return d}return null};CNode.prototype.Get_NodeByMoveNumber=function(a){if(0===a)return this;for(var b=0,c=this;b!==a&&!(0>=c.Get_NextsCount());){c=c.Get_Next(c.Get_NextCur());if(!c)break;c.Have_Move()&&b++}return c};
CNode.prototype.Copy_CurrentVariant=function(a){var b=new CNode;b.m_aCommands=this.m_aCommands;0<this.m_aNext.length&&this!==a&&(b.m_aNext[0]=this.m_aNext[this.m_nNextCur].Copy_CurrentVariant(a),b.m_nNextCur=0,b.m_aNext[0].m_oPrev=b);return b};CNode.prototype.Is_Node=function(){return!0};CNode.prototype.Clear=function(){this.m_aNext=[];this.m_nNextCur=-1;this.m_aCommands=[];this.m_oMove=new CMove(0,BOARD_EMPTY);this.m_sComment="";this.m_oTerritory=new CTerritory(!1,{})};
CNode.prototype.Get_Next=function(a){return void 0!==this.m_aNext[a]?this.m_aNext[a]:this.m_aNext[this.m_nNextCur]};CNode.prototype.Get_NextCur=function(){return this.m_nNextCur};CNode.prototype.Set_NextCur=function(a){this.m_nNextCur=a>=this.m_aNext.length?this.m_aNext.length-1:a};CNode.prototype.Get_NextsCount=function(){return this.m_aNext.length};
CNode.prototype.Add_Next=function(a,b,c){a.Set_Prev(this);if(void 0===c&&!0===this.m_bOrigin&&!0===a.m_bOrigin)for(c=0;c<this.m_aNext.length&&!0===this.m_aNext[c].m_bOrigin;)c++;if(void 0===c){if(this.m_aNext.push(a),!0===b||-1===this.m_nNextCur)this.m_nNextCur=this.m_aNext.length-1}else c=Math.max(0,Math.min(this.m_aNext.length,c)),this.m_aNext.splice(c,0,a),!0===b||-1===this.m_nNextCur?this.m_nNextCur=c:this.m_nNextCur>=c&&this.m_nNextCur++;this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};
CNode.prototype.Remove_Next=function(a){this.m_aNext.splice(a,1);this.m_nNextCur>=a&&this.m_nNextCur--; -1===this.m_nNextCur&&0<this.m_aNext.length&&(this.m_nNextCur=0);this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};CNode.prototype.Get_Prev=function(){return this.m_oPrev};CNode.prototype.Set_Prev=function(a){this.m_oPrev=a};CNode.prototype.Add_Command=function(a){this.m_aCommands.push(a);this.ToHandler_AddCommand(a);this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};
CNode.prototype.Get_Command=function(a){return this.m_aCommands[a]};CNode.prototype.Get_CommandsCount=function(){return this.m_aCommands.length};CNode.prototype.Set_Move=function(a){this.m_oMove=a;this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};CNode.prototype.Get_Move=function(){return this.m_oMove};CNode.prototype.Have_Move=function(){return BOARD_EMPTY===this.m_oMove.Get_Type()?!1:!0};CNode.prototype.Add_Comment=function(a){this.m_sComment+=a;this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};
CNode.prototype.Set_Comment=function(a){this.m_sComment=a;this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};CNode.prototype.Get_Comment=function(){return this.m_sComment};CNode.prototype.Is_TerritoryUse=function(){return this.m_oTerritory.Is_Use()};CNode.prototype.Is_TerritoryForceUse=function(){return this.m_oTerritory.Is_ForceUse()};CNode.prototype.Set_TerritoryUse=function(a){this.m_oTerritory.Set_Use(a)};CNode.prototype.Set_TerritoryForceUse=function(a){this.m_oTerritory.Set_ForceUse(a)};
CNode.prototype.Add_TerritoryPoint=function(a,b){this.m_oTerritory.Add_Point(a,b)};CNode.prototype.Remove_TerritoryPoint=function(a){this.m_oTerritory.Remove_Point(a)};CNode.prototype.Clear_TerritoryPoints=function(){this.m_oTerritory.Clear_Points()};CNode.prototype.Fill_TerritoryToLogicBoard=function(a){this.m_oTerritory.Fill_PointsToLogicBoard(a)};CNode.prototype.Fill_TerritoryFromLogicBoard=function(a){this.m_oTerritory.Fill_PointsFromLogicBoard(a)};
CNode.prototype.Get_MainVariantLen=function(){for(var a=1,b=this;0<b.Get_NextsCount();)a++,b=b.Get_Next(0);return a};CNode.prototype.GoTo_MainVariant=function(){for(var a=this;0<a.Get_NextsCount();)a.Set_NextCur(0),a=a.Get_Next(0)};CNode.prototype.Get_LastNodeInMainVariant=function(){for(var a=this;0<a.Get_NextsCount();)a=a.Get_Next(0);return a};CNode.prototype.Is_First=function(){return null===this.m_oPrev?!0:!1};
CNode.prototype.Make_ThisNodeCurrent=function(){for(var a=!1,b=this.Get_Prev(),c=this;null!=b;){for(var d=!1,e=0,f=b.Get_NextsCount();e<f;e++)if(c===b.Get_Next(e)){e!==b.Get_NextCur()&&(a=!0);b.Set_NextCur(e);d=!0;break}if(!d)return!1;c=b;b=b.Get_Prev()}return a};CNode.prototype.Is_OnMainVariant=function(){for(var a=this;null!==(a=a.Get_Prev());)if(0!=a.Get_NextCur())return!1;return!0};
CNode.prototype.Is_OnCurrentVariant=function(){for(var a=this,b;null!=(b=a.Get_Prev());){if(b.Get_Next(b.Get_NextCur())!=a)return!1;a=b}return!0};CNode.prototype.Set_NavigatorInfo=function(a,b,c){this.m_oNavInfo.X=a;this.m_oNavInfo.Y=b;this.m_oNavInfo.Num=c};CNode.prototype.Get_NavigatorInfo=function(){return this.m_oNavInfo};
CNode.prototype.Add_Move=function(a,b,c){a=Common_XYtoValue(a,b);this.Add_Command(new CCommand(BOARD_BLACK===c?ECommand.B:ECommand.W,a));BOARD_EMPTY===this.m_oMove.Get_Type()&&(this.m_oMove.Set_Value(a),this.m_oMove.Set_Type(c))};CNode.prototype.Add_MoveNumber=function(a){this.Add_Command(new CCommand(ECommand.MN,a))};CNode.prototype.AddOrRemove_Stones=function(a,b){this.Add_Command(new CCommand(BOARD_BLACK===a?ECommand.AB:BOARD_WHITE===a?ECommand.AW:ECommand.AE,Common_CopyArray(b),b.length))};
CNode.prototype.Add_Mark=function(a,b){var c=ECommand.Unknown;switch(a){case EDrawingMark.Cr:c=ECommand.CR;break;case EDrawingMark.Lm:return;case EDrawingMark.Sq:c=ECommand.SQ;break;case EDrawingMark.Tr:c=ECommand.TR;break;case EDrawingMark.Tx:c=ECommand.LB;break;case EDrawingMark.X:c=ECommand.MA;break;case ECommand.RM:c=ECommand.RM}this.Add_Command(new CCommand(c,Common_CopyArray(b),b.length))};CNode.prototype.Add_TextMark=function(a,b){this.Add_Command(new CCommand(ECommand.LB,{Text:a,Pos:b}))};
CNode.prototype.Set_NextMove=function(a){this.Add_Command(new CCommand(ECommand.PL,a))};CNode.prototype.Add_BlackTimeLeft=function(a){this.Add_Command(new CCommand(ECommand.BL,a))};CNode.prototype.Add_WhiteTimeLeft=function(a){this.Add_Command(new CCommand(ECommand.WL,a))};CNode.prototype.Show_Variants=function(a,b){b.Clear_Variants();switch(a){case EShowVariants.Next:this.private_ShowNextVariants(b,-1);break;case EShowVariants.Curr:var c=this.Get_Prev();null!==c&&c.private_ShowNextVariants(b,this.Get_Move().Get_Value())}};
CNode.prototype.Count_NodeNumber=function(){for(var a=1,b=this;null!==(b=b.Get_Prev());)a++;return a};CNode.prototype.private_ShowNextVariants=function(a,b){if(a)for(var c=0,d=this.Get_NextsCount();c<d;c++){var e=this.Get_Next(c).Get_Move();BOARD_EMPTY!==e.Get_Type()&&b!==e.Get_Value()&&(e=Common_ValuetoXY(e.Get_Value()),a.Draw_Variant(e.X,e.Y))}};CNode.prototype.Find_RightNodes=function(a){-1!==this.m_sComment.indexOf("RIGHT")&&a.push(this);for(var b=0,c=this.Get_NextsCount();b<c;b++)this.Get_Next(b).Find_RightNodes(a)};
CNode.prototype.Add_ColorMark=function(a,b,c){this.m_oColorMap[Common_XYtoValue(a,b)]=c;this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};CNode.prototype.Remove_ColorMark=function(a,b){delete this.m_oColorMap[Common_XYtoValue(a,b)];this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};CNode.prototype.Remove_AllColorMarks=function(){this.m_oColorMap={};this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};
CNode.prototype.Draw_ColorMap=function(a){a.Clear_AllColorMarks();for(var b in this.m_oColorMap)a.m_oColorMarks[b]=this.m_oColorMap[b];a.Draw_AllColorMarks()};CNode.prototype.Copy_ColorMapFromPrevNode=function(){this.m_oColorMap={};if(null!==this.m_oPrev){var a=this.m_oPrev.m_oColorMap,b;for(b in a)this.m_oColorMap[b]=a[b].Copy()}this.m_oGameTree&&this.m_oGameTree.Set_Modified(!0)};
CNode.prototype.Get_ColorTable=function(a){for(var b in this.m_oColorMap){var c=this.m_oColorMap[b].ToLong();a[c]=!0}b=0;for(c=this.Get_NextsCount();b<c;b++)this.m_aNext[b].Get_ColorTable(a)};CNode.prototype.Make_CurrentVariantMainly=function(){for(var a=this,b=this.Get_NextCur(),c=this.Get_Next(b);null!==c&&void 0!==c;)0!==b&&(a.m_aNext.splice(b,1),a.m_aNext.splice(0,0,c),a.Set_NextCur(0)),a=c,b=a.Get_NextCur(),c=a.Get_Next(b)};
CNode.prototype.Move_Variant=function(a){for(var b=this,c=this.Get_Prev();null!==c&&void 0!==c;){var d=c.Get_NextsCount();if(1<c.Get_NextsCount()){for(var e=0;e<d;++e)if(b===c.Get_Next(e)){0<a?0<e&&(c.m_aNext.splice(e,1),c.m_aNext.splice(e-1,0,b),c.Set_NextCur(e-1)):e<d-1&&(c.m_aNext.splice(e,1),c.m_aNext.splice(e+1,0,b),c.Set_NextCur(e+1));break}break}b=c;c=c.Get_Prev()}};
CNode.prototype.Get_Reference=function(a){var b=this,c=b,d=new CStreamWriter;d.Write_String("GBMR");if(!1!==a){for(;!b.Is_FromFile();){a=b.Get_Prev();if(null===a)return"";b=a}d.Write_Short(1);d.Write_String2(b.Get_Id());if(b!==c){d.Write_Byte(1);a=[];for(var e=c;e!==b;)a.splice(0,0,e),e=e.Get_Prev();d.Write_Long(a.length);b=0;for(e=a.length;b<e;b++){var f=a[b];d.Write_Short(1);c=d.Get_CurPosition();d.Skip(4);for(var g=0,h=0,k=f.Get_CommandsCount();h<k;h++){var l=f.Get_Command(h),m=l.Get_Type(),n=
l.Get_Value();l=l.Get_Count();switch(m){case ECommand.B:d.Write_Short(16);d.Write_Long(4);d.Write_Long(n);g++;break;case ECommand.W:d.Write_Short(17);d.Write_Long(4);d.Write_Long(n);g++;break;case ECommand.AB:case ECommand.AW:case ECommand.AE:switch(m){case ECommand.AB:d.Write_Short(32);break;case ECommand.AW:d.Write_Short(33);break;case ECommand.AE:d.Write_Short(34)}d.Write_Long(4*(l+1));d.Write_Long(l);for(m=0;m<l;m++)d.Write_Long(n[m]);g++}}f=d.Get_CurPosition();d.Seek(c);d.Write_Long(g);d.Seek(f);
d.Write_Short(0)}}else d.Write_Byte(0)}else{d.Write_Short(2);a=d.Get_CurPosition();d.Skip(4);b=this.Get_FirstNode();for(e=0;b!==c&&0<b.Get_NextsCount();)e++,d.Write_Long(b.Get_NextCur()),b=b.Get_Next();f=d.Get_CurPosition();d.Seek(a);d.Write_Long(e);d.Seek(f)}return Common.Encode_Base64_UrlSafe(d.Get_Bytes())};CNode.prototype.Get_FirstNode=function(){for(var a=this;null!==a.Get_Prev();)a=a.Get_Prev();return a};
CNode.prototype.Get_MoveNumber=function(){if(-1===this.m_nMoveNumber){var a=0,b=this,c=b.Get_Prev();for(b.Have_Move()&&a++;null!==c;)b=c,c=b.Get_Prev(),b.Have_Move()&&a++;this.m_nMoveNumber=a}return this.m_nMoveNumber};CNode.prototype.Have_ChildNodeWithMove=function(a,b,c){if(c!==BOARD_BLACK&&c!==BOARD_WHITE)return-1;a=Common_XYtoValue(a,b);b=0;for(var d=this.Get_NextsCount();b<d;++b){var e=this.Get_Next(b).Get_Move();if(a===e.Get_Value()&&c==e.Get_Type())return b}return-1};
CNode.prototype.ToHandler_AddCommand=function(){this.m_oHandler&&this.m_oHandler.Add_NodeCommand&&this.m_oHandler.Add_NodeCommand(this.Get_Id(),Command.To_String())};CNode.prototype.FromHandler_AddCommand=function(a){var b=new CCommand;b.From_String(a);this.m_aCommands.push(b)};
CNode.prototype.ToHandler_UpdateNexts=function(){if(this.m_oHandler&&this.m_oHandler.Update_NodeNexts){for(var a=[],b=0,c=this.m_aNext.length;b<c;++b)a.push(this.m_aNext[b].Get_Id());this.m_oHandler.Update_NodeNexts(this.Get_Id(),a)}};CNode.prototype.FromHandler_UpdateNexts=function(a){};var g_nSgfReaderCharCodeOffsetLo=96,g_nSgfReaderCharCodeOffsetHi=64,g_nSgfReaderCharCode_a=97,g_nSgfReaderCharCode_z=122,g_nSgfReaderCharCode_A=65,g_nSgfReaderCharCode_Z=90,ESgfEncoding={None:0,UTF8:1};function CSgfReader(a){this.m_oGameTree=a;this.m_sSGF=[];this.m_nVariantDepth=this.m_nPos=0;this.m_arrVariant=[];this.m_bValidNode=!0;this.m_nLength=0;this.m_oViewPort={X0:100,Y0:100,X1:-1,Y1:-1};this.m_eEncoding=ESgfEncoding.None;this.m_oColorTable=null}
CSgfReader.prototype.Load=function(a){if(void 0!==a&&""!==a&&(this.private_Init(),this.private_Normalize(a),!this.private_Parse()&&this.m_oGameTree&&this.m_oGameTree.Get_Drawing())){a=this.m_oGameTree;var b=a.Get_Drawing();CreateWindow(b.Get_MainDiv().id,EWindowType.Error,{GameTree:a,Drawing:b,ErrorText:"File cannot be read. Invalid SGF file.",W:275,H:80})}};
CSgfReader.prototype.private_Init=function(){this.m_sSGF=[];this.m_nVariantDepth=this.m_nPos=0;this.m_arrVariant=[];this.m_bValidNode=!0;this.m_nLength=0};
CSgfReader.prototype.private_Normalize=function(a){for(var b=0,c=a.length,d=[],e=!1;b<c;){(e||32<a.charCodeAt(b))&&d.push(a.charAt(b));if(3<=d.length&&"["==d[d.length-1]){var f=d[d.length-3]+d[d.length-2];if("C"==d[d.length-2]&&"UC"!=f||"AN"==f||"BR"==f||"BT"==f||"CP"==f||"DT"==f||"EV"==f||"GN"==f||"GC"==f||"ON"==f||"OT"==f||"PB"==f||"PC"==f||"PW"==f||"RE"==f||"RO"==f||"RU"==f||"SO"==f||"TM"==f||"US"==f||"WR"==f||"WT"==f)e=!0}else e&&1<=d.length&&"]"==d[d.length-1]&&(2>d.length||"\\"!=d[d.length-
2])&&(e=!1);b++}this.m_sSGF=d;this.m_nLength=this.m_sSGF.length};
CSgfReader.prototype.private_Parse=function(){this.m_oGameTree.Reset();if("("===this.m_sSGF[0]&&";"===this.m_sSGF[1])for(this.m_nPos++;this.m_nPos<this.m_nLength&&(")"!==this.m_sSGF[this.m_nPos]||0!==this.m_nVariantDepth);){var a=this.m_sSGF[this.m_nPos];if(";"===a){if(1!=this.m_nPos?this.m_oGameTree.Add_NewNode(!1,!1):this.m_oGameTree.Set_CurNode(this.m_oGameTree.Get_FirstNode()),this.m_oGameTree.m_oCurNode.m_bLoaded=!0,!this.private_ReadNode())return!1}else if("("===a)this.m_arrVariant[this.m_nVariantDepth]=
this.m_oGameTree.Get_CurNode(),this.m_nVariantDepth++,this.m_nPos++;else if(")"===a)this.m_nVariantDepth--,this.m_oGameTree.Set_CurNode(this.m_arrVariant[this.m_nVariantDepth]),this.m_nPos++;else return!1}else return!1;return!0};
CSgfReader.prototype.private_ReadNode=function(){this.m_nPos++;for(var a=this.m_sSGF[this.m_nPos],b=this.m_sSGF[this.m_nPos+1];void 0!==a&&")"!==a&&";"!==a&&"("!==a;){switch(a){case "A":switch(b){case "B":this.private_ReadAddOrRemoveStone(BOARD_BLACK);break;case "E":this.private_ReadAddOrRemoveStone(BOARD_EMPTY);break;case "W":this.private_ReadAddOrRemoveStone(BOARD_WHITE);break;case "N":this.private_ReadAN();break;case "P":this.private_ReadAP();break;default:this.private_ReadUnknown()}break;case "B":switch(b){case "[":this.private_ReadMove(BOARD_BLACK);
break;case "R":this.private_ReadBR();break;case "T":this.private_ReadBT();break;case "L":this.private_ReadBL();break;default:this.private_ReadUnknown()}break;case "C":switch(b){case "[":this.private_ReadComments();break;case "A":this.private_ReadCA();break;case "P":this.private_ReadCP();break;case "R":this.private_ReadMark(EDrawingMark.Cr);break;case "T":this.private_ReadCT();break;case "M":this.private_ReadCM();break;default:this.private_ReadUnknown()}break;case "D":switch(b){case "T":this.private_ReadDT();
break;default:this.private_ReadUnknown()}break;case "E":switch(b){case "V":this.private_ReadEV();break;default:this.private_ReadUnknown()}break;case "F":switch(b){case "F":this.private_ReadFF();break;default:this.private_ReadUnknown()}break;case "G":switch(b){case "N":this.private_ReadGN();break;case "C":this.private_ReadGC();break;case "M":this.private_ReadGM();break;default:this.private_ReadUnknown()}break;case "H":switch(b){case "A":this.private_ReadHA();break;default:this.private_ReadUnknown()}break;
case "K":switch(b){case "M":this.private_ReadKM();break;default:this.private_ReadUnknown()}break;case "L":switch(b){case "B":this.private_ReadLB();break;default:this.private_ReadUnknown()}break;case "M":switch(b){case "A":this.private_ReadMark(EDrawingMark.X);break;default:this.private_ReadUnknown()}break;case "O":switch(b){case "N":this.private_ReadON();break;case "T":this.private_ReadOT();break;default:this.private_ReadUnknown()}break;case "P":switch(b){case "B":this.private_ReadPB();break;case "C":this.private_ReadPC();
break;case "W":this.private_ReadPW();break;case "L":this.private_ReadPL();break;default:this.private_ReadUnknown()}break;case "R":switch(b){case "E":this.private_ReadRE();break;case "O":this.private_ReadRO();break;case "U":this.private_ReadRU();break;default:this.private_ReadUnknown()}break;case "S":switch(b){case "Q":this.private_ReadMark(EDrawingMark.Sq);break;case "T":this.private_ReadST();break;case "Z":this.private_ReadSZ();break;case "O":this.private_ReadSO();break;default:this.private_ReadUnknown()}break;
case "T":switch(b){case "R":this.private_ReadMark(EDrawingMark.Tr);break;case "M":this.private_ReadTM();break;case "B":this.private_ReadTerritory(BOARD_BLACK);break;case "W":this.private_ReadTerritory(BOARD_WHITE);break;default:this.private_ReadUnknown()}break;case "U":switch(b){case "S":this.private_ReadUS();break;default:this.private_ReadUnknown()}break;case "W":switch(b){case "[":this.private_ReadMove(BOARD_WHITE);break;case "R":this.private_ReadWR();break;case "T":this.private_ReadWT();break;
case "L":this.private_ReadWL();break;default:this.private_ReadUnknown()}break;default:this.private_ReadUnknown()}if(!this.m_bValidNode)return!1;a=this.m_sSGF[this.m_nPos];b=this.m_sSGF[this.m_nPos+1]}return!0};CSgfReader.prototype.private_ReadSimpleText=function(a){void 0===a&&(a="]");for(var b="";void 0!==this.m_sSGF[this.m_nPos]&&a!==this.m_sSGF[this.m_nPos];)b+=this.m_sSGF[this.m_nPos],this.m_nPos++;void 0===this.m_sSGF[this.m_nPos]&&(this.m_bValidNode=!1);this.m_nPos++;return b};
CSgfReader.prototype.private_ReadReal=function(a){a=parseFloat(this.private_ReadSimpleText(a));return isNaN(a)?0:a};CSgfReader.prototype.private_ReadNumber=function(a){a=parseInt(this.private_ReadSimpleText(a));return isNaN(a)?0:a};
CSgfReader.prototype.private_ReadUnknown=function(){for(;;){for(;void 0!==this.m_sSGF[this.m_nPos]&&"]"!==this.m_sSGF[this.m_nPos]&&this.m_nPos<this.m_nLength;)for(this.m_nPos++;"]"===this.m_sSGF[this.m_nPos]&&"\\"===this.m_sSGF[this.m_nPos-1];)this.m_nPos++;this.m_nPos++;if("["!==this.m_sSGF[this.m_nPos])break}};
CSgfReader.prototype.private_LetterToNumber=function(a){a=a.charCodeAt(0);if(a>=g_nSgfReaderCharCode_a&&a<=g_nSgfReaderCharCode_z)return a-g_nSgfReaderCharCodeOffsetLo;if(a>=g_nSgfReaderCharCode_A&&a<=g_nSgfReaderCharCode_Z)return a-g_nSgfReaderCharCodeOffsetHi+26;this.m_bValidNode=!1;return 0};
CSgfReader.prototype.private_ReadAddOrRemoveStone=function(a){this.m_nPos+=3;var b=[];if("]"!==this.m_sSGF[this.m_nPos]){for(;;){var c=this.m_sSGF[this.m_nPos];this.m_nPos++;var d=this.m_sSGF[this.m_nPos];this.m_nPos++;var e=this.private_LetterToNumber(c),f=this.private_LetterToNumber(d);if(":"===this.m_sSGF[this.m_nPos])for(this.m_nPos++,c=this.m_sSGF[this.m_nPos],this.m_nPos++,d=this.m_sSGF[this.m_nPos],this.m_nPos++,c=this.private_LetterToNumber(c),d=this.private_LetterToNumber(d);f<=d;f++)for(var g=
e;g<=c;g++)this.private_RegisterPoint(g,f),b.push(Common_XYtoValue(g,f));else this.private_RegisterPoint(e,f),b.push(Common_XYtoValue(e,f));if("]"!==this.m_sSGF[this.m_nPos]){this.m_bValidNode=!1;return}this.m_nPos++;if("["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}this.m_oGameTree.AddOrRemove_Stones(a,b)}};CSgfReader.prototype.private_ReadAN=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameAnnotator(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadAP=function(){this.m_nPos+=3;this.m_oGameTree.Set_Application(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadMove=function(a){this.m_nPos+=2;if("]"==this.m_sSGF[this.m_nPos])this.m_oGameTree.Add_Move(0,0,a);else{var b=this.m_sSGF[this.m_nPos];this.m_nPos++;var c=this.m_sSGF[this.m_nPos];this.m_nPos++;var d=this.m_oGameTree.Get_Board().Get_Size();if("t"===b&&"t"===c&&19>=d.X&&19>=d.Y)this.m_oGameTree.Add_Move(0,0,a);else for(b=this.private_LetterToNumber(b),c=this.private_LetterToNumber(c),this.private_RegisterPoint(b,c),this.m_oGameTree.Add_Move(b,c,a);"]"!==this.m_sSGF[this.m_nPos];)if(this.m_nPos++,
this.m_nPos>=this.m_nLength){this.m_bValidNode=!1;break}}this.m_nPos++};CSgfReader.prototype.private_ReadBR=function(){this.m_nPos+=3;this.m_oGameTree.Set_BlackRating(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadBT=function(){this.m_nPos+=3;this.m_oGameTree.Set_BlackTeam(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadBL=function(){this.m_nPos+=3;this.m_oGameTree.Add_BlackTimeLeft(this.private_ReadReal())};
CSgfReader.prototype.private_ReadComments=function(){this.m_nPos+=2;for(var a="";"]"!==this.m_sSGF[this.m_nPos]||"\\"===this.m_sSGF[this.m_nPos-1];)"]"===this.m_sSGF[this.m_nPos+1]&&"\\"===this.m_sSGF[this.m_nPos]?(a+="]",this.m_nPos++):a+=this.m_sSGF[this.m_nPos],this.m_nPos++;this.m_nPos++;switch(this.m_eEncoding){case ESgfEncoding.UTF8:a=Common_UTF8_Decode(a)}var b=this.m_oGameTree.Get_CurNode();b&&b.Add_Comment(a)};
CSgfReader.prototype.private_ReadCA=function(){this.m_nPos+=3;var a=this.private_ReadSimpleText();this.m_oGameTree.Set_Charset(a)};CSgfReader.prototype.private_ReadCP=function(){this.m_nPos+=3;this.m_oGameTree.Set_Copyright(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadMark=function(a){this.m_nPos+=3;var b=[];if("]"!==this.m_sSGF[this.m_nPos]){for(;;){var c=this.m_sSGF[this.m_nPos];this.m_nPos++;var d=this.m_sSGF[this.m_nPos];this.m_nPos++;var e=this.private_LetterToNumber(c),f=this.private_LetterToNumber(d);if(":"===this.m_sSGF[this.m_nPos])for(this.m_nPos++,c=this.m_sSGF[this.m_nPos],this.m_nPos++,d=this.m_sSGF[this.m_nPos],this.m_nPos++,c=this.private_LetterToNumber(c),d=this.private_LetterToNumber(d);f<=d;f++)for(var g=e;g<=
c;g++)this.private_RegisterPoint(g,f),b.push(Common_XYtoValue(g,f));else this.private_RegisterPoint(e,f),b.push(Common_XYtoValue(e,f));if("]"!==this.m_sSGF[this.m_nPos]){this.m_bValidNode=!1;return}this.m_nPos++;if("["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}this.m_oGameTree.Add_Mark(a,b)}};CSgfReader.prototype.private_ReadDT=function(){this.m_nPos+=3;this.m_oGameTree.Set_DateTime(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadEV=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameEvent(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadFF=function(){this.private_ReadUnknown()};CSgfReader.prototype.private_ReadGN=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameName(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadGC=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameInfo(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadGM=function(){this.m_nPos+=3;1!==this.private_ReadNumber()&&(this.m_bValidNode=!1)};
CSgfReader.prototype.private_ReadHA=function(){this.m_nPos+=3;this.m_oGameTree.Set_Handicap(this.private_ReadNumber())};CSgfReader.prototype.private_ReadKM=function(){this.m_nPos+=3;this.m_oGameTree.Set_Komi(this.private_ReadReal())};
CSgfReader.prototype.private_ReadLB=function(){for(this.m_nPos+=3;;){var a=this.m_sSGF[this.m_nPos];this.m_nPos++;var b=this.m_sSGF[this.m_nPos];this.m_nPos++;a=this.private_LetterToNumber(a);b=this.private_LetterToNumber(b);this.m_nPos++;for(var c="";"]"!==this.m_sSGF[this.m_nPos]&&this.m_nPos<this.m_nLength;)c+=this.m_sSGF[this.m_nPos],this.m_nPos++;this.private_RegisterPoint(a,b);this.m_oGameTree.Add_TextMark(c,Common_XYtoValue(a,b));if("]"!==this.m_sSGF[this.m_nPos]){this.m_bValidNode=!1;break}this.m_nPos++;
if("["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}};CSgfReader.prototype.private_ReadON=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameFuseki(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadOT=function(){this.m_nPos+=3;this.m_oGameTree.Set_OverTime(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadPB=function(){this.m_nPos+=3;this.m_oGameTree.Set_Black(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadPC=function(){this.m_nPos+=3;this.m_oGameTree.Set_GamePlace(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadPL=function(){this.m_nPos+=3;"W"===this.private_ReadSimpleText()?this.m_oGameTree.Set_NextMove(BOARD_WHITE):this.m_oGameTree.Set_NextMove(BOARD_BLACK)};CSgfReader.prototype.private_ReadPW=function(){this.m_nPos+=3;this.m_oGameTree.Set_White(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadRE=function(){this.m_nPos+=3;this.m_oGameTree.Set_Result(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadRO=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameRound(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadRU=function(){this.m_nPos+=3;this.m_oGameTree.Set_Rules(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadST=function(){this.m_nPos+=3;switch(this.private_ReadNumber()){case 0:this.m_oGameTree.Set_ShowVariants(EShowVariants.Next);break;case 1:this.m_oGameTree.Set_ShowVariants(EShowVariants.Curr);break;default:this.m_oGameTree.Set_ShowVariants(EShowVariants.None)}};
CSgfReader.prototype.private_ReadSZ=function(){this.m_nPos+=3;var a=this.private_ReadSimpleText(),b,c;-1==(c=a.indexOf(":"))?a=b=Math.min(52,Math.max(parseInt(a),2)):(b=parseInt(a.substr(0,c)),a=parseInt(a.substr(c+1,a.length-c-1)));this.m_oGameTree.Set_BoardSize(b,a)};CSgfReader.prototype.private_ReadSO=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameSource(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadTM=function(){this.m_nPos+=3;this.m_oGameTree.Set_TimeLimit(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadTerritory=function(a){this.m_nPos+=3;var b=[];if("]"!==this.m_sSGF[this.m_nPos]){for(;;){var c=this.m_sSGF[this.m_nPos];this.m_nPos++;var d=this.m_sSGF[this.m_nPos];this.m_nPos++;var e=this.private_LetterToNumber(c),f=this.private_LetterToNumber(d);if(":"===this.m_sSGF[this.m_nPos])for(this.m_nPos++,c=this.m_sSGF[this.m_nPos],this.m_nPos++,d=this.m_sSGF[this.m_nPos],this.m_nPos++,c=this.private_LetterToNumber(c),d=this.private_LetterToNumber(d);f<=d;f++)for(var g=
e;g<=c;g++)b.push(Common_XYtoValue(g,f));else b.push(Common_XYtoValue(e,f));if("]"!==this.m_sSGF[this.m_nPos]){this.m_bValidNode=!1;return}this.m_nPos++;if("["!==this.m_sSGF[this.m_nPos])break;this.m_nPos++}this.m_oGameTree.Add_TerritoryPoint(a,b)}};CSgfReader.prototype.private_ReadUS=function(){this.m_nPos+=3;this.m_oGameTree.Set_GameTranscriber(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadWR=function(){this.m_nPos+=3;this.m_oGameTree.Set_WhiteRating(this.private_ReadSimpleText())};
CSgfReader.prototype.private_ReadWT=function(){this.m_nPos+=3;this.m_oGameTree.Set_WhiteTeam(this.private_ReadSimpleText())};CSgfReader.prototype.private_ReadWL=function(){this.m_nPos+=3;this.m_oGameTree.Add_WhiteTimeLeft(this.private_ReadReal())};CSgfReader.prototype.private_RegisterPoint=function(a,b){a<this.m_oViewPort.X0&&(this.m_oViewPort.X0=a);a>this.m_oViewPort.X1&&(this.m_oViewPort.X1=a);b<this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=b);b>this.m_oViewPort.Y1&&(this.m_oViewPort.Y1=b)};
CSgfReader.prototype.private_ReadCT=function(){this.m_nPos+=3;var a=this.private_ReadSimpleText();if(""!==a&&(a=Common.Decode_Base64(a),a=new CStreamReader(a,a.length),"SGFCT"===a.Get_String(5))){a.Get_Short();var b=a.Get_Long();this.m_oColorTable=[];for(var c=0;c<b;c++){var d=a.Get_Long();this.m_oColorTable[c]=new CColor(0,0,0,0);this.m_oColorTable[c].FromLong(d)}}};
CSgfReader.prototype.private_ReadCM=function(){this.m_nPos+=3;var a=this.private_ReadSimpleText();if(""!==a&&(a=Common.Decode_Base64(a),a=new CStreamReader(a,a.length),"SGFCM"===a.Get_String(5))){a.Get_Short();var b=a.Get_Short(),c=a.Get_Short(),d=this.m_oGameTree.Get_CurNode();d.m_oColorMap={};for(var e=0;e<c;e++)for(var f=0;f<b;f++){var g=a.Get_Byte();if(void 0!==this.m_oColorTable[g]&&0!==this.m_oColorTable[g].a){var h=Common_XYtoValue(f+1,e+1);d.m_oColorMap[h]=this.m_oColorTable[g].Copy()}}}};
function CFileReaderBase(a){this.m_oGameTree=a;this.m_sFile=[];this.m_nSize=this.m_nPos=0}CFileReaderBase.prototype.private_Normalize=function(a){for(var b=a.length,c=[],d=0;d<b;)c.push(a.charAt(d++));this.m_nPos=0;this.m_sFile=c;this.m_nSize=this.m_sFile.length};CFileReaderBase.prototype.private_PrepareGameTree=function(){this.m_oGameTree.Reset();this.m_oGameTree.Set_CurNode(this.m_oGameTree.Get_FirstNode());this.m_oGameTree.m_oCurNode.m_bLoaded=!0};
CFileReaderBase.prototype.private_ReadChar=function(){return this.m_nPos>=this.m_nSize?-1:this.m_sFile[this.m_nPos++]};CFileReaderBase.prototype.private_ReadLine=function(){for(var a="",b=null;-1!==b&&"\n"!==b;)b=this.private_ReadChar(),a+=b;return a};CFileReaderBase.prototype.private_IsEOF=function(){return this.m_nPos>=this.m_nSize?!0:!1};var g_nNgfReaderCharCodeOffset=65;
function CNgfReader(a){CNgfReader.superclass.constructor.call(this,a);this.m_nMovesCount=this.m_nHandicap=0;this.m_nBoardSize=19}CommonExtend(CNgfReader,CFileReaderBase);CNgfReader.prototype.Load=function(a){this.private_Normalize(a);this.private_PrepareGameTree();this.private_ReadHeader();this.private_ProcessHandicap();this.private_ReadGameTree()};
CNgfReader.prototype.private_ReadHeader=function(){this.m_oGameTree.Set_GameInfo(this.private_ReadLine());this.m_nBoardSize=this.private_ReadLine()|0;this.m_oGameTree.Set_BoardSize(this.m_nBoardSize,this.m_nBoardSize);this.private_ReadPlayer(!1);this.private_ReadPlayer(!0);this.private_ReadLine();var a=this.private_ReadLine();this.m_nHandicap=Math.min(9,Math.max(a|0,0));this.m_oGameTree.Set_Handicap(this.m_nHandicap);this.private_ReadLine();a=this.private_ReadLine();a=parseFloat(a);this.m_oGameTree.Set_Komi(a);
a=this.private_ReadLine();this.m_oGameTree.Set_DateTime(a);this.private_ReadLine();a=this.private_ReadLine();this.m_oGameTree.Set_Result(a);this.m_nMovesCount=this.private_ReadLine()|0};
CNgfReader.prototype.private_ProcessHandicap=function(){if(!(1>=this.m_nHandicap)){var a=[],b=[];19===this.m_nBoardSize?b=[4,10,16]:13===this.m_nBoardSize?b=[4,7,10]:9===this.m_nBoardSize&&(b=[3,5,7]);if(3===b.length)switch(this.m_nHandicap){case 2:a=[[b[2],b[0]],[b[0],b[2]]];break;case 3:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]]];break;case 4:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]],[b[0],b[0]]];break;case 5:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]],[b[0],b[0]],[b[1],b[1]]];break;case 6:a=[[b[2],b[0]],[b[0],
b[2]],[b[2],b[2]],[b[0],b[0]],[b[0],b[1]],[b[2],b[1]]];break;case 7:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]],[b[0],b[0]],[b[0],b[1]],[b[2],b[1]],[b[1],b[1]]];break;case 8:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]],[b[0],b[0]],[b[0],b[1]],[b[2],b[1]],[b[1],b[0]],[b[1],b[2]]];break;case 9:a=[[b[2],b[0]],[b[0],b[2]],[b[2],b[2]],[b[0],b[0]],[b[0],b[1]],[b[2],b[1]],[b[1],b[0]],[b[1],b[2]],[b[1],b[1]]]}if(0<a.length){b=[];for(var c=0,d=a.length;c<d;c++)b.push(Common_XYtoValue(a[c][0],a[c][1]));this.m_oGameTree.AddOrRemove_Stones(BOARD_BLACK,
b)}}};CNgfReader.prototype.private_ReadGameTree=function(){if(!this.private_IsEOF())for(var a=0;a<this.m_nMovesCount&&(this.m_oGameTree.Add_NewNode(!1,!1),this.m_oGameTree.m_oCurNode.m_bLoaded=!0,this.private_ReadNodeLine(),!this.private_IsEOF());a++);};
CNgfReader.prototype.private_ReadNodeLine=function(){if("PM"!==this.private_ReadChar()+this.private_ReadChar())return this.private_ReadLine();this.private_ReadChar();this.private_ReadChar();var a="B"===this.private_ReadChar()?BOARD_BLACK:BOARD_WHITE,b=this.private_ReadChar(),c=this.private_ReadChar();b=b.charCodeAt(0)-g_nNgfReaderCharCodeOffset;c=c.charCodeAt(0)-g_nNgfReaderCharCodeOffset;0>b||0>c?this.m_oGameTree.Add_Move(0,0,a):this.m_oGameTree.Add_Move(b,c,a);this.private_ReadLine()};
CNgfReader.prototype.private_ReadPlayer=function(a){var b=this.private_ReadLine(),c=b.indexOf(" "),d="";if(-1!==c){var e=this.private_ClearString(b.substr(0,c));d=this.private_ClearString(b.substr(c))}else e=this.private_ClearString(b);!0===a?(this.m_oGameTree.Set_Black(e),this.m_oGameTree.Set_BlackRating(d)):(this.m_oGameTree.Set_White(e),this.m_oGameTree.Set_WhiteRating(d))};CNgfReader.prototype.private_ClearString=function(a){return a.replace(/\s+/g,"")};
function CGibReader(a){CGibReader.superclass.constructor.call(this,a)}CommonExtend(CGibReader,CFileReaderBase);CGibReader.prototype.Load=function(a){this.private_Normalize(a);this.private_PrepareGameTree();!1!==this.private_ReadHeader()&&this.private_ReadGameTree()};
CGibReader.prototype.private_ReadHeader=function(){for(var a=-1;"\\"!==a;){if(this.private_IsEOF())return!1;a=this.private_ReadChar()}a=this.private_ReadChar()+this.private_ReadChar();if("GS"===a)return this.m_nPos-=3,!0;if("HS"!==a)return!1;for(;;){for(a=-1;"\\"!==a;){if(this.private_IsEOF())return!1;a=this.private_ReadChar()}a=this.private_ReadChar();if("H"===a){if("E"!==this.private_ReadChar())break;return!0}if("["!==a)break;for(var b="";;){if(this.private_IsEOF())return!1;a=this.private_ReadChar();
if("="===a)break;b+=a}for(var c="";;){if(this.private_IsEOF())return!1;a=this.private_ReadChar();if("\\"===a){if("]"===this.private_ReadChar())break;return!1}c+=a}this.private_ProcessHeaderRecord(b,c)}return!1};CGibReader.prototype.private_ProcessHeaderRecord=function(a,b){switch(a){case "WUSERINFO":case "BUSERINFO":case "GAMEINFOMAIN":case "GAMEINFOSUB":this.private_ReadInfo(b)}};
CGibReader.prototype.private_ReadGameTree=function(){for(var a=-1;"\\"!==a;){if(this.private_IsEOF())return!1;a=this.private_ReadChar()}a=this.private_ReadChar()+this.private_ReadChar();if("GS"!==a)return!1;this.private_ReadLine();this.private_ReadLine();for(this.private_ReadLine();!this.private_IsEOF();){a=this.private_ReadLine();if(-1!==a.indexOf("\\GE"))return!0;var b=this.private_ParseNodeLine(a);if(0>=b.length)return!1;a=b[0];if("INI"===a)5<=b.length&&this.m_oGameTree.Set_GameInfo(b[4]);else if("STO"===
a){if(6!==b.length)return!1;this.m_oGameTree.Add_NewNode(!1,!1);this.m_oGameTree.m_oCurNode.m_bLoad=!0;this.m_oGameTree.Add_Move((b[4]|0)+1,(b[5]|0)+1,"1"===b[3]?BOARD_BLACK:BOARD_WHITE)}}};CGibReader.prototype.private_ParseNodeLine=function(a){for(var b=[],c=a;-1!==(a=c.indexOf(" "));)b.push(c.substr(0,a)),c=c.substr(a+1);return b};
CGibReader.prototype.private_ParseValue=function(a){for(var b=[],c=a;-1!==(a=c.indexOf(","));){var d=c.substr(0,a),e=d,f="",g;-1!==(g=d.indexOf(":"))&&(e=d.substr(0,g),f=d.substr(g+1));b.push({Name:e,Value:f});c=c.substr(a+1)}return b};
CGibReader.prototype.private_ReadInfo=function(a){var b=null,c=null;a=this.private_ParseValue(a);for(var d=0,e=a.length;d<e;d++){var f=a[d].Value;switch(a[d].Name){case "WNICK":this.m_oGameTree.Set_White(f);break;case "BNICK":this.m_oGameTree.Set_Black(f);break;case "WLV":this.m_oGameTree.Set_WhiteRating(this.private_ParseRank(f));break;case "BLV":this.m_oGameTree.Set_BlackRating(this.private_ParseRank(f));break;case "GNAME":this.m_oGameTree.Set_GameEvent(f);break;case "GDATE":this.m_oGameTree.Set_DateTime(f);
break;case "GPLC":this.m_oGameTree.Set_GamePlace(f);break;case "GCMT":this.m_oGameTree.Set_GameInfo(f);break;case "GONGJE":this.m_oGameTree.Set_Komi((f|0)/10);break;case "GRLT":b=f;break;case "ZIPSU":c=f}}null!==b&&this.private_ParseGameResult(b,c)};CGibReader.prototype.private_ParseRank=function(a){a|=0;return 18>a?18-a+"k":26<a?a-26+"p":a-17+"d"};
CGibReader.prototype.private_ParseGameResult=function(a,b){switch(a){case "0":this.m_oGameTree.Set_Result("Black "+(b|0)/10+" win");break;case "1":this.m_oGameTree.Set_Result("White "+(b|0)/10+" win");break;case "3":this.m_oGameTree.Set_Result("Black wins by resignation");break;case "4":this.m_oGameTree.Set_Result("White wins by resignation");break;case "255":this.m_oGameTree.Set_Result("Unfinished")}};function CSgfWriter(){this.m_oColorTable=this.m_oGameTree=this.m_sFile=null}CSgfWriter.prototype.Write=function(a){this.m_oGameTree=a;this.m_sFile="";this.m_oColorTable=null;this.private_Write(a.Get_FirstNode())};CSgfWriter.prototype.private_WriteString=function(a){this.m_sFile+=a};CSgfWriter.prototype.private_WriteCommandName=function(a){this.private_WriteString(a)};
CSgfWriter.prototype.private_WriteMovePos=function(a){0!=a?this.private_WritePos(a):this.private_WriteString(String.fromCharCode(91,93))};CSgfWriter.prototype.private_NumberToCharCode=function(a){return 26>=a?g_nSgfReaderCharCodeOffsetLo+a:g_nSgfReaderCharCodeOffsetHi+a-26};CSgfWriter.prototype.private_WritePos=function(a){a=Common_ValuetoXY(a);this.private_WriteString(String.fromCharCode(91,this.private_NumberToCharCode(a.X),this.private_NumberToCharCode(a.Y),93))};
CSgfWriter.prototype.private_WritePos2=function(a){a=Common_ValuetoXY(a);this.private_WriteString(String.fromCharCode(this.private_NumberToCharCode(a.X),this.private_NumberToCharCode(a.Y)))};CSgfWriter.prototype.private_WritePosArray=function(a){for(var b=0,c=a.length;b<c;b++)this.private_WritePos(a[b])};CSgfWriter.prototype.private_WriteReal=function(a){this.private_WriteString("["+a+"]")};CSgfWriter.prototype.private_WriteSimpleText=function(a){this.private_WriteString("["+a+"]")};
CSgfWriter.prototype.private_WriteCommand=function(a,b){this.private_WriteCommandName(a);this.private_WriteSimpleText(b)};CSgfWriter.prototype.private_WriteNonEmptyCommand=function(a,b){b&&""!==b&&this.private_WriteCommand(a,b)};
CSgfWriter.prototype.private_WriteGameInfo=function(){var a=this.m_oGameTree,b=a.Get_Board().Get_Size();this.private_WriteCommand("GM",1);this.private_WriteCommand("FF",4);this.private_WriteCommand("CA","UTF-8");this.private_WriteCommand("AP","WebGoBoard:"+GoBoardApi.Get_Version());this.private_WriteCommand("ST",a.Get_ShowVariants());this.private_WriteNonEmptyCommand("RU",a.Get_Rules());this.private_WriteCommand("SZ",b.X==b.Y?b.X:b.X+":"+b.Y);this.private_WriteCommand("KM",a.Get_Komi());this.private_WriteCommand("HA",
a.Get_Handicap());this.private_WriteNonEmptyCommand("TM",a.Get_TimeLimit());this.private_WriteNonEmptyCommand("OT",a.Get_OverTime());this.private_WriteNonEmptyCommand("RE",a.Get_Result());this.private_WriteNonEmptyCommand("GN",a.Get_GameName());this.private_WriteNonEmptyCommand("DT",a.Get_DateTime());this.private_WriteNonEmptyCommand("CP",a.Get_Copyright());this.private_WriteNonEmptyCommand("GC",a.Get_GameInfo());this.private_WriteNonEmptyCommand("PB",a.Get_BlackName());this.private_WriteNonEmptyCommand("BR",
a.Get_BlackRating());this.private_WriteNonEmptyCommand("BT",a.Get_BlackTeam());this.private_WriteNonEmptyCommand("PW",a.Get_WhiteName());this.private_WriteNonEmptyCommand("WR",a.Get_WhiteRating());this.private_WriteNonEmptyCommand("WT",a.Get_WhiteTeam());this.private_WriteNonEmptyCommand("EV",a.Get_GameEvent());this.private_WriteNonEmptyCommand("RO",a.Get_GameRound());this.private_WriteNonEmptyCommand("PC",a.Get_GamePlace());this.private_WriteNonEmptyCommand("AN",a.Get_GameAnnotator());this.private_WriteNonEmptyCommand("ON",
a.Get_GameFuseki());this.private_WriteNonEmptyCommand("SO",a.Get_GameSource());this.private_WriteNonEmptyCommand("US",a.Get_GameTranscriber());a={};this.m_oGameTree.Get_FirstNode().Get_ColorTable(a);b=1;var c=[],d;for(d in a)a[d]=b,c[b++]=d|0;1<b&&(a[0]=0,c[0]=0,this.m_oColorTable=a,this.private_WriteColorTable(c))};
CSgfWriter.prototype.private_WriteNode=function(a){this.private_WriteString(";");a===this.m_oGameTree.Get_FirstNode()&&this.private_WriteGameInfo();this.private_WriteAddOrRemoveStones(a);this.private_WriteMarks(a);for(var b=0,c=a.Get_CommandsCount();b<c;b++){var d=a.Get_Command(b),e=d.Get_Type();d=d.Get_Value();switch(e){case ECommand.B:this.private_WriteCommandName("B");this.private_WriteMovePos(d);break;case ECommand.W:this.private_WriteCommandName("W");this.private_WriteMovePos(d);break;case ECommand.BL:this.private_WriteCommandName("BL");
this.private_WriteReal(d);break;case ECommand.WL:this.private_WriteCommandName("WL");this.private_WriteReal(d);break;case ECommand.PL:this.private_WriteCommandName("PL"),this.private_WriteSimpleText(d===BOARD_WHITE?"W":"B")}}b=a.Get_Comment();""!==b&&(b=b.replace(RegExp("]","g"),"\\]"),this.private_WriteCommandName("C"),this.private_WriteString("["),this.private_WriteString(b),this.private_WriteString("]"));null!==this.m_oColorTable&&this.private_WriteNodeColorMap(a)};
CSgfWriter.prototype.private_Write=function(a){var b=a.Get_Prev(),c=!1;if(null===b||1<b.Get_NextsCount())c=!0;c&&this.private_WriteString("(");this.private_WriteNode(a);b=0;for(var d=a.Get_NextsCount();b<d;b++)this.private_Write(a.Get_Next(b));c&&this.private_WriteString(")")};
CSgfWriter.prototype.private_WriteColorTable=function(a){var b=new CStreamWriter;b.Write_String("SGFCT");b.Write_Short(1);b.Write_Long(a.length);for(var c=0,d=a.length;c<d;c++)b.Write_Long(a[c]);a=Common.Encode_Base64(b.Get_Bytes());this.private_WriteCommand("CT",a)};
CSgfWriter.prototype.private_WriteNodeColorMap=function(a){var b=new CStreamWriter;b.Write_String("SGFCM");b.Write_Short(1);var c=this.m_oGameTree.Get_Board().Get_Size(),d=c.X;c=c.Y;b.Write_Short(d);b.Write_Short(c);for(var e=!1,f=0;f<c;f++)for(var g=0;g<d;g++){var h=a.m_oColorMap[Common_XYtoValue(g+1,f+1)];h?(h=h.ToLong(),void 0!==this.m_oColorTable[h]?(b.Write_Byte(this.m_oColorTable[h]),e=!0):b.Write_Byte(0)):b.Write_Byte(0)}!0===e&&(a=Common.Encode_Base64(b.Get_Bytes()),this.private_WriteCommand("CM",
a))};
CSgfWriter.prototype.private_WriteAddOrRemoveStones=function(a){for(var b=[],c=[],d=[],e=0,f=a.Get_CommandsCount();e<f;e++){var g=a.Get_Command(e),h=g.Get_Type();g=g.Get_Value();switch(h){case ECommand.AB:case ECommand.AW:case ECommand.AE:for(var k=0,l=g.length;k<l;k++){for(var m=g[k],n=0,p=b.length;n<p;n++)m===b[n]&&(b.splice(n,1),p--,n--);n=0;for(p=c.length;n<p;n++)m===c[n]&&(c.splice(n,1),p--,n--);n=0;for(p=d.length;n<p;n++)m===d[n]&&(d.splice(n,1),p--,n--);ECommand.AB===h?b.push(m):ECommand.AW===h?
c.push(m):ECommand.AE===h&&d.push(m)}}}0<b.length&&(this.private_WriteCommandName("AB"),this.private_WritePosArray(b));0<c.length&&(this.private_WriteCommandName("AW"),this.private_WritePosArray(c));0<d.length&&(this.private_WriteCommandName("AE"),this.private_WritePosArray(d))};
CSgfWriter.prototype.private_WriteMarks=function(a){for(var b=[[],[],[],[],[],[]],c=[],d=0,e=a.Get_CommandsCount();d<e;d++){var f=a.Get_Command(d),g=f.Get_Type(),h=f.Get_Value(),k=-1;switch(g){case ECommand.LB:k=0;h=[h.Pos];break;case ECommand.CR:k=1;break;case ECommand.MA:k=2;break;case ECommand.SQ:k=3;break;case ECommand.TR:k=4;break;case ECommand.RM:k=5}g=0;for(var l=h.length;g<l;g++)for(var m=h[g],n=0,p=b.length;n<p;n++)if(n===k)b[n].push(m),0==n&&c.push(f.Get_Value().Text);else for(var q=0,t=
b[n].length;q<t;q++)m===b[n][q]&&(b[n].splice(q,1),0===n&&c.splice(q,1),t--,q--)}if(0<b[0].length)for(this.private_WriteCommandName("LB"),g=0,e=b[0].length;g<e;g++)this.private_WriteString("["),this.private_WritePos2(b[0][g]),this.private_WriteString(":"+c[g]+"]");0<b[1].length&&(this.private_WriteCommandName("CR"),this.private_WritePosArray(b[1]));0<b[2].length&&(this.private_WriteCommandName("MA"),this.private_WritePosArray(b[2]));0<b[3].length&&(this.private_WriteCommandName("SQ"),this.private_WritePosArray(b[3]));
0<b[4].length&&(this.private_WriteCommandName("TR"),this.private_WritePosArray(b[4]))};function CTerritory(a,b){this.m_bUse=a;this.m_aPoints=b;this.m_bForceUse=!1}CTerritory.prototype.CopyFrom=function(a){this.m_bUse=a.m_bUse;this.m_bForceUse=a.m_bForceUse;this.m_aPoints={};for(var b in a.m_aPoints)this.m_aPoints[b]=a.m_aPoints[b]};CTerritory.prototype.Is_Use=function(){return!0===this.Is_ForceUse()?!0:this.m_bUse};CTerritory.prototype.Is_ForceUse=function(){return this.m_bForceUse};CTerritory.prototype.Set_Use=function(a){this.m_bUse=a};
CTerritory.prototype.Set_ForceUse=function(a){this.m_bForceUse=a};CTerritory.prototype.Add_Point=function(a,b){this.m_aPoints[""+a]=b};CTerritory.prototype.Remove_Point=function(a){delete this.m_aPoints[""+a]};CTerritory.prototype.Clear_Points=function(){this.m_aPoints={}};CTerritory.prototype.Fill_PointsToLogicBoard=function(a){for(var b in this.m_aPoints){var c=Common_ValuetoXY(parseInt(b));a.Set_ScorePoint(c.X,c.Y,this.m_aPoints[b])}};
CTerritory.prototype.Fill_PointsFromLogicBoard=function(a){this.Clear_Points();for(var b=a.Get_Size(),c=1;c<=b.Y;c++)for(var d=1;d<=b.X;d++){var e=a.Get_ScorePoint(d,c),f=Common_XYtoValue(d,c);BOARD_BLACK!==e&&BOARD_WHITE!==e||this.Add_Point(f,e)}};CGoBoardApi.prototype.Version="0.10.10";var EBoardMode={Move:0,CountScores:1,AddRemove:2,AddMarkTr:3,AddMarkSq:4,AddMarkCr:5,AddMarkX:6,AddMarkTx:7,AddMarkNum:8,ScoreEstimate:9,AddMarkColor:10,ViewPort:11};
function CDrawingBoard(a){this.m_oDrawing=a;this.m_oLogicBoard=this.m_oGameTree=null;this.m_eMode=EBoardMode.Move;this.m_bRulers=g_oGlobalSettings.Is_Rulers();this.m_dKoeffDiam=this.m_dKoeffCellH=this.m_dKoeffCellW=this.m_dKoeffOffsetX=this.m_dKoeffOffsetY=0;this.m_oBoardPosition={};this.m_oCreateWoodyId=null;this.m_bBlackWhiteLastMark=!1;this.m_oImageData={W:0,H:0,W2:0,H2:0,StoneDiam:0,ShadowOff:0,HandiRad:2,Lines:null,Handi:null,Board:null,BlackStone:null,WhiteStones:[],WhiteStones2:Array(361),
BlackTarget:null,WhiteTarget:null,ResizeBoard:null,X_Black:null,X_White:null,Tr_Black:null,Tr_White:null,Tr_Hint:null,Sq_Black:null,Sq_White:null,Ter_Black:null,Ter_White:null,Ter_Black2:null,Ter_White2:null,LastMove:null,Cr_Black:null,Cr_White:null,RcolorTarget:null,GcolorTarget:null,BcolorTarget:null,AcolorTarget:null};this.m_oVariantsColor=new CColor(255,0,0,128);this.HtmlElement={Control:null,Board:{Control:null},Lines:{Control:null},Stones:{Control:null},Colors:{Control:null},Shadow:{Control:null},
Variants:{Control:null},Marks:{Control:null},Select:{Control:null},Target:{Control:null},Event:{Control:null},LinkedControls:[]};this.m_oTarget=new CBoardTarget(this.m_oImageData,this);this.m_oColorMarks={};this.m_oMarks={};this.m_oLastMoveMark=-1;this.m_oHints={};this.m_oViewPort={X0:0,Y0:0,X1:18,Y1:18};this.m_oViewPortSelection={Start:!1,StartX:-1,StartY:-1,EndX:-1,EndY:-1};this.m_oPresentation=this.m_oEventsCatcher=null;this.m_bMouseDown=!1;var b=this;this.private_OnMouseMove=function(a){check_MouseMoveEvent(a);
a=b.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);a=b.private_GetBoardPosByXY(a.X,a.Y);b.private_MoveTarget(a.X,a.Y,global_mouseEvent,!1);b.private_HandleMouseMove(a.X,a.Y,global_mouseEvent)};this.private_OnMouseOut=function(a){check_MouseMoveEvent(a);!0===b.m_bMouseDown&&(b.m_bMouseDown=!1,b.private_OnMouseUp(a));b.private_HideTarget()};this.private_OnMouseDown=function(a){check_MouseDownEvent(a,!0);b.m_bMouseDown=!0;b.HtmlElement.Event.Control.HtmlElement.focus();var c=b.private_UpdateMousePos(global_mouseEvent.X,
global_mouseEvent.Y);c=b.private_GetBoardPosByXY(c.X,c.Y);b.private_HandleMouseDown(c.X,c.Y,global_mouseEvent);a.preventDefault();return!1};this.private_OnMouseUp=function(a){check_MouseMoveEvent(a);b.m_bMouseDown=!1;a=b.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y);a=b.private_GetBoardPosByXY(a.X,a.Y);b.private_HandleMouseUp(a.X,a.Y,global_mouseEvent)};this.private_OnMouseWheel=function(a){if(b.m_bMouseLock)return!1;0>(void 0!=a.wheelDelta?a.wheelDelta:-a.detail)?b.m_oGameTree.Step_Forward(1):
b.m_oGameTree.Step_Backward(1);a.preventDefault&&a.preventDefault();return!1};this.private_OnKeyDown=function(a){check_KeyboardEvent(a);if(16===global_keyboardEvent.KeyCode&&EBoardMode.AddRemove===b.Get_Mode()){global_mouseEvent.ShiftKey=!0;b.private_UpdateTargetType();var c=!0}else 16!==global_keyboardEvent.KeyCode&&17!==global_keyboardEvent.KeyCode||EBoardMode.AddMarkColor!==b.Get_Mode()?(c=b.private_HandleKeyDown(global_keyboardEvent),!0===c&&112<=global_keyboardEvent.KeyCode&&121>=global_keyboardEvent.KeyCode?
b.private_UpdateTargetType():!0===c&&b.private_HideTarget()):(16===global_keyboardEvent.KeyCode?global_mouseEvent.ShiftKey=!0:17===global_keyboardEvent.KeyCode&&(global_mouseEvent.CtrlKey=!0),b.private_UpdateTargetType(),c=!0);!0===c&&a.preventDefault();return c?!1:!0};this.private_OnKeyUp=function(a){check_KeyboardEvent(a);16===global_keyboardEvent.KeyCode&&EBoardMode.AddRemove===b.Get_Mode()?(global_mouseEvent.ShiftKey=!1,b.private_UpdateTargetType()):16!==global_keyboardEvent.KeyCode&&17!==global_keyboardEvent.KeyCode||
EBoardMode.AddMarkColor!==b.Get_Mode()||(16===global_keyboardEvent.KeyCode?global_mouseEvent.ShiftKey=!1:17===global_keyboardEvent.KeyCode&&(global_mouseEvent.CtrlKey=!1),b.private_UpdateTargetType())};this.private_OnKeyPress=function(a){};this.private_StartDrawingTimer=function(){return setTimeout(function(){b.private_CreateTrueColorBoard();b.private_CreateLines();b.private_CreateTrueColorStones();b.private_CreateShadows();b.private_CreateMarks();b.private_OnResize();b.m_oImageData.ResizeBoard=b.Get_FullImage(!0)},
20)};this.private_OnDragover=function(a){a.preventDefault();return!1};this.private_OnDrop=function(a){a.preventDefault();if(0<a.dataTransfer.files.length&&FileReader){a=a.dataTransfer.files[0];var c=a.name.split(".").pop().toLowerCase(),e=new FileReader;e.onload=function(a){b.m_oGameTree.Load_Sgf(a.target.result,null,null,c)};e.readAsText(a);b.Focus()}};this.private_OnContextMenu=function(a){a.preventDefault();return!1}}
CDrawingBoard.prototype.Init=function(a,b){this.m_oDrawing&&this.m_oDrawing.Register_Board(this);this.Set_GameTree(b);this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement,d=a+"_BoardCanvas",e=a+"_LinesCanvas",f=a+"_ColorCanvas",g=a+"_ShadowsCanvas",h=a+"_StonesCanvas",k=a+"_VariantsCanvas",l=a+"_MarksCanvas",m=a+"_TargetCanvas",n=a+"_SelectCanvas",p=a+"_CursorCanvas",q=a+"_EventDiv";this.private_CreateCanvasElement(c,d);this.private_CreateCanvasElement(c,e);
this.private_CreateCanvasElement(c,f);this.private_CreateCanvasElement(c,g);this.private_CreateCanvasElement(c,h);this.private_CreateCanvasElement(c,k);this.private_CreateCanvasElement(c,l);this.private_CreateCanvasElement(c,n);this.private_CreateCanvasElement(c,m);this.private_CreateDivElement(c,p);c=this.private_CreateDivElement(c,q);this.m_oTarget.Init(p);p=this.HtmlElement.Control;this.private_FillHtmlElement(this.HtmlElement.Board,p,d);this.private_FillHtmlElement(this.HtmlElement.Lines,p,e);
this.private_FillHtmlElement(this.HtmlElement.Colors,p,f);this.private_FillHtmlElement(this.HtmlElement.Shadow,p,g);this.private_FillHtmlElement(this.HtmlElement.Stones,p,h);this.private_FillHtmlElement(this.HtmlElement.Variants,p,k);this.private_FillHtmlElement(this.HtmlElement.Marks,p,l);this.private_FillHtmlElement(this.HtmlElement.Select,p,n);this.private_FillHtmlElement(this.HtmlElement.Target,p,m);this.private_FillHtmlElement(this.HtmlElement.Event,p,q);c.onmousemove=this.private_OnMouseMove;
c.onmouseout=this.private_OnMouseOut;c.onmousedown=this.private_OnMouseDown;c.onmouseup=this.private_OnMouseUp;c.onkeydown=this.private_OnKeyDown;c.onkeyup=this.private_OnKeyUp;c.onkeypress=this.private_OnKeyPress;c.tabIndex=-1;c.style.hidefocus=!0;c.style.outline=0;c.ondragover=this.private_OnDragover;c.ondrop=this.private_OnDrop;c.onmousewheel=this.private_OnMouseWheel;c.addEventListener&&(c.addEventListener("contextmenu",this.private_OnContextMenu,!1),c.addEventListener("DOMMouseScroll",this.private_OnMouseWheel,
!1));return p};CDrawingBoard.prototype.Add_LinkedControl=function(a){this.HtmlElement.LinkedControls.push(a)};CDrawingBoard.prototype.Focus=function(){this.HtmlElement.Event.Control.HtmlElement.focus()};CDrawingBoard.prototype.Set_Rulers=function(a){a!==this.m_bRulers&&(g_oGlobalSettings.Set_Rulers(a),this.m_bRulers=a,this.m_oDrawing.Update_Size(!0))};CDrawingBoard.prototype.Get_Rulers=function(){return this.m_bRulers};CDrawingBoard.prototype.Set_ShellWhiteStones=function(a){this.m_oGameTree&&this.m_oGameTree.Get_LocalSettings().Set_BoardShellWhiteStones(a)};
CDrawingBoard.prototype.Set_BlackWhiteLastMark=function(a){this.m_bBlackWhiteLastMark=a};
CDrawingBoard.prototype.Get_FullImage=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=this.HtmlElement.Board.Control.HtmlElement.width;b.height=this.HtmlElement.Board.Control.HtmlElement.height;c.drawImage(this.HtmlElement.Board.Control.HtmlElement,0,0);c.drawImage(this.HtmlElement.Lines.Control.HtmlElement,0,0);!0===a&&c.drawImage(this.HtmlElement.Colors.Control.HtmlElement,0,0);c.drawImage(this.HtmlElement.Shadow.Control.HtmlElement,0,0);c.drawImage(this.HtmlElement.Stones.Control.HtmlElement,
0,0);c.drawImage(this.HtmlElement.Marks.Control.HtmlElement,0,0);return b};CDrawingBoard.prototype.Update_Size=function(a){var b=this.HtmlElement.Control.HtmlElement.clientWidth,c=this.HtmlElement.Control.HtmlElement.clientHeight,d=this.Get_AspectRatio(),e=c*d;e<=b?b=e:c=b/d;if(b!==this.m_oImageData.W2||c!==this.m_oImageData.H2||!0===a)this.m_oImageData.W2=b,this.m_oImageData.H2=c,this.HtmlElement.Control.Resize(b,c),this.private_UpdateKoeffs(),this.private_OnResize(a)};
CDrawingBoard.prototype.Set_Presentation=function(a){this.m_oPresentation=a};CDrawingBoard.prototype.On_Resize=function(a){this.private_UpdateKoeffs();this.private_OnResize(a)};CDrawingBoard.prototype.On_EndLoadSgf=function(){this.m_oImageData.ResizeBoard=null;null!==this.m_oPresentation&&this.m_oGameTree.Get_CurNode().Count_NodeNumber()>=this.m_oPresentation.Get_NodesCountInSlide()&&this.m_oPresentation.On_EndSgfSlide()};
CDrawingBoard.prototype.Set_ViewPort=function(a,b,c,d){var e=this.m_oLogicBoard.Get_Size(),f=e.X;e=e.Y;this.m_oViewPort.X0=Math.max(0,Math.min(f-1,a));this.m_oViewPort.Y0=Math.max(0,Math.min(e-1,b));this.m_oViewPort.X1=Math.max(0,Math.min(f-1,c));this.m_oViewPort.Y1=Math.max(0,Math.min(e-1,d));this.m_oViewPort.X1<=this.m_oViewPort.X0&&(this.m_oViewPort.X0=0,this.m_oViewPort.X1=f-1);this.m_oViewPort.Y1<=this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=0,this.m_oViewPort.Y1=e-1)};
CDrawingBoard.prototype.Get_ViewPort=function(){return this.m_oViewPort};CDrawingBoard.prototype.Reset_ViewPort=function(){var a=this.m_oLogicBoard.Get_Size(),b=a.X;a=a.Y;this.m_oViewPort.X0=0;this.m_oViewPort.Y0=0;this.m_oViewPort.X1=b-1;this.m_oViewPort.Y1=a-1};CDrawingBoard.prototype.Get_ViewPort=function(){return this.m_oViewPort};
CDrawingBoard.prototype.Get_SelectedViewPort=function(){return{X0:Math.min(this.m_oViewPortSelection.StartX,this.m_oViewPortSelection.EndX),Y0:Math.min(this.m_oViewPortSelection.StartY,this.m_oViewPortSelection.EndY),X1:Math.max(this.m_oViewPortSelection.StartX,this.m_oViewPortSelection.EndX),Y1:Math.max(this.m_oViewPortSelection.StartY,this.m_oViewPortSelection.EndY)}};
CDrawingBoard.prototype.Draw_Sector=function(a,b,c){if(this.m_oImageData.Lines&&c!==this.m_oBoardPosition[Common_XYtoValue(a,b)]){var d=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d"),e=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d"),f=this.m_oImageData.StoneDiam,g=(f-1)/2,h=this.m_oImageData.Lines,k=this.m_oImageData.ShadowOff,l=this.private_GetSettings_Shadows();if(!0===this.private_IsPointInViewPort(a-1,b-1)){var m=h[a-1].X-g;g=h[b-1].Y-g;d.clearRect(m,g,f,f);!0===l&&
e.clearRect(m+k,g+k,f,f);switch(c){case BOARD_BLACK:d.drawImage(this.m_oImageData.BlackStone,m,g);!0===l&&e.drawImage(this.m_oImageData.Shadow,m+k,g+k);break;case BOARD_WHITE:f=this.m_oImageData.WhiteStones2[a-1+(b-1)*this.m_oLogicBoard.Get_Size().X],d.drawImage(this.m_oImageData.WhiteStones[f],m,g),!0===l&&e.drawImage(this.m_oImageData.Shadow,m+k,g+k)}}this.m_oBoardPosition[Common_XYtoValue(a,b)]=c;!0===this.m_oTarget.Check_XY(a,b)&&this.private_UpdateTargetType()}};
CDrawingBoard.prototype.Get_BoardState=function(){var a={},b={};for(d in this.m_oBoardPosition)a[d]=this.m_oBoardPosition[d];for(var c in this.m_oMarks){var d=parseInt(c);var e=this.m_oMarks[c];EDrawingMark.Tx===e.Get_Type()&&BOARD_EMPTY===this.m_oLogicBoard.Get(e.Get_X(),e.Get_Y())?b[d]=!1:b[d]=!0}return{Stones:a,Marks:b}};
CDrawingBoard.prototype.Get_BoardAreaByPosition=function(a,b,c,d){if(!0!==this.private_IsPointInViewPort(a-1,b-1))return null;var e=this.m_oImageData.Lines;if(!0===d){d=this.m_oImageData.StoneDiam;var f=(d-1)/2;c=c?this.m_oImageData.ShadowOff:0;a=e[a-1].X-f;e=e[b-1].Y-f;return{X0:a,Y0:e,X1:a+d+c,Y1:e+d+c}}d=e[a-1].X_L2;b=e[b-1].Y_L2;return{X0:d,Y0:b,X1:d+(e[1].X-e[0].X+2),Y1:b+(e[1].Y-e[0].Y+2)}};CDrawingBoard.prototype.Show_Target=function(){this.private_UpdateTargetType()};
CDrawingBoard.prototype.Remove_Mark=function(a,b){var c=Common_XYtoValue(a,b);delete this.m_oMarks[""+c];c===this.m_oLastMoveMark&&(this.m_oMarks[""+c]=new CDrawingMark(a,b,EDrawingMark.Lm,""))};CDrawingBoard.prototype.Get_Mark=function(a,b){var c=Common_XYtoValue(a,b);return(c=this.m_oMarks[""+c])?c:null};CDrawingBoard.prototype.Add_Mark=function(a){this.private_SetMark(a.Get_X(),a.Get_Y(),a)};CDrawingBoard.prototype.Remove_AllMarks=function(){this.m_oMarks={}};
CDrawingBoard.prototype.Draw_Marks=function(){this.private_DrawMarks()};CDrawingBoard.prototype.Draw_AllStones=function(){this.private_DrawTrueColorAllStones()};CDrawingBoard.prototype.Set_LastMoveMark=function(a,b){this.private_SetLastMoveMark(a,b)};CDrawingBoard.prototype.Set_EstimateMode=function(a){this.m_oEventsCatcher=a;this.Set_Mode(EBoardMode.ScoreEstimate)};CDrawingBoard.prototype.Set_ViewPortMode=function(){this.Set_Mode(EBoardMode.ViewPort)};
CDrawingBoard.prototype.Set_GameTree=function(a){this.m_oGameTree=a;this.m_oLogicBoard=a.Get_Board();a.Set_DrawingBoard(this);this.Reset_ViewPort()};
CDrawingBoard.prototype.Estimate_Scores=function(){this.m_oLogicBoard.Init_ScoreEstimate();var a=this.m_oLogicBoard.Estimate_Scores(this);if(this.m_oEventsCatcher){var b=a.BlackReal+this.m_oGameTree.Get_BlackCapt()-a.WhiteReal-this.m_oGameTree.Get_WhiteCapt()-this.m_oGameTree.Get_Komi();this.m_oEventsCatcher.On_EstimateEnd(a.BlackReal,a.WhiteReal,a.BlackPotential,a.WhitePotential,b)}this.m_oGameTree.Update_InterfaceState()};
CDrawingBoard.prototype.Set_Mode=function(a){(this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_BOARDMODE||a===EBoardMode.ScoreEstimate||a===EBoardMode.ViewPort)&&this.m_eMode!==a&&(EBoardMode.CountScores===this.m_eMode&&this.m_oGameTree.Clear_TerritoryPoints(),this.m_eMode=a,this.private_UpdateTargetType(),EBoardMode.CountScores===a?(this.m_oLogicBoard.Init_CountScores(),this.m_oGameTree.Count_Scores()):EBoardMode.ScoreEstimate===a&&this.Estimate_Scores(),this.m_oGameTree.Update_InterfaceState())};
CDrawingBoard.prototype.Get_Mode=function(){return this.m_eMode};CDrawingBoard.prototype.Start_CountScoresInMatch=function(){this.m_eMode=EBoardMode.CountScores;this.private_UpdateTargetType();this.m_oGameTree.Count_Scores();this.m_oGameTree.Update_InterfaceState()};CDrawingBoard.prototype.End_CountScoresInMatch=function(){this.m_eMode=EBoardMode.Move;this.private_UpdateTargetType();this.m_oGameTree.Update_InterfaceState()};
CDrawingBoard.prototype.private_DrawVariants=function(){this.m_oGameTree&&this.m_oGameTree.Show_Variants()};CDrawingBoard.prototype.Draw_Variant=function(a,b){if(this.m_oImageData.Lines){var c=(this.m_oImageData.StoneDiam/2-1)/2,d=this.m_oImageData.Lines;if(!0===this.private_IsPointInViewPort(a-1,b-1)){var e=d[a-1].X;d=d[b-1].Y;var f=this.HtmlElement.Variants.Control.HtmlElement.getContext("2d");f.fillStyle=this.m_oVariantsColor.ToString();f.beginPath();f.arc(e,d,c,0,2*Math.PI,!1);f.fill()}}};
CDrawingBoard.prototype.Clear_Variants=function(){this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,0,this.m_oImageData.W,this.m_oImageData.H)};
CDrawingBoard.prototype.Get_AspectRatio=function(){var a=this.m_oLogicBoard.Get_Size(),b=a.X;a=a.Y;var c=(this.m_oViewPort.X1-this.m_oViewPort.X0)*g_dBoardCellW+2*g_dBoardHorOffset,d=(this.m_oViewPort.Y1-this.m_oViewPort.Y0)*g_dBoardCellW+2*g_dBoardHorOffset;!0===this.m_bRulers&&(c+=g_dBoardCellW,d+=g_dBoardCellW);0<this.m_oViewPort.X0&&(c+=g_dBoardCellW_2/2);this.m_oViewPort.X1<b-1&&(c+=g_dBoardCellW_2/2);0<this.m_oViewPort.Y0&&(d+=g_dBoardCellW_2/2);this.m_oViewPort.Y1<a-1&&(d+=g_dBoardCellW_2/
2);return c/d};CDrawingBoard.prototype.private_CreateCanvasElement=function(a,b){var c=document.createElement("canvas");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CDrawingBoard.prototype.private_CreateDivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};CDrawingBoard.prototype.private_FillHtmlElement=function(a,b,c){a.Control=CreateControlContainer(c);a=a.Control;a.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;b.AddControl(a)};
CDrawingBoard.prototype.private_UpdateMousePos=function(a,b){var c=Common_FindPosition(this.HtmlElement.Board.Control.HtmlElement);return{X:a-c.X,Y:b-c.Y}};
CDrawingBoard.prototype.private_UpdateKoeffs=function(){var a=this.m_oLogicBoard.Get_Size(),b=a.X;a=a.Y;this.m_oViewPort.X0=Math.max(0,Math.min(b-1,this.m_oViewPort.X0));this.m_oViewPort.Y0=Math.max(0,Math.min(a-1,this.m_oViewPort.Y0));this.m_oViewPort.X1=Math.max(0,Math.min(b-1,this.m_oViewPort.X1));this.m_oViewPort.Y1=Math.max(0,Math.min(a-1,this.m_oViewPort.Y1));this.m_oViewPort.X1<=this.m_oViewPort.X0&&(this.m_oViewPort.X0=0,this.m_oViewPort.X1=b-1);this.m_oViewPort.Y1<=this.m_oViewPort.Y0&&(this.m_oViewPort.Y0=
0,this.m_oViewPort.Y1=a-1);var c=(this.m_oViewPort.X1-this.m_oViewPort.X0)*g_dBoardCellW+2*g_dBoardHorOffset,d=(this.m_oViewPort.Y1-this.m_oViewPort.Y0)*g_dBoardCellW+2*g_dBoardHorOffset,e=g_dBoardHorOffset,f=g_dBoardHorOffset;!0===this.m_bRulers&&(c+=g_dBoardCellW,d+=g_dBoardCellW,e+=g_dBoardCellW_2,f+=g_dBoardCellW_2);0<this.m_oViewPort.X0&&(c+=g_dBoardCellW_2/2,e+=g_dBoardCellW_2/2);this.m_oViewPort.X1<b-1&&(c+=g_dBoardCellW_2/2);0<this.m_oViewPort.Y0&&(d+=g_dBoardCellW_2/2,f+=g_dBoardCellW_2/
2);this.m_oViewPort.Y1<a-1&&(d+=g_dBoardCellW_2/2);this.m_dKoeffCellH=g_dBoardCellW/d;this.m_dKoeffCellW=g_dBoardCellW/c;this.m_dKoeffOffsetX=e/c;this.m_dKoeffOffsetY=f/d;this.m_dKoeffDiam=4/c};
CDrawingBoard.prototype.private_OnResize=function(a){var b=this.HtmlElement.Board.Control.HtmlElement.width,c=this.HtmlElement.Board.Control.HtmlElement.height;b!=this.m_oImageData.W||c!=this.m_oImageData.H||null===this.m_oImageData.Board||null!==this.m_oCreateWoodyId||!0===a?(null!==this.m_oCreateWoodyId&&clearTimeout(this.m_oCreateWoodyId),this.m_oCreateWoodyId=this.private_StartDrawingTimer(),this.private_CreateLines(),this.private_DrawSimpleBoard(b,c)):this.private_DrawTrueColorFullBoard();EBoardMode.ViewPort===
this.m_eMode&&this.private_UpdateSelectCanvas()};
CDrawingBoard.prototype.private_DrawSimpleBoard=function(a,b){if(0!==a&&0!==b)if(null!==this.m_oImageData.ResizeBoard)this.HtmlElement.Board.Control.HtmlElement.getContext("2d").drawImage(this.m_oImageData.ResizeBoard,0,0,a,b);else{var c=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");c.fillStyle=this.private_GetSettings_BoardColor().ToString();c.fillRect(0,0,a,b);var d=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d");c=this.m_dKoeffCellW*a;var e=this.m_dKoeffCellH*b,f=this.m_dKoeffOffsetX*
a-this.m_oViewPort.X0*c,g=this.m_dKoeffOffsetY*b-this.m_oViewPort.Y0*e,h=this.m_oLogicBoard.Get_Size();d.clearRect(0,0,a,b);d.strokeStyle=this.private_GetSettings_LinesColor().ToString();for(var k=f+(h.X-1)*c,l=0;l<h.Y;l++){var m=g+l*e;d.beginPath();d.moveTo(f,m);d.lineTo(k,m);d.stroke()}k=g+(h.Y-1)*e;for(var n=0;n<h.X;n++)m=f+n*c,d.beginPath(),d.moveTo(m,g),d.lineTo(m,k),d.stroke();d.fillStyle=this.private_GetSettings_LinesColor().ToString();l=Math.max(2,this.m_dKoeffDiam*a/2);n=this.m_oLogicBoard.Get_HandiPoints();
for(var p=0,q=n.length;p<q;p++)k=f+n[p][0]*c,m=g+n[p][1]*c,d.beginPath(),d.arc(k,m,l,0,2*Math.PI,!1),d.fill();d=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d");d.clearRect(0,0,a,b);d.strokeStyle=this.private_GetSettings_LinesColor().ToString();d.lineWidth=1;p=(new CColor(0,0,0,255)).ToString();q=(new CColor(255,255,255,255)).ToString();for(l=1;l<=h.Y;l++)for(n=1;n<=h.X;n++){k=this.m_oLogicBoard.Get(n,l);if(BOARD_BLACK===k)d.fillStyle=p;else if(BOARD_WHITE===k)d.fillStyle=q;else continue;
k=f+(n-1)*c;m=g+(l-1)*e;d.beginPath();d.arc(k,m,c/2,0,2*Math.PI,!1);d.fill();d.stroke()}this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Target.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Select.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b)}};
CDrawingBoard.prototype.private_CreateTrueColorBoard=function(){var a=this.HtmlElement.Board.Control.HtmlElement.width,b=this.HtmlElement.Board.Control.HtmlElement.height,c=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");if(0!==a&&0!==b){c=c.createImageData(a,b);var d=this.private_GetSettings_BoardColor(),e=d.r,f=d.g;d=d.b;var g=100/a,h=1.6,k=2.72;var l=2432/150;for(var m=Array(a),n=0,p=0;n<a;n++,p+=g)m[n]=.6+h*p+k*p*p*p+l*p*p*p*p*p;g=Array(b);n=1/b;h=.02;k=.004;l=.04/15;var q=0;for(p=
0;q<b;q++,p+=n)g[q]=h*p+k*p*p*p+l*p*p*p*p*p;if(!0===this.private_GetSettings_TrueColorBoard())for(q=0;q<b;q++)for(n=0;n<a;n++){l=40*(m[n]+g[q])+.5;l-=Math.floor(l);l=.2>l?1-l/2:.4>l?1-(.4-l)/2:1;if(q==b-1||q==b-2&&n<a-2||n>=a-1||n==a-2&&q<b-1)l/=2;0==q||1==q&&1<n||0==n||1==n&&1<q?(h=128+e*l/2,k=128+f*l/2,l=128+d*l/2):(h=e*l,k=f*l,l*=d);p=4*(n+q*a);c.data[p+0]=h;c.data[p+1]=k;c.data[p+2]=l;c.data[p+3]=255}else for(q=0;q<b;q++)for(n=0;n<a;n++)0==q||1==q&&1<n||0==n||1==n&&1<q?(h=128+e/2,k=128+f/2,l=
128+d/2):(h=e,k=f,l=d),p=4*(n+q*a),c.data[p+0]=h,c.data[p+1]=k,c.data[p+2]=l,c.data[p+3]=255;this.m_oImageData.Board=this.private_CreateCanvas(a,b,c);this.m_oImageData.W=a;this.m_oImageData.H=b;this.m_oCreateWoodyId=null}};CDrawingBoard.prototype.private_DrawTrueColorFullBoard=function(){this.private_DrawTrueColorBoard();this.private_DrawRulers();this.private_DrawTrueColorLines();this.private_RedrawTrueColorAllStones();this.private_DrawAllColorMarks();this.private_DrawMarks();this.private_DrawVariants()};
CDrawingBoard.prototype.private_DrawTrueColorBoard=function(){this.HtmlElement.Board.Control.HtmlElement.getContext("2d").drawImage(this.m_oImageData.Board,0,0)};
CDrawingBoard.prototype.private_CreateLines=function(){var a=this.m_oImageData.W,b=this.m_oImageData.H;if(0!==a&&0!==b){var c=this.m_dKoeffOffsetX*a,d=this.m_dKoeffOffsetY*b;b*=this.m_dKoeffCellH;var e=this.m_dKoeffCellW*a,f=this.m_oLogicBoard.Get_Size(),g=Math.max(f.X,f.Y);f=Array(f.X);c-=e*this.m_oViewPort.X0;d-=b*this.m_oViewPort.Y0;for(var h,k,l,m,n,p,q,t,r,A,y=0;y<g;y++)h=c+y*e,l=c+y*e+.6*e,n=c+y*e-.6*e,q=c+y*e+.5*e,r=c+y*e-.5*e,k=d+y*b,m=d+y*b+.6*b,p=d+y*b-.6*b,t=d+y*b+.5*b,A=d+y*b-.5*b,f[y]=
{X:Math.floor(h+.5),X_G:Math.floor(l+.5),X_L:Math.floor(n+.5),X_G2:Math.floor(q+.5),X_L2:Math.floor(r+.5),Y:Math.floor(k+.5),Y_G:Math.floor(m+.5),Y_L:Math.floor(p+.5),Y_G2:Math.floor(t+.5),Y_L2:Math.floor(A+.5)};this.m_oImageData.Lines=f;a=Math.max(2,Math.ceil(this.m_dKoeffDiam*a/2));b=2*a+1;e=this.private_GetSettings_LinesColor();this.m_oImageData.Handi=this.private_DrawHandiMark(a,a,a,b+2,b+2,e);this.m_oImageData.HandiRad=a+1}};
CDrawingBoard.prototype.private_DrawTrueColorLines=function(a){if(this.m_oImageData.Lines){var b=this.m_oImageData.W,c=this.m_oImageData.H,d=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),e=this.m_oLogicBoard.Get_Size(),f=this.m_oImageData.Lines;d.clearRect(0,0,b,c);for(var g=this.m_oImageData.Handi,h=this.m_oImageData.HandiRad,k=this.m_oLogicBoard.Get_HandiPoints(),l=0,m=k.length;l<m;l++)!0===this.private_IsPointInViewPort(k[l][0],k[l][1])&&d.drawImage(g,f[k[l][0]].X-h,f[k[l][1]].Y-
h);k=0===this.m_oViewPort.X0?f[this.m_oViewPort.X0].X:f[this.m_oViewPort.X0].X_L;l=e.X-1===this.m_oViewPort.X1?f[this.m_oViewPort.X1].X:f[this.m_oViewPort.X1].X_G;var n=0===this.m_oViewPort.Y0?f[this.m_oViewPort.Y0].Y:f[this.m_oViewPort.Y0].Y_L,p=e.Y-1===this.m_oViewPort.Y1?f[this.m_oViewPort.Y1].Y:f[this.m_oViewPort.Y1].Y_G;h=d.createImageData(1,c);m=d.createImageData(b,1);for(var q=this.private_GetSettings_LinesColor(),t=0;t<c;t++)g=4*t,t>=n&&t<=p&&(h.data[g+0]=q.r,h.data[g+1]=q.g,h.data[g+2]=q.b,
h.data[g+3]=q.a);for(t=0;t<b;t++)g=4*t,k<=t&&t<=l&&(m.data[g+0]=q.r,m.data[g+1]=q.g,m.data[g+2]=q.b,m.data[g+3]=q.a);for(b=0;b<e.X;b++)!0===this.private_IsVerLineInViewPort(b)&&d.putImageData(h,f[b].X,0);for(b=0;b<e.Y;b++)!0===this.private_IsHorLineInViewPort(b)&&d.putImageData(m,0,f[b].Y);if(void 0!==a)for(e=f[1].X-f[0].X+2,b=f[1].Y-f[0].Y+2,g=0,m=a.length;g<m;g++)c=a[g].X,h=a[g].Y,!0===this.private_IsPointInViewPort(c-1,h-1)&&BOARD_EMPTY===this.m_oLogicBoard.Get(c,h)&&d.clearRect(f[c-1].X_L2,f[h-
1].Y_L2,e,b)}};CDrawingBoard.prototype.private_DrawHandiMark=function(a,b,c,d,e,f){a=document.createElement("canvas").getContext("2d").createImageData(d,e);b=a.data;c=d/2-.5;for(var g=c-.2,h=0;h<d;h++)for(var k=0;k<d;k++){var l=h-c,m=k-c;l=g-Math.sqrt(l*l+m*m);m=4*(h*d+d-k-1);if(0<=l){var n=255;.8>=l&&(n=parseInt(255*(1-(.8-l)/.8)));b[m+0]=f.r;b[m+1]=f.g;b[m+2]=f.b;b[m+3]=n}else b[m+0]=0,b[m+1]=0,b[m+2]=0,b[m+3]=0}return this.private_CreateCanvas(d,e,a)};
CDrawingBoard.prototype.private_PutPixel=function(a,b,c,d,e,f,g){b=4*(b+c*e);a.data[b+0]=g.r;a.data[b+1]=g.g;a.data[b+2]=g.b;a.data[b+3]=d};CDrawingBoard.prototype.private_PutHorLine=function(a,b,c,d,e,f,g,h){for(;b<=c;b++)this.private_PutPixel(a,b,e,d,f,g,h)};CDrawingBoard.prototype.private_PutVerLine=function(a,b,c,d,e,f,g,h){for(;b<=c;b++)this.private_PutPixel(a,e,b,d,f,g,h)};
CDrawingBoard.prototype.private_CreateCanvas=function(a,b,c){var d=document.createElement("canvas");d.width=a;d.height=b;d.getContext("2d").putImageData(c,0,0);return d};
CDrawingBoard.prototype.private_CreateTrueColorStones=function(a){if(this.m_oImageData.Lines){var b=this.HtmlElement.Board.Control.HtmlElement.width,c=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d");a=2*Math.floor((a?a:Math.floor(this.m_dKoeffCellW*b))/2)+1;this.m_oImageData.StoneDiam=a;this.m_oTarget.Update_Size(a);var d=c.createImageData(a,a),e=c.createImageData(a,a),f=c.createImageData(a,a),g=c.createImageData(a,a),h=d.data;b=e.data;var k=f.data,l=g.data,m=this.private_GetSettings_WhiteColor(),
n=this.private_GetSettings_BlackColor(),p=this.private_GetSettings_DarkBoard();if(!0===this.private_GetSettings_TrueColorStones()){var q=a/2-.5,t=q-.2;m=Math.sqrt(3);for(var r=0;r<a;r++)for(var A=0;A<a;A++){var y=r-q,w=A-q,x=t-Math.sqrt(y*y+w*w),v=4*(r*a+a-A-1);if(0<=x){var B=t*t-y*y-w*w;B=0<B?Math.sqrt(B)*m:0;p=y;var L=w;n=Math.sqrt(6*(p*p+L*L+B*B));n=(2*B-p+L)/n;p=0;.9<n&&(p=10*(n-.9));B=255;.8>=x&&(x=(.8-x)/.8,B=.7,y-w<t/3&&(B=1),B=parseInt(255*(1-x*B)));y=parseInt(10+10*n+140*p);h[v+0]=y;h[v+
1]=y;h[v+2]=y;h[v+3]=B;k[v+0]=y;k[v+1]=y;k[v+2]=y;k[v+3]=parseInt(B/2);y=parseInt(200+10*n+45*p);b[v+0]=y;b[v+1]=y;b[v+2]=y;b[v+3]=B;l[v+0]=y;l[v+1]=y;l[v+2]=y;l[v+3]=parseInt(B/2)}else h[v+0]=0,h[v+1]=0,h[v+2]=0,h[v+3]=0,k[v+0]=0,k[v+1]=0,k[v+2]=0,k[v+3]=0,b[v+0]=0,b[v+1]=0,b[v+2]=0,b[v+3]=0,l[v+0]=0,l[v+1]=0,l[v+2]=0,l[v+3]=0}}else for(q=a/2-.5,t=q-.2,r=0;r<a;r++)for(A=0;A<a;A++)if(y=r-q,w=A-q,x=t-Math.sqrt(y*y+w*w),v=4*(r*a+a-A-1),0<=x){B=255;if(.8>=x){var E=(.8-x)/.8;B=.7;y-w<t/3&&(B=1);B=parseInt(255*
(1-E*B))}else 1.6>=x&&.8<=x&&!0===p&&(E=(1.6-x)/.8,B=.7,y-w<t/3&&(B=1),B=parseInt(E*B*255));L=!1;1.6>=x&&(L=!0);!1===L||!1===p?(h[v+0]=n.r,h[v+1]=n.g,h[v+2]=n.b,h[v+3]=B,k[v+0]=n.r,k[v+1]=n.g,k[v+2]=n.b,k[v+3]=parseInt(B/2)):(h[v+0]=m.r,h[v+1]=m.g,h[v+2]=m.b,h[v+3]=B,k[v+0]=m.r,k[v+1]=m.g,k[v+2]=m.b,k[v+3]=B);B=255;.8>=x?(E=(.8-x)/.8,B=.7,y-w<t/3&&(B=1),B=parseInt(255*(1-E*B))):1.6>=x&&.8<=x&&!1===p&&(E=(1.6-x)/.8,B=.7,y-w<t/3&&(B=1),B=parseInt(E*B*255));!1===L||!0===p?(b[v+0]=m.r,b[v+1]=m.g,b[v+
2]=m.b,b[v+3]=B,l[v+0]=m.r,l[v+1]=m.g,l[v+2]=m.b,l[v+3]=parseInt(B/2)):(b[v+0]=n.r,b[v+1]=n.g,b[v+2]=n.b,b[v+3]=B,l[v+0]=n.r,l[v+1]=n.g,l[v+2]=n.b,l[v+3]=B)}else h[v+0]=0,h[v+1]=0,h[v+2]=0,h[v+3]=0,k[v+0]=0,k[v+1]=0,k[v+2]=0,k[v+3]=0,b[v+0]=0,b[v+1]=0,b[v+2]=0,b[v+3]=0,l[v+0]=0,l[v+1]=0,l[v+2]=0,l[v+3]=0;this.m_oImageData.BlackStone=this.private_CreateCanvas(a,a,d);this.m_oImageData.WhiteStone=this.private_CreateCanvas(a,a,e);this.m_oImageData.BlackTarget=this.private_CreateCanvas(a,a,f);this.m_oImageData.WhiteTarget=
this.private_CreateCanvas(a,a,g);d=[];e=[];for(v=0;28>v;v++)for(d[v]=c.createImageData(a,a),e[v]=d[v].data,r=0;r<a;r++)for(A=0;A<a;A++)f=4*(r*a+A),e[v][f+0]=b[f+0],e[v][f+1]=b[f+1],e[v][f+2]=b[f+2],e[v][f+3]=b[f+3];e.push(l);e.push(b);!0===this.private_GetSettings_ShellWhiteStones()&&this.private_CreateShellWhiteStones(e,a,a);c=0;for(b=d.length;c<b;++c)this.m_oImageData.WhiteStones[c]=this.private_CreateCanvas(a,a,d[c]);c=this.m_oLogicBoard.Get_Size();for(a=0;a<c.Y;a++)for(b=0;b<c.X;b++)this.m_oImageData.WhiteStones2[b+
a*c.X]=Math.floor(Math.random()*(this.m_oImageData.WhiteStones.length-1))}};
CDrawingBoard.prototype.private_CreateShellWhiteStones=function(a,b,c){for(var d=b/51*978|0,e,f=Array(d),g=0;g<d;g++)f[g]=(Math.sin(18*g/d)+1)/20+(Math.sin(3*g/d)+1)/10;for(var h=Array(d),k=0;k<d;k++)h[k]=.2*Math.cos(5*k/d)+.1*Math.sin(11*k/d);var l=Array(d*d);for(k=0;k<d;k++)for(g=0;g<d;g++)e=90*(f[g]+h[k])+.5,e-=Math.floor(e),e=.2>e?1-e/2:.4>e?1-(.4-e)/2:1,l[g+k*d]=e;f=a.length;for(h=0;h<f;h++){var m=a[h];switch(h){case 0:var n=12*d/978|0;var p=163*d/978|0;break;case 1:n=12*d/978|0;p=213*d/978|
0;break;case 2:n=12*d/978|0;p=263*d/978|0;break;case 3:n=12*d/978|0;p=313*d/978|0;break;case 4:n=62*d/978|0;p=163*d/978|0;break;case 5:n=62*d/978|0;p=213*d/978|0;break;case 6:n=62*d/978|0;p=263*d/978|0;break;case 7:n=62*d/978|0;p=313*d/978|0;break;case 8:n=113*d/978|0;p=163*d/978|0;break;case 9:n=113*d/978|0;p=213*d/978|0;break;case 10:n=113*d/978|0;p=263*d/978|0;break;case 11:n=113*d/978|0;p=313*d/978|0;break;case 12:n=163*d/978|0;p=163*d/978|0;break;case 13:n=163*d/978|0;p=213*d/978|0;break;case 14:n=
163*d/978|0;p=263*d/978|0;break;case 15:n=163*d/978|0;p=313*d/978|0;break;case 16:n=213*d/978|0;p=163*d/978|0;break;case 17:n=213*d/978|0;p=213*d/978|0;break;case 18:n=213*d/978|0;p=263*d/978|0;break;case 19:n=213*d/978|0;p=313*d/978|0;break;case 20:n=263*d/978|0;p=163*d/978|0;break;case 21:n=263*d/978|0;p=213*d/978|0;break;case 22:n=263*d/978|0;p=263*d/978|0;break;case 23:n=263*d/978|0;p=313*d/978|0;break;case 24:n=313*d/978|0;p=163*d/978|0;break;case 25:n=313*d/978|0;p=213*d/978|0;break;case 26:n=
313*d/978|0;p=263*d/978|0;break;case 27:n=313*d/978|0;p=313*d/978|0;break;case 28:n=12*d/978|0;p=12*d/978|0;break;case 29:n=12*d/978|0,p=12*d/978|0}for(k=0;k<c;k++)for(g=0;g<b;g++){e=l[n+g+(p+k)*d];var q=4*(g+k*b);m[q+0]*=Math.pow(e,.8);m[q+1]*=Math.pow(e,.8);m[q+2]*=Math.pow(e,.8)}}};
CDrawingBoard.prototype.private_RedrawTrueColorAllStones=function(){var a=this.m_oImageData.W,b=this.m_oImageData.H;this.HtmlElement.Stones.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.m_oBoardPosition={};this.private_DrawTrueColorAllStones()};
CDrawingBoard.prototype.private_DrawTrueColorAllStones=function(){for(var a=this.m_oLogicBoard.Get_Size(),b=1;b<=a.Y;b++)for(var c=1;c<=a.X;c++)this.Draw_Sector(c,b,this.m_oLogicBoard.Get(c,b))};
CDrawingBoard.prototype.private_CreateShadows=function(){if(this.m_oImageData.Lines){var a=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d"),b=this.m_oImageData.StoneDiam;a=a.createImageData(b,b);var c=a.data;this.m_oImageData.ShadowOff=Math.max(parseInt(.15*b),3);for(var d=(b-5)/2+1,e=0;e<b;e++)for(var f=0;f<b;f++){var g=Math.abs(e-d),h=Math.abs(f-d);g=Math.sqrt(h*h+g*g)/d;g=1>g?.15+.75*(1-g):0;h=4*(b*e+f);c[h+0]=0;c[h+1]=0;c[h+2]=0;c[h+3]=parseInt(255*g)}this.m_oImageData.Shadow=this.private_CreateCanvas(b,
b,a)}};CDrawingBoard.prototype.Update_Target=function(){this.private_UpdateTargetType()};
CDrawingBoard.prototype.private_UpdateTargetType=function(){var a=this.m_oTarget.Get_LogicPos(),b=a.Y,c=a.X;if(!1===this.private_IsPointInViewPort(c-1,b-1))this.m_oTarget.Hide();else{a=EBoardTargetType.Unknown;var d=this.m_oLogicBoard.Get(c,b);switch(this.m_eMode){case EBoardMode.Move:BOARD_EMPTY===d&&(a=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?EBoardTargetType.BlackStone:EBoardTargetType.WhiteStone);break;case EBoardMode.CountScores:BOARD_BLACK===d?a=EBoardTargetType.WhiteX:BOARD_WHITE===d&&
(a=EBoardTargetType.BlackX);break;case EBoardMode.AddRemove:a=BOARD_BLACK===d?EBoardTargetType.WhiteX:BOARD_WHITE===d?EBoardTargetType.BlackX:global_mouseEvent.ShiftKey?EBoardTargetType.WhiteStone:EBoardTargetType.BlackStone;break;case EBoardMode.ScoreEstimate:b=this.m_oLogicBoard.Get_SE(c,b);BOARD_BLACK===b?a=EBoardTargetType.WhiteX:BOARD_WHITE===b&&(a=EBoardTargetType.BlackX);break;case EBoardMode.AddMarkColor:a=global_mouseEvent.CtrlKey&&!global_mouseEvent.ShiftKey?EBoardTargetType.ColorR:!global_mouseEvent.CtrlKey&&
global_mouseEvent.ShiftKey?EBoardTargetType.ColorG:global_mouseEvent.CtrlKey&&global_mouseEvent.ShiftKey?EBoardTargetType.ColorA:EBoardTargetType.ColorB;break;default:a=BOARD_BLACK===d||BOARD_EMPTY===d&&!0===this.private_GetSettings_DarkBoard()?EBoardTargetType.WhiteX:EBoardTargetType.BlackX}EBoardTargetType.Unknown!=a&&this.m_oGameTree.Get_LocalSettings().Is_ShowTarget()?this.m_oTarget.Set_Type(a):this.m_oTarget.Hide()}};
CDrawingBoard.prototype.private_MoveTarget=function(a,b,c,d){!1===this.private_IsPointInViewPort(a-1,b-1)?this.m_oTarget.Hide():null===this.m_oCreateWoodyId&&null!==this.m_oImageData.Lines&&(void 0===d&&(d=!1),!1===this.m_oTarget.Check_LogicPos(a,b,d)&&(EBoardMode.AddMarkColor===this.m_eMode&&this.m_bMouseDown&&!d&&this.private_AddColorMark(a,b,c),c=(this.m_oImageData.StoneDiam-1)/2,d=this.m_oImageData.Lines,a=d[a-1].X-c,b=d[b-1].Y-c,this.m_oTarget.Show(),this.m_oTarget.Set_Pos(a,b),this.private_UpdateTargetType()))};
CDrawingBoard.prototype.private_HideTarget=function(){this.m_oTarget.Hide()};
CDrawingBoard.prototype.private_GetBoardPosByXY=function(a,b){var c=this.m_oImageData.W,d=this.m_oImageData.H,e=this.m_dKoeffCellH*d,f=this.m_dKoeffCellW*c;c=this.m_dKoeffOffsetX*c-e*this.m_oViewPort.X0;var g=this.m_dKoeffOffsetY*d-f*this.m_oViewPort.Y0,h=this.m_oLogicBoard.Get_Size();for(d=0;d<h.Y-1&&b>g+e*d+e/2;d++);for(e=0;e<h.X-1&&a>c+f*e+f/2;e++);e=Math.max(this.m_oViewPort.X0,Math.min(this.m_oViewPort.X1,e));d=Math.max(this.m_oViewPort.Y0,Math.min(this.m_oViewPort.Y1,d));return{X:e+1,Y:d+1}};
CDrawingBoard.prototype.private_GetXYByBoardPos=function(a,b){var c=this.m_oImageData.W,d=this.m_oImageData.H;return{X:this.m_dKoeffOffsetX*c+(a-1)*this.m_dKoeffCellW*c,Y:this.m_dKoeffOffsetY*d+(b-1)*this.m_dKoeffCellH*d}};
CDrawingBoard.prototype.private_CreateMarks=function(){if(this.m_oImageData.Lines){var a=this.private_GetSettings_TrueColorBoard(),b=this.private_GetSettings_DarkBoard(),c=this.m_oImageData.StoneDiam;this.m_oImageData.X_Black=this.private_DrawX(c,c,.05*c,new CColor(0,0,0,255));this.m_oImageData.X_White=this.private_DrawX(c,c,.05*c,new CColor(255,255,255,255));this.m_oImageData.Tr_Black=this.private_DrawTriangle(c,c,.05*c,new CColor(0,0,0,255));this.m_oImageData.Tr_White=this.private_DrawTriangle(c,
c,.05*c,new CColor(255,255,255,255));this.m_oImageData.Tr_Hint=this.private_DrawTriangle(c,c,.05*c,new CColor(255,0,0,255));this.m_oImageData.Sq_Black=this.private_DrawEmptySquare(c,c,.05*c,new CColor(0,0,0,255));this.m_oImageData.Sq_White=this.private_DrawEmptySquare(c,c,.05*c,new CColor(255,255,255,255));this.m_oImageData.Ter_Black=this.private_DrawFilledSquare(c,c,.05*c,!1,new CColor(0,0,0,255),a?new CColor(0,0,0,255):b?new CColor(255,255,255,255):new CColor(0,0,0,255));this.m_oImageData.Ter_White=
this.private_DrawFilledSquare(c,c,.05*c,!1,new CColor(255,255,255,255),a?new CColor(255,255,255,255):b?new CColor(255,255,255,255):new CColor(0,0,0,255));this.m_oImageData.Ter_Black2=this.private_DrawFilledSquare(c,c,.05*c,!0,new CColor(0,0,0,255),a?new CColor(0,0,0,255):b?new CColor(255,255,255,255):new CColor(0,0,0,255));this.m_oImageData.Ter_White2=this.private_DrawFilledSquare(c,c,.05*c,!0,new CColor(255,255,255,255),a?new CColor(255,255,255,255):b?new CColor(255,255,255,255):new CColor(0,0,0,
255));this.m_oImageData.LastMove=this.private_DrawCircle(c,c,.05*c,new CColor(255,0,0,255));this.m_oImageData.Cr_Black=this.private_DrawCircle(c,c,.05*c,new CColor(0,0,0,255));this.m_oImageData.Cr_White=this.private_DrawCircle(c,c,.05*c,new CColor(255,255,255,255));this.m_oImageData.RcolorTarget=this.private_DrawEmptySquare(c,c,.05*c,new CColor(200,0,0,255));this.m_oImageData.GcolorTarget=this.private_DrawEmptySquare(c,c,.05*c,new CColor(0,128,0,255));this.m_oImageData.BcolorTarget=this.private_DrawEmptySquare(c,
c,.05*c,new CColor(0,0,200,255));this.m_oImageData.AcolorTarget=this.private_DrawEmptySquare(c,c,.05*c,new CColor(128,128,128,255))}};CDrawingBoard.prototype.private_DrawX=function(a,b,c,d){var e=document.createElement("canvas");e.width=a;e.height=b;var f=e.getContext("2d");f.clearRect(0,0,a,b);f.strokeStyle=d.ToString();f.fillStyle=d.ToString();f.lineWidth=c;f.beginPath();f.moveTo(1*a/4,1*b/4);f.lineTo(3*a/4,3*b/4);f.moveTo(3*a/4,1*b/4);f.lineTo(1*a/4,3*b/4);f.stroke();return e};
CDrawingBoard.prototype.private_DrawTriangle=function(a,b,c,d,e){void 0===e&&(e=1);var f=document.createElement("canvas");f.width=a;f.height=b;var g=f.getContext("2d");g.clearRect(0,0,a,b);g.globalAlpha=e;g.strokeStyle=d.ToString();g.fillStyle=d.ToString();g.lineWidth=c;c=a/2;b=3*b/4;d=.1*a;e=Math.sqrt(c*c-(b-c)*(b-c))+c;c=-Math.sqrt(c*c-(b-c)*(b-c))+c;g.beginPath();g.moveTo(a/2,d);g.lineTo(e-d,b);g.lineTo(c+d,b);g.closePath();g.stroke();return f};
CDrawingBoard.prototype.private_DrawEmptySquare=function(a,b,c,d){var e=document.createElement("canvas");e.width=a;e.height=b;var f=e.getContext("2d");f.clearRect(0,0,a,b);f.strokeStyle=d.ToString();f.fillStyle=d.ToString();f.lineWidth=Math.floor(c+.5);var g=a/2,h=-b/2*Math.sqrt(2)/2+b/2,k=Math.floor(-Math.sqrt(g*g-(h-g)*(h-g))+g);g=Math.ceil(+Math.sqrt(g*g-(h-g)*(h-g))+g);h=Math.ceil(h);var l=Math.floor(b/2*Math.sqrt(2)/2+b/2);c=Math.floor(c);for(var m=f.createImageData(a,b),n=0;n<b;n++)for(var p=
0;p<a;p++){var q=4*(n*a+p);(k<=p&&p<=k+c||g-c<=p&&p<=g)&&h<=n&&n<=l||(h<=n&&n<=h+c||l-c<=n&&n<=l)&&k<=p&&p<=g?(m.data[q+0]=d.r,m.data[q+1]=d.g,m.data[q+2]=d.b,m.data[q+3]=255):(m.data[q+0]=0,m.data[q+1]=0,m.data[q+2]=0,m.data[q+3]=0)}f.putImageData(m,0,0);return e};
CDrawingBoard.prototype.private_DrawFilledSquare=function(a,b,c,d,e,f){c=document.createElement("canvas");c.width=a;c.height=b;var g=c.getContext("2d"),h=g.createImageData(a,b),k=d?b/4|0:b/3|0,l=d?3*b/4|0:2*b/3|0,m=d?a/4|0:a/3|0;d=d?3*a/4|0:2*a/3|0;for(var n=0;n<b;n++)for(var p=0;p<a;p++){var q=4*(n*a+p);(n===k||n===l)&&p>=m&&p<=d||(p===m||p===d)&&n>=k&&n<=l?(h.data[q+0]=f.r,h.data[q+1]=f.g,h.data[q+2]=f.b,h.data[q+3]=255):n>k&&n<l&&p>m&&p<d?(h.data[q+0]=e.r,h.data[q+1]=e.g,h.data[q+2]=e.b,h.data[q+
3]=255):h.data[q+3]=0}g.putImageData(h,0,0);return c};CDrawingBoard.prototype.private_DrawCircle=function(a,b,c,d){var e=document.createElement("canvas");e.width=a;e.height=b;var f=e.getContext("2d");f.clearRect(0,0,a,b);var g=a/2,h=4*c;f.strokeStyle=d.ToString();f.fillStyle=d.ToString();f.lineWidth=c;f.beginPath();f.arc(a/2,b/2,g-h,0,2*Math.PI,!1);f.stroke();return e};
CDrawingBoard.prototype.private_DrawRulers=function(){if(!0===this.m_bRulers&&this.m_oImageData.Lines){var a=this.HtmlElement.Board.Control.HtmlElement.getContext("2d"),b=this.m_oImageData.W,c=this.m_oImageData.H,d=this.m_oLogicBoard.Get_Size(),e=2*this.m_oImageData.StoneDiam/3,f=(e-1)/2,g=this.m_oImageData.Lines,h=2*e/3;this.private_GetSettings_DarkBoard()?a.fillStyle="rgb(255,255,255)":a.fillStyle="rgb(0,0,0)";for(var k=this.m_oViewPort.X0;k<=this.m_oViewPort.X1;k++){var l=g[k].X-f,m=this.m_dKoeffOffsetY*
c/3-f,n=Common_X_to_String(k+1,d.X),p=Common_IsInt(n)?"Arial":"Helvetica, Arial, Verdana";p=h+"px "+p;a.font=p;p=e/2+h/3;var q=(e-a.measureText(n).width)/2;a.fillText(n,l+q,m+p);m=c-this.m_dKoeffOffsetY*c/3-f;a.fillText(n,l+q,m+p)}for(c=this.m_oViewPort.Y0;c<=this.m_oViewPort.Y1;c++)l=this.m_dKoeffOffsetX*b/3-f,m=g[c].Y-f,n=d.Y-c+"",p=Common_IsInt(n)?"Arial":"Helvetica, Arial, Verdana",p=h+"px "+p,a.font=p,p=e/2+h/3,q=(e-a.measureText(n).width)/2,a.fillText(n,l+q,m+p),l=b-this.m_dKoeffOffsetX*b/3-
f,a.fillText(n,l+q,m+p)}};CDrawingBoard.prototype.private_GetMark=function(a,b){var c=this.m_oMarks[""+Common_XYtoValue(a,b)];return void 0!==c?c:null};CDrawingBoard.prototype.private_SetMark=function(a,b,c){EDrawingMark.Lm===c.Get_Type()?this.private_SetLastMoveMark(a,b):this.m_oMarks[""+Common_XYtoValue(a,b)]=c};
CDrawingBoard.prototype.private_SetLastMoveMark=function(a,b){if(0>=a||0>=b)this.m_oLastMoveMark=0;else{var c=Common_XYtoValue(a,b);void 0===this.m_oMarks[""+c]&&(this.m_oMarks[""+c]=new CDrawingMark(a,b,EDrawingMark.Lm,""));this.m_oLastMoveMark=c}};
CDrawingBoard.prototype.private_DrawMarks=function(){this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(0,0,this.m_oImageData.W,this.m_oImageData.H);var a=[],b;for(b in this.m_oMarks){var c=this.m_oMarks[b];void 0===this.m_oHints[b]&&(this.private_DrawMark(c),EDrawingMark.Tx===c.Get_Type()&&a.push({X:c.Get_X(),Y:c.Get_Y()}))}for(b in this.m_oHints)c=Common_ValuetoXY(b),this.private_DrawHint(c.X,c.Y),a.push({X:c.X,Y:c.Y});this.private_DrawTrueColorLines(a)};
CDrawingBoard.prototype.private_DrawMark=function(a){if(this.m_oImageData.Lines){var b=a.Get_X(),c=a.Get_Y(),d=a.Get_Type(),e=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d"),f=this.private_GetSettings_DarkBoard();if(!0===this.private_IsPointInViewPort(b-1,c-1)){var g=this.m_oImageData.StoneDiam,h=(g-1)/2,k=this.m_oImageData.Lines,l=k[b-1].X-h;h=k[c-1].Y-h;b=this.m_oLogicBoard.Get(b,c);e.clearRect(l,h,g,g);switch(d){case EDrawingMark.Tb:e.drawImage(this.m_oImageData.Ter_Black,l,h);break;
case EDrawingMark.Tw:e.drawImage(this.m_oImageData.Ter_White,l,h);break;case EDrawingMark.Tb2:e.drawImage(this.m_oImageData.Ter_Black2,l,h);break;case EDrawingMark.Tw2:e.drawImage(this.m_oImageData.Ter_White2,l,h);break;case EDrawingMark.Lm:!0===this.m_bBlackWhiteLastMark?BOARD_BLACK===b?e.drawImage(this.m_oImageData.Cr_White,l,h):e.drawImage(this.m_oImageData.Cr_Black,l,h):e.drawImage(this.m_oImageData.LastMove,l,h);break;case EDrawingMark.Cr:e.drawImage(b===BOARD_BLACK||b==BOARD_EMPTY&&1==f?this.m_oImageData.Cr_White:
this.m_oImageData.Cr_Black,l,h);break;case EDrawingMark.Sq:e.drawImage(b===BOARD_BLACK||b==BOARD_EMPTY&&1==f?this.m_oImageData.Sq_White:this.m_oImageData.Sq_Black,l,h);break;case EDrawingMark.Tr:e.drawImage(b===BOARD_BLACK||b==BOARD_EMPTY&&1==f?this.m_oImageData.Tr_White:this.m_oImageData.Tr_Black,l,h);break;case EDrawingMark.X:e.drawImage(b===BOARD_BLACK||b==BOARD_EMPTY&&1==f?this.m_oImageData.X_White:this.m_oImageData.X_Black,l,h);break;case EDrawingMark.Tx:a=a.Get_Text(),d=2>=a.length?2*g/3:g/
2,c=Common_IsInt(a)?"Arial":"Helvetica, Arial, Verdana",e.fillStyle=b===BOARD_BLACK||b==BOARD_EMPTY&&1==f?"rgb(255,255,255)":"rgb(0,0,0)",e.font=d+"px "+c,f=g/2+d/3,g=(g-e.measureText(a).width)/2,e.fillText(a,l+g,h+f)}}}};
CDrawingBoard.prototype.private_DrawHint=function(a,b){if(this.m_oImageData.Lines){var c=this.HtmlElement.Marks.Control.HtmlElement.getContext("2d");if(!0===this.private_IsPointInViewPort(a-1,b-1)){var d=(this.m_oImageData.StoneDiam-1)/2,e=this.m_oImageData.Lines;c.drawImage(this.m_oImageData.Tr_Hint,e[a-1].X-d,e[b-1].Y-d)}}};
CDrawingBoard.prototype.private_ClearMark=function(a,b){if(this.m_oImageData.Lines&&!0===this.private_IsPointInViewPort(a-1,b-1)){var c=(this.m_oImageData.StoneDiam-1)/2,d=this.m_oImageData.Lines,e=d[a-1].X-c;d=d[b-1].Y-c;this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(e,d,2*c,2*c);c=Common_ValuetoXY(this.m_oLastMoveMark);a===c.X&&b===c.Y&&(this.private_SetLastMoveMark(a,b),this.private_DrawMark(this.private_GetMark(a,b)))}};CDrawingBoard.prototype.Draw_AllColorMarks=function(){this.private_DrawAllColorMarks()};
CDrawingBoard.prototype.Clear_AllColorMarks=function(){this.private_ClearAllColorMarks()};CDrawingBoard.prototype.private_DrawAllColorMarks=function(){for(var a in this.m_oColorMarks){var b=Common_ValuetoXY(a);this.private_DrawColorMark(b.X,b.Y)}};CDrawingBoard.prototype.private_ClearAllColorMarks=function(){for(var a in this.m_oColorMarks){var b=Common_ValuetoXY(a);this.private_ClearColorMark(b.X,b.Y)}this.m_oColorMarks={}};
CDrawingBoard.prototype.private_AddColorMark=function(a,b,c){var d=Common_XYtoValue(a,b);if(g_mouse_button_right===c.Button)void 0!==this.m_oColorMarks[d]&&(delete this.m_oColorMarks[d],this.private_ClearColorMark(a,b),this.m_oGameTree.Remove_ColorMark(a,b));else{c=c.CtrlKey&&!c.ShiftKey?new CColor(200,0,0,50):c.ShiftKey&&!c.CtrlKey?new CColor(0,100,0,50):c.ShiftKey&&c.CtrlKey?new CColor(80,80,80,50):new CColor(0,0,200,50);if(void 0!==this.m_oColorMarks[d]){var e=this.m_oColorMarks[d];c.r===e.r&&
c.g===e.g&&c.b===e.b?(c=e.a,this.m_oColorMarks[d].a=50>c?50:100>c?100:150>c?150:200):this.m_oColorMarks[d]=c}else this.m_oColorMarks[d]=c;this.private_DrawColorMark(a,b);this.m_oGameTree.Add_ColorMark(a,b,this.m_oColorMarks[d])}};
CDrawingBoard.prototype.private_DrawColorMark=function(a,b){this.private_ClearColorMark(a,b);var c=this.HtmlElement.Colors.Control.HtmlElement.getContext("2d"),d=this.m_oImageData.Lines,e=a-1,f=b-1;c.fillStyle=this.m_oColorMarks[Common_XYtoValue(a,b)].ToString();c.beginPath();c.moveTo(d[e].X_L2,d[f].Y_L2);c.lineTo(d[e].X_G2,d[f].Y_L2);c.lineTo(d[e].X_G2,d[f].Y_G2);c.lineTo(d[e].X_L2,d[f].Y_G2);c.closePath();c.fill()};
CDrawingBoard.prototype.private_ClearColorMark=function(a,b){var c=this.HtmlElement.Colors.Control.HtmlElement.getContext("2d"),d=this.m_oImageData.Lines,e=a-1,f=b-1;c.clearRect(d[e].X_L2,d[f].Y_L2,d[e].X_G2-d[e].X_L2,d[f].Y_G2-d[f].Y_L2)};
CDrawingBoard.prototype.private_HandleMouseDown=function(a,b,c){switch(this.m_eMode){case EBoardMode.Move:this.private_AddMove(a,b,c);break;case EBoardMode.CountScores:this.private_CountScores(a,b,c);break;case EBoardMode.AddRemove:this.private_AddOrRemoveStones(a,b,c);break;case EBoardMode.AddMarkTr:this.private_AddTriangle(a,b,c);break;case EBoardMode.AddMarkSq:this.private_AddSquare(a,b,c);break;case EBoardMode.AddMarkCr:this.private_AddCircle(a,b,c);break;case EBoardMode.AddMarkX:this.private_AddX(a,
b,c);break;case EBoardMode.AddMarkTx:this.private_AddText(a,b,c);break;case EBoardMode.AddMarkNum:this.private_AddNum(a,b,c);break;case EBoardMode.ScoreEstimate:this.private_ScoreEstimate(a,b,c);break;case EBoardMode.AddMarkColor:this.private_AddColorMark(a,b,c);break;case EBoardMode.ViewPort:this.private_StartViewPortSelection(a,b,c)}};CDrawingBoard.prototype.private_HandleMouseUp=function(a,b,c){EBoardMode.ViewPort===this.m_eMode&&this.private_EndViewPortSelection(a,b);this.private_UpdateSelectCanvas()};
CDrawingBoard.prototype.private_HandleMouseMove=function(a,b,c){EBoardMode.ViewPort===this.m_eMode&&this.private_MoveViewPortSelection(a,b);this.private_UpdateSelectCanvas()};CDrawingBoard.prototype.private_StartViewPortSelection=function(a,b,c){this.m_oViewPortSelection.Start=!0;this.m_oViewPortSelection.StartX=a;this.m_oViewPortSelection.StartY=b;this.m_oViewPortSelection.EndX=a;this.m_oViewPortSelection.EndY=b;this.private_UpdateSelectCanvas()};
CDrawingBoard.prototype.private_MoveViewPortSelection=function(a,b){!0===this.m_oViewPortSelection.Start&&(this.m_oViewPortSelection.EndX=a,this.m_oViewPortSelection.EndY=b)};CDrawingBoard.prototype.private_EndViewPortSelection=function(a,b){!0===this.m_oViewPortSelection.Start&&(this.m_oViewPortSelection.Start=!1,this.m_oViewPortSelection.EndX=a,this.m_oViewPortSelection.EndY=b)};
CDrawingBoard.prototype.Set_ViewPortSelection=function(a,b,c,d){this.m_oViewPortSelection.StartX=a+1;this.m_oViewPortSelection.StartY=b+1;this.m_oViewPortSelection.EndX=c+1;this.m_oViewPortSelection.EndY=d+1;this.private_UpdateSelectCanvas()};
CDrawingBoard.prototype.private_UpdateSelectCanvas=function(){if(EBoardMode.ViewPort===this.m_eMode&&!(!this.m_oImageData.Lines||0>=this.m_oViewPortSelection.StartX||0>=this.m_oViewPortSelection.StartY||0>=this.m_oViewPortSelection.EndX||0>=this.m_oViewPortSelection.EndY)){var a=this.m_oImageData.W,b=this.m_oImageData.H,c=this.m_oImageData.Lines,d=this.HtmlElement.Select.Control.HtmlElement.getContext("2d");d.clearRect(0,0,a,b);a=this.m_oViewPortSelection.StartX-1;b=this.m_oViewPortSelection.StartY-
1;var e=this.m_oViewPortSelection.EndX-1,f=this.m_oViewPortSelection.EndY-1;if(a>e){var g=e;e=a;a=g}b>f&&(g=f,f=b,b=g);g=new CColor(107,112,122,128);d.fillStyle=g.ToString();d.beginPath();d.moveTo(c[a].X_L2,c[b].Y_L2);d.lineTo(c[e].X_G2,c[b].Y_L2);d.lineTo(c[e].X_G2,c[f].Y_G2);d.lineTo(c[a].X_L2,c[f].Y_G2);d.closePath();d.fill()}};
CDrawingBoard.prototype.private_AddMove=function(a,b,c){var d=this.m_oGameTree.Get_Handler();if(g_mouse_button_right==c.Button)if(d&&d.AddNewNodeWithMove){c=this.m_oGameTree.Get_CurNode();var e=c.Get_Prev();if(e){this.m_oGameTree.Set_Handler(null);this.m_oGameTree.GoTo_Node(e);var f=this.m_oGameTree.Get_NextMove();if(!1===this.private_CanMakeMove(a,b))this.m_oGameTree.GoTo_Node(c),this.m_oGameTree.Set_Handler(d);else{var g=this.m_oGameTree.Get_CurNode().Have_ChildNodeWithMove(a,b,f);-1===g||d.CheckExistNodeOnMove&&
!0!==d.CheckExistNodeOnMove()?(this.m_oGameTree.GoTo_Node(c),this.m_oGameTree.Set_Handler(d),d.AddNewNodeWithMove(e,a,b,f)):(a=this.m_oGameTree.Get_CurNode().Get_Next(g),this.m_oGameTree.GoTo_Node(c),this.m_oGameTree.Set_Handler(d),d.GoToNode&&d.GoToNode(a))}}}else 1<=this.m_oGameTree.Get_CurNodeDepth()&&(this.m_oGameTree.Step_Backward(1),this.private_MakeMove(a,b));else c.ShiftKey&&c.CtrlKey?(a=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_WHITE:BOARD_BLACK,this.m_oGameTree.Set_NextMove(a),
this.private_UpdateTargetType()):!0===c.CtrlKey?(d=this.m_oLogicBoard.Get_Size(),a=Common_XYtoString(a,b,d.X,d.Y),this.m_oGameTree.Add_Comment(a),(b=this.m_oGameTree.Get_Drawing())&&b.Add_CommentWithCoordinates&&b.Add_CommentWithCoordinates(a)):c.ShiftKey?this.m_oGameTree.GoTo_NodeByXY(a,b):d&&d.AddNewNodeWithMove?!1!==this.private_CanMakeMove(a,b)&&(f=this.m_oGameTree.Get_NextMove(),g=this.m_oGameTree.Get_CurNode().Have_ChildNodeWithMove(a,b,f),-1===g||d.CheckExistNodeOnMove&&!0!==d.CheckExistNodeOnMove()?
d.AddNewNodeWithMove(this.m_oGameTree.Get_CurNode(),a,b,f):(a=this.m_oGameTree.Get_CurNode().Get_Next(g),d.GoToNode&&d.GoToNode(a))):(this.private_MakeMove(a,b),null!==this.m_oPresentation&&this.m_oGameTree.Get_CurNode().Count_NodeNumber()>=this.m_oPresentation.Get_NodesCountInSlide()&&this.m_oPresentation.On_EndSgfSlide())};
CDrawingBoard.prototype.private_CountScores=function(a,b,c){var d=this.m_oGameTree.Get_Handler();d?d.MarkLife&&BOARD_EMPTY!==this.m_oLogicBoard.Get(a,b)&&(c=this.m_oLogicBoard.Get_ScorePoint(a,b),d.MarkLife(a,b,BOARD_BLACK!==c&&BOARD_WHITE!==c?!1:!0)):!0===c.CtrlKey?this.Set_Mode(EBoardMode.Move):(this.m_oLogicBoard.Select_DeadGroup(a,b),this.m_oGameTree.Count_Scores())};
CDrawingBoard.prototype.private_AddOrRemoveStones=function(a,b,c){var d=BOARD_BLACK;if(BOARD_EMPTY!==this.m_oLogicBoard.Get(a,b))d=BOARD_EMPTY;else if(c.ShiftKey||.5<Math.random())d=BOARD_WHITE;if(c=this.m_oGameTree.Get_Handler()){var e=this.m_oGameTree.Get_CurNode();e=!0===e.Have_Move()||e===this.m_oGameTree.Get_FirstNode();c.AddOrRemoveStone&&c.AddOrRemoveStone(e,a,b,d)}else!0===this.m_oGameTree.Get_CurNode().Have_Move()&&!0===this.m_oGameTree.Add_NewNode(!0,!0)&&this.m_oGameTree.Execute_CurNodeCommands(),
this.Draw_Sector(a,b,d),this.m_oLogicBoard.Set(a,b,d,-1),this.m_oGameTree.AddOrRemove_Stones(d,[Common_XYtoValue(a,b)])};
CDrawingBoard.prototype.private_AddMark=function(a,b,c){var d=this.private_GetMark(b,c),e=this.m_oGameTree.Get_Handler();e?e.AddOrRemoveMark&&e.AddOrRemoveMark(null===d||a!==d.Get_Type(),b,c,a):null!==d&&a===d.Get_Type()?(this.m_oGameTree.Remove_Mark([Common_XYtoValue(b,c)]),this.Remove_Mark(b,c),this.private_ClearMark(b,c)):(d=new CDrawingMark(b,c,a,""),this.m_oGameTree.Add_Mark(a,[Common_XYtoValue(b,c)]),this.private_SetMark(b,c,d),this.private_DrawMark(d))};
CDrawingBoard.prototype.private_AddTriangle=function(a,b,c){this.private_AddMark(EDrawingMark.Tr,a,b)};CDrawingBoard.prototype.private_AddSquare=function(a,b,c){this.private_AddMark(EDrawingMark.Sq,a,b)};CDrawingBoard.prototype.private_AddCircle=function(a,b,c){this.private_AddMark(EDrawingMark.Cr,a,b)};CDrawingBoard.prototype.private_AddX=function(a,b,c){this.private_AddMark(EDrawingMark.X,a,b)};
CDrawingBoard.prototype.private_AddText=function(a,b,c){var d=this.private_GetMark(a,b),e=this.m_oGameTree.Get_Handler();if(null!==d&&EDrawingMark.Tx===d.Get_Type()){if(e){e.AddOrRemoveMark&&e.AddOrRemoveMark(!1,a,b,EDrawingMark.Tx,d.Get_Text());return}this.m_oGameTree.Remove_Mark([Common_XYtoValue(a,b)]);this.Remove_Mark(a,b)}else{var f="";if(c.ShiftKey){if(!this.m_oDrawing||!this.HtmlElement.Control||!this.HtmlElement.Control.HtmlElement)return;c=this.m_oDrawing.Get_MainDiv();if(!c)return;d=this.private_GetXYByBoardPos(a,
b);var g=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),h=window.g_oLocalization?window.g_oLocalization.gameRoom.labelPlaceholder:"Label...",k=50;window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("16px 'Times New Roman', Times, serif"),k=window.g_oTextMeasurer.Measure(h)+6+2+2);var l=document.createElement("input");l.style.position="absolute";l.style.top=g.Y+d.Y-10+"px";l.style.left=g.X+d.X-k/2+"px";l.style.width=k+"px";l.style.height="20px";l.style.fontFamily='"Times New Roman", Times, serif';
l.style.fontSize="16px";l.type="text";l.placeholder=h;l.style.outline=0;l.style.border="1px solid rgb(166, 166, 166)";l.style.boxShadow="rgba(0, 0, 0, 0.8) 0px 1px 15px";l.style.padding="3px";c.appendChild(l);l.focus();var m=this;l.onblur=function(){m.m_oDrawing.Remove_LabelElement()};l.onkeydown=function(c){27===c.keyCode?m.m_oDrawing.Remove_LabelElement():13===c.keyCode&&(f=this.value,e?e.AddOrRemoveMark&&e.AddOrRemoveMark(!0,a,b,EDrawingMark.Tx,f):(c=new CDrawingMark(a,b,EDrawingMark.Tx,f),m.m_oGameTree.Add_TextMark(f,
Common_XYtoValue(a,b)),m.private_SetMark(a,b,c),m.private_DrawMarks()),m.m_oDrawing.Remove_LabelElement())};m.m_oDrawing.Register_AddLabelElement(l);return}if(void 0==f||""===f||null===f)if(f=this.private_GetNextTextMark(),null===f){c=this.m_oGameTree;(d=c.Get_Drawing())&&CreateWindow(d.Get_MainDiv().id,EWindowType.Error,{GameTree:c,Drawing:d,ErrorText:"Sorry, all standard labels are used up! To add more labels, use shift and click on the board to make up ur own labels.",W:305,H:115});return}if(e){e.AddOrRemoveMark&&
e.AddOrRemoveMark(!0,a,b,EDrawingMark.Tx,f);return}c=new CDrawingMark(a,b,EDrawingMark.Tx,f);this.m_oGameTree.Add_TextMark(f,Common_XYtoValue(a,b));this.private_SetMark(a,b,c)}this.private_DrawMarks()};
CDrawingBoard.prototype.private_AddNum=function(a,b,c){var d=this.private_GetMark(a,b),e=this.m_oGameTree.Get_Handler();if(null!==d&&EDrawingMark.Tx===d.Get_Type()){if(e){e.AddOrRemoveMark&&e.AddOrRemoveMark(!1,a,b,EDrawingMark.Tx,d.Get_Text());return}this.m_oGameTree.Remove_Mark([Common_XYtoValue(a,b)]);this.Remove_Mark(a,b)}else{d="";if(c.ShiftKey){c=this.m_oLogicBoard.Get_Num(a,b);if(-1==c){a=this.m_oGameTree;(b=a.Get_Drawing())&&CreateWindow(b.Get_MainDiv().id,EWindowType.Error,{GameTree:a,Drawing:b,
ErrorText:"Sorry, no move has been made at that location, so you can't mark it with the move number.",W:305,H:115});return}d=""+c}if(void 0===d||""===d||null===d)d=this.private_GetNextNumMark();if(e){e.AddOrRemoveMark&&e.AddOrRemoveMark(!0,a,b,EDrawingMark.Tx,d);return}e=new CDrawingMark(a,b,EDrawingMark.Tx,d);this.m_oGameTree.Add_TextMark(d,Common_XYtoValue(a,b));this.private_SetMark(a,b,e)}this.private_DrawMarks()};
CDrawingBoard.prototype.private_GetNextTextMark=function(){var a=[],b=-1,c;for(c in this.m_oMarks){var d=this.m_oMarks[c];if(EDrawingMark.Tx==d.Get_Type()){d=d.Get_Text();var e=d.charCodeAt(0);1==d.length&&65<=e&&90>=e&&(a[e]=1)}}for(c=65;90>=c;c++)if(void 0===a[c]||""==a[c]){b=c;break}return-1==b?null:String.fromCharCode(b)};
CDrawingBoard.prototype.private_GetNextNumMark=function(){var a=[],b=0,c;for(c in this.m_oMarks){var d=this.m_oMarks[c];EDrawingMark.Tx===d.Get_Type()&&Common_IsInt(d.Get_Text())&&(a[b]=parseInt(d.Get_Text()),b++)}if(0>=b)return"1";a.sort(Common_SortIncrease);d=c=0;for(var e=!1,f=0;f<b;f++){if(a[f]>c+1){d=c+1;e=!0;break}c=a[f]}e||(d=c+1);return""+d};
CDrawingBoard.prototype.private_MakeMove=function(a,b){if(1==this.private_CanMakeMove(a,b)){var c=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_BLACK:BOARD_WHITE;!0===this.m_oGameTree.Add_NewNodeByPos(a,b,c)&&this.m_oGameTree.Execute_CurNodeCommands()}};
CDrawingBoard.prototype.private_CanMakeMove=function(a,b){var c=!1;if(BOARD_EMPTY===this.m_oLogicBoard.Get(a,b)){c=BOARD_BLACK===this.m_oGameTree.Get_NextMove()?BOARD_BLACK:BOARD_WHITE;var d=this.m_oLogicBoard.Get_Ko();this.m_oLogicBoard.Set(a,b,c,-1);c=null!==this.m_oLogicBoard.Check_Kill(a,b,c,!0)?!0:null!==this.m_oLogicBoard.Check_Dead(a,b,c)?!1:!0;this.m_oLogicBoard.Set(a,b,BOARD_EMPTY,-1);this.m_oLogicBoard.Set_Ko(d)}return c};
CDrawingBoard.prototype.private_ScoreEstimate=function(a,b,c){this.m_oLogicBoard.Mark_DeadGroupForEstimate(a,b);a=this.m_oLogicBoard.Estimate_Scores(this);this.m_oEventsCatcher&&(b=a.BlackReal+this.m_oGameTree.Get_BlackCapt()-a.WhiteReal-this.m_oGameTree.Get_WhiteCapt()-this.m_oGameTree.Get_Komi(),this.m_oEventsCatcher.On_EstimateEnd(a.BlackReal,a.WhiteReal,a.BlackPotential,a.WhitePotential,b));this.Draw_Marks();this.private_UpdateTargetType()};
CDrawingBoard.prototype.private_HandleKeyDown=function(a){if(EBoardMode.ScoreEstimate!==this.m_eMode&&EBoardMode.ViewPort!==this.m_eMode){var b=this.m_oGameTree.Get_Handler(),c=a.KeyCode,d=!1;if(8===c||46===c){if(b&&b.RemoveNode){b.RemoveNode(this.m_oGameTree.Get_CurNode());return}this.m_oGameTree.Remove_CurNode();d=!0}else 36===c?!0===a.CtrlKey&&!0===a.ShiftKey&&(this.m_oGameTree.GoTo_StartNode(),d=!0):37===c?(a.CtrlKey&&a.ShiftKey?this.m_oGameTree.Step_BackwardToStart():a.CtrlKey?this.m_oGameTree.Step_Backward(5):
this.m_oGameTree.Step_Backward(1),d=!0):38===c?(a.CtrlKey?this.m_oGameTree.GoTo_MainVariant():this.m_oGameTree.GoTo_PrevVariant(),d=!0):39===c?(a.CtrlKey&&a.ShiftKey?this.m_oGameTree.Step_ForwardToEnd():a.CtrlKey?this.m_oGameTree.Step_Forward(5):this.m_oGameTree.Step_Forward(1),d=!0):40===c?(this.m_oGameTree.GoTo_NextVariant(),d=!0):65===c&&!0===a.CtrlKey&&!0===a.ShiftKey?(this.private_DrawLogo(),d=!0):67===c&&!0===a.CtrlKey?(EBoardMode.AddMarkColor===this.m_eMode?this.m_oGameTree.Copy_ColorMapFromPrevNode():
CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.CreateNew,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),d=!0):68===c&&!0===a.CtrlKey?(!0===a.ShiftKey?this.m_oGameTree.Move_Variant(-1):CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.DiagramSL,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),d=!0):69===c&&!0===a.CtrlKey?(this.m_oGameTree&&this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_ESTIMATE&&CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.ScoreEstimate,
{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),d=!0):72===c&&!0===a.CtrlKey?(!0===a.ShiftKey?this.m_oGameTree.Download_GifBoardScreenShot():this.m_oGameTree.Download_PngBoardScreenShot(),d=!0):73===c&&!0===a.CtrlKey?(!0===a.ShiftKey?this.m_oGameTree.Download_GifForProblem():this.m_oGameTree.Download_GifForCurVariant(),d=!0):75===c&&!0===a.CtrlKey?(CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Kifu,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}),d=!0):77===c&&!0===a.CtrlKey&&
!0===a.ShiftKey?(this.m_oGameTree.Make_CurrentVariantMainly(),d=!0):79===c&&!0===a.CtrlKey?(EBoardMode.AddMarkColor===this.m_eMode?CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.CountColors,{DrawingBoard:this,Drawing:this.m_oDrawing}):this.m_oGameTree&&this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_LOADFILE&&(!0===a.ShiftKey?CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Clipboard,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}):Common.OpenFileDialog(this.m_oGameTree)),
d=!0):82===c&&!0===a.CtrlKey?(EBoardMode.AddMarkColor===this.m_eMode?(this.private_ClearAllColorMarks(),this.m_oGameTree.Remove_AllColorMarks()):this.Set_Rulers(!0===this.m_bRulers?!1:!0),d=!0):83===c&&!0===a.CtrlKey?(b=this.m_oGameTree.Save_Sgf(),FileReader&&Blob&&(a=this.m_oGameTree.Get_GameName(),""===a&&(a=this.m_oGameTree.Get_WhiteName()+" vs. "+this.m_oGameTree.Get_BlackName()),""===a&&(a="download"),a+=".sgf",b=new Blob([b],{type:"text/plain;charset=utf-8"}),Common.SaveAs(b,a,"application/x-go-sgf")),
d=!0):85===c&&!0===a.CtrlKey?!0===a.ShiftKey&&(this.m_oGameTree.Move_Variant(1),d=!0):86===c&&!0===a.CtrlKey?(!0===a.ShiftKey?this.m_oGameTree&&this.m_oGameTree.m_nEditingFlags&EDITINGFLAGS_VIEWPORT&&CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.ViewPort,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing}):(a=this.m_oGameTree.Get_ShowVariants(),a++,a>EShowVariants.Max&&(a=EShowVariants.Min),this.m_oGameTree.Set_ShowVariants(a)),d=!0):112===c?(this.Set_Mode(EBoardMode.Move),d=!0):
113===c?(this.Set_Mode(EBoardMode.CountScores),d=!0):114===c?(this.Set_Mode(EBoardMode.AddRemove),d=!0):115===c?(this.Set_Mode(EBoardMode.AddMarkTr),d=!0):116===c?(this.Set_Mode(EBoardMode.AddMarkSq),d=!0):117===c?(this.Set_Mode(EBoardMode.AddMarkCr),d=!0):118===c?(this.Set_Mode(EBoardMode.AddMarkX),d=!0):119===c?(this.Set_Mode(EBoardMode.AddMarkTx),d=!0):120===c?(this.Set_Mode(EBoardMode.AddMarkNum),d=!0):121===c&&(this.Set_Mode(EBoardMode.AddMarkColor),d=!0);return d}};
CDrawingBoard.prototype.private_IsPointInViewPort=function(a,b){return a>=this.m_oViewPort.X0&&a<=this.m_oViewPort.X1&&b>=this.m_oViewPort.Y0&&b<=this.m_oViewPort.Y1?!0:!1};CDrawingBoard.prototype.private_IsHorLineInViewPort=function(a){return a>=this.m_oViewPort.Y0&&a<=this.m_oViewPort.Y1?!0:!1};CDrawingBoard.prototype.private_IsVerLineInViewPort=function(a){return a>=this.m_oViewPort.X0&&a<=this.m_oViewPort.X1?!0:!1};CDrawingBoard.prototype.private_GetSettings_TrueColorBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardTrueColorBoard()};
CDrawingBoard.prototype.private_GetSettings_TrueColorStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardTrueColorStones()};CDrawingBoard.prototype.private_GetSettings_ShellWhiteStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardShellWhiteStones()};CDrawingBoard.prototype.private_GetSettings_Shadows=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardShadows()};CDrawingBoard.prototype.private_GetSettings_WhiteColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardWhiteColor()};
CDrawingBoard.prototype.private_GetSettings_BlackColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardBlackColor()};CDrawingBoard.prototype.private_GetSettings_BoardColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardBoardColor()};CDrawingBoard.prototype.private_GetSettings_LinesColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_BoardLinesColor()};CDrawingBoard.prototype.private_GetSettings_DarkBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_BoardDarkBoard()};
CDrawingBoard.prototype.private_DrawLogo=function(){this.private_DrawTrueColorBoard();var a=this.m_oImageData.W,b=this.m_oImageData.H,c=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d");c.clearRect(0,0,a,b);for(var d=a/406,e=b/348,f=[207,193,1],g=[{X:0,Y:49},{X:0,Y:198},{X:71,Y:348},{X:178,Y:348},{X:318,Y:348},{X:406,Y:238},{X:406,Y:41},{X:247,Y:0}],h=[[[162,162,2],[221,125,2],[256,156,2],[250,203,1],[234,231,2],[199,236,0],[177,228,1],[150,195,1]],[[133,141,2],[229,89,1],[283,136,1],[282,
210,2],[247,249,0],[195,261,2],[158,250,0],[124,196,0]],[[106,122,0],[238,45,0],[309,115,0],[312,216,2],[260,267,0],[187,300,1],[138,272,0],[96,197,1]],[[72,99,2],[246,10,0],[346,88,1],[344,224,0],[272,291,0],[182,329,0],[115,298,0],[60,197,0]],[[28,67,0],[259,-40,0],[373,66,0],[385,233,0],[298,319,2],[170,380,0],[81,336,0],[14,198]]],k=0,l=g.length;k<l;k++)c.beginPath(),c.moveTo(f[0]*d,f[1]*e),c.lineTo(g[k].X*d,g[k].Y*e),c.stroke();g=0;for(k=h.length;g<k;g++){l=h[g];c.beginPath();for(var m=0,n=l.length;m<
n;m++){var p=l[m];0===m?c.moveTo(p[0]*d,p[1]*e):c.lineTo(p[0]*d,p[1]*e)}c.closePath();c.stroke()}h.push([f]);this.private_CreateTrueColorStones(30*d);this.private_CreateShadows();c=this.HtmlElement.Stones.Control.HtmlElement.getContext("2d");f=this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d");c.clearRect(0,0,a,b);f.clearRect(0,0,a,b);a=(this.m_oImageData.StoneDiam-1)/2;b=this.m_oImageData.ShadowOff;g=0;for(k=h.length;g<k;g++)for(l=h[g],m=0,n=l.length;m<n;m++){p=l[m];var q=(p[0]*d|0)-a,
t=(p[1]*e|0)-a;BOARD_BLACK===p[2]?c.drawImage(this.m_oImageData.BlackStone,q,t):BOARD_WHITE===p[2]&&c.drawImage(this.m_oImageData.WhiteStones[Math.random()*(this.m_oImageData.WhiteStones.length-1)|0],q,t);BOARD_BLACK!==p[2]&&BOARD_WHITE!==p[2]||f.drawImage(this.m_oImageData.Shadow,q+b,t+b)}};
CDrawingBoard.prototype.Clear_Board=function(){var a=this.m_oImageData.W,b=this.m_oImageData.H;this.HtmlElement.Board.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Lines.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Stones.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Colors.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Shadow.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Variants.Control.HtmlElement.getContext("2d").clearRect(0,
0,a,b);this.HtmlElement.Marks.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Target.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b);this.HtmlElement.Select.Control.HtmlElement.getContext("2d").clearRect(0,0,a,b)};CDrawingBoard.prototype.Get_GameTree=function(){return this.m_oGameTree};CDrawingBoard.prototype.Show_Hint=function(a,b){this.m_oHints[""+Common_XYtoValue(a,b)]=!0;this.private_DrawMarks()};CDrawingBoard.prototype.Hide_Hint=function(){this.m_oHints={};this.private_DrawMarks()};var EBoardTargetType={Unknown:-1,BlackStone:0,WhiteStone:1,BlackX:2,WhiteX:3,ColorR:4,ColorG:5,ColorB:6,ColorA:7};function CBoardTarget(a,b){this.m_oDrawingBoard=b;this.m_nLogicY=this.m_nLogicX=-1;this.m_oHtmlElement=null;this.m_eType=EBoardTargetType.Unknown;this.m_nSize=-1;this.m_oImageData=a}CBoardTarget.prototype.Init=function(a){this.m_oHtmlElement=document.getElementById(a);this.m_oHtmlElement.style.position="absolute";this.Hide()};
CBoardTarget.prototype.Get_LogicPos=function(){return{X:this.m_nLogicX,Y:this.m_nLogicY}};CBoardTarget.prototype.Update_Size=function(a){this.m_oHtmlElement.width=a;this.m_oHtmlElement.height=a;this.m_oHtmlElement.style.width=a+"px";this.m_oHtmlElement.style.height=a+"px";this.m_nSize=a;this.m_eType=EBoardTargetType.Unknown};CBoardTarget.prototype.Hide=function(){this.m_oHtmlElement.style.display="none";this.m_nLogicY=this.m_nLogicX=-1};
CBoardTarget.prototype.Show=function(){var a=this.m_oDrawingBoard.Get_GameTree();a&&!0===a.Get_LocalSettings().Is_ShowTarget()&&(this.m_oHtmlElement.style.display="block")};CBoardTarget.prototype.Check_LogicPos=function(a,b,c){if(a==this.m_nLogicX&&b==this.m_nLogicY&&1!=c)return!0;this.m_nLogicX=a;this.m_nLogicY=b;this.Show();return!1};CBoardTarget.prototype.Set_Pos=function(a,b){this.m_oHtmlElement.style.left=a+"px";this.m_oHtmlElement.style.top=b+"px"};
CBoardTarget.prototype.Set_Type=function(a){if(a!=this.m_eType&&(this.m_eType=a,EBoardTargetType.Unknown!==a)){var b=document.createElement("canvas");b.width=this.m_nSize;b.height=this.m_nSize;var c=b.getContext("2d");switch(a){case EBoardTargetType.BlackStone:c.drawImage(this.m_oImageData.BlackTarget,0,0);break;case EBoardTargetType.WhiteStone:c.drawImage(this.m_oImageData.WhiteTarget,0,0);break;case EBoardTargetType.BlackX:c.drawImage(this.m_oImageData.X_Black,0,0);break;case EBoardTargetType.WhiteX:c.drawImage(this.m_oImageData.X_White,
0,0);break;case EBoardTargetType.ColorR:c.drawImage(this.m_oImageData.RcolorTarget,0,0);break;case EBoardTargetType.ColorG:c.drawImage(this.m_oImageData.GcolorTarget,0,0);break;case EBoardTargetType.ColorB:c.drawImage(this.m_oImageData.BcolorTarget,0,0);break;case EBoardTargetType.ColorA:c.drawImage(this.m_oImageData.AcolorTarget,0,0)}a=b.toDataURL("image/png");this.m_oHtmlElement.style.backgroundImage="url('"+a+"')"}};
CBoardTarget.prototype.Check_XY=function(a,b){return a==this.m_nLogicX&&b==this.m_nLogicY?!0:!1};var EDrawingButtonState={Normal:0,Active:1,Hover:2,Disabled:4,Selected:8},EDrawingButtonState2={AutoPlayPlaying:0,AutoPlayStopped:16};
function CDrawingButtonBase(a){this.m_oGameTree=(this.m_oDrawing=a)?a.Get_GameTree():null;this.m_nState=EDrawingButtonState.Normal;this.m_nState2=EDrawingButtonState2.AutoPlayStopped;this.m_bSelected=!1;this.m_oImageData={Disabled:null,Normal:null,Hover:null,Active:null,Selected:null};this.HtmlElement={Control:null,Canvas:{Control:null}};this.m_oNormaBColor=new CColor(0,0,0,51);this.m_oNormaFColor=new CColor(255,255,255,255);this.m_oHoverBColor=new CColor(0,0,0,102);this.m_oHoverFColor=new CColor(255,
255,255,255);this.m_oActiveBColor=new CColor(0,0,0,153);this.m_oActiveFColor=new CColor(255,255,255,255);this.m_oDisabledBColor=new CColor(0,0,0,0);this.m_oDisabledFColor=new CColor(140,140,140,255);this.m_oSelectedBColor=new CColor(0,0,0,77);this.m_nLoadReady=this.m_nH=this.m_nW=0;var b=this;this.private_OnMouseDown=function(a){EDrawingButtonState.Disabled!==b.m_nState&&(check_MouseDownEvent(a,!0),b.m_nState=EDrawingButtonState.Active,b.private_UpdateState(),a.stopImmediatePropagation(),b.private_ClickTransformIn())};
this.private_OnMouseUp=function(a){if(EDrawingButtonState.Disabled!==b.m_nState){if(global_mouseEvent.Sender!==a.target)return;b.m_nState=EDrawingButtonState.Hover;b.private_UpdateState();b.private_HandleMouseDown();a.stopImmediatePropagation()}b.private_OnFocus();b.private_ClickTransformOut()};this.private_OnMouseOver=function(a){EDrawingButtonState.Disabled!==b.m_nState&&(EDrawingButtonState.Active!==b.m_nState&&(b.m_nState=EDrawingButtonState.Hover),b.private_UpdateState())};this.private_OnMouseOut=
function(a){EDrawingButtonState.Disabled!==b.m_nState&&(b.m_nState=b.m_bSelected?EDrawingButtonState.Selected:EDrawingButtonState.Normal,b.private_UpdateState(),b.private_ClickTransformOut())};this.private_OnFocus=function(){!b.m_oGameTree||b instanceof CDrawingButtonGameInfo||b.m_oGameTree.Focus()};this.private_OnDragStart=function(a){a.dataTransfer.effectAllowed="all";a.dataTransfer.setData("text/sgf","(;SZ[19];)")}}
CDrawingButtonBase.prototype.Init=function(a,b){this.m_oGameTree=b;this.private_RegisterButton();this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement,d=this.private_GetHint();c.setAttribute("title",d);c.style.backgroundColor="rgba(217,217,217,1)";d=document.createElement("canvas");d.setAttribute("id",a+"_canvas");d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style["-webkit-transition"]="background 2s";
d.style.transition="background 2s";d.draggable="false";d.ondragstart=function(a){a.preventDefault();return!1};c.appendChild(d);this.HtmlElement.Canvas.Control=CreateControlContainer(a+"_canvas");d=this.HtmlElement.Canvas.Control;d.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);d.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;this.HtmlElement.Control.AddControl(d);c.onmousedown=this.private_OnMouseDown;c.onmouseup=this.private_OnMouseUp;c.onmouseover=this.private_OnMouseOver;c.onmouseout=
this.private_OnMouseOut;c.onfocus=this.private_OnFocus;c.tabIndex=-1;c.style.outline="none";c.draggable="true";c.ondragstart=this.private_OnDragStart;this.Update_Size()};CDrawingButtonBase.prototype.Update_Size=function(a){if(!0===this.private_IsReady()){var b=this.HtmlElement.Control.HtmlElement.clientWidth,c=this.HtmlElement.Control.HtmlElement.clientHeight;if(b!==this.m_nW||c!==this.m_nH||!0===a)this.m_nW=b,this.m_nH=c,this.HtmlElement.Control.Resize(this.m_nW,this.m_nH),this.private_OnResize()}};
CDrawingButtonBase.prototype.Set_Enabled=function(a){!0===a&&this.m_nState===EDrawingButtonState.Disabled?(this.m_nState=EDrawingButtonState.Normal,this.private_UpdateState()):!1===a&&this.m_nState!==EDrawingButtonState.Disabled&&(this.m_nState=EDrawingButtonState.Disabled,this.private_UpdateState())};CDrawingButtonBase.prototype.Set_State2=function(a){this.m_nState2!==a&&(this.m_nState2=a,this.private_OnResize(),this.HtmlElement.Control.HtmlElement.setAttribute("title",this.private_GetHint()))};
CDrawingButtonBase.prototype.Set_Selected=function(a){this.m_bSelected!==a&&(this.m_bSelected=a,!0===a&&EDrawingButtonState.Normal===this.m_nState?(this.m_nState=EDrawingButtonState.Selected,this.private_UpdateState()):!1===a&&EDrawingButtonState.Selected===this.m_nState&&(this.m_nState=EDrawingButtonState.Normal,this.private_UpdateState()))};
CDrawingButtonBase.prototype.Hide=function(){this.HtmlElement.Control&&this.HtmlElement.Control.HtmlElement&&(this.HtmlElement.Control.HtmlElement.style.display="none")};CDrawingButtonBase.prototype.Show=function(){this.HtmlElement.Control&&this.HtmlElement.Control.HtmlElement&&(this.HtmlElement.Control.HtmlElement.style.display="block")};
CDrawingButtonBase.prototype.private_OnResize=function(){var a=this.m_nH,b=this.m_nW;0!==b&&0!==a&&(this.m_oImageData.Active=this.private_Draw(this.m_oActiveBColor,this.m_oActiveFColor,b,a),this.m_oImageData.Hover=this.private_Draw(this.m_oHoverBColor,this.m_oHoverFColor,b,a,!1,!0),this.m_oImageData.Normal=this.private_Draw(this.m_oNormaBColor,this.m_oNormaFColor,b,a),this.m_oImageData.Disabled=this.private_Draw(this.m_oDisabledBColor,this.m_oDisabledFColor,b,a,!0),this.m_oImageData.Selected=this.private_Draw(this.m_oSelectedBColor,
this.m_oHoverFColor,b,a,!1,!0),this.private_UpdateState())};CDrawingButtonBase.prototype.private_Draw=function(a,b,c,d,e,f){var g=this.HtmlElement.Canvas.Control.HtmlElement.getContext("2d");g.clearRect(0,0,c,d);g.fillStyle=a.ToString();g.fillRect(0,0,c,d);g.fillStyle=b.ToString();g.strokeStyle=b.ToString();var h=.8*Math.min(c,d)|0;this.private_DrawOnCanvas(g,h,(c-h)/2,(d-h)/2,e,c,d,a,b);!0===f&&this.private_DrawSelectionBounds(g,c,d);return g.getImageData(0,0,c,d)};
CDrawingButtonBase.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){};CDrawingButtonBase.prototype.private_DrawTriangle=function(a,b,c,d,e){var f=Math.ceil(b+a/5+.5);b=Math.ceil(b+4*a/5+.5);var g=Math.ceil(c+a/5+.5),h=Math.ceil(c+a/2+.5);a=Math.ceil(c+4*a/5+.5);0>e?(d.beginPath(),d.moveTo(f,h),d.lineTo(b,g),d.lineTo(b,a)):(d.beginPath(),d.moveTo(f,g),d.lineTo(b,h),d.lineTo(f,a));d.closePath();d.fill()};
CDrawingButtonBase.prototype.private_UpdateState=function(){var a=this.HtmlElement.Canvas.Control.HtmlElement.getContext("2d");switch(this.m_nState){case EDrawingButtonState.Hover:var b=this.m_oImageData.Hover;break;case EDrawingButtonState.Active:b=this.m_oImageData.Active;break;case EDrawingButtonState.Disabled:b=this.m_oImageData.Disabled;break;case EDrawingButtonState.Selected:b=this.m_oImageData.Selected;break;default:case EDrawingButtonState.Normal:b=this.m_oImageData.Normal}b&&a.putImageData(b,
0,0)};CDrawingButtonBase.prototype.private_HandleMouseDown=function(){};CDrawingButtonBase.prototype.private_GetHint=function(){return""};CDrawingButtonBase.prototype.private_RegisterButton=function(){};CDrawingButtonBase.prototype.private_AddImageToLoad=function(a){this.m_nLoadReady--;var b=new Image,c=this;b.onload=function(){c.private_OnImageReady()};b.src=a;return b};CDrawingButtonBase.prototype.private_IsReady=function(){return 0>this.m_nLoadReady?!1:!0};
CDrawingButtonBase.prototype.private_OnImageReady=function(){this.m_nLoadReady++;0<=this.m_nLoadReady&&this.Update_Size(!0)};CDrawingButtonBase.prototype.private_ClickTransformIn=function(){this.HtmlElement.Control.HtmlElement.style.transition="transform 0.1s ease-out";this.HtmlElement.Control.HtmlElement.style.transform="scale(0.9)"};
CDrawingButtonBase.prototype.private_ClickTransformOut=function(){this.HtmlElement.Control.HtmlElement.style.transition="transform 0.2s ease-out";this.HtmlElement.Control.HtmlElement.style.transform="scale(1)"};CDrawingButtonBase.prototype.private_DrawSelectionBounds=function(a,b,c){a.beginPath();a.lineWidth=1;a.strokeStyle=(new CColor(0,0,0,255)).ToString();a.moveTo(0,0);a.lineTo(b,0);a.lineTo(b,c);a.lineTo(0,c);a.lineTo(0,0);a.stroke();a.beginPath()};
function CDrawingButtonBackwardToStart(a){CDrawingButtonBackwardToStart.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRIczM2u5QAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA80lEQVRYw+3XMYqFMBQF0JshlYgg8hqXIELERrfgAmaVA65DYQrTuASbIIKIVSBTDQy/m59A/od3+8AhvNxHBACM44hXyQdeLAxiEIMY9HYgIvoehsG1beve4oaklOi6ztV17aKDpJTo+96VZYk8z5GmaTzQL4aIsO87tNbiuq44oEfMsiziPM84MxQS4w0KjfEGKaUcEeG+b6zr+uWL8QZprYUxBkmSoKqqzyzL4oKstZimSRhjUBQFmqZxvijvoQ6NCvLsQ6KCFeMjSinlojb1X9S2bTiOA880tQy9XK21mOdZPHte8EeRQQxiEIMY9L/8AMSPglq/uMNKAAAAAElFTkSuQmCC");
this.m_oImageDisabled=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRcMrA1KxAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA6UlEQVRYw+3XPQqEMBAF4Jdgr52VYBpvIlZWoodUUll5Ae+gjYKVnb1gttrFakGdJYGd1Al8+XvDAI4NAQDDMDgDkq6dEIMYxKC/A3lXF+z7bvq+h1IKaZqKb3PvBK73i122bWt83/9UAqtXprU24zhiXVccx2H3DWmtzTzPiKIIZVkKKaU90BlTVZWw+suoMCQgSsxjUNd1ZpomBEFAgnkMyrJMKKWwbRvqujZOJHVRFCKOYyzLQoIiedSUKLJvT4UiDcYzqmkaYz2p36gkSRCGIe4k9U+Ka57nt9sr7ssYxCAGMYhBF8cLoc5sGgK/ZxQAAAAASUVORK5CYII=")}
CommonExtend(CDrawingButtonBackwardToStart,CDrawingButtonBase);CDrawingButtonBackwardToStart.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonBackwardToStart.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_BackwardToStart()};
CDrawingButtonBackwardToStart.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backwardStart:"Back to the start")+" (Ctrl+Shift+Left)"};CDrawingButtonBackwardToStart.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_BackwardToStartButton(this)};
function CDrawingButtonBackward5(a){CDrawingButtonBackward5.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRwVK5I7zwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAcUlEQVRYw+3VwQnAIAyFYVu6UJbqDB0vh9xFcA7xHALpCAptpbXvO77TDwENAQAAfkBECjPvvfujYoyuql5r9Z59SIyqekrJW/uwmJyzt3bETBuzfv7NedXJEDVV1F1fx3Y1iIgWESlmdvTsAAAAszsB2vBQahKN40YAAAAASUVORK5CYII=");this.m_oImageDisabled=
this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSMBaZbFjgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA80lEQVRYw+3XvQqDMBQF4HNtcBOsc0fBB9DB53dScHB1cepWcMkWxNulFilU1Cb9457xLPlIokkIt7Rti08mSRIAgIcvi4AEJCAB/QXIGMPDMPCsOj7pn+VkDaS15qIo0DQNmO9jH+b9ipytgLTWXFUVmBlxHIOIpv4y79+yZBNmHEekaYowDGmpXxu1F1OWJZgZWZYhiiJa6p3OkEvMZpBrzO//h4IgoDzPQUSo6xp93/NS/5YZco3atWQuUbv3kCvUS5t6PnjXdfej47HfErLxDDLGsOd5UErRmn7pGaRsfKq+79OWXi5oAhKQgAQkIIu5AvJV2EqdOHDMAAAAAElFTkSuQmCC")}
CommonExtend(CDrawingButtonBackward5,CDrawingButtonBase);CDrawingButtonBackward5.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonBackward5.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Backward(5)};CDrawingButtonBackward5.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backward5:"Back 5 moves")+" (Ctrl+Left)"};
CDrawingButtonBackward5.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_Backward_5Button(this)};
function CDrawingButtonBackward(a){CDrawingButtonBackward.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSUz9xsziAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxUlEQVRYw+3VIQ7DMAwF0J+ppHABQSEhISVBPdLOsKvsEr1NSKQoKi0oq0IqdbQabN0lquwTPNnfthiGATXVA5UVgxjEIAbdDqSUmqWUrypAxpit7/unc+7Ttm1ZkDFm67oOADCOI3LO5UB7TAgBMUZRbGS/mBCCKBZqaswp0BWYe92hlJLw3gMArLWw1m7FO3QF6vTIqFEkGaJEkYV6j9Ja4+jraCg3JKUklmWZ13V9H30dDfXaTtMk+Q4xiEEMYhCD/lhfy3RcBznfWwkAAAAASUVORK5CYII=");this.m_oImageDisabled=
this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSgeB2oRsAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAx0lEQVRYw+3XMQqEMBAF0D8h2AniGbyBFp7fSiGFrY1HsEkXxL/VwtY6bkTmHyA8kskPEQBYlgVPicPDYiADGchArwOllLjvOx8BijFyGAbM8wySeUExRk7TBJJomgYikg/0xRzHgbZtUVWVnF3La2DGcQRJdF2Huq4l21BrYy6B7sC8q4fKspS+7yEiCCFg2zZm36E7UJePTBulMkOaKLWh/kWt63r66RDtb1BKic45eO9P1YDXvrZFUYj1kIEMZCADGeiP+QAy+XDf76BlKwAAAABJRU5ErkJggg==")}
CommonExtend(CDrawingButtonBackward,CDrawingButtonBase);CDrawingButtonBackward.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonBackward.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Backward(1)};CDrawingButtonBackward.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.backward1:"Back")+" (Left)"};
CDrawingButtonBackward.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_BackwardButton(this)};
function CDrawingButtonForward(a){CDrawingButtonForward.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSkJnaKlNgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxUlEQVRYw+3WIQ7DIBQG4L8NBiQCVVODqeFU21V6he0QPUsNhqQh2AossrsDvKVseb8n+QL8D4Zt29BTRnQWBjGIQQz6WZDW+mGMydQgUbNISgnn3EspBe/9FWMcbt2hUgpSSgCAZVkwz/N1+5EdxzGEEMhRTZc6hECOam4ZNYqk9pSo/xyM1trLWgsA8N6jZQyMPWGaQdSYJtA3MNUgKSWmaSLHVL9lpRTs+/4UQqzneeouWpZzflNj+IPGIAYxiEEMqsgHyjhf9O2e3l4AAAAASUVORK5CYII=");this.m_oImageDisabled=
this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSgxrLss6QAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAyUlEQVRYw+3VsQqDUAwF0JvycBPEbxBcBR38ficFB1cXP8HFTSS3U3/Al9LXNtkDB5KbyLquSKXqusYDiZWDHOQgB30t6LounufJJEAksSwLhmHAcRz8OEhEUFUVSGKaJlPU7ZEVRSFt20JVTVFRS12WpXRdB1XFOI4mqOiUvVAkTVAmsbdE/eZh3Ped8zxDRND3PfI8l4+BLDHRIGtMFOgdmKjXsW2bOQYAwt3X0TQNVBVZlollysLtxhAk2dg7yEEOcpCD/gn0BPdVbmFsgto0AAAAAElFTkSuQmCC")}
CommonExtend(CDrawingButtonForward,CDrawingButtonBase);CDrawingButtonForward.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonForward.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Forward(1)};CDrawingButtonForward.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forward1:"Forward")+" (Right)"};
CDrawingButtonForward.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ForwardButton(this)};
function CDrawingButtonForward5(a){CDrawingButtonForward5.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSQ2nmr2RgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAZUlEQVRYw+3VMQrAIAyFYelhe84M7kHwHMU5S3qAVnCxpOH/xrfkQdCUAgBIRETOWuu1mm83xnAzc1X1lXy71pqb2WP4LP9E7/11+CynVPpSR5o/KdTKKPOblxXudIQ7rgAABHQDS2dNsnKXx6sAAAAASUVORK5CYII=");this.m_oImageDisabled=
this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDSQYQrz7iQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAxElEQVRYw+2VPQuDMBCG30j/QIduHQP5AQr6/5cQyBAQBxenbl0C2b0uOhQSxI8ULfdM4eXgHnJHAjAMwzAXoe/751JN13XUti1N9fdYvpfbfFBKvZaKnXPw3sNaSwAesbyqKrFHqFhTLKUEEcEYgxDCO5ZPsr8RqutalGWJcRy/mqfyLWy6Xq01WWshhEDTNJjHlMqzC+WU2rWAOaSKsz0//zGyUy11TpnVQrllVi/1MAzRpqk8O6lP9MjPlWEYhmGuzgcvy8ThfV4IDQAAAABJRU5ErkJggg==")}
CommonExtend(CDrawingButtonForward5,CDrawingButtonBase);CDrawingButtonForward5.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonForward5.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_Forward(5)};CDrawingButtonForward5.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forward5:"Forward 5 moves")+" (Ctrl+Right)"};
CDrawingButtonForward5.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_Forward_5Button(this)};
function CDrawingButtonForwardToEnd(a){CDrawingButtonForwardToEnd.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDRAjSJ3hWgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABBElEQVRYw+3WwYmFMBAG4D8PvUgIiKYJERQv2oJXYatcsA4Pqxh42EQQIQQPImRr2DyzesgUMHyZyUwCPCxI3/ePwXRdh9fTKuRBHuRBHnRFVFVl2rY1nPOffwHleW7qujZBEFx+mD9npJQijmOkaYowDM0wDOQ8z/taprWGEIKs6wrOOZqmubRSVi1TSmGeZyco60vtCvXRlLlAfTz2Siksy/K97zs45yiKwtwKYowhy7KvKIogpYQQgtwGYoyhLEuTJAmklLhiBbyehLEGucJYgSilKIrCCcbq6dBaY9s2HMeBcRwvxViBAOD9fhM4isBF0mmayG17yP8YPciDPMiDHMcvBCGFxBHbK9gAAAAASUVORK5CYII=");this.m_oImageDisabled=
this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwTDQ4kArhLJgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA9UlEQVRYw+3WsY6FIBAF0CtQWNjTEWw0Uf+/9x/URBsNVnQmdhqZ1+wPLMo+s2H6S85MYALwskrGcXwNpixLsLdNKIIiKIIi6IkyxlDbtnSe59+ArLU0TROFaEb8NuCcg7UWxhgcx0FN0yRfBTHGUNd1QkS0LAsAPIoSPiHOOX4Qj6OEbzAUStwJh0CJux1xzlFVVbLvO83zjCzLiDH2vT10XReGYaBt25DnObTWtybE7mK6rqN1XaG1xhN3iL0J4w0KhfECOefQ930QjPemllIiTVMURfEoxvvZSykTKWWQ74cIcahSKlFKxQ9aBEVQBEXQv6wPn1Z3S2AlDhEAAAAASUVORK5CYII=")}
CommonExtend(CDrawingButtonForwardToEnd,CDrawingButtonBase);CDrawingButtonForwardToEnd.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){(b=e?this.m_oImageDisabled:this.m_oImage)&&a.drawImage(b,0,0)};CDrawingButtonForwardToEnd.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Step_ForwardToEnd()};CDrawingButtonForwardToEnd.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.forwardEnd:"Go to the end")+" (Ctrl+Shift+Right)"};
CDrawingButtonForwardToEnd.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ForwardToEndButton(this)};function CDrawingButtonNextVariant(a){CDrawingButtonNextVariant.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonNextVariant,CDrawingButtonBase);
CDrawingButtonNextVariant.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+.2*b+.5);f=Math.ceil(c+.35*b+.5);g=Math.ceil(c+.57*b+.5);c=Math.ceil(c+.92*b+.5);h=Math.ceil(d+.2*b+.5);k=Math.ceil(d+.38*b+.5);var l=Math.ceil(d+.52*b+.5),m=Math.ceil(d+.6*b+.5),n=Math.ceil(d+.68*b+.5);b=Math.ceil(d+.84*b+.5);a.beginPath();a.moveTo(e,h);a.lineTo(f,h);a.lineTo(f,l);a.lineTo(g,l);a.lineTo(g,k);a.lineTo(c,m);a.lineTo(g,b);a.lineTo(g,n);a.lineTo(e,n);a.closePath();a.fill()};
CDrawingButtonNextVariant.prototype.private_HandleMouseDown=function(){this.m_oGameTree.GoTo_NextVariant()};CDrawingButtonNextVariant.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.nextVariant:"Next variant")+" (Down)"};CDrawingButtonNextVariant.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_NextVariantButton(this)};
function CDrawingButtonPrevVariant(a){CDrawingButtonPrevVariant.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonPrevVariant,CDrawingButtonBase);
CDrawingButtonPrevVariant.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+.2*b+.5);f=Math.ceil(c+.35*b+.5);g=Math.ceil(c+.57*b+.5);c=Math.ceil(c+.92*b+.5);h=Math.ceil(d+.8*b+.5);k=Math.ceil(d+.62*b+.5);var l=Math.ceil(d+.48*b+.5),m=Math.ceil(d+.4*b+.5),n=Math.ceil(d+(1-.68)*b+.5);b=Math.ceil(d+(1-.84)*b+.5);a.beginPath();a.moveTo(e,h);a.lineTo(f,h);a.lineTo(f,l);a.lineTo(g,l);a.lineTo(g,k);a.lineTo(c,m);a.lineTo(g,b);a.lineTo(g,n);a.lineTo(e,n);a.closePath();a.fill()};
CDrawingButtonPrevVariant.prototype.private_HandleMouseDown=function(){this.m_oGameTree.GoTo_PrevVariant()};CDrawingButtonPrevVariant.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.prevVariant:"Previous variant")+" (Up)"};CDrawingButtonPrevVariant.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_PrevVariantButton(this)};
function CDrawingButtonEditModeMove(a){CDrawingButtonEditModeMove.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeMove,CDrawingButtonBase);
CDrawingButtonEditModeMove.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+.5*b-b/10+.5);f=Math.ceil(d+.5*b-b/10+.5);g=Math.ceil(.25*b+.5);a.fillStyle=(new CColor(255,255,255)).ToString();a.strokeStyle=(new CColor(0,0,0)).ToString();a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill();a.stroke();a.fillStyle=(new CColor(0,0,0)).ToString();e=Math.ceil(c+.5*b+b/10+.5);f=Math.ceil(d+.5*b+b/10+.5);g=Math.ceil(.25*b+.5);a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill()};
CDrawingButtonEditModeMove.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.Move)};CDrawingButtonEditModeMove.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeMoves:"Moves")+" (F1)"};CDrawingButtonEditModeMove.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeMoveButton(this)};
function CDrawingButtonEditModeScores(a){CDrawingButtonEditModeScores.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeScores,CDrawingButtonBase);
CDrawingButtonEditModeScores.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=a.createImageData(b,b);f=b/5|0;g=4*b/5|0;for(k=0;k<b;k++)for(var l=0;l<b;l++){var m=4*(k*b+l);k>=f&&k<=g&&l>=f&&l<=g?(b-k>=l||k===f||k===g||l===f||l===g?(e.data[m+0]=0,e.data[m+1]=0,e.data[m+2]=0):(e.data[m+0]=255,e.data[m+1]=255,e.data[m+2]=255),e.data[m+3]=255):(e.data[m+0]=h.r,e.data[m+1]=h.g,e.data[m+2]=h.b,e.data[m+3]=h.a)}a.putImageData(e,c,d)};
CDrawingButtonEditModeScores.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.CountScores)};CDrawingButtonEditModeScores.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeScores:"Count Scores")+" (F2)"};CDrawingButtonEditModeScores.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeScoresButton(this)};
function CDrawingButtonEditModeAddRem(a){CDrawingButtonEditModeAddRem.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeAddRem,CDrawingButtonBase);
CDrawingButtonEditModeAddRem.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+.75*b+.5);f=Math.ceil(d+.125*b+.5);g=Math.ceil(.25*b+.5);h=Math.ceil(.02*b+.5);a.fillRect(e,f,g,h);e=Math.ceil(c+.875*b+.5);f=Math.ceil(d+.5);g=Math.ceil(.02*b+.5);h=Math.ceil(.25*b+.5);a.fillRect(e,f,g,h);e=Math.ceil(c+.5);f=Math.ceil(d+.875*b+.5);g=Math.ceil(.25*b+.5);h=Math.ceil(.02*b+.5);a.fillRect(e,f,g,h);e=Math.ceil(c+.5*b-b/10+.5);f=Math.ceil(d+.5*b-b/10+.5);g=Math.ceil(.25*b+.5);a.fillStyle=
(new CColor(255,255,255)).ToString();a.strokeStyle=(new CColor(0,0,0)).ToString();a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill();a.stroke();a.fillStyle=(new CColor(0,0,0)).ToString();e=Math.ceil(c+.5*b+b/10+.5);f=Math.ceil(d+.5*b+b/10+.5);g=Math.ceil(.25*b+.5);a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill()};CDrawingButtonEditModeAddRem.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddRemove)};
CDrawingButtonEditModeAddRem.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeEditor:"Editor")+" (F3)"};CDrawingButtonEditModeAddRem.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeAddRemButton(this)};function CDrawingButtonEditModeTr(a){CDrawingButtonEditModeTr.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeTr,CDrawingButtonBase);
CDrawingButtonEditModeTr.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){h=b/2;e=3*b/4;f=.1*b;g=Math.sqrt(h*h-(e-h)*(e-h))+h;h=-Math.sqrt(h*h-(e-h)*(e-h))+h;a.lineWidth=Math.ceil(.05*b+.5);a.beginPath();a.moveTo(c+b/2,d+2*f);a.lineTo(c+g-f,d+e+f);a.lineTo(c+h+f,d+e+f);a.closePath();a.stroke()};CDrawingButtonEditModeTr.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkTr)};
CDrawingButtonEditModeTr.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeTriangles:"Triangles")+" (F4)"};CDrawingButtonEditModeTr.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeTrButton(this)};function CDrawingButtonEditModeSq(a){CDrawingButtonEditModeSq.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeSq,CDrawingButtonBase);
CDrawingButtonEditModeSq.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){h=b/2;f=.05*b;g=-b/2*Math.sqrt(2)/2+b/2;e=Math.floor(c+(Math.sqrt(h*h-(g-h)*(g-h))+h)-f);c=Math.ceil(c+(-Math.sqrt(h*h-(g-h)*(g-h))+h)+f);g=Math.ceil(d+g+f);d=Math.floor(d+(b/2*Math.sqrt(2)/2+b/2)-f);a.lineWidth=Math.ceil(.05*b+.5);a.beginPath();a.moveTo(e,g);a.lineTo(c,g);a.lineTo(c,d);a.lineTo(e,d);a.closePath();a.stroke()};CDrawingButtonEditModeSq.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkSq)};
CDrawingButtonEditModeSq.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeSquares:"Squares")+" (F5)"};CDrawingButtonEditModeSq.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeSqButton(this)};function CDrawingButtonEditModeCr(a){CDrawingButtonEditModeCr.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeCr,CDrawingButtonBase);
CDrawingButtonEditModeCr.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=.05*b;f=b/2;g=4*e;a.lineWidth=Math.ceil(e+.5);a.beginPath();a.arc(c+b/2,d+b/2,f-g,0,2*Math.PI,!1);a.stroke()};CDrawingButtonEditModeCr.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkCr)};CDrawingButtonEditModeCr.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeCircles:"Circles")+" (F6)"};
CDrawingButtonEditModeCr.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeCrButton(this)};function CDrawingButtonEditModeX(a){CDrawingButtonEditModeX.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeX,CDrawingButtonBase);CDrawingButtonEditModeX.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=c+.25*b;c+=.75*b;f=d+.25*b;d+=.75*b;a.lineWidth=Math.ceil(.05*b+.5);a.beginPath();a.moveTo(e,f);a.lineTo(c,d);a.moveTo(c,f);a.lineTo(e,d);a.stroke()};
CDrawingButtonEditModeX.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkX)};CDrawingButtonEditModeX.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeXMarks:"X marks")+" (F7)"};CDrawingButtonEditModeX.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeXButton(this)};
function CDrawingButtonEditModeText(a){CDrawingButtonEditModeText.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeText,CDrawingButtonBase);CDrawingButtonEditModeText.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=.8*b;a.font=e+"px Arial";d=d+b/2+e/3;b=c+(b-a.measureText("A").width)/2;a.fillText("A",b,d)};CDrawingButtonEditModeText.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkTx)};
CDrawingButtonEditModeText.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeText:"Text labels")+" (F8)"};CDrawingButtonEditModeText.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeTextButton(this)};function CDrawingButtonEditModeNum(a){CDrawingButtonEditModeNum.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeNum,CDrawingButtonBase);
CDrawingButtonEditModeNum.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=.8*b;a.font=e+"px Helvetica, Arial, Verdana";d=d+b/2+e/3;b=c+(b-a.measureText("1").width)/2;a.fillText("1",b,d)};CDrawingButtonEditModeNum.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkNum)};
CDrawingButtonEditModeNum.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeNumbers:"Numeric labels")+" (F9)"};CDrawingButtonEditModeNum.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeNumButton(this)};function CDrawingButtonAutoPlay(a){CDrawingButtonAutoPlay.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonAutoPlay,CDrawingButtonBase);
CDrawingButtonAutoPlay.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){EDrawingButtonState2.AutoPlayStopped===this.m_nState2?this.private_DrawTriangle(b,c,d,a,1):(e=Math.floor(c+b/5+b/20+.5),c=Math.ceil(c+4*b/5-b/20+.5),f=Math.ceil(d+b/5+.5),d=Math.ceil(d+4*b/5+.5),g=Math.ceil(e+b/5),b=Math.floor(c-b/5),a.beginPath(),a.moveTo(e,f),a.lineTo(g,f),a.lineTo(g,d),a.lineTo(e,d),a.closePath(),a.fill(),a.beginPath(),a.moveTo(c,f),a.lineTo(b,f),a.lineTo(b,d),a.lineTo(c,d),a.closePath(),a.fill())};
CDrawingButtonAutoPlay.prototype.private_HandleMouseDown=function(){EDrawingButtonState2.AutoPlayStopped===this.m_nState2?this.m_oGameTree.Start_AutoPlay():this.m_oGameTree.Stop_AutoPlay()};CDrawingButtonAutoPlay.prototype.private_GetHint=function(){return EDrawingButtonState2.AutoPlayStopped===this.m_nState2?window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.startAutoplay:"Start autoplay":window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.stopAutoplay:"Stop autoplay"};
CDrawingButtonAutoPlay.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_AutoPlayButton(this)};function CDrawingButtonClose(a){CDrawingButtonClose.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonClose,CDrawingButtonBase);
CDrawingButtonClose.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){b=a.createImageData(f,g);e=b.data;c=(f-8)/2|0;d=(g-8)/2|0;for(h=0;h<g;h++)for(var l=0;l<f;l++){var m=4*(l+h*f),n=k.r,p=k.g,q=k.b,t=h-d,r=l-c;if(0===t&&(0===r||1===r||6===r||7===r)||1===t&&(1===r||2===r||5===r||6===r)||2===t&&(2===r||3===r||4===r||5===r)||3===t&&(3===r||4===r)||4===t&&(3===r||4===r)||5===t&&(2===r||3===r||4===r||5===r)||6===t&&(1===r||2===r||5===r||6===r)||7===t&&(0===r||1===r||6===r||7===r))q=p=n=255;e[m+
0]=n;e[m+1]=p;e[m+2]=q;e[m+3]=255}a.putImageData(b,0,0)};CDrawingButtonClose.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Close()};CDrawingButtonClose.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.common.button.close:"Close"};CDrawingButtonClose.prototype.private_ClickTransformIn=function(){};CDrawingButtonClose.prototype.private_ClickTransformOut=function(){};CDrawingButtonClose.prototype.private_DrawSelectionBounds=function(a,b,c){};
function CDrawingButtonGameInfo(a){CDrawingButtonGameInfo.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonGameInfo,CDrawingButtonBase);CDrawingButtonGameInfo.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=.02*b;f=b/2;g=4*e;a.lineWidth=Math.ceil(e+.5);a.beginPath();a.arc(c+b/2,d+b/2,f-g,0,2*Math.PI,!1);a.stroke();e=.9*b;a.font=e+"px Times New Roman, Sans serif";d=d+b/2+e/3;b=c+(b-a.measureText("i").width)/2;a.fillText("i",b,d)};
CDrawingButtonGameInfo.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.GameInfo,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})};CDrawingButtonGameInfo.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.gameInfo:"Game info"};function CDrawingButtonOK(a){CDrawingButtonOK.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonOK,CDrawingButtonBase);
CDrawingButtonOK.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e="OK";window.g_oLocalization&&(e=window.g_oLocalization.common.button.ok);a.lineWidth=1;a.moveTo(0,0);a.lineTo(0,g);a.lineTo(f,g);a.lineTo(f,0);a.lineTo(0,0);a.stroke();f=e;g=.8*b;e=g+"px Tahoma, Sans serif";a.fillStyle=(new CColor(0,0,0,255)).ToString();a.font=e;d=d+b/2+g/3;b=c+(b-a.measureText(f).width)/2;a.fillText(f,b,d)};CDrawingButtonOK.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Handle_OK()};
CDrawingButtonOK.prototype.private_GetHint=function(){var a="OK";window.g_oLocalization&&(a=window.g_oLocalization.common.button.ok);return a};CDrawingButtonOK.prototype.private_ClickTransformIn=function(){};CDrawingButtonOK.prototype.private_ClickTransformOut=function(){};CDrawingButtonOK.prototype.private_DrawSelectionBounds=function(a,b,c){};function CDrawingButtonCancel(a){CDrawingButtonCancel.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonCancel,CDrawingButtonBase);
CDrawingButtonCancel.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e="Cancel";window.g_oLocalization&&(e=window.g_oLocalization.common.button.cancel);a.lineWidth=1;a.moveTo(0,0);a.lineTo(0,g);a.lineTo(f,g);a.lineTo(f,0);a.lineTo(0,0);a.stroke();f=e;g=.8*b;e=g+"px Tahoma, Sans serif";a.fillStyle=(new CColor(0,0,0,255)).ToString();a.font=e;d=d+b/2+g/3;b=c+(b-a.measureText(f).width)/2;a.fillText(f,b,d)};CDrawingButtonCancel.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Handle_Cancel()};
CDrawingButtonCancel.prototype.private_GetHint=function(){var a="Cancel";window.g_oLocalization&&(a=window.g_oLocalization.common.button.cancel);return a};CDrawingButtonCancel.prototype.private_ClickTransformIn=function(){};CDrawingButtonCancel.prototype.private_ClickTransformOut=function(){};CDrawingButtonCancel.prototype.private_DrawSelectionBounds=function(a,b,c){};function CDrawingButtonSettings(a){CDrawingButtonSettings.superclass.constructor.call(this,a);this.m_oTransformCanvas=null}
CommonExtend(CDrawingButtonSettings,CDrawingButtonBase);
CDrawingButtonSettings.prototype.Init=function(a,b){CDrawingButtonToolbarCustomize.superclass.Init.apply(this,arguments);var c=this.HtmlElement.Control.HtmlElement,d=document.createElement("canvas");d.setAttribute("id",a+"_transform");d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.width=36;d.height=36;d.draggable="false";d.ondragstart=function(a){a.preventDefault();return!1};c.appendChild(d);c=CreateControlContainer(a+"_canvas");c.Bounds.SetParams(0,
0,1E3,1E3,!1,!1,!1,!1,-1,-1);c.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;this.HtmlElement.Control.AddControl(c);this.m_oTransformCanvas=d};
CDrawingButtonSettings.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=this.m_oTransformCanvas.getContext("2d");e.fillStyle=a.fillStyle;e.strokeStyle=a.strokeStyle;g=.02*b;a=b/2-b/30;f=b/4;e.lineWidth=Math.ceil(7*g+.5);e.beginPath();e.arc(c+b/2,d+b/2,f,0,2*Math.PI,!1);e.stroke();e.lineWidth=Math.ceil(5*g+.5);for(g=0;9>g;g++)e.beginPath(),h=40*g*Math.PI/180,e.lineTo(c+f*Math.cos(h)+b/2,d-f*Math.sin(h)+b/2),e.lineTo(c+a*Math.cos(h)+b/2,d-a*Math.sin(h)+b/2),e.stroke()};
CDrawingButtonSettings.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Settings,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing});"rotate(90deg)"!==this.m_oTransformCanvas.style.transform?(this.m_oTransformCanvas.style.transition="transform 0.5s linear",this.m_oTransformCanvas.style.transform="rotate(90deg)"):(this.m_oTransformCanvas.style.transition="transform 0.5s linear",this.m_oTransformCanvas.style.transform="rotate(0deg)")};
CDrawingButtonSettings.prototype.private_GetHint=function(){return"Settings"};function CDrawingButtonPass(a){CDrawingButtonPass.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonPass,CDrawingButtonBase);CDrawingButtonPass.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=window.g_oLocalization?window.g_oLocalization.gameRoom.button.pass:"Pass";f=.9*b;a.font=f+"px Times New Roman, Sans serif";d=d+b/2+f/3;b=c+(b-a.measureText(e).width)/2;a.fillText(e,b,d)};
CDrawingButtonPass.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Pass()};CDrawingButtonPass.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.pass:"Pass"};function CDrawingButtonAbout(a){CDrawingButtonAbout.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonAbout,CDrawingButtonBase);
CDrawingButtonAbout.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=.02*b;f=b/2;g=4*e;a.lineWidth=Math.ceil(e+.5);a.beginPath();a.arc(c+b/2,d+b/2,f-g,0,2*Math.PI,!1);a.stroke();e=.9*b;a.font=e+"px Times New Roman, Sans serif";d=d+b/2+e/3;b=c+(b-a.measureText("?").width)/2;a.fillText("?",b,d)};CDrawingButtonAbout.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.About,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})};
CDrawingButtonAbout.prototype.private_GetHint=function(){return"About"};function CDrawingButtonTabComments(a){CDrawingButtonTabComments.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonTabComments,CDrawingButtonBase);
CDrawingButtonTabComments.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+3*b/20+.5);f=Math.ceil(c+16*b/20+.5);g=Math.ceil(c+14*b/20+.5);c=Math.ceil(c+11*b/20+.5);h=Math.ceil(d+5*b/20+.5);k=Math.ceil(d+14*b/20+.5);b=Math.ceil(d+18*b/20+.5);a.lineWidth=2;a.beginPath();a.moveTo(e,h);a.lineTo(f,h);a.lineTo(f,k);a.lineTo(g,k);a.lineTo(g,b);a.lineTo(c,k);a.lineTo(e,k);a.closePath();a.stroke()};CDrawingButtonTabComments.prototype.private_HandleMouseDown=function(){this.m_oParent.Select(this)};
CDrawingButtonTabComments.prototype.private_GetHint=function(){return"Comments"};function CDrawingButtonTabNavigator(a){CDrawingButtonTabNavigator.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonTabNavigator,CDrawingButtonBase);
CDrawingButtonTabNavigator.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=c+0;f=c+5*b/20;g=c+15*b/20;c+=b;h=d+6*b/20;d+=16*b/20;b=b/6+1|0;a.lineWidth=2;a.lineJoin="miter";a.strokeStyle="rgba(0,0,0, 1)";a.beginPath();a.moveTo(e-2|0,h|0);a.lineTo(c+2|0,h|0);a.stroke();a.beginPath();a.moveTo(f|0,h|0);a.lineTo(f|0,d|0);a.lineTo(c+2|0,d|0);a.stroke();a.lineWidth=1;a.strokeStyle=(new CColor(0,0,0)).ToString();a.fillStyle=(new CColor(255,255,255)).ToString();a.beginPath();a.arc(g,h,b,0,2*Math.PI,
!1);a.fill();a.stroke();a.beginPath();a.arc(g,d,b,0,2*Math.PI,!1);a.fill();a.stroke();a.fillStyle=(new CColor(0,0,0)).ToString();a.beginPath();a.arc(f,h,b,0,2*Math.PI,!1);a.fill()};CDrawingButtonTabNavigator.prototype.private_HandleMouseDown=function(){this.m_oParent.Select(this)};CDrawingButtonTabNavigator.prototype.private_GetHint=function(){return"Navigator"};
function CDrawingButtonBoardMode(a){CDrawingButtonBoardMode.superclass.constructor.call(this,a);var b=a.Get_MainDiv(),c=this;this.m_nWidth=373;this.m_nHeight=40;var d=document.createElement("div");d.id=b.id+"ButtonBoardModeToolbarWrapper";d.style.position="absolute";d.style.top="100px";d.style.left="100px";d.style.width=this.m_nWidth+"px";d.style.height=this.m_nHeight+"px";d.style.background="rgb(217, 217, 217)";d.style.display="block";d.style.border="1px solid rgb(166, 166, 166)";d.style.boxShadow=
"0px 1px 15px rgba(0,0,0,0.8)";d.style.opacity=0;d.style.overflowY="hidden";d.style.boxSizing="border-box";d.onclick=function(){c.Hide_Toolbar()};b.appendChild(d);var e=document.createElement("div");e.id=b.id+"ButtonBoardModeToolbar";e.style.position="absolute";e.style.top="1px";e.style.left="1px";e.style.right="1px";e.style.bottom="1px";d.appendChild(e);this.m_oButtonMove=new CDrawingButtonEditModeMove(a);this.m_oButtonScores=new CDrawingButtonEditModeScores(a);this.m_oButtonAddRem=new CDrawingButtonEditModeAddRem(a);
this.m_oButtonTr=new CDrawingButtonEditModeTr(a);this.m_oButtonSq=new CDrawingButtonEditModeSq(a);this.m_oButtonCr=new CDrawingButtonEditModeCr(a);this.m_oButtonX=new CDrawingButtonEditModeX(a);this.m_oButtonText=new CDrawingButtonEditModeText(a);this.m_oButtonNum=new CDrawingButtonEditModeNum(a);this.m_oButtonColor=new CDrawingButtonEditModeColor(a);b=new CDrawingToolbar(a);b.Add_Control(this.m_oButtonMove,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonScores,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonAddRem,
36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonTr,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonSq,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonCr,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonX,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonText,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonNum,36,1,EToolbarFloat.Left);b.Add_Control(this.m_oButtonColor,36,1,EToolbarFloat.Left);b.Init(e.id,a.Get_GameTree());b.Update_Size();d.style.display="none";this.m_oToolbarElement=
d;this.m_nTransitionId=null;this.m_nTop=0;d.style.transitionProperty="opacity,top,height";d.style.transitionDuration="1s";d.style.transitionTimingFunction="cubic-bezier(0,0,0,1)";d.style.transitionDelay="0s";this.m_nShowToolbarId=this.m_eMode=null}CommonExtend(CDrawingButtonBoardMode,CDrawingButtonBase);
CDrawingButtonBoardMode.prototype.Update_Size=function(){CDrawingButtonBoardMode.superclass.Update_Size.apply(this,arguments);var a=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),b=a.X-this.m_nWidth/2+18;a=a.Y-50;var c=this.m_oDrawing.Get_Width(),d=this.m_oDrawing.Get_Height();b+this.m_nWidth>c-5&&(b=c-5-this.m_nWidth);5>b&&(b=5);a+this.m_nHeight>d-5&&(a=d-5-this.m_nHeight);5>a&&(a=5);this.m_nTop=a;this.m_oToolbarElement.style.left=b+"px";this.m_oToolbarElement.style.top=
a+"px"};CDrawingButtonBoardMode.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){};
CDrawingButtonBoardMode.prototype.private_HandleMouseDown=function(){if("none"===this.m_oToolbarElement.style.display){if(null===this.m_nShowToolbarId){var a=this;this.m_nShowToolbarId=setTimeout(function(){null!==a.m_nTransitionId&&(clearTimeout(a.m_nTransitionId),a.m_nTransitionId=null);a.m_oToolbarElement.style.display="block";a.m_oToolbarElement.style.opacity=0;a.m_oToolbarElement.style.top=a.m_nTop+50+"px";a.m_oToolbarElement.style.height="0px";a.m_nTransitionId=setTimeout(function(){a.m_oToolbarElement.style.opacity=
1;a.m_oToolbarElement.style.top=a.m_nTop+"px";a.m_oToolbarElement.style.height=a.m_nHeight+"px";a.m_nTransitionId=null;a.m_nShowToolbarId=null},20)},20)}}else this.Hide_Toolbar()};CDrawingButtonBoardMode.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editMode:"Select Edit mode")+" (F1-F10)"};CDrawingButtonBoardMode.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_SelectBoardModeButton(this)};
CDrawingButtonBoardMode.prototype.On_UpdateBoardMode=function(a){if(this.m_eMode!==a){this.m_eMode=a;switch(a){case EBoardMode.Move:this.m_oImageData=this.m_oButtonMove.m_oImageData;break;case EBoardMode.CountScores:this.m_oImageData=this.m_oButtonScores.m_oImageData;break;case EBoardMode.AddRemove:this.m_oImageData=this.m_oButtonAddRem.m_oImageData;break;case EBoardMode.AddMarkTr:this.m_oImageData=this.m_oButtonTr.m_oImageData;break;case EBoardMode.AddMarkSq:this.m_oImageData=this.m_oButtonSq.m_oImageData;
break;case EBoardMode.AddMarkCr:this.m_oImageData=this.m_oButtonCr.m_oImageData;break;case EBoardMode.AddMarkX:this.m_oImageData=this.m_oButtonX.m_oImageData;break;case EBoardMode.AddMarkTx:this.m_oImageData=this.m_oButtonText.m_oImageData;break;case EBoardMode.AddMarkNum:this.m_oImageData=this.m_oButtonNum.m_oImageData;break;case EBoardMode.AddMarkColor:this.m_oImageData=this.m_oButtonColor.m_oImageData}this.private_UpdateState()}};CDrawingButtonBoardMode.prototype.private_OnResize=function(){this.private_UpdateState()};
CDrawingButtonBoardMode.prototype.Hide_Toolbar=function(){if("none"!==this.m_oToolbarElement.style.display){null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null);this.m_oToolbarElement.style.opacity=0;this.m_oToolbarElement.style.top=this.m_nTop+50+"px";this.m_oToolbarElement.style.height="0px";var a=this;this.m_nTransitionId=setTimeout(function(){a.m_oToolbarElement.style.display="none";a.m_nTransitionId=null},500)}};
function CDrawingButtonEditModeColor(a){CDrawingButtonEditModeText.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonEditModeColor,CDrawingButtonBase);
CDrawingButtonEditModeColor.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){a.lineWidth=2;a.strokeStyle="rgb(0, 0, 200)";a.beginPath();a.moveTo(18,12);a.lineTo(18,6);a.lineTo(6,6);a.lineTo(6,18);a.lineTo(12,18);a.stroke();a.strokeStyle="rgb(0, 100, 0)";a.beginPath();a.moveTo(24,18);a.lineTo(24,12);a.lineTo(12,12);a.lineTo(12,24);a.lineTo(18,24);a.stroke();a.strokeStyle="rgb(200, 0, 0)";a.beginPath();a.moveTo(30,30);a.lineTo(30,18);a.lineTo(18,18);a.lineTo(18,30);a.closePath();a.stroke()};
CDrawingButtonEditModeColor.prototype.private_HandleMouseDown=function(){this.m_oGameTree.Get_DrawingBoard().Set_Mode(EBoardMode.AddMarkColor)};CDrawingButtonEditModeColor.prototype.private_GetHint=function(){return(window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.editModeColors:"Color marks")+" (F10)"};CDrawingButtonEditModeColor.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_EditModeColorButton(this)};
function CDrawingButtonToolbarCustomize(a,b){CDrawingButtonEditModeText.superclass.constructor.call(this,a);this.m_oImage=this.private_AddImageToLoad("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAICAYAAADJEc7MAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wwVDQAZ4Th1ZQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAkUlEQVQY033PsRHDIAwF0A+nitILUHCnhoapklW8QrZhBBo1NDRULEEak3OwsSpO0pOEijG+QgifWityzgoP4Zzr1lqklN5ERLsxBswMAH2FmbkfPSCiXbfWNhEZRTBzf0IigtbapgGglKJWeEalFAUANBqORPfe/84eg2b0Bxf4FgGAnv9zPnuFLhvnzaf3Jb5oPFaLEyr1tgAAAABJRU5ErkJggg==");
this.m_oTransformCanvas=null;this.m_oMultiLevelToolbar=b;var c=a.Get_MainDiv(),d=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.mainNavigation:"Main navigation",e=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.treeNavigation:"Tree navigation",f=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.generalToolbar:"General toolbar",g=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.autoplay:"Autoplay toolbar",
h=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.timelinePanel:"Timeline panel",k=window.g_oLocalization?window.g_oLocalization.gameRoom.toolbarCustomization.kifuMode:"Kifu mode";this.m_nWidth=160;this.m_nHeight=134;window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont('16px "Times New Roman", Times, serif'),this.m_nWidth=33+Math.max(window.g_oTextMeasurer.Measure(d),window.g_oTextMeasurer.Measure(e),window.g_oTextMeasurer.Measure(f),window.g_oTextMeasurer.Measure(g),
window.g_oTextMeasurer.Measure(h),window.g_oTextMeasurer.Measure(k))+7);var l=document.createElement("div");l.id=c.id+"ToolbarCustomizeWrapper";l.style.position="absolute";l.style.top="100px";l.style.left="100px";l.style.width=this.m_nWidth+"px";l.style.height=this.m_nHeight+"px";l.style.background="rgb(255, 255, 255)";l.style.display="block";l.style.border="1px solid rgb(166, 166, 166)";l.style.boxShadow="0px 1px 15px rgba(0,0,0,0.8)";l.style.overflowY="hidden";c.appendChild(l);l.style.transitionProperty=
"height";l.style.transitionDuration="0.2s";l.style.transitionDelay="0s";l.style.display="none";this.m_oContextMenuElement=l;this.m_nShowId=this.m_nTransitionId=null;c=document.createElement("ul");c.style.padding="5px 0";c.style.margin="2px 0 0";c.style.listStyle="none";c.style.fontSize="16px";c.style.backgroundClip="padding-box";c.style.lineHeight="20px";this.m_oMainNavigationCheckElement=this.private_CreateListItem(c,d,function(){a.Toggle_MultiLevelToolbarMainNavigation()},g_oGlobalSettings.Is_MultiLevelToolbarMainNavigation());
this.m_oTreeNavigationCheckElement=this.private_CreateListItem(c,e,function(){a.Toggle_MultiLevelToolbarTreeNavigation()},g_oGlobalSettings.Is_MultiLevelToolbarTreeNavigation());this.m_oGeneralCheckElement=this.private_CreateListItem(c,f,function(){a.Toggle_MultiLevelToolbarGeneral()},g_oGlobalSettings.Is_MultiLevelToolbarGeneral());this.m_oAutoPlayCheckElement=this.private_CreateListItem(c,g,function(){a.Toggle_MultiLevelToolbarAutoPlay()},g_oGlobalSettings.Is_MultiLevelToolbarAutoPlay());this.m_oTimelineCheckElement=
this.private_CreateListItem(c,h,function(){a.Toggle_MultiLevelToolbarTimeline()},g_oGlobalSettings.Is_MultiLevelToolbarTimeline());this.m_oKifuModeCheckElement=this.private_CreateListItem(c,k,function(){a.Toggle_MultiLevelToolbarKifuMode()},g_oGlobalSettings.Is_MultiLevelToolbarKifuMode());l.appendChild(c)}CommonExtend(CDrawingButtonToolbarCustomize,CDrawingButtonBase);
CDrawingButtonToolbarCustomize.prototype.Init=function(a,b){CDrawingButtonToolbarCustomize.superclass.Init.apply(this,arguments);var c=this.HtmlElement.Control.HtmlElement,d=document.createElement("canvas");d.setAttribute("id",a+"_transform");d.setAttribute("style","position:absolute;padding:0;margin:0;top:14px;left:11px;width:14px;height:8px;");d.width=14;d.height=8;d.setAttribute("oncontextmenu","return false;");d.draggable="false";d.ondragstart=function(a){a.preventDefault();return!1};c.appendChild(d);
this.m_oTransformCanvas=d};
CDrawingButtonToolbarCustomize.prototype.Update_Size=function(){CDrawingButtonToolbarCustomize.superclass.Update_Size.apply(this,arguments);var a=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),b=a.X+36-this.m_nWidth;a=a.Y+36+5;var c=this.m_oDrawing.Get_Width(),d=this.m_oDrawing.Get_Height();b+this.m_nWidth>c-5&&(b=c-5-this.m_nWidth);5>b&&(b=5);a+this.m_nHeight>d-5&&(a=d-5-this.m_nHeight);5>a&&(a=5);this.m_nTop=a;this.m_oContextMenuElement.style.left=b+"px";this.m_oContextMenuElement.style.top=
a+"px"};CDrawingButtonToolbarCustomize.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){this.m_oTransformCanvas&&this.m_oTransformCanvas.getContext("2d").drawImage(this.m_oImage,0,0)};
CDrawingButtonToolbarCustomize.prototype.private_HandleMouseDown=function(){if("none"===this.m_oContextMenuElement.style.display){if(null===this.m_nShowId){var a=this;this.m_nShowId=setTimeout(function(){null!==a.m_nTransitionId&&(clearTimeout(a.m_nTransitionId),a.m_nTransitionId=null);a.m_oContextMenuElement.style.display="block";a.m_oContextMenuElement.style.height="0px";a.m_nTransitionId=setTimeout(function(){a.m_oContextMenuElement.style.height=a.m_nHeight+"px";a.m_nTransitionId=null;a.m_nShowId=
null;a.m_oTransformCanvas.style.transition="transform 0.2s ease";a.m_oTransformCanvas.style.transform="rotate(180deg)";a.Set_Selected(!0)},20)},20)}}else this.Hide_ContextMenu()};CDrawingButtonToolbarCustomize.prototype.private_GetHint=function(){return""};CDrawingButtonToolbarCustomize.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_ToolbarCustomizeButton(this)};
CDrawingButtonToolbarCustomize.prototype.Hide_ContextMenu=function(a){if("none"!==this.m_oContextMenuElement.style.display)if(!0===a)this.m_oContextMenuElement.style.height="0px",this.m_oContextMenuElement.style.display="none",this.m_oTransformCanvas.style.transition="transform 0.2s ease",this.m_oTransformCanvas.style.transform="rotate(0deg)",this.Set_Selected(!1);else{null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null);this.m_oContextMenuElement.style.height=
"0px";var b=this;this.m_nTransitionId=setTimeout(function(){b.m_oContextMenuElement.style.display="none";b.m_nTransitionId=null;b.m_oTransformCanvas.style.transition="transform 0.2s ease";b.m_oTransformCanvas.style.transform="rotate(0deg)";b.Set_Selected(!1)},200)}};
CDrawingButtonToolbarCustomize.prototype.private_CreateListItem=function(a,b,c,d){var e=document.createElement("li");e.style.fontFamily='"Times New Roman", Times, serif';e.style.width=this.m_nWidth-10+"px";e.style.height="20px";e.style.color="#444444";e.style.margin="0px 5px 0px 5px";e.style.cursor="pointer";var f=document.createElement("div");f.style.paddingLeft="3px";f.style.width="20px";f.style.height="20px";f.style["float"]="left";Common.Set_InnerTextToElement(f,d?"\u2714":"");e.appendChild(f);
d=document.createElement("div");d.style.paddingLeft="5px";d.style.height="20px";d.style.width=this.m_nWidth-10-20-10+"px";d.style["float"]="left";d.style.overflow="hidden";Common.Set_InnerTextToElement(d,b);e.appendChild(d);e.onmouseover=function(){e.style.background="#d8dadc";e.style.color="#373737"};e.onmouseout=function(){e.style.background="transparent";e.style.color="#444444"};var g=this;e.onclick=function(){c&&c();g.Hide_ContextMenu(!0)};a.appendChild(e);return f};
CDrawingButtonToolbarCustomize.prototype.Set_MainNavigation=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_MainNavigation(a);this.private_UpdateCheckElement(this.m_oMainNavigationCheckElement,a)};CDrawingButtonToolbarCustomize.prototype.Set_TreeNavigation=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_TreeNavigation(a);this.private_UpdateCheckElement(this.m_oTreeNavigationCheckElement,a)};
CDrawingButtonToolbarCustomize.prototype.Set_General=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_General(a);this.private_UpdateCheckElement(this.m_oGeneralCheckElement,a)};CDrawingButtonToolbarCustomize.prototype.Set_AutoPlay=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_AutoPlay(a);this.private_UpdateCheckElement(this.m_oAutoPlayCheckElement,a)};
CDrawingButtonToolbarCustomize.prototype.Set_Timeline=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_Timeline(a);this.private_UpdateCheckElement(this.m_oTimelineCheckElement,a)};CDrawingButtonToolbarCustomize.prototype.Set_KifuMode=function(a){this.m_oMultiLevelToolbar&&this.m_oMultiLevelToolbar.Set_KifuMode(a);this.private_UpdateCheckElement(this.m_oKifuModeCheckElement,a)};
CDrawingButtonToolbarCustomize.prototype.private_UpdateCheckElement=function(a,b){a&&(!0===b?Common.Set_InnerTextToElement(a,"\u2714"):Common.Set_InnerTextToElement(a,""))};
function CDrawingButtonFileMenu(a){CDrawingButtonFileMenu.superclass.constructor.call(this,a);var b=a.Get_MainDiv();a=a.Get_GameTree();var c=document.createElement("div");c.style.position="absolute";c.style.top="40px";c.style.width="200px";c.style.backgroundColor="white";c.style.borderWidth="1px";c.style.borderColor="#b3b3b3";c.style.borderStyle="solid";c.style.padding="0px";c.style.boxShadow="0px 0px 2px 0px rgba(0,0,0,0.3)";c.style.opacity="1";c.style.zIndex="10";c.style.overflowX="hidden";c.style.overflowY=
"hidden";c.style.maxHeight="calc(100vh - 90px)";c.style.transitionProperty="height";c.style.transitionDuration="0.2s";c.style.transitionDelay="0s";this.m_oMainDiv=b;this.m_oMenuElement=c;this.m_nHeight=c.clientHeight;this.m_nWidth=c.clientWidth;this.m_nShowId=this.m_nTransitionId=null;this.m_oGameTree=a;b.appendChild(c);this.InitDefaultMenu(!1);c.style.display="none"}CommonExtend(CDrawingButtonFileMenu,CDrawingButtonBase);
CDrawingButtonFileMenu.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){f=2;e=c+3;g=c+b-3;k=d+9;var l=d+6+9;d=d+12+9;a.fillStyle=!0===this.m_oActiveBColor.Compare(h)?"rgb(167, 167, 167)":"rgb(217, 217, 217)";a.fillRect(0,0,b+2*c,b+2*c);a.lineWidth=f;a.strokeStyle="rgb(100, 100, 100)";a.beginPath();a.moveTo(e,k);a.lineTo(g,k);a.stroke();a.beginPath();a.moveTo(e,l);a.lineTo(g,l);a.stroke();a.beginPath();a.moveTo(e,d);a.lineTo(g,d);a.stroke()};
CDrawingButtonFileMenu.prototype.private_CreateMenuItem=function(a,b,c){var d=document.createElement("div");d.style.padding="0px";d.style.maring="0px";a.appendChild(d);var e=document.createElement("div");e.style.display="flex";e.style.alignItems="center";e.style.padding="0px";e.style.position="relative";e.style.cursor="pointer";e.style.transition="background-color 0.25s ease";e.style.backgroundColor="#fff";e.style.color="#424242";e.style.border="1px solid transparent";e.style.outline="none";d.appendChild(e);
a=document.createElement("div");a.style.padding="10px 20px";a.style.position="relative";a.style.cursor="pointer";a.style.borderBottom="1px solid #e6e7e8";a.style.transition="background-color 0.25s ease";a.style.outline="none";a.style.width="100%";e.appendChild(a);var f=document.createElement("span");f.style.color="#4d4d4d";f.style.fontFamily='"Segoe UI Light","Segoe UI Semilight","Segoe UI",Helvetica,Tahoma,Geneva,Verdana,sans-serif';f.style.fontWeight="lighter";f.style.fontSize="15px";f.style.userSelect=
"none";f.style.verticalAlign="middle";f.style.cursor="pointer";Common.Set_InnerTextToElement(f,b);a.appendChild(f);e.onmouseover=function(){e.style.backgroundColor="#e6e6e6";e.style.color="#424242"};e.onmouseout=function(){e.style.background="transparent";e.style.color="#424242";e.style.border="1px solid transparent"};e.onmousedown=function(){e.style.backgroundColor="#969696";e.style.border="1px solid #737373";e.style.color="#424242"};e.onmouseup=function(){e.style.backgroundColor="#e6e6e6";e.style.color=
"#424242";e.style.border="1px solid transparent"};var g=this;e.onclick=function(){c&&c();g.Hide_Menu(!0)};return d};CDrawingButtonFileMenu.prototype.private_HandleMouseDown=function(){this.Show_Menu()};CDrawingButtonFileMenu.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.menu.hint:"Menu"};
CDrawingButtonFileMenu.prototype.Show_Menu=function(){if("none"===this.m_oMenuElement.style.display){if(null===this.m_nShowId){var a=this;this.m_nShowId=setTimeout(function(){null!==a.m_nTransitionId&&(clearTimeout(a.m_nTransitionId),a.m_nTransitionId=null);a.m_oMenuElement.style.display="block";a.m_oMenuElement.style.height="0px";a.m_nTransitionId=setTimeout(function(){a.m_oMenuElement.style.height=a.m_nHeight+"px";a.m_nTransitionId=null;a.m_nShowId=null;a.Set_Selected(!0)},20)},20)}}else this.Hide_Menu()};
CDrawingButtonFileMenu.prototype.Hide_Menu=function(a){if("none"!==this.m_oMenuElement.style.display)if(!0===a)this.m_oMenuElement.style.height="0px",this.m_oMenuElement.style.display="none",this.Set_Selected(!1);else{null!==this.m_nTransitionId&&(clearTimeout(this.m_nTransitionId),this.m_nTransitionId=null);this.m_oMenuElement.style.height="0px";var b=this;this.m_nTransitionId=setTimeout(function(){b.m_oMenuElement.style.display="none";b.m_nTransitionId=null;b.Set_Selected(!1)},200)}};
CDrawingButtonFileMenu.prototype.Update_Size=function(){CDrawingButtonFileMenu.superclass.Update_Size.apply(this,arguments);var a=this.m_oDrawing.Get_ElementOffset(this.HtmlElement.Control.HtmlElement),b=a.X;a=a.Y+36+5;var c=this.m_oDrawing.Get_Width(),d=this.m_oDrawing.Get_Height();b+this.m_nWidth>c-5&&(b=c-5-this.m_nWidth);5>b&&(b=5);a+this.m_nHeight>d-5&&(a=d-5-this.m_nHeight);5>a&&(a=5);this.m_nTop=a;this.m_oMenuElement.style.left=b+"px";this.m_oMenuElement.style.top=a+"px"};
CDrawingButtonFileMenu.prototype.private_ClickTransformIn=function(){};CDrawingButtonFileMenu.prototype.private_ClickTransformOut=function(){};
CDrawingButtonFileMenu.prototype.InitDefaultMenu=function(a){var b=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.createNew:"Create New",c=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.loadFile:"Load from disk",d=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.loadFileFromClipboard:"Load from clipboard",e=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.downloadSGF:"Download as SGF",f=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.createSnapshot:
"Create snapshot",g=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.exportToGif:"Export to GIF",h=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.convertToASCIIDiagram:"Convert to ASCII diagram",k=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.scoreEstimator:"Score estimator",l=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.toggleCoordinates:"Toggle coordinates",m=window.g_oLocalization?window.g_oLocalization.gameRoom.menu.gameInfo:"Game info",n=window.g_oLocalization?
window.g_oLocalization.gameRoom.menu.cropBoard:"Crop the board",p=this.m_oMenuElement,q=this.m_oGameTree,t=this.m_oMainDiv;p.style.display="block";p.style.opacity=null;p.style.height=null;Common.ClearNode(p);var r=this;!0!==a&&(this.private_CreateMenuItem(p,b,function(){CreateWindow(t.id,EWindowType.CreateNew,{GameTree:q,Drawing:r.m_oDrawing})}),this.private_CreateMenuItem(p,c,function(){Common.OpenFileDialog(q)}),this.private_CreateMenuItem(p,d,function(){CreateWindow(t.id,EWindowType.Clipboard,
{GameTree:q,Drawing:r.m_oDrawing})}));this.private_CreateMenuItem(p,m,function(){CreateWindow(t.id,EWindowType.GameInfo,{GameTree:q,Drawing:r.m_oDrawing})});this.private_CreateMenuItem(p,e,function(){if(FileReader&&Blob){var a=q.Save_Sgf(),b=q.Get_MatchName();""===b&&(b="download");b+=".sgf";a=new Blob([a],{type:"text/plain;charset=utf-8"});Common.SaveAs(a,b,"application/x-go-sgf")}});this.private_CreateMenuItem(p,f,function(){q.Download_PngBoardScreenShot()});this.private_CreateMenuItem(p,g,function(){q.Download_GifForCurVariant()});
this.private_CreateMenuItem(p,h,function(){CreateWindow(t.id,EWindowType.DiagramSL,{GameTree:q,Drawing:r.m_oDrawing})});this.private_CreateMenuItem(p,k,function(){CreateWindow(t.id,EWindowType.ScoreEstimate,{GameTree:q,Drawing:r.m_oDrawing})});this.private_CreateMenuItem(p,l,function(){q.Toggle_Rulers()});this.private_CreateMenuItem(p,n,function(){CreateWindow(t.id,EWindowType.ViewPort,{GameTree:q,Drawing:r.m_oDrawing})});this.m_nHeight=p.clientHeight;p.style.display="none"};
function CDrawingButtonKifuWindow(a){CDrawingButtonKifuWindow.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonKifuWindow,CDrawingButtonBase);
CDrawingButtonKifuWindow.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){e=Math.ceil(c+.5*b-b/10+.5);f=Math.ceil(d+.5*b-b/10+.5);g=Math.ceil(.35*b+.5);a.fillStyle=(new CColor(255,255,255)).ToString();a.strokeStyle=(new CColor(0,0,0)).ToString();a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill();a.stroke();h="\u767d";k=.4*b*1.4;a.font=k+"px Times New Roman, Sans serif";a.fillStyle="rgb(0, 0, 0)";f+=k/3;e+=-a.measureText(h).width/2;a.fillText(h,e,f);a.fillStyle=(new CColor(0,0,0)).ToString();
e=Math.ceil(c+.5*b+b/10+.5);f=Math.ceil(d+.5*b+b/10+.5);a.beginPath();a.arc(e,f,g,0,2*Math.PI,!1);a.fill();h="\u9ed2";a.fillStyle="rgb(255, 255, 255)";f+=k/3;e+=-a.measureText(h).width/2;a.fillText(h,e,f)};CDrawingButtonKifuWindow.prototype.private_HandleMouseDown=function(){CreateWindow(this.HtmlElement.Control.HtmlElement.id,EWindowType.Kifu,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing})};
CDrawingButtonKifuWindow.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.showKifu:"Show kifu"};function CDrawingButtonKifuMode(a){CDrawingButtonKifuWindow.superclass.constructor.call(this,a)}CommonExtend(CDrawingButtonKifuMode,CDrawingButtonBase);
CDrawingButtonKifuMode.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){d=c=0;b=36;f=c+10|.5;e=c+25|.5;g=d+10|.5;h=d+25|.5;a.lineWidth=2;a.strokeStyle="rgb(0, 0, 0)";a.beginPath();a.moveTo(c+1,g);a.lineTo(b/2+1,g);a.moveTo(c+1,h);a.lineTo(b+c-1,h);a.moveTo(f,d+1);a.lineTo(f,b+d-1);a.moveTo(e,b/2);a.lineTo(e,b+d-1);a.stroke();a.fillStyle="rgb(255, 255, 255)";a.beginPath();a.arc(f,g,5.5,0,2*Math.PI,!1);a.stroke();a.fill();a.beginPath();a.arc(e,h,5.5,0,2*Math.PI,!1);a.stroke();a.fill();a.fillStyle=
"rgb(0, 0, 0)";a.beginPath();a.arc(f,h,5.5,0,2*Math.PI,!1);a.stroke();a.fill();a.font="22px Times New Roman, Sans serif";b=g+22/3;c=e-a.measureText("?").width/2;a.fillText("?",c,b)};CDrawingButtonKifuMode.prototype.private_HandleMouseDown=function(){!0===this.m_oGameTree.Is_KifuMode()?this.m_oGameTree.Stop_KifuMode():this.m_oGameTree.Start_KifuMode()};
CDrawingButtonKifuMode.prototype.private_GetHint=function(){return window.g_oLocalization?window.g_oLocalization.gameRoom.button.hint.toggleKifuMode:"Toggle kifu mode"};CDrawingButtonKifuMode.prototype.private_RegisterButton=function(){this.m_oDrawing.Register_KifuModeButton(this)};
function CDrawingButtonSimpleText(a,b,c){CDrawingButtonSimpleText.superclass.constructor.call(this,null);this.m_oNormaBColor=new CColor(234,234,234,255);this.m_oNormaFColor=new CColor(172,172,172,255);this.m_oHoverBColor=new CColor(227,240,252,255);this.m_oHoverFColor=new CColor(126,180,234,255);this.m_oActiveBColor=new CColor(207,230,252,255);this.m_oActiveFColor=new CColor(86,157,229,255);this.m_oDisabledBColor=new CColor(239,239,239,255);this.m_oDisabledFColor=new CColor(217,217,217,255);this.m_sText=
a?a:"";this.m_sHint=c?c:"";this.m_fHandler=b?b:null}CommonExtend(CDrawingButtonSimpleText,CDrawingButtonBase);CDrawingButtonSimpleText.prototype.private_DrawOnCanvas=function(a,b,c,d,e,f,g,h,k){a.lineWidth=1;a.moveTo(0,0);a.lineTo(0,g);a.lineTo(f,g);a.lineTo(f,0);a.lineTo(0,0);a.stroke();e=this.m_sText;a.fillStyle=(new CColor(0,0,0,255)).ToString();a.font="16px 'Segoe UI', Helvetica, Tahoma, Geneva, Verdana, sans-serif";d=d+b/2+16/3;b=c+(b-a.measureText(e).width)/2;a.fillText(e,b,d)};
CDrawingButtonSimpleText.prototype.private_HandleMouseDown=function(){if(this.m_fHandler)return this.m_fHandler()};CDrawingButtonSimpleText.prototype.private_GetHint=function(){return this.m_sHint};CDrawingButtonSimpleText.prototype.private_ClickTransformIn=function(){};CDrawingButtonSimpleText.prototype.private_ClickTransformOut=function(){};CDrawingButtonSimpleText.prototype.private_DrawSelectionBounds=function(a,b,c){};function CDrawingComments(a){this.m_oDrawing=a;this.m_oGameTree=null;this.HtmlElement={Control:null,TextArea:{Control:null}};var b=this;this.private_OnValueChange=function(){b.private_OnChangeComment()}}
CDrawingComments.prototype.Init=function(a,b){this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement;c.style.background=(new CColor(217,217,217,255)).ToString();c.style.boxSizing="content-box";var d=a+"_TextArea",e=document.createElement("textarea");e.setAttribute("id",d);e.setAttribute("style","position:absolute;padding:0;margin:0;resize:none;outline: none;-moz-appearance: none;padding:2px;");c.appendChild(e);e.onchange=this.private_OnValueChange;
e.onblur=this.private_OnValueChange;e.style.outline="none";e.style.margin="0px";e.style.border="1px solid rgb(172,172,172)";e.style.overflowY="auto";c=this.HtmlElement.Control;this.HtmlElement.TextArea.Control=CreateControlContainer(d);d=this.HtmlElement.TextArea.Control;d.Bounds.SetParams(6,0,12,6,!0,!0,!0,!0,-1,-1);d.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;c.AddControl(d);this.m_oDrawing&&this.m_oDrawing.Register_Comments(this);this.Update_Size()};
CDrawingComments.prototype.Update_Comments=function(a){this.HtmlElement.TextArea.Control.HtmlElement.value=a};CDrawingComments.prototype.Update_Size=function(){this.HtmlElement.Control.Resize(this.HtmlElement.Control.HtmlElement.clientWidth,this.HtmlElement.Control.HtmlElement.clientHeight)};CDrawingComments.prototype.private_OnChangeComment=function(){this.m_oGameTree.Set_Comment(this.HtmlElement.TextArea.Control.HtmlElement.value)};
function CDrawingPlayerInfo(a){this.m_oDrawing=a;this.m_nPlayer=BOARD_EMPTY;this.m_oGameTree=null;this.HtmlElement={Control:null,NameDiv:null,ScoresDiv:null,Image:null};this.m_oImage=null;this.m_sRank=this.m_sName="";this.m_dScores=0;this.m_bScores=!1}
CDrawingPlayerInfo.prototype.Init=function(a,b,c){this.m_nPlayer=c;this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);b=this.HtmlElement.Control.HtmlElement;b.style.backgroundColor=(new CColor(217,217,217,255)).ToString();this.HtmlElement.NameDiv=document.createElement("div");this.HtmlElement.ScoresDiv=document.createElement("div");this.HtmlElement.Image=document.createElement("canvas");var d=this.HtmlElement.Image,e=this.HtmlElement.NameDiv,f=this.HtmlElement.ScoresDiv;b.appendChild(d);
b.appendChild(e);b.appendChild(f);e.style.paddingLeft="25px";f.style.paddingLeft="25px";e.style.fontSize="14pt";f.style.fontSize="10pt";d.setAttribute("id",a+"_Image");d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.left="0px";d.style.top="0px";d.style.width="25px";d.style.height="25px";d.width=25;d.height=25;a=d.getContext("2d");a.clearRect(0,0,25,25);b=Math.ceil(13);d=Math.ceil(13);e=Math.ceil(6.75);BOARD_WHITE===c?(a.fillStyle=
(new CColor(255,255,255)).ToString(),a.strokeStyle=(new CColor(0,0,0)).ToString()):BOARD_BLACK===c&&(a.fillStyle=(new CColor(0,0,0)).ToString(),a.strokeStyle=(new CColor(0,0,0)).ToString());a.beginPath();a.arc(b,d,e,0,2*Math.PI,!1);a.fill();a.stroke();this.m_oDrawing&&(BOARD_BLACK===c?this.m_oDrawing.Register_BlackInfo(this):BOARD_WHITE===c&&this.m_oDrawing.Register_WhiteInfo(this));this.private_Update()};
CDrawingPlayerInfo.prototype.Update_Size=function(){this.private_Update();var a=this.m_dTextWidth,b=this.HtmlElement.Control.HtmlElement.clientWidth-25;a=b<a?0:(b-a)/2;this.HtmlElement.Image.style.left=a+"px";a+=25;this.HtmlElement.NameDiv.style.paddingLeft=a+"px";this.HtmlElement.ScoresDiv.style.paddingLeft=a+"px";this.HtmlElement.NameDiv.style.overflow="hidden";this.HtmlElement.NameDiv.style.textOverflow="ellipsis";this.HtmlElement.NameDiv.style["-o-text-overflow"]="ellipsis";this.HtmlElement.NameDiv.style.height=
"25px";this.HtmlElement.NameDiv.style.lineHeight="25px";this.HtmlElement.NameDiv.style.fontFamily='"Times New Roman", Times, serif';this.HtmlElement.ScoresDiv.style.overflow="hidden";this.HtmlElement.ScoresDiv.style.textOverflow="ellipsis";this.HtmlElement.ScoresDiv.style["-o-text-overflow"]="ellipsis";this.HtmlElement.ScoresDiv.style.height="25px";this.HtmlElement.ScoresDiv.style.lineHeight="25px";this.HtmlElement.ScoresDiv.style.fontFamily='"Times New Roman", Times, serif'};
CDrawingPlayerInfo.prototype.Update_Name=function(a){this.m_sName=a;this.private_Update()};CDrawingPlayerInfo.prototype.Update_Rank=function(a){this.m_sRank=a;this.private_Update()};CDrawingPlayerInfo.prototype.Update_Captured=function(a){this.m_bScores=!1;this.m_dScores=a;this.private_Update()};CDrawingPlayerInfo.prototype.Update_Scores=function(a){this.m_bScores=!0;this.m_dScores=a;this.private_Update()};
CDrawingPlayerInfo.prototype.private_Update=function(){var a=this.HtmlElement.ScoresDiv,b=(""===this.m_sName?BOARD_BLACK===this.m_nPlayer?"Black ":"White ":this.m_sName)+(""===this.m_sRank?"":"["+this.m_sRank+"]"),c=(!0===this.m_bScores?"Scores ":"Captured ")+this.m_dScores;Common.Set_InnerTextToElement(this.HtmlElement.NameDiv,b);Common.Set_InnerTextToElement(a,c);a=document.createElement("canvas").getContext("2d");a.font="14pt Times New Roman";this.m_dTextWidth=a.measureText(b).width};
function CDrawingViewerScores(a){this.m_oDrawing=a;this.m_oGameTree=null;this.HtmlElement={Control:null,ScoresWDiv:null,ScoresBDiv:null,ImageW:null,ImageB:null};this.m_dScoresB=this.m_dScoresW=0}
CDrawingViewerScores.prototype.Init=function(a,b){this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement;c.style.backgroundColor=(new CColor(217,217,217,255)).ToString();this.HtmlElement.ScoresWDiv=document.createElement("div");this.HtmlElement.ImageW=document.createElement("canvas");this.HtmlElement.ScoresBDiv=document.createElement("div");this.HtmlElement.ImageB=document.createElement("canvas");c.appendChild(this.HtmlElement.ScoresWDiv);
c.appendChild(this.HtmlElement.ImageW);c.appendChild(this.HtmlElement.ScoresBDiv);c.appendChild(this.HtmlElement.ImageB);this.HtmlElement.ImageW.style.position="absolute";this.HtmlElement.ImageW.style.left="0px";this.HtmlElement.ImageW.style.top="0px";this.HtmlElement.ScoresWDiv.style.position="absolute";this.HtmlElement.ScoresWDiv.style.left="25px";this.HtmlElement.ScoresWDiv.style.top="0px";this.HtmlElement.ScoresWDiv.style.overflow="hidden";this.HtmlElement.ScoresWDiv.style.textOverflow="ellipsis";
this.HtmlElement.ScoresWDiv.style.height="25px";this.HtmlElement.ScoresWDiv.style.fontFamily='"Times New Roman", Times, serif';this.HtmlElement.ScoresWDiv.style.fontSize="16px";this.HtmlElement.ScoresWDiv.style.lineHeight="25px";this.HtmlElement.ImageB.style.position="absolute";this.HtmlElement.ImageB.style.left="61px";this.HtmlElement.ImageB.style.top="0px";this.HtmlElement.ScoresBDiv.style.position="absolute";this.HtmlElement.ScoresBDiv.style.left="86px";this.HtmlElement.ScoresWDiv.style.top="0px";
this.HtmlElement.ScoresBDiv.style.overflow="hidden";this.HtmlElement.ScoresBDiv.style.textOverflow="ellipsis";this.HtmlElement.ScoresBDiv.style.height="25px";this.HtmlElement.ScoresBDiv.style.fontFamily='"Times New Roman", Times, serif';this.HtmlElement.ScoresBDiv.style.fontSize="16px";this.HtmlElement.ScoresBDiv.style.lineHeight="25px";this.private_DrawColor(this.HtmlElement.ImageW,!1);this.private_DrawColor(this.HtmlElement.ImageB,!0);this.private_Update()};
CDrawingViewerScores.prototype.private_DrawColor=function(a,b){a.setAttribute("oncontextmenu","return false;");a.style.padding="0px";a.style.margin="0px";a.style.width="25px";a.style.height="25px";a.width=25;a.height=25;var c=a.getContext("2d");c.clearRect(0,0,25,25);var d=Math.ceil(13),e=Math.ceil(13),f=Math.ceil(6.75);c.fillStyle=b?(new CColor(0,0,0)).ToString():(new CColor(255,255,255)).ToString();c.strokeStyle=(new CColor(0,0,0)).ToString();c.beginPath();c.arc(d,e,f,0,2*Math.PI,!1);c.fill();c.stroke()};
CDrawingViewerScores.prototype.Update_Size=function(){this.private_Update()};CDrawingViewerScores.prototype.Update_Scores=function(a,b){this.m_dScoresW=a;this.m_dScoresB=b;this.private_Update()};CDrawingViewerScores.prototype.private_Update=function(){Common.Set_InnerTextToElement(this.HtmlElement.ScoresWDiv,""+this.m_dScoresW);Common.Set_InnerTextToElement(this.HtmlElement.ScoresBDiv,""+this.m_dScoresB)};
function CDrawingViewerTitle(a){this.m_oDrawing=a;this.m_oGameTree=null;this.HtmlElement={Control:null,TitleDiv:null};this.m_sTitle="White vs. Black"}
CDrawingViewerTitle.prototype.Init=function(a,b){this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement;c.style.backgroundColor=(new CColor(217,217,217,255)).ToString();this.HtmlElement.TitleDiv=document.createElement("div");c.appendChild(this.HtmlElement.TitleDiv);this.HtmlElement.TitleDiv.style.position="absolute";this.HtmlElement.TitleDiv.style.left="0px";this.HtmlElement.TitleDiv.style.top="0px";this.HtmlElement.TitleDiv.style.overflow=
"hidden";this.HtmlElement.TitleDiv.style.textOverflow="ellipsis";this.HtmlElement.TitleDiv.style.fontFamily='"Times New Roman", Times, serif';this.HtmlElement.TitleDiv.style.fontSize="16px";this.HtmlElement.TitleDiv.style.height="25px";this.HtmlElement.TitleDiv.style.lineHeight="25px";this.HtmlElement.TitleDiv.style.width="100%";this.HtmlElement.TitleDiv.style.textAlign="center";this.private_Update()};CDrawingViewerTitle.prototype.Set_Title=function(a){this.m_sTitle=a;this.private_Update()};
CDrawingViewerTitle.prototype.Update_Size=function(){this.private_Update()};CDrawingViewerTitle.prototype.private_Update=function(){Common.Set_InnerTextToElement(this.HtmlElement.TitleDiv,""+this.m_sTitle)};function CControlBounds(){this.B=this.R=this.T=this.L=0;this.isAbsB=this.isAbsR=this.isAbsT=this.isAbsL=!1;this.AbsH=this.AbsW=-1}CControlBounds.prototype.SetParams=function(a,b,c,d,e,f,g,h,k,l){this.L=a;this.T=b;this.R=c;this.B=d;this.isAbsL=e;this.isAbsT=f;this.isAbsR=g;this.isAbsB=h;this.AbsW=k;this.AbsH=l};var g_anchor_left=1,g_anchor_top=2,g_anchor_right=4,g_anchor_bottom=8;
function CControlContainer(){this.Bounds=new CControlBounds;this.Anchor=g_anchor_left|g_anchor_top;this.HtmlElement=this.TabIndex=this.Parent=this.Name=null;this.AbsolutePosition=new CControlBounds;this.Controls=[];this.Type=this.height=this.width=0;this.DrawingElement=null;this.RMin=400}CControlContainer.prototype.Set_Type=function(a,b,c){this.Type=a;(this.DrawingElement=b)&&b.Add_LinkedControl&&b.Add_LinkedControl(this);c&&void 0!==c.RMin&&(this.RMin=c.RMin)};
CControlContainer.prototype.AddControl=function(a){a.Parent=this;this.Controls[this.Controls.length]=a};
CControlContainer.prototype.Resize=function(a,b){this.width=a;this.height=b;if(null==this.Parent)this.AbsolutePosition.L=0,this.AbsolutePosition.T=0,this.AbsolutePosition.R=a,this.AbsolutePosition.B=b,null!==this.HtmlElement&&this.private_ResizeControls(a,b);else{var c=this.Anchor&5;var d=this.Anchor&10;if(g_anchor_left==c){c=this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*a/1E3;var e=-1!=this.Bounds.AbsW?c+this.Bounds.AbsW:this.Bounds.isAbsR?a-this.Bounds.R:this.Bounds.R*a/1E3}else g_anchor_right==
c?(e=this.Bounds.isAbsR?a-this.Bounds.R:this.Bounds.R*a/1E3,c=-1!=this.Bounds.AbsW?e-this.Bounds.AbsW:this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*a/1E3):(g_anchor_left|g_anchor_right)==c?(c=this.Bounds.isAbsL?this.Bounds.L:this.Bounds.L*a/1E3,e=this.Bounds.isAbsR?a-this.Bounds.R:this.Bounds.R*a/1E3):(c=this.Bounds.L,e=this.Bounds.R);if(g_anchor_top==d){d=this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*b/1E3;var f=-1!=this.Bounds.AbsH?d+this.Bounds.AbsH:this.Bounds.isAbsB?b-this.Bounds.B:this.Bounds.B*
b/1E3}else g_anchor_bottom==d?(f=this.Bounds.isAbsB?b-this.Bounds.B:this.Bounds.B*b/1E3,d=-1!=this.Bounds.AbsH?f-this.Bounds.AbsH:this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*b/1E3):(g_anchor_top|g_anchor_bottom)==d?(d=this.Bounds.isAbsT?this.Bounds.T:this.Bounds.T*b/1E3,f=this.Bounds.isAbsB?b-this.Bounds.B:this.Bounds.B*b/1E3):(d=this.Bounds.T,f=this.Bounds.B);e<c&&(e=c);f<d&&(f=d);-2===this.Bounds.AbsW?e=c+1*(f-d):-3===this.Bounds.AbsW&&(c=1*(f-d));this.AbsolutePosition.L=c;this.AbsolutePosition.T=
d;this.AbsolutePosition.R=e;this.AbsolutePosition.B=f;this.HtmlElement.style.left=(c+.5|0)+"px";this.HtmlElement.style.top=(d+.5|0)+"px";this.HtmlElement.style.width=(e-c+.5|0)+"px";this.HtmlElement.style.height=(f-d+.5|0)+"px";this.HtmlElement.width=e-c+.5|0;this.HtmlElement.height=f-d+.5|0;this.private_ResizeControls(e-c,f-d)}};
CControlContainer.prototype.private_ResizeControls=function(a,b){var c=this.Controls.length;if(1===this.Type&&2===c){var d=this.DrawingElement?this.DrawingElement.Get_AspectRatio():1,e=this.Controls[0],f=this.Controls[1],g=b;var h=a-this.RMin;var k=g*d;d=h/d;k<=h?(d=g,h=g=0):(k=h,h=0,g=(g-d)/2);e.Bounds.SetParams(h,g,1E3,1E3,!0,!0,!1,!1,k,d);e.Anchor=g_anchor_left|g_anchor_top;f.Bounds.SetParams(k,0,1E3,1E3,!0,!1,!1,!1,-1,-1);f.Anchor=g_anchor_right|g_anchor_bottom|g_anchor_top}else 2===this.Type&&
1===c?this.DrawingElement?(d=this.DrawingElement.Get_AspectRatio(),e=this.Controls[0],k=b*d,d=a/d,k<=a?(d=b,g=0,h=(a-k)/2):(k=a,h=0,g=(b-d)/2),e.Bounds.SetParams(h,g,1E3,1E3,!0,!0,!1,!1,k,d),e.Anchor=g_anchor_left|g_anchor_top):(e=this.Controls[0],h=Math.min(a,b),e.Bounds.SetParams((a-h)/2,(b-h)/2,1E3,1E3,!0,!0,!0,!1,h,h),e.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_top):3===this.Type&&2===c&&(d=this.DrawingElement?this.DrawingElement.Get_AspectRatio():1,e=this.Controls[0],f=this.Controls[1],g=
this.RMin,h=a,g=b-g,k=g*d,d=h/d,k<=h?(d=g,g=0,h=(h-k)/2):(k=h,g=h=0),e.Bounds.SetParams(h,g,1E3,1E3,!0,!0,!1,!1,k,d),e.Anchor=g_anchor_left|g_anchor_top,f.Bounds.SetParams(0,d,1E3,1E3,!1,!0,!1,!1,-1,-1),f.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom);for(h=0;h<c;h++)this.Controls[h].Resize(a,b)};CControlContainer.prototype.Clear=function(){this.Controls=[];this.Type=0;this.DrawingElement=null;this.RMin=400};
CControlContainer.prototype.SetParams=function(a,b,c,d,e,f,g,h,k,l){this.Bounds.SetParams(a,b,c,d,e,f,g,h,k,l)};CControlContainer.prototype.SetAnchor=function(a,b,c,d){this.Anchor=0;a&&(this.Anchor|=g_anchor_left);b&&(this.Anchor|=g_anchor_top);c&&(this.Anchor|=g_anchor_right);d&&(this.Anchor|=g_anchor_bottom)};function CreateControlContainer(a){var b=new CControlContainer;b.Name=a;b.HtmlElement=document.getElementById(a);return b}
function CreateControlContainerByElement(a){var b=new CControlContainer;b.HtmlElement=a;return b}function CControlContainerBoardAndBottomButtons(){this.HtmlElement=this.Parent=null;this.H=0;this.Controls=[]}CControlContainerBoardAndBottomButtons.prototype.Set=function(a){this.H=a};CControlContainerBoardAndBottomButtons.prototype.AddControl=function(a){a.Parent=this;this.Controls[this.Controls.length]=a};
CControlContainerBoardAndBottomButtons.prototype.Resize=function(a,b){var c=b-this.H,d=a;d!==c&&(c=d=Math.min(d,c));var e=(b-this.H-c)/2;this.HtmlElement.style.left=parseInt((a-d)/2+.5)+"px";this.HtmlElement.style.top=parseInt(e+.5)+"px";this.HtmlElement.style.width=parseInt(d+.5)+"px";this.HtmlElement.style.height=parseInt(c+this.H+.5)+"px";this.HtmlElement.width=parseInt(d+.5);this.HtmlElement.height=parseInt(c+this.H+.5);e=this.Controls.length;for(var f=0;f<e;f++)this.Controls[f].Resize(d,c+this.H)};
CControlContainerBoardAndBottomButtons.Create=function(a){var b=new CControlContainerBoardAndBottomButtons;b.Name=a;b.HtmlElement=document.getElementById(a);return b};var EColorScheme={Custom:0,TrueColor:1,BookStyle:2,SimpleColor:3,Dark:4},ESettingsNavigatorLabels={Empty:0,MoveNumbers:1,MoveNumbersCurrentVariant:2,MoveCoordinates:3},ESettingsLoadShowVariants={None:0,Curr:1,Next:2,FromFile:3},EDrawingTemplate={None:0,SimpleBoard:1,Viewer:2,VerEditor:3,HorEditor:4,Problems:5,GoUniverseViewerHor:21,GoUniverseViewerVer:22,GoUniverseMatch:23};
function CSettingsBase(){this.m_oBoardPr={bTrueColorBoard:!0,bTrueColorStones:!0,oBoardColor:new CColor(231,188,95,255),bShellWhiteStones:!0,bShadows:!0,oWhiteColor:new CColor(255,255,255,255),oBlackColor:new CColor(0,0,0,255),oLinesColor:new CColor(0,0,0,255),bDarkBoard:!1};this.m_oNavigatorPr={bTrueColorBoard:!0,bTrueColorStones:!0,oBoardColor:new CColor(231,188,95,255),bShadows:!0,oWhiteColor:new CColor(255,255,255,255),oBlackColor:new CColor(0,0,0,255),oLinesColor:new CColor(0,0,0,255),bDarkBoard:!1}}
CSettingsBase.prototype.private_SetColorScheme=function(a){var b,c,d=new CColor(255,255,255,255),e=new CColor(0,0,0,255);new CColor(0,0,0,255);var f=!1;switch(a){default:case EColorScheme.TrueColor:var g=c=b=a=!0;var h=new CColor(231,188,95,255);var k=new CColor(0,0,0,255);break;case EColorScheme.BookStyle:g=c=b=a=!1;h=new CColor(255,255,255,255);k=new CColor(0,0,0,255);break;case EColorScheme.SimpleColor:g=c=b=a=!1;h=new CColor(231,188,95,255);k=new CColor(0,0,0,255);break;case EColorScheme.Dark:g=
c=b=a=!1,f=!0,h=new CColor(30,30,30,255),d=new CColor(220,220,220,220),k=new CColor(255,255,255,255)}var l=!1,m=!1;if(this.m_oBoardPr.bTrueColorBoard!==a||this.m_oBoardPr.bTrueColorStones!==b||!0!==this.m_oBoardPr.oBoardColor.Compare(h)||this.m_oBoardPr.bShellWhiteStones!==c||this.m_oBoardPr.bShadows!==g||!0!==this.m_oBoardPr.oWhiteColor.Compare(d)||!0!==this.m_oBoardPr.oBlackColor.Compare(e)||!0!==this.m_oBoardPr.oLinesColor.Compare(k)||this.m_oBoardPr.bDarkBoard!==f)this.m_oBoardPr.bTrueColorBoard=
a,this.m_oBoardPr.bTrueColorStones=b,this.m_oBoardPr.oBoardColor=h,this.m_oBoardPr.bShellWhiteStones=c,this.m_oBoardPr.bShadows=g,this.m_oBoardPr.oWhiteColor=d,this.m_oBoardPr.oBlackColor=e,this.m_oBoardPr.oLinesColor=k,this.m_oBoardPr.bDarkBoard=f,l=!0;if(this.m_oNavigatorPr.bTrueColorBoard!==a||this.m_oNavigatorPr.bTrueColorStones!==b||!0!==this.m_oNavigatorPr.oBoardColor.Compare(h)||this.m_oNavigatorPr.bShadows!==g||!0!==this.m_oNavigatorPr.oWhiteColor.Compare(d)||!0!==this.m_oNavigatorPr.oBlackColor.Compare(e)||
!0!==this.m_oNavigatorPr.oLinesColor.Compare(k)||this.m_oNavigatorPr.bDarkBoard!==f)this.m_oNavigatorPr.bTrueColorBoard=a,this.m_oNavigatorPr.bTrueColorStones=b,this.m_oNavigatorPr.oBoardColor=h,this.m_oNavigatorPr.bShadows=g,this.m_oNavigatorPr.oWhiteColor=d,this.m_oNavigatorPr.oBlackColor=e,this.m_oNavigatorPr.oLinesColor=k,this.m_oNavigatorPr.bDarkBoard=f,m=!0;return{Board:l,Navigator:m}};
function CSettings(){CSettings.superclass.constructor.call(this);this.m_bSound=!0;this.m_bCycleThroughVariants=this.m_bRulers=this.m_bLoadUnfinishedFilesOnLastNode=!1;this.m_eNavigatorLabels=ESettingsNavigatorLabels.MoveNumbers;this.m_eLoadShowVariants=ESettingsLoadShowVariants.FromFile;this.m_bMultiLevelToolbarKifuMode=this.m_bMultiLevelToolbarTimeline=this.m_bMultiLevelToolbarAutoPlay=this.m_bMultiLevelToolbarGeneral=this.m_bMultiLevelToolbarTreeNavigation=this.m_bMultiLevelToolbarMainNavigation=
this.m_bShowTarget=!0}CommonExtend(CSettings,CSettingsBase);
CSettings.prototype.Load_FromLocalStorage=function(){this.m_bShowTarget="0"===Common.Get_LocalStorageItem("ShowTarget")?!1:!0;this.m_bCycleThroughVariants="1"===Common.Get_LocalStorageItem("CycleThroughVariants")?!0:!1;this.m_bSound="0"===Common.Get_LocalStorageItem("Sound")?!1:!0;var a=Common.Get_LocalStorageItem("NavigatorLabels");this.m_eNavigatorLabels=a&&""!==a?parseInt(a):ESettingsNavigatorLabels.MoveNumbers;a=EColorScheme.TrueColor;var b=Common.Get_LocalStorageItem("ColorScheme");"BookStyle"===
b?a=EColorScheme.BookStyle:"SimpleColor"===b?a=EColorScheme.SimpleColor:"Dark"===b&&(a=EColorScheme.Dark);this.Set_ColorScheme(a);this.m_bLoadUnfinishedFilesOnLastNode="1"===Common.Get_LocalStorageItem("LoadUnfinishedFilesOnLastNode")?!0:!1;this.m_eLoadShowVariants=(a=Common.Get_LocalStorageItem("ShowVariants"))&&""!==a?parseInt(a):ESettingsLoadShowVariants.FromFile;this.m_bRulers="1"===Common.Get_LocalStorageItem("Rulers")?!0:!1;this.m_bMultiLevelToolbarMainNavigation="0"==Common.Get_LocalStorageItem("MultiLevelToolbarMainNavigation")?
!1:!0;this.m_bMultiLevelToolbarTreeNavigation="0"==Common.Get_LocalStorageItem("MultiLevelToolbarTreeNavigation")?!1:!0;this.m_bMultiLevelToolbarGeneral="0"==Common.Get_LocalStorageItem("MultiLevelToolbarGeneral")?!1:!0;this.m_bMultiLevelToolbarAutoPlay="1"==Common.Get_LocalStorageItem("MultiLevelToolbarAutoPlay")?!0:!1;this.m_bMultiLevelToolbarTimeline="1"==Common.Get_LocalStorageItem("MultiLevelToolbarTimeline")?!0:!1;this.m_bMultiLevelToolbarKifuMode="1"==Common.Get_LocalStorageItem("MultiLevelToolbarKifuMode")?
!0:!1};CSettings.prototype.Set_Sound=function(a){this.m_bSound=a;Common.Set_LocalStorageItem("Sound",!0===a?"1":"0")};CSettings.prototype.Is_SoundOn=function(){return this.m_bSound};CSettings.prototype.Set_Rulers=function(a){this.m_bRulers=a;Common.Set_LocalStorageItem("Rulers",!0===a?"1":"0")};CSettings.prototype.Is_Rulers=function(){return this.m_bRulers};
CSettings.prototype.Set_LoadUnfinishedFilesOnLastNode=function(a){this.m_bLoadUnfinishedFilesOnLastNode=a;Common.Set_LocalStorageItem("LoadUnfinishedFilesOnLastNode",!0===a?"1":"0")};CSettings.prototype.Is_LoadUnfinishedFilesOnLastNode=function(){return this.m_bLoadUnfinishedFilesOnLastNode};CSettings.prototype.Set_CycleThroughVariants=function(a){this.m_bCycleThroughVariants=a;Common.Set_LocalStorageItem("CycleThroughVariants",!0===a?"1":"0")};CSettings.prototype.Is_CycleThroughVariants=function(){return this.m_bCycleThroughVariants};
CSettings.prototype.Set_ShowTarget=function(a){this.m_bShowTarget=a;Common.Set_LocalStorageItem("ShowTarget",!0===a?"1":"0")};CSettings.prototype.Is_ShowTarget=function(){return this.m_bShowTarget};
CSettings.prototype.Set_ColorScheme=function(a){switch(a){case EColorScheme.TrueColor:Common.Set_LocalStorageItem("ColorScheme","TrueColor");break;case EColorScheme.BookStyle:Common.Set_LocalStorageItem("ColorScheme","BookStyle");break;case EColorScheme.SimpleColor:Common.Set_LocalStorageItem("ColorScheme","SimpleColor");break;case EColorScheme.Dark:Common.Set_LocalStorageItem("ColorScheme","Dark")}return this.private_SetColorScheme(a)};CSettings.prototype.Get_NavigatorLabel=function(){return this.m_eNavigatorLabels};
CSettings.prototype.Set_NavigatorLabel=function(a){this.m_eNavigatorLabels=a;Common.Set_LocalStorageItem("NavigatorLabels",a)};CSettings.prototype.Get_LoadShowVariants=function(){return this.m_eLoadShowVariants};CSettings.prototype.Set_LoadShowVariants=function(a){this.m_eLoadShowVariants=a;Common.Set_LocalStorageItem("ShowVariants",a)};
CSettings.prototype.Toggle_MultiLevelToolbarMainNavigation=function(){this.m_bMultiLevelToolbarMainNavigation=!this.m_bMultiLevelToolbarMainNavigation;Common.Set_LocalStorageItem("MultiLevelToolbarMainNavigation",!0===this.m_bMultiLevelToolbarMainNavigation?"1":"0");return this.m_bMultiLevelToolbarMainNavigation};
CSettings.prototype.Toggle_MultiLevelToolbarTreeNavigation=function(){this.m_bMultiLevelToolbarTreeNavigation=!this.m_bMultiLevelToolbarTreeNavigation;Common.Set_LocalStorageItem("MultiLevelToolbarTreeNavigation",!0===this.m_bMultiLevelToolbarTreeNavigation?"1":"0");return this.m_bMultiLevelToolbarTreeNavigation};
CSettings.prototype.Toggle_MultiLevelToolbarGeneral=function(){this.m_bMultiLevelToolbarGeneral=!this.m_bMultiLevelToolbarGeneral;Common.Set_LocalStorageItem("MultiLevelToolbarGeneral",!0===this.m_bMultiLevelToolbarGeneral?"1":"0");return this.m_bMultiLevelToolbarGeneral};
CSettings.prototype.Toggle_MultiLevelToolbarAutoPlay=function(){this.m_bMultiLevelToolbarAutoPlay=!this.m_bMultiLevelToolbarAutoPlay;Common.Set_LocalStorageItem("MultiLevelToolbarAutoPlay",!0===this.m_bMultiLevelToolbarAutoPlay?"1":"0");return this.m_bMultiLevelToolbarAutoPlay};
CSettings.prototype.Toggle_MultiLevelToolbarTimeline=function(){this.m_bMultiLevelToolbarTimeline=!this.m_bMultiLevelToolbarTimeline;Common.Set_LocalStorageItem("MultiLevelToolbarTimeline",!0===this.m_bMultiLevelToolbarTimeline?"1":"0");return this.m_bMultiLevelToolbarTimeline};
CSettings.prototype.Toggle_MultiLevelToolbarKifuMode=function(){this.m_bMultiLevelToolbarKifuMode=!this.m_bMultiLevelToolbarKifuMode;Common.Set_LocalStorageItem("MultiLevelToolbarKifuMode",!0===this.m_bMultiLevelToolbarKifuMode?"1":"0");return this.m_bMultiLevelToolbarKifuMode};CSettings.prototype.Is_MultiLevelToolbarMainNavigation=function(){return this.m_bMultiLevelToolbarMainNavigation};CSettings.prototype.Is_MultiLevelToolbarTreeNavigation=function(){return this.m_bMultiLevelToolbarTreeNavigation};
CSettings.prototype.Is_MultiLevelToolbarGeneral=function(){return this.m_bMultiLevelToolbarGeneral};CSettings.prototype.Is_MultiLevelToolbarAutoPlay=function(){return this.m_bMultiLevelToolbarAutoPlay};CSettings.prototype.Is_MultiLevelToolbarTimeline=function(){return this.m_bMultiLevelToolbarTimeline};CSettings.prototype.Is_MultiLevelToolbarKifuMode=function(){return this.m_bMultiLevelToolbarKifuMode};var g_oGlobalSettings=new CSettings;
function CLocalSetting(a){CLocalSetting.superclass.constructor.call(this);this.m_oBoardPr={bTrueColorBoard:null,bTrueColorStones:null,oBoardColor:null,bShellWhiteStones:null,bShadows:null,oWhiteColor:null,oBlackColor:null,oLinesColor:null,bDarkBoard:null};this.m_oNavigatorPr={bTrueColorBoard:null,bTrueColorStones:null,oBoardColor:null,bShadows:null,oWhiteColor:null,oBlackColor:null,oLinesColor:null,bDarkBoard:null};this.m_oGameTree=a;this.m_bShowTarget=null;this.m_bEmbedding=!1}
CommonExtend(CLocalSetting,CSettingsBase);CLocalSetting.prototype.Is_Embedding=function(){return this.m_bEmbedding};CLocalSetting.prototype.Set_Embedding=function(a){this.m_bEmbedding=a};CLocalSetting.prototype.Set_ColorScheme=function(a){return null!==a?this.private_SetColorScheme(a):{Board:!0,Navigator:!0}};CLocalSetting.prototype.Is_BoardTrueColorBoard=function(){return null===this.m_oBoardPr.bTrueColorBoard?g_oGlobalSettings.m_oBoardPr.bTrueColorBoard:this.m_oBoardPr.bTrueColorBoard};
CLocalSetting.prototype.Is_BoardTrueColorStones=function(){return null===this.m_oBoardPr.bTrueColorStones?g_oGlobalSettings.m_oBoardPr.bTrueColorStones:this.m_oBoardPr.bTrueColorStones};CLocalSetting.prototype.Is_BoardShellWhiteStones=function(){return null===this.m_oBoardPr.bShellWhiteStones?g_oGlobalSettings.m_oBoardPr.bShellWhiteStones:this.m_oBoardPr.bShellWhiteStones};CLocalSetting.prototype.Set_BoardShellWhiteStones=function(a){this.m_oBoardPr.bShellWhiteStones=a};
CLocalSetting.prototype.Is_BoardShadows=function(){return null===this.m_oBoardPr.bShadows?g_oGlobalSettings.m_oBoardPr.bShadows:this.m_oBoardPr.bShadows};CLocalSetting.prototype.Get_BoardWhiteColor=function(){return null===this.m_oBoardPr.oWhiteColor?g_oGlobalSettings.m_oBoardPr.oWhiteColor:this.m_oBoardPr.oWhiteColor};CLocalSetting.prototype.Get_BoardBlackColor=function(){return null===this.m_oBoardPr.oBlackColor?g_oGlobalSettings.m_oBoardPr.oBlackColor:this.m_oBoardPr.oBlackColor};
CLocalSetting.prototype.Get_BoardBoardColor=function(){return null===this.m_oBoardPr.oBoardColor?g_oGlobalSettings.m_oBoardPr.oBoardColor:this.m_oBoardPr.oBoardColor};CLocalSetting.prototype.Get_BoardLinesColor=function(){return null===this.m_oBoardPr.oLinesColor?g_oGlobalSettings.m_oBoardPr.oLinesColor:this.m_oBoardPr.oLinesColor};CLocalSetting.prototype.Is_BoardDarkBoard=function(){return null===this.m_oBoardPr.bDarkBoard?g_oGlobalSettings.m_oBoardPr.bDarkBoard:this.m_oBoardPr.bDarkBoard};
CLocalSetting.prototype.Is_NavigatorTrueColorBoard=function(){return null===this.m_oNavigatorPr.bTrueColorBoard?g_oGlobalSettings.m_oNavigatorPr.bTrueColorBoard:this.m_oNavigatorPr.bTrueColorBoard};CLocalSetting.prototype.Is_NavigatorTrueColorStones=function(){return null===this.m_oNavigatorPr.bTrueColorStones?g_oGlobalSettings.m_oNavigatorPr.bTrueColorStones:this.m_oNavigatorPr.bTrueColorStones};
CLocalSetting.prototype.Is_NavigatorShadows=function(){return null===this.m_oNavigatorPr.bShadows?g_oGlobalSettings.m_oNavigatorPr.bShadows:this.m_oNavigatorPr.bShadows};CLocalSetting.prototype.Get_NavigatorWhiteColor=function(){return null===this.m_oNavigatorPr.oWhiteColor?g_oGlobalSettings.m_oNavigatorPr.oWhiteColor:this.m_oNavigatorPr.oWhiteColor};
CLocalSetting.prototype.Get_NavigatorBlackColor=function(){return null===this.m_oNavigatorPr.oBlackColor?g_oGlobalSettings.m_oNavigatorPr.oBlackColor:this.m_oNavigatorPr.oBlackColor};CLocalSetting.prototype.Get_NavigatorBoardColor=function(){return null===this.m_oNavigatorPr.oBoardColor?g_oGlobalSettings.m_oNavigatorPr.oBoardColor:this.m_oNavigatorPr.oBoardColor};
CLocalSetting.prototype.Get_NavigatorLinesColor=function(){return null===this.m_oNavigatorPr.oLinesColor?g_oGlobalSettings.m_oNavigatorPr.oLinesColor:this.m_oNavigatorPr.oLinesColor};CLocalSetting.prototype.Is_NavigatorDarkBoard=function(){return null===this.m_oNavigatorPr.bDarkBoard?g_oGlobalSettings.m_oNavigatorPr.bDarkBoard:this.m_oNavigatorPr.bDarkBoard};CLocalSetting.prototype.Is_ShowTarget=function(){return null===this.m_bShowTarget?g_oGlobalSettings.Is_ShowTarget():this.m_bShowTarget};
CLocalSetting.prototype.Set_ShowTarget=function(a){this.m_bShowTarget=a};
function CDrawing(a){(this.m_oGameTree=a)&&a.Set_Drawing(this);this.m_oControl=this.m_oDisableElement=this.m_oMainControl=this.m_oMainDiv=null;this.m_aElements=[];this.m_oButtons={BackwardToStart:[],Backward_5:[],Backward:[],Forward:[],Forward_5:[],ForwardToEnd:[],NextVariant:[],PrevVariant:[],Pass:null,BoardModeMove:[],BoardModeScores:[],BoardModeEditor:[],BoardModeTr:[],BoardModeSq:[],BoardModeCr:[],BoardModeX:[],BoardModeText:[],BoardModeNum:[],BoardModeColor:[],ToolbarCustomize:null,Menu:null,
KifuMode:null,EditorControl:null};this.m_oWindows={Kifu:null};this.m_oViewerTitle=this.m_oViewerScores=this.m_oWhiteInfo=this.m_oBlackInfo=this.m_oSelectBoardModeButton=this.m_oAutoPlaySlider=this.m_oAutoPlayButton=this.m_oTimeLine=this.m_oNavigator=this.m_oBoard=this.m_oAddLabelElement=null;this.m_aComments=[];var b=this;this.m_bNeedUpdateSize=!0;this.m_eTemplateType=EDrawingTemplate.None;this.m_bMixedTemplate=!1;this.m_nMixedTemplateIndex=-1;this.m_nMixedRightSide=400;this.m_nMixedBotSize=200;this.m_nMinWidth=
-1;this.m_nVerEditorComNavH=this.m_nVerEditorToolbarH=this.m_nVerEditorTitleH=this.m_nViewerToolbarH=this.m_nViewerTitleH=0;this.m_arrStateHandlers=[];this.m_nAnimationFrameTimer=null;this.private_OnMainDivClick=function(){b.m_oSelectBoardModeButton&&b.m_oSelectBoardModeButton.Hide_Toolbar();b.m_oButtons.ToolbarCustomize&&b.m_oButtons.ToolbarCustomize.Hide_ContextMenu(!1);b.m_oButtons.Menu&&b.m_oButtons.Menu.Hide_Menu(!1);b.m_oButtons.EditorControl&&b.m_oButtons.EditorControl.Hide_Menu(!1)};this.private_OnTimerDraw=
function(){null!==b.m_nAnimationFrameTimer&&(Common_CancelAnimationFrame(b.m_nAnimationFrameTimer),b.m_nAnimationFrameTimer=null);b.m_nAnimationFrameTimer=Common_RequestAnimationFrame(b.private_OnTimerDraw);b.m_oNavigator&&b.m_oNavigator.Need_Redraw()&&b.m_oNavigator.Draw();b.m_bNeedUpdateSize&&b.private_UpdateSize(!1)};this.private_OnTimerDraw()}
CDrawing.prototype.OnDestroy=function(){null!==this.m_nAnimationFrameTimer&&(Common_CancelAnimationFrame(this.m_nAnimationFrameTimer),this.m_nAnimationFrameTimer=null);this.m_oMainDiv&&delete g_aWindows[this.m_oMainDiv.id]};
CDrawing.prototype.Disable=function(){if(this.m_oMainDiv){var a=document.createElement("div");a.style.width="100%";a.style.height="100%";a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.backgroundColor="rgb(0, 0, 0)";a.style.opacity=.4;this.m_oMainDiv.appendChild(a);this.m_oDisableElement=a;if(a=g_aWindows[this.m_oMainDiv.id][EWindowType.Error])a=a.HtmlElement.Control.HtmlElement;Common.Is_NodeDescendant(this.m_oMainDiv,a,0)&&(this.m_oMainDiv.removeChild(a),this.m_oMainDiv.appendChild(a))}};
CDrawing.prototype.Enable=function(){this.m_oDisableElement&&(this.m_oMainDiv.removeChild(this.m_oDisableElement),this.m_oDisableElement=null)};CDrawing.prototype.Get_Width=function(){return this.m_oMainDiv?parseInt(this.m_oMainDiv.clientWidth):0};CDrawing.prototype.Get_Height=function(){return this.m_oMainDiv?parseInt(this.m_oMainDiv.clientHeight):0};CDrawing.prototype.Get_MainDiv=function(){return this.m_oMainDiv};CDrawing.prototype.Get_GameTree=function(){return this.m_oGameTree};
CDrawing.prototype.Get_ElementOffset=function(a){for(var b=0,c=0;a!=this.m_oMainDiv&&a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{X:b,Y:c}};CDrawing.prototype.Set_TemplateType=function(a){this.m_eTemplateType=a};CDrawing.prototype.Create_SimpleBoard=function(a){this.Set_TemplateType(EDrawingTemplate.SimpleBoard);this.private_SetMainDiv(a);var b=new CDrawingBoard(this);b.Init(a,this.m_oGameTree);b.Focus();this.m_aElements.push(b);this.Update_Size()};
CDrawing.prototype.Create_Viewer=function(a){this.Set_TemplateType(EDrawingTemplate.Viewer);this.private_CreateWrappingMainDiv(a);this.m_nMinWidth=295;a=this.m_oGameTree;var b=this.m_oMainControl,c=this.m_oMainDiv.id;this.m_nViewerTitleH=25;this.m_nViewerToolbarH=36;var d=c+"I";this.private_CreateDiv(b.HtmlElement,d);var e=CreateControlContainer(d);e.Bounds.SetParams(0,0,1E3,0,!1,!1,!1,!1,-1,25);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(e);var f=d+"S";this.private_CreateDiv(e.HtmlElement,
f);var g=CreateControlContainer(f);g.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,122,-1);g.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom;e.AddControl(g);this.m_oViewerScores=new CDrawingViewerScores(this);this.m_oViewerScores.Init(f,a);this.m_aElements.push(this.m_oViewerScores);d+="T";this.private_CreateDiv(e.HtmlElement,d);f=CreateControlContainer(d);f.Bounds.SetParams(122,0,1E3,1E3,!0,!1,!1,!1,-1,-1);f.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom;e.AddControl(f);this.m_oViewerTitle=new CDrawingViewerTitle(this);
this.m_oViewerTitle.Init(d,a);this.m_aElements.push(this.m_oViewerTitle);e=c+"T";this.private_CreateDiv(b.HtmlElement,e);d=CreateControlContainer(e);d.Bounds.SetParams(0,0,1E3,0,!1,!1,!1,!0,-1,36);d.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right;b.AddControl(d);d=new CDrawingToolbar(this);d.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left);
d.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right);d.Add_Control(new CDrawingButtonGameInfo(this),36,1,EToolbarFloat.Right);d.Init(e,a);this.m_aElements.push(d);d=c+"B";e=this.private_CreateDiv(b.HtmlElement,d);c=CreateControlContainer(d);c.Bounds.SetParams(0,25,
1E3,36,!1,!0,!1,!0,-1,-1);c.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom;b.AddControl(c);b=d+"B";this.private_CreateDiv(e,b);f=CreateControlContainer(b);c.AddControl(f);d+="N";this.private_CreateDiv(e,d);e=CreateControlContainer(d);c.AddControl(e);e=new CDrawingBoard(this);e.Init(b,this.m_oGameTree);e.Focus();this.m_aElements.push(e);c.Set_Type(3,e,{RMin:0});this.Update_Size();a.On_EndLoadDrawing()};
CDrawing.prototype.Create_BoardWithNavigateButtons=function(a){g_oGlobalSettings.Load_FromLocalStorage();this.m_nMinWidth=739;this.private_SetMainDiv(a);var b=this.m_oGameTree,c=CreateControlContainer(a);this.private_CreateDiv(c.HtmlElement,a+"div");var d=CControlContainerBoardAndBottomButtons.Create(a+"div");d.Set(38);var e=d.HtmlElement;c.AddControl(d);var f=a+"_Board",g=a+"_ToolbarPanel";a+="_Toolbar";this.private_CreateDiv(e,f);e=this.private_CreateDiv(e,g);e.style.background="rgb(217, 217, 217)";
this.private_CreateDiv(e,a);e=CreateControlContainer(f);e.Bounds.SetParams(0,0,1E3,38,!1,!1,!1,!0,-1,-1);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;d.AddControl(e);e=new CDrawingBoard(this);e.Init(f,b);e.Focus();f=CreateControlContainer(g);f.Bounds.SetParams(0,0,1E3,0,!1,!1,!1,!0,-1,38);f.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(f);d=CreateControlContainer(a);d.Bounds.SetParams(0,1,1E3,1,!1,!0,!1,!0,-1,-1);d.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right;f.AddControl(d);
d=new CDrawingToolbar(this);d.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonNextVariant(this),
36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonPrevVariant(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeMove(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeScores(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeAddRem(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeTr(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeSq(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeCr(this),
36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeX(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeText(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonEditModeNum(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonGameInfo(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right);d.Add_Control(new CDrawingButtonSettings(this),36,1,EToolbarFloat.Right);d.Init(a,b);this.m_oControl=c;this.m_aElements.push(e);
this.m_aElements.push(d);this.Update_Size()};CDrawing.prototype.Create_MixedFullTemplate=function(a){this.m_bMixedTemplate=!0;this.m_nMixedRightSide=400;this.m_nMixedBotSize=200;this.private_CreateWrappingMainDiv(a);this.private_UpdateSize(!0)};CDrawing.prototype.Create_HorizontalFullTemplate=function(a){this.m_bMixedTemplate=!1;this.private_CreateWrappingMainDiv(a);this.private_CreateHorFullTemplate();this.Set_TemplateType(EDrawingTemplate.HorEditor)};
CDrawing.prototype.Create_VerticalFullTemplate=function(a){this.m_bMixedTemplate=!1;this.private_CreateWrappingMainDiv(a);this.private_CreateVerFullTemplate();this.Set_TemplateType(EDrawingTemplate.VerEditor)};
CDrawing.prototype.Create_VerticalSpecialTemplate_1=function(a){this.private_CreateWrappingMainDiv(a);this.m_nMinWidth=332;a=this.m_oGameTree;var b=this.m_oMainControl,c=this.m_oMainDiv.id,d=a.Get_LocalSettings().Is_Embedding(),e=c+"B";this.private_CreateDiv(b.HtmlElement,e).style.background="rgb(217, 217, 217)";e=CreateControlContainer(e);e.Bounds.SetParams(0,0,1E3,0,!0,!1,!1,!1,-1,50);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(e);var f=c+"I";this.private_CreateDiv(b.HtmlElement,
f);e=CreateControlContainer(f);e.Bounds.SetParams(!0!==d?43:0,0,1E3,0,!0,!1,!1,!1,-1,50);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(e);d=c+"O";this.private_CreateDiv(b.HtmlElement,d);c=CreateControlContainer(d);c.Bounds.SetParams(0,50,1E3,1E3,!1,!0,!1,!1,-1,-1);c.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right;b.AddControl(c);b=f+"W";this.private_CreateDiv(e.HtmlElement,b);var g=CreateControlContainer(b);g.Bounds.SetParams(0,0,500,1E3,!1,!1,!1,!1,-1,-1);g.Anchor=g_anchor_top|
g_anchor_left|g_anchor_right|g_anchor_bottom;e.AddControl(g);g=new CDrawingPlayerInfo(this);g.Init(b,a,BOARD_WHITE);this.m_aElements.push(g);f+="B";this.private_CreateDiv(e.HtmlElement,f);b=CreateControlContainer(f);b.Bounds.SetParams(500,0,1E3,1E3,!1,!1,!1,!1,-1,-1);b.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;e.AddControl(b);e=new CDrawingPlayerInfo(this);e.Init(f,a,BOARD_BLACK);this.m_aElements.push(e);e=new CDrawingBoard(this);this.m_aElements.push(e);c.Set_Type(3,e,{RMin:this.m_nMixedBotSize-
50});f=d+"B";this.private_CreateDiv(c.HtmlElement,f);b=CreateControlContainer(f);c.AddControl(b);e.Init(f,a);e.Focus();f=d+"N";b=this.private_CreateDiv(c.HtmlElement,f);d=CreateControlContainer(f);c.AddControl(d);b.style.background="rgb(217, 217, 217)";b=f+"T";this.private_CreateDiv(d.HtmlElement,b);g=CreateControlContainer(b);g.Bounds.SetParams(0,1,1E3,1,!1,!0,!1,!0,-1,-1);g.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(g);g=new CDrawingToolbar(this);g.Add_Control(new CDrawingButtonBackwardToStart(this),
36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonForwardToEnd(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Right);g.Add_Control(new CDrawingButtonAutoPlay(this),
36,1,EToolbarFloat.Right);g.Init(b,a);this.m_aElements.push(g);this.m_nMixedBotSize=196;c.Set_Type(3,e,{RMin:this.m_nMixedBotSize-50});c=CreateControlContainer(b);c.Bounds.SetParams(0,1,1E3,0,!1,!0,!1,!1,-1,36);c.Anchor=g_anchor_left|g_anchor_right|g_anchor_top;d.AddControl(c);e=f+"U";this.private_CreateDiv(d.HtmlElement,e);c=CreateControlContainer(e);c.Bounds.SetParams(0,38,1E3,1E3,!1,!0,!1,!1,-1,-1);c.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom;d.AddControl(c);d=e+"N";this.private_CreateDiv(c.HtmlElement,
d);e=CreateControlContainer(d);e.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);e.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom;c.AddControl(e);c=new CDrawingNavigator(this);c.Init(d,a);this.m_aElements.push(c);this.Update_Size();a.On_EndLoadDrawing()};
CDrawing.prototype.private_CreateWrappingMainDiv=function(a){g_oGlobalSettings.Load_FromLocalStorage();var b=CreateControlContainer(a);this.m_oControl=b;a+="GB";this.private_CreateDiv(b.HtmlElement,a);var c=CreateControlContainer(a);c.Bounds.SetParams(0,0,1,1,!1,!1,!0,!0,-1,-1);c.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;b.AddControl(c);this.private_SetMainDiv(a,c)};
CDrawing.prototype.private_CreateHorFullTemplate=function(){var a=this.m_oGameTree,b=this.m_oMainControl,c=this.m_oMainDiv.id,d=a.Get_LocalSettings().Is_Embedding();this.m_nMixedRightSide=344;var e=new CDrawingBoard(this);b.Set_Type(1,e,{RMin:this.m_nMixedRightSide});var f=c+"_Board",g=c+"_Panel";this.private_CreateDiv(b.HtmlElement,f);this.private_CreateDiv(b.HtmlElement,g);var h=CreateControlContainer(f);c=CreateControlContainer(g);b.AddControl(h);b.AddControl(c);e.Init(f,a);e.Focus();f=g+"_CaT";
g+="_Navigator";this.private_CreateDiv(c.HtmlElement,f);this.private_CreateDiv(c.HtmlElement,g);b=CreateControlContainer(f);b.Bounds.SetParams(0,0,1E3,500,!1,!1,!1,!1,-1,-1);b.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;c.AddControl(b);b.HtmlElement.style.background="rgb(217, 217, 217)";h=CreateControlContainer(g);h.Bounds.SetParams(0,500,1E3,1E3,!1,!1,!1,!1,-1,-1);h.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;c.AddControl(h);c=new CDrawingNavigator(this);
c.Init(g,a);var k=f+"_Info";g=f+"_Comments";h=f+"_Toolbar";this.private_CreateDiv(b.HtmlElement,k);this.private_CreateDiv(b.HtmlElement,g);this.private_CreateDiv(b.HtmlElement,h);var l=CreateControlContainer(k);l.Bounds.SetParams(!0!==d?43:0,0,1E3,0,!0,!1,!1,!1,-1,50);l.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(l);var m=k+"_White";k+="_Black";this.private_CreateDiv(l.HtmlElement,m);this.private_CreateDiv(l.HtmlElement,k);var n=CreateControlContainer(m);n.Bounds.SetParams(0,0,500,
1E3,!1,!1,!1,!1,-1,-1);n.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;l.AddControl(n);n=CreateControlContainer(k);n.Bounds.SetParams(500,0,1E3,1E3,!1,!1,!1,!1,-1,-1);n.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;l.AddControl(n);l=new CDrawingPlayerInfo(this);l.Init(m,a,BOARD_WHITE);m=new CDrawingPlayerInfo(this);m.Init(k,a,BOARD_BLACK);!0!==d&&(d=f+"_M",this.private_CreateDiv(b.HtmlElement,d),f=CreateControlContainer(d),f.Bounds.SetParams(7,7,1E3,7,!0,!0,!1,
!0,36,36),f.Anchor=g_anchor_top|g_anchor_left,b.AddControl(f),f=new CDrawingButtonFileMenu(this),f.Init(d,a),this.Register_MenuButton(f),this.m_aElements.push(f));var p=new CDrawingMultiLevelToolbar(this);p.Init(h);var q=p.Get_Height(),t=CreateControlContainer(h);t.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,q);t.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom;b.AddControl(t);var r=CreateControlContainer(g);r.Bounds.SetParams(0,50,1E3,q+1,!1,!0,!1,!0,-1,-1);r.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|
g_anchor_bottom;b.AddControl(r);var A=this;p.Set_OnChangeCallback(function(){q=p.Get_Height();t.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,q);r.Bounds.SetParams(0,50,1E3,q+1,!1,!0,!1,!0,-1,-1);A.Update_Size(!1)});d=new CDrawingComments(this);d.Init(g,a);this.m_aElements.push(e);this.m_aElements.push(c);this.m_aElements.push(d);this.m_aElements.push(p);this.m_aElements.push(m);this.m_aElements.push(l);this.Update_Size();a.On_EndLoadDrawing()};
CDrawing.prototype.private_CreateVerFullTemplate=function(){this.m_nMinWidth=332;var a=this.m_oGameTree,b=this.m_oMainControl,c=this.m_oMainDiv.id,d=a.Get_LocalSettings().Is_Embedding(),e=c+"B";this.private_CreateDiv(b.HtmlElement,e).style.background="rgb(217, 217, 217)";e=CreateControlContainer(e);e.Bounds.SetParams(0,0,1E3,0,!0,!1,!1,!1,-1,50);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(e);e=c+"I";this.private_CreateDiv(b.HtmlElement,e);if(!0!==d){var f=c+"M";this.private_CreateDiv(b.HtmlElement,
f);var g=CreateControlContainer(f);g.Bounds.SetParams(7,7,1E3,7,!0,!0,!1,!0,36,36);g.Anchor=g_anchor_top|g_anchor_left;b.AddControl(g);g=new CDrawingButtonFileMenu(this);g.Init(f,a);this.Register_MenuButton(g);this.m_aElements.push(g)}f=CreateControlContainer(e);f.Bounds.SetParams(!0!==d?43:0,0,1E3,0,!0,!1,!1,!1,-1,50);f.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(f);c+="O";this.private_CreateDiv(b.HtmlElement,c);var h=CreateControlContainer(c);h.Bounds.SetParams(0,50,1E3,1E3,!1,
!0,!1,!1,-1,-1);h.Anchor=g_anchor_bottom|g_anchor_left|g_anchor_right;b.AddControl(h);b=e+"W";this.private_CreateDiv(f.HtmlElement,b);d=CreateControlContainer(b);d.Bounds.SetParams(0,0,500,1E3,!1,!1,!1,!1,-1,-1);d.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;f.AddControl(d);d=new CDrawingPlayerInfo(this);d.Init(b,a,BOARD_WHITE);this.m_aElements.push(d);e+="B";this.private_CreateDiv(f.HtmlElement,e);b=CreateControlContainer(e);b.Bounds.SetParams(500,0,1E3,1E3,!1,!1,!1,!1,-1,-1);
b.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;f.AddControl(b);b=new CDrawingPlayerInfo(this);b.Init(e,a,BOARD_BLACK);this.m_aElements.push(b);var k=new CDrawingBoard(this);this.m_aElements.push(k);h.Set_Type(3,k,{RMin:this.m_nMixedBotSize-50});e=c+"B";this.private_CreateDiv(h.HtmlElement,e);b=CreateControlContainer(e);h.AddControl(b);k.Init(e,a);k.Focus();c+="N";b=this.private_CreateDiv(h.HtmlElement,c);e=CreateControlContainer(c);h.AddControl(e);b.style.background="rgb(217, 217, 217)";
b=c+"T";this.private_CreateDiv(e.HtmlElement,b);var l=new CDrawingMultiLevelToolbar(this);l.Init(b);var m=l.Get_Height();this.m_aElements.push(l);this.m_nMixedBotSize=m+160;h.Set_Type(3,k,{RMin:this.m_nMixedBotSize-50});var n=CreateControlContainer(b);n.Bounds.SetParams(0,1,1E3,0,!1,!0,!1,!1,-1,m);n.Anchor=g_anchor_left|g_anchor_right|g_anchor_top;e.AddControl(n);c+="U";this.private_CreateDiv(e.HtmlElement,c);var p=CreateControlContainer(c);p.Bounds.SetParams(0,m+2,1E3,1E3,!1,!0,!1,!1,-1,-1);p.Anchor=
g_anchor_left|g_anchor_right|g_anchor_bottom;e.AddControl(p);var q=this;l.Set_OnChangeCallback(function(){m=l.Get_Height();q.m_nMixedBotSize=m+160;h.Set_Type(3,k,{RMin:q.m_nMixedBotSize-50});n.Bounds.SetParams(0,1,1E3,0,!1,!0,!1,!1,-1,m);p.Bounds.SetParams(0,m+2,1E3,1E3,!1,!0,!1,!1,-1,-1);q.Update_Size(!1)});e=c+"L";this.private_CreateDiv(p.HtmlElement,e);b=CreateControlContainer(e);b.Bounds.SetParams(0,0,0,1E3,!1,!1,!1,!1,36,-1);b.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom;p.AddControl(b);
b=c+"R";this.private_CreateDiv(p.HtmlElement,b);f=CreateControlContainer(b);f.Bounds.SetParams(36,0,1E3,1E3,!0,!1,!1,!1,-1,-1);f.Anchor=g_anchor_right|g_anchor_top|g_anchor_bottom;p.AddControl(f);c=b+"N";this.private_CreateDiv(f.HtmlElement,c);d=CreateControlContainer(c);d.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);d.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom;f.AddControl(d);b+="C";this.private_CreateDiv(f.HtmlElement,b);d=CreateControlContainer(b);d.Bounds.SetParams(0,
0,1E3,1E3,!1,!1,!1,!1,-1,-1);d.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom;f.AddControl(d);f=new CDrawingNavigator(this);f.Init(c,a);this.m_aElements.push(f);f=new CDrawingComments(this);f.Init(b,a);this.m_aElements.push(f);f=new CDrawingNavigatorCommentsTabs(this);f.Init(e,a,c,b);this.m_aElements.push(f);this.Update_Size();a.On_EndLoadDrawing();this.m_nVerEditorTitleH=50;this.m_nVerEditorToolbarH=36;this.m_nVerEditorComNavH=160};
CDrawing.prototype.Create_BoardCommentsButtonsNavigator=function(a){return this.Create_HorizontalFullTemplate(a)};
CDrawing.prototype.Create_Problems=function(a){this.Set_TemplateType(EDrawingTemplate.Problems);var b=this.m_oGameTree,c=new CDrawingBoard(this),d=CreateControlContainer(a),e=a+"GoBoard";this.private_CreateDiv(d.HtmlElement,e);var f=CreateControlContainer(e);f.Bounds.SetParams(0,0,1,1,!1,!1,!0,!0,-1,-1);f.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;d.AddControl(f);this.m_nMixedRightSide=200;f.Set_Type(1,c,{RMin:this.m_nMixedRightSide});var g=a+"_Board",h=a+"_Panel";this.private_CreateDiv(f.HtmlElement,
g);this.private_CreateDiv(f.HtmlElement,h);var k=CreateControlContainer(g);a=CreateControlContainer(h);f.AddControl(k);f.AddControl(a);a.HtmlElement.style.background="rgb(217, 217, 217)";c.Init(g,b);c.Focus();c.Set_ShellWhiteStones(!1);f=h+"_Toolbar";g=h+"_Comments";this.private_CreateDiv(a.HtmlElement,g);this.private_CreateDiv(a.HtmlElement,f);h=CreateControlContainer(g);h.Bounds.SetParams(0,38,1E3,1E3,!1,!0,!1,!1,-1,-1);h.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;a.AddControl(h);
h=CreateControlContainer(f);h.Bounds.SetParams(6,1,1E3,1E3,!0,!0,!1,!0,-1,36);h.Anchor=g_anchor_left|g_anchor_right|g_anchor_top;a.AddControl(h);a=new CDrawingComments(this);a.Init(g,b);g=new CDrawingToolbar(this);g.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left);g.Add_Control(new CDrawingButtonAbout(this),36,1,EToolbarFloat.Left);g.Init(f,b);this.m_aElements.push(c);this.m_aElements.push(a);this.m_aElements.push(g);this.m_oControl=d;this.Update_Size();b.On_EndLoadDrawing();
this.private_SetMainDiv(e)};CDrawing.prototype.Update_Size=function(a){a?this.private_UpdateSize(!0):this.m_bNeedUpdateSize=!0};CDrawing.prototype.private_SetMainDiv=function(a,b){this.m_oMainDiv=document.getElementById(a);this.m_oMainControl=b;this.m_oMainDiv.style.background="url('"+g_sBackground+"')";this.m_oMainDiv.onclick=this.private_OnMainDivClick};
CDrawing.prototype.private_ClearMainDiv=function(){for(this.Remove_LabelElement();this.m_oMainDiv.firstChild;)this.m_oMainDiv.removeChild(this.m_oMainDiv.firstChild);this.m_oMainControl&&this.m_oMainControl.Clear();g_aWindows={}};
CDrawing.prototype.private_UpdateSize=function(a){if(!0===this.m_bMixedTemplate){var b=this.m_oControl.HtmlElement.clientWidth,c=this.m_oControl.HtmlElement.clientHeight;0<this.m_nMinWidth&&b<this.m_nMinWidth&&(b=this.m_nMinWidth);b=c-(b-this.m_nMixedRightSide)>this.m_nMixedBotSize+100?1:0;this.m_nMixedTemplateIndex!==b&&(this.m_nMixedTemplateIndex=b,this.private_ClearMainDiv(),0===this.m_nMixedTemplateIndex?this.private_CreateHorFullTemplate():this.private_CreateVerFullTemplate(),this.m_oGameTree&&
(this.m_oGameTree.GoTo_Node(this.m_oGameTree.Get_CurNode(),!0),this.m_oGameTree.Update_InterfaceState(!0)))}this.m_bNeedUpdateSize=!1;this.m_oControl&&(b=this.m_oControl.HtmlElement.clientWidth,c=this.m_oControl.HtmlElement.clientHeight,0<this.m_nMinWidth&&b<this.m_nMinWidth&&(b=this.m_nMinWidth),this.m_oControl.Resize(b,c));b=0;for(c=this.m_aElements.length;b<c;b++)this.m_aElements[b].Update_Size(a)};
CDrawing.prototype.private_CreateDiv=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};CDrawing.prototype.Register_PassButton=function(a){this.m_oButtons.Pass=a};CDrawing.prototype.Register_BackwardToStartButton=function(a){this.m_oButtons.BackwardToStart.push(a)};CDrawing.prototype.Register_Backward_5Button=function(a){this.m_oButtons.Backward_5.push(a)};
CDrawing.prototype.Register_BackwardButton=function(a){this.m_oButtons.Backward.push(a)};CDrawing.prototype.Register_ForwardButton=function(a){this.m_oButtons.Forward.push(a)};CDrawing.prototype.Register_Forward_5Button=function(a){this.m_oButtons.Forward_5.push(a)};CDrawing.prototype.Register_ForwardToEndButton=function(a){this.m_oButtons.ForwardToEnd.push(a)};CDrawing.prototype.Register_NextVariantButton=function(a){this.m_oButtons.NextVariant.push(a)};
CDrawing.prototype.Register_PrevVariantButton=function(a){this.m_oButtons.PrevVariant.push(a)};CDrawing.prototype.Register_EditModeMoveButton=function(a){this.m_oButtons.BoardModeMove.push(a)};CDrawing.prototype.Register_EditModeScoresButton=function(a){this.m_oButtons.BoardModeScores.push(a)};CDrawing.prototype.Register_EditModeAddRemButton=function(a){this.m_oButtons.BoardModeEditor.push(a)};CDrawing.prototype.Register_EditModeTrButton=function(a){this.m_oButtons.BoardModeTr.push(a)};
CDrawing.prototype.Register_EditModeSqButton=function(a){this.m_oButtons.BoardModeSq.push(a)};CDrawing.prototype.Register_EditModeCrButton=function(a){this.m_oButtons.BoardModeCr.push(a)};CDrawing.prototype.Register_EditModeXButton=function(a){this.m_oButtons.BoardModeX.push(a)};CDrawing.prototype.Register_EditModeTextButton=function(a){this.m_oButtons.BoardModeText.push(a)};CDrawing.prototype.Register_EditModeNumButton=function(a){this.m_oButtons.BoardModeNum.push(a)};
CDrawing.prototype.Register_EditModeColorButton=function(a){this.m_oButtons.BoardModeColor.push(a)};CDrawing.prototype.Register_Comments=function(a){this.m_aComments.push(a)};CDrawing.prototype.Register_Board=function(a){this.m_oBoard=a};CDrawing.prototype.Register_Navigator=function(a){this.m_oNavigator=a};CDrawing.prototype.Register_TimeLine=function(a){this.m_oTimeLine=a};CDrawing.prototype.Register_AutoPlaySpeed=function(a){this.m_oAutoPlaySlider=a};
CDrawing.prototype.Register_AutoPlayButton=function(a){this.m_oAutoPlayButton=a};CDrawing.prototype.Register_SelectBoardModeButton=function(a){this.m_oSelectBoardModeButton=a};CDrawing.prototype.Register_ToolbarCustomizeButton=function(a){this.m_oButtons.ToolbarCustomize=a};CDrawing.prototype.Register_AddLabelElement=function(a){this.Remove_LabelElement();this.m_oAddLabelElement=a};CDrawing.prototype.Register_MenuButton=function(a){this.m_oButtons.Menu=a};
CDrawing.prototype.Register_EditorControlButton=function(a){this.m_oButtons.EditorControl=a};CDrawing.prototype.Register_KifuModeButton=function(a){this.m_oButtons.KifuMode=a};CDrawing.prototype.Register_KifuWindow=function(a){this.m_oWindows.Kifu=a};CDrawing.prototype.Remove_LabelElement=function(){if(this.m_oAddLabelElement){var a=this.m_oAddLabelElement;this.m_oAddLabelElement=null;this.m_oMainDiv.removeChild(a)}};CDrawing.prototype.On_StartAutoPlay=function(){this.m_oAutoPlayButton&&this.m_oAutoPlayButton.Set_State2(EDrawingButtonState2.AutoPlayPlaying)};
CDrawing.prototype.On_StopAutoPlay=function(){this.m_oAutoPlayButton&&this.m_oAutoPlayButton.Set_State2(EDrawingButtonState2.AutoPlayStopped)};CDrawing.prototype.Update_AutoPlaySpeed=function(a){this.m_oAutoPlaySlider&&this.m_oAutoPlaySlider.Update_Pos(a)};CDrawing.prototype.Update_KifuMode=function(){this.m_oButtons.KifuMode&&this.m_oButtons.KifuMode.Set_Selected(this.m_oGameTree.Is_KifuMode())};CDrawing.prototype.Register_BlackInfo=function(a){this.m_oBlackInfo=a};
CDrawing.prototype.Register_WhiteInfo=function(a){this.m_oWhiteInfo=a};CDrawing.prototype.Update_BlackName=function(a){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Name(a);this.private_UpdateViewerTitle()};CDrawing.prototype.Update_BlackRank=function(a){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Rank(a)};CDrawing.prototype.Update_WhiteName=function(a){this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Name(a);this.private_UpdateViewerTitle()};
CDrawing.prototype.Update_WhiteRank=function(a){this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Rank(a)};CDrawing.prototype.private_UpdateViewerTitle=function(){this.m_oViewerTitle&&this.m_oViewerTitle.Set_Title(this.m_oGameTree.Get_MatchName())};CDrawing.prototype.Update_Captured=function(a,b){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Captured(a);this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Captured(b);this.m_oViewerScores&&this.m_oViewerScores.Update_Scores(b,a)};
CDrawing.prototype.Update_Scores=function(a,b){this.m_oBlackInfo&&this.m_oBlackInfo.Update_Scores(a);this.m_oWhiteInfo&&this.m_oWhiteInfo.Update_Scores(b);this.m_oViewerScores&&this.m_oViewerScores.Update_Scores(b,a)};
CDrawing.prototype.Update_InterfaceState=function(a){for(var b=0,c=this.m_oButtons.BackwardToStart.length;b<c;b++)this.m_oButtons.BackwardToStart[b].Set_Enabled(a.Backward);b=0;for(c=this.m_oButtons.Backward_5.length;b<c;b++)this.m_oButtons.Backward_5[b].Set_Enabled(a.Backward);b=0;for(c=this.m_oButtons.Backward.length;b<c;b++)this.m_oButtons.Backward[b].Set_Enabled(a.Backward);b=0;for(c=this.m_oButtons.Forward.length;b<c;b++)this.m_oButtons.Forward[b].Set_Enabled(a.Forward);b=0;for(c=this.m_oButtons.Forward_5.length;b<
c;b++)this.m_oButtons.Forward_5[b].Set_Enabled(a.Forward);b=0;for(c=this.m_oButtons.ForwardToEnd.length;b<c;b++)this.m_oButtons.ForwardToEnd[b].Set_Enabled(a.Forward);b=0;for(c=this.m_oButtons.NextVariant.length;b<c;b++)this.m_oButtons.NextVariant[b].Set_Enabled(a.NextVariant);b=0;for(c=this.m_oButtons.PrevVariant.length;b<c;b++)this.m_oButtons.PrevVariant[b].Set_Enabled(a.PrevVariant);b=0;for(c=this.m_oButtons.BoardModeMove.length;b<c;b++)this.m_oButtons.BoardModeMove[b].Set_Selected(a.BoardMode===
EBoardMode.Move);b=0;for(c=this.m_oButtons.BoardModeScores.length;b<c;b++)this.m_oButtons.BoardModeScores[b].Set_Selected(a.BoardMode===EBoardMode.CountScores);b=0;for(c=this.m_oButtons.BoardModeEditor.length;b<c;b++)this.m_oButtons.BoardModeEditor[b].Set_Selected(a.BoardMode===EBoardMode.AddRemove);b=0;for(c=this.m_oButtons.BoardModeTr.length;b<c;b++)this.m_oButtons.BoardModeTr[b].Set_Selected(a.BoardMode===EBoardMode.AddMarkTr);b=0;for(c=this.m_oButtons.BoardModeSq.length;b<c;b++)this.m_oButtons.BoardModeSq[b].Set_Selected(a.BoardMode===
EBoardMode.AddMarkSq);b=0;for(c=this.m_oButtons.BoardModeCr.length;b<c;b++)this.m_oButtons.BoardModeCr[b].Set_Selected(a.BoardMode===EBoardMode.AddMarkCr);b=0;for(c=this.m_oButtons.BoardModeX.length;b<c;b++)this.m_oButtons.BoardModeX[b].Set_Selected(a.BoardMode===EBoardMode.AddMarkX);b=0;for(c=this.m_oButtons.BoardModeText.length;b<c;b++)this.m_oButtons.BoardModeText[b].Set_Selected(a.BoardMode===EBoardMode.AddMarkTx);b=0;for(c=this.m_oButtons.BoardModeNum.length;b<c;b++)this.m_oButtons.BoardModeNum[b].Set_Selected(a.BoardMode===
EBoardMode.AddMarkNum);b=0;for(c=this.m_oButtons.BoardModeColor.length;b<c;b++)this.m_oButtons.BoardModeColor[b].Set_Selected(a.BoardMode===EBoardMode.AddMarkColor);this.m_oTimeLine&&this.m_oTimeLine.Update_Pos(a.TimelinePos);this.m_oSelectBoardModeButton&&this.m_oSelectBoardModeButton.On_UpdateBoardMode(a.BoardMode);this.m_oWindows.Kifu&&this.m_oWindows.Kifu.Update_NextMove();this.Update_ColorsCounter();b=0;for(c=this.m_arrStateHandlers.length;b<c;++b){var d=this.m_arrStateHandlers[b];d&&d.OnGameTreeStateChange&&
d.OnGameTreeStateChange(this.m_oGameTree,a)}};CDrawing.prototype.Update_Comments=function(a){for(var b=0,c=this.m_aComments.length;b<c;b++)this.m_aComments[b].Update_Comments(a)};CDrawing.prototype.Update_ColorsCounter=function(){var a=g_aWindows[EWindowType.CountColors];a&&a.Is_Visible()&&a.Update()};
CDrawing.prototype.Toggle_MultiLevelToolbarMainNavigation=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarMainNavigation();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_MainNavigation(a);return a};CDrawing.prototype.Toggle_MultiLevelToolbarTreeNavigation=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarTreeNavigation();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_TreeNavigation(a);return a};
CDrawing.prototype.Toggle_MultiLevelToolbarGeneral=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarGeneral();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_General(a);return a};CDrawing.prototype.Toggle_MultiLevelToolbarAutoPlay=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarAutoPlay();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_AutoPlay(a);return a};
CDrawing.prototype.Toggle_MultiLevelToolbarTimeline=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarTimeline();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_Timeline(a);return a};CDrawing.prototype.Toggle_MultiLevelToolbarKifuMode=function(){var a=g_oGlobalSettings.Toggle_MultiLevelToolbarKifuMode();this.m_oButtons.ToolbarCustomize&&this.m_oButtons.ToolbarCustomize.Set_KifuMode(a);return a};
CDrawing.prototype.Get_DivHeightByWidth=function(a){var b=this.m_oGameTree?this.m_oGameTree.Get_DrawingBoard():null;if(!b)return 0;var c=b.Get_AspectRatio();if(.1>Math.abs(c))return 0;b=1/b.Get_AspectRatio();switch(this.m_eTemplateType){case EDrawingTemplate.SimpleBoard:return b*a;case EDrawingTemplate.Viewer:return this.m_nViewerTitleH+this.m_nViewerToolbarH+b*a;case EDrawingTemplate.VerEditor:return this.m_nVerEditorComNavH+this.m_nVerEditorTitleH+this.m_nVerEditorToolbarH+b*a;case EDrawingTemplate.HorEditor:return(a-
this.m_nMixedRightSide)*b;case EDrawingTemplate.Problems:return(a-this.m_nMixedRightSide)*b}return 0};CDrawing.prototype.Get_TemplateType=function(){return this.m_eTemplateType};CDrawing.prototype.Add_StateHandler=function(a){this.m_arrStateHandlers.push(a)};
CDrawing.prototype.Create_ViewerForBooklet=function(a){this.Set_TemplateType(EDrawingTemplate.Viewer);this.private_CreateWrappingMainDiv(a);this.m_oMainDiv.style.background="";this.m_nMinWidth=295;a=this.m_oGameTree;var b=this.m_oMainControl,c=this.m_oMainDiv.id;this.m_nViewerTitleH=25;this.m_nViewerToolbarH=36;var d=c+"I";this.private_CreateDiv(b.HtmlElement,d);var e=CreateControlContainer(d);e.Bounds.SetParams(0,0,1E3,0,!1,!1,!1,!1,-1,25);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;b.AddControl(e);
d+="S";this.private_CreateDiv(e.HtmlElement,d);var f=CreateControlContainer(d);f.Bounds.SetParams(159,0,1E3,1E3,!0,!1,!1,!1,122,-1);f.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom;e.AddControl(f);this.m_oViewerScores=new CDrawingViewerScores(this);this.m_oViewerScores.Init(d,a);this.m_oViewerScores.HtmlElement.Control.HtmlElement.style.backgroundColor="";this.m_aElements.push(this.m_oViewerScores);e=c+"T";this.private_CreateDiv(b.HtmlElement,e);d=CreateControlContainer(e);d.Bounds.SetParams(109,
0,1E3,0,!0,!1,!1,!0,221,36);d.Anchor=g_anchor_bottom|g_anchor_left;b.AddControl(d);d=new CDrawingToolbar(this);d.Add_Control(new CDrawingButtonBackwardToStart(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonBackward(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForward(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForward5(this),36,1,EToolbarFloat.Left);d.Add_Control(new CDrawingButtonForwardToEnd(this),
36,1,EToolbarFloat.Left);d.Init(e,a);d.HtmlElement.Control.HtmlElement.style.backgroundColor="";this.m_aElements.push(d);d=c+"B";e=this.private_CreateDiv(b.HtmlElement,d);c=CreateControlContainer(d);c.Bounds.SetParams(0,25,1E3,36,!1,!0,!1,!0,-1,-1);c.Anchor=g_anchor_left|g_anchor_right|g_anchor_top|g_anchor_bottom;b.AddControl(c);b=d+"B";this.private_CreateDiv(e,b);f=CreateControlContainer(b);c.AddControl(f);d+="N";this.private_CreateDiv(e,d);e=CreateControlContainer(d);c.AddControl(e);e=new CDrawingBoard(this);
e.Init(b,this.m_oGameTree);e.Focus();this.m_aElements.push(e);c.Set_Type(3,e,{RMin:0});this.Update_Size();a.On_EndLoadDrawing()};function CDrawingFullInfo(){this.m_oGameTree=null;this.HtmlElement={Control:null}}CDrawingFullInfo.prototype.Init=function(){};CDrawingFullInfo.prototype.Update_Size=function(){};var g_mouse_event_type_down=0,g_mouse_event_type_move=1,g_mouse_event_type_up=2,g_mouse_event_type_wheel=3,g_mouse_button_left=0,g_mouse_button_center=1,g_mouse_button_right=2,g_mouse_event_settings_lock=1,g_mouse_event_settings_count=2;
function CMouseEventHandler(){this.Y=this.X=0;this.Button=g_mouse_button_left;this.Type=g_mouse_event_type_move;this.ShiftKey=this.CtrlKey=this.AltKey=!1;this.Sender=null;this.LastClickTime=-1;this.WheelDelta=this.ClickCount=0;this.IsPressed=!1;this.LastY=this.LastX=0;this.KoefPixToMM=1;this.IsLocked=!1;this.buttonObject=null;this.LockMouse=function(){return this.IsLocked?!1:this.IsLocked=!0};this.UnLockMouse=function(){return this.IsLocked?(this.IsLocked=!1,!0):!1}}
function CKeyboardEvent(){this.ShiftKey=this.CtrlKey=this.AltKey=!1;this.Sender=null;this.KeyCode=this.CharCode=0}var global_mouseEvent=new CMouseEventHandler,global_keyboardEvent=new CKeyboardEvent;
function check_KeyboardEvent(a){global_keyboardEvent.AltKey=a.altKey;global_keyboardEvent.CtrlKey=void 0!==a.metaKey?a.ctrlKey||a.metaKey:a.ctrlKey;global_keyboardEvent.ShiftKey=a.shiftKey;global_keyboardEvent.Sender=a.srcElement?a.srcElement:a.target;global_keyboardEvent.CharCode=a.charCode;global_keyboardEvent.KeyCode=a.keyCode;global_keyboardEvent.Which=a.which}
function check_MouseMoveEvent(a){if(global_mouseEvent.IsLocked)return!1;if(a.pageX||a.pageY)global_mouseEvent.X=a.pageX,global_mouseEvent.Y=a.pageY;else if(a.clientX||a.clientY)global_mouseEvent.X=a.clientX,global_mouseEvent.Y=a.clientY;global_mouseEvent.AltKey=a.altKey;global_mouseEvent.ShiftKey=a.shiftKey;global_mouseEvent.CtrlKey=a.ctrlKey||a.metaKey;global_mouseEvent.Type=g_mouse_event_type_move;global_mouseEvent.IsLocked||(global_mouseEvent.Sender=a.srcElement?a.srcElement:a.target);if(3<Math.abs(global_mouseEvent.X-
global_mouseEvent.LastX)||3<Math.abs(global_mouseEvent.Y-global_mouseEvent.LastY))global_mouseEvent.LastClickTime=-1,global_mouseEvent.ClickCount=0;return!0}
function check_MouseDownEvent(a,b){if(a.pageX||a.pageY)global_mouseEvent.X=a.pageX,global_mouseEvent.Y=a.pageY;else if(a.clientX||a.clientY)global_mouseEvent.X=a.clientX,global_mouseEvent.Y=a.clientY;global_mouseEvent.LastX=global_mouseEvent.X;global_mouseEvent.LastY=global_mouseEvent.Y;global_mouseEvent.AltKey=a.altKey;global_mouseEvent.ShiftKey=a.shiftKey;global_mouseEvent.CtrlKey=a.ctrlKey||a.metaKey;global_mouseEvent.Type=g_mouse_event_type_down;global_mouseEvent.Button=a.button;global_mouseEvent.Sender=
a.srcElement?a.srcElement:a.target;if(b){var c=(new Date).getTime();0==global_mouseEvent.ClickCount?(global_mouseEvent.ClickCount=1,global_mouseEvent.LastClickTime=c):500>c-global_mouseEvent.LastClickTime?(global_mouseEvent.LastClickTime=c,global_mouseEvent.ClickCount++):(global_mouseEvent.ClickCount=1,global_mouseEvent.LastClickTime=c)}else global_mouseEvent.LastClickTime=-1,global_mouseEvent.ClickCount=1;window.g_bIsMouseUpLockedSend=!1}
function InitCaptureEvents(){window.onmousemove=function(a){return Window_OnMouseMove(a)};window.onmouseup=function(a){return Window_OnMouseUp(a)}}function Window_OnMouseMove(a){if(global_mouseEvent.IsLocked&&void 0!=global_mouseEvent.Sender&&null!=global_mouseEvent.Sender&&void 0!=global_mouseEvent.Sender.onmousemove&&null!=global_mouseEvent.Sender.onmousemove)global_mouseEvent.Sender.onmousemove(a)}
function Window_OnMouseUp(a){if(!1===window.g_bIsMouseUpLockedSend){window.g_bIsMouseUpLockedSend=!0;if(global_mouseEvent.IsLocked&&global_mouseEvent.Sender&&void 0!=global_mouseEvent.Sender.onmouseup&&null!=global_mouseEvent.Sender.onmouseup)global_mouseEvent.Sender.onmouseup(a,!0);global_mouseEvent.Sender=null}}InitCaptureEvents();function CInterfaceState(){this.PrevVariant=this.NextVariant=this.Forward=this.Backward=!0;this.BoardMode=EBoardMode.Move;this.TimelinePos=0;this.AutoPlaySpeed=null};var EDrawingMark={Lm:-1,Tr:0,Sq:1,Cr:2,Tx:3,X:4,Tb:5,Tw:6,Tb2:7,Tw2:8};function CDrawingMark(a,b,c,d){this.m_oPos={X:void 0===a?0:a,Y:void 0==b?0:b};this.m_nType=void 0===c?EDrawingMark.Tr:c;this.m_sText=void 0===d?"":d}CDrawingMark.prototype.Get_Pos=function(){return this.m_oPos};CDrawingMark.prototype.Get_X=function(){return this.m_oPos.X};CDrawingMark.prototype.Get_Y=function(){return this.m_oPos.Y};CDrawingMark.prototype.Set_Pos=function(a,b){this.m_oPos.X=a;this.m_oPos.Y=b};
CDrawingMark.prototype.Get_Type=function(){return this.m_nType};CDrawingMark.prototype.Set_Type=function(a){this.m_nType=a};CDrawingMark.prototype.Get_Text=function(){return this.m_sText};CDrawingMark.prototype.Set_Text=function(a){this.m_sText=a};function CDrawingNavigator(a){function b(){if(d.m_bMouseLock)d.m_nHorScrollBlurTimerId=null;else{var a=parseFloat(d.HtmlElement.HorScroll.style.opacity),c=parseFloat(d.HtmlElement.HorScrollBG.style.opacity);a=Math.max(a-.01,0);c=Math.max(c-.01,0);d.HtmlElement.HorScroll.style.opacity=a;d.HtmlElement.HorScrollBG.style.opacity=c;d.m_nHorScrollBlurTimerId=.001<a?setTimeout(b,10):null}}function c(){if(d.m_bMouseLock)d.m_nHorScrollBlurTimerId=null;else{var a=parseFloat(d.HtmlElement.VerScroll.style.opacity),
b=parseFloat(d.HtmlElement.VerScrollBG.style.opacity);a=Math.max(a-.01,0);b=Math.max(b-.01,0);d.HtmlElement.VerScroll.style.opacity=a;d.HtmlElement.VerScrollBG.style.opacity=b;d.m_nVerScrollBlurTimerId=.001<a?setTimeout(c,10):null}}this.m_oDrawing=a;this.m_oGameTree=null;this.m_oMap=new CNavigatorMap;this.m_bNeedRedrawGameCurrent=this.m_bNeedRedrawMap=this.m_bNeedRedrawCurrent=!0;this.HtmlElement={Control:null,Board:{Control:null},Selection:{Control:null},Current:{Control:null},Lines:{Control:null},
Shadows:{Control:null},Nodes:{Control:null},Events:{Control:null},HorScroll:null,VerScroll:null,HorScrollBG:null,VerScrollBG:null,ScrollW:0,ScrollH:0};this.m_oCreateWoodyId=null;this.m_oImageData={W:0,H:0,Board:null,Black:null,White:null,BlackT:null,WhiteT:null,Hor_Start:null,Hor_Start2:null,Hor:null,Hor2:null,Hor_End:null,Ver:null,Ver2:null,Ver3:null,Hor_Start_T:null,Hor_Start2_T:null,Hor_Start2_T_2:null,Hor_Start2_T_3:null,Hor_T:null,Hor2_T:null,Hor2_T_2:null,Hor2_T_3:null,Hor_End_T:null,Ver_T:null,
Ver2_T:null,Ver2_T_2:null,Ver2_T_3:null,Ver3_T:null,Triangle:null,Triangle_T:null,Triangle_B:null,Triangle_W:null,Triangle_BT:null,Triangle_WT:null,Target:null,Current:null,GameCurrent:null,Shadow:null,ShadowOff:0};this.m_oOffset={X:0,Y:0};this.m_bMouseLock=!1;this.m_bNavigatorScroll=!0;this.m_oLastDrawMap={W:0,H:0,X:0,Y:0};this.m_nVerScrollBlurTimerId=this.m_nHorScrollBlurTimerId=this.m_nVerScrollTimerId=this.m_nHorScrollTimerId=null;var d=this;this.private_StartDrawingTimer=function(){return setTimeout(function(){d.private_CreateTrueColorBoard()},
20)};this.private_OnMouseDown=function(a){d.m_bMouseLock||(d.m_oGameTree&&d.m_oGameTree.Focus(),check_MouseDownEvent(a,!0),a=d.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y),a=d.m_oMap.Get(a.X,a.Y),a.Is_Node()&&d.m_oGameTree&&d.m_oGameTree.GoTo_Node(a))};this.private_OnMouseMove=function(a){d.m_bMouseLock||(check_MouseMoveEvent(a),a=d.private_UpdateMousePos(global_mouseEvent.X,global_mouseEvent.Y),d.private_UpdateTarget(a.X,a.Y))};this.private_OnMouseOut=function(a){d.m_bMouseLock||
d.private_UpdateTarget(-1,-1)};this.private_OnMouseWheel=function(a){if(d.m_bMouseLock)return!1;var b=void 0!=a.wheelDelta?0<a.wheelDelta?-45:45:0<a.detail?45:-45;a.preventDefault&&a.preventDefault();var e=d.m_oMap.Get_Height()+1,h=d.HtmlElement.Board.Control.HtmlElement.height;d.m_oOffset.Y-=b;d.m_oOffset.Y=Math.min(0,Math.max(d.m_oOffset.Y,-(20+24*e-h)));d.private_DrawMap();d.private_OnMouseMove(a);d.private_UpdateScrollsPos();d.private_ClearVerScrollBlurTimer();d.HtmlElement.VerScrollBG.style.opacity=
.3;d.HtmlElement.VerScroll.style.opacity=.5;d.m_nVerScrollBlurTimerId=setTimeout(c,500);return!1};this.private_OnFocus=function(){d.m_oGameTree&&d.m_oGameTree.Focus()};this.private_ClearHorScrollTimer=function(){null!==d.m_nHorScrollTimerId&&(clearTimeout(d.m_nHorScrollTimerId),d.m_nHorScrollTimerId=null)};this.private_ClearHorScrollBlurTimer=function(){null!==d.m_nHorScrollBlurTimerId&&(clearTimeout(d.m_nHorScrollBlurTimerId),d.m_nHorScrollBlurTimerId=null)};this.private_OnMouseDownHorScrollBG=function(a){function b(a){var c=
-d.m_oOffset.X;c!==l?(c=c<l?Math.min(l,c+200):Math.max(l,c-200),d.m_oOffset.X=-c,d.private_DrawMap(),d.private_UpdateScrollsPos(),d.m_nHorScrollTimerId=c!==l?setTimeout(b,!0===a?300:30):null):d.m_nHorScrollTimerId=null}d.private_ClearHorScrollTimer();check_MouseDownEvent(a,!0);a=Common_FindPosition(d.HtmlElement.HorScrollBG);a=global_mouseEvent.X-a.X;var c=d.m_oMap.Get_Width()+1,e=d.HtmlElement.ScrollW,k=d.m_oImageData.W-4;a=Math.max(0,Math.min(k-e,a-e/2));var l=a/(k-e)*(20+24*c-k);b(!0)};this.private_OnMouseUpHorScrollBG=
function(a){d.private_ClearHorScrollTimer()};this.private_OnMouseOverHorScrollBG=function(){d.private_ClearHorScrollBlurTimer();d.HtmlElement.HorScrollBG.style.opacity=.3;d.HtmlElement.HorScroll.style.opacity=.5};this.private_OnMouseOutHorScrollBG=function(){d.private_ClearHorScrollTimer();d.m_nHorScrollBlurTimerId=setTimeout(b,10)};this.private_ClearVerScrollTimer=function(){null!==d.m_nVerScrollTimerId&&(clearTimeout(d.m_nVerScrollTimerId),d.m_nVerScrollTimerId=null)};this.private_ClearVerScrollBlurTimer=
function(){null!==d.m_nVerScrollBlurTimerId&&(clearTimeout(d.m_nVerScrollBlurTimerId),d.m_nVerScrollBlurTimerId=null)};this.private_OnMouseDownVerScrollBG=function(a){function b(a){var c=-d.m_oOffset.Y;c!==l?(c=c<l?Math.min(l,c+48):Math.max(l,c-48),d.m_oOffset.Y=-c,d.private_DrawMap(),d.private_UpdateScrollsPos(),d.m_nVerScrollTimerId=c!==l?setTimeout(b,!0===a?300:30):null):d.m_nVerScrollTimerId=null}d.private_ClearVerScrollTimer();check_MouseDownEvent(a,!0);a=Common_FindPosition(d.HtmlElement.VerScrollBG);
a=global_mouseEvent.Y-a.Y;var c=d.m_oMap.Get_Height()+1,e=d.HtmlElement.ScrollH,k=d.m_oImageData.H-4;a=Math.max(0,Math.min(k-e,a-e/2));var l=a/(k-e)*(20+24*c-k);b(!0)};this.private_OnMouseUpVerScrollBG=function(a){d.private_ClearVerScrollTimer()};this.private_OnMouseOverVerScrollBG=function(){d.private_ClearVerScrollBlurTimer();d.HtmlElement.VerScrollBG.style.opacity=.3;d.HtmlElement.VerScroll.style.opacity=.5};this.private_OnMouseOutVerScrollBG=function(){d.private_ClearVerScrollTimer();d.m_nVerScrollBlurTimerId=
setTimeout(c,10)};this.private_OnMouseOverHorScroll=function(){d.private_ClearHorScrollBlurTimer();d.HtmlElement.HorScroll.style.opacity=.7;d.HtmlElement.HorScrollBG.style.opacity=.3};this.private_OnMouseOutHorScroll=function(){d.private_ClearHorScrollTimer();d.m_nHorScrollBlurTimerId=setTimeout(b,10)};this.private_OnMouseOverVerScroll=function(){d.private_ClearVerScrollBlurTimer();d.HtmlElement.VerScroll.style.opacity=.7;d.HtmlElement.VerScrollBG.style.opacity=.3};this.private_OnMouseOutVerScroll=
function(){d.HtmlElement.VerScroll.style.opacity=.5;d.m_nVerScrollBlurTimerId=setTimeout(c,10)};this.private_OnDragStartScroll=function(){d.m_bMouseLock=!0};this.private_OnDragEndScroll=function(){d.m_bMouseLock=!1;var a=global_mouseEvent.X,f=global_mouseEvent.Y,g=Common_FindPosition(d.HtmlElement.HorScrollBG),h=g.X;g=g.Y;var k=d.HtmlElement.HorScrollBG.clientWidth,l=d.HtmlElement.HorScrollBG.clientHeight;if(a<h||a>h+k||f<g||f>g+l)d.m_nHorScrollBlurTimerId=setTimeout(b,10);g=Common_FindPosition(d.HtmlElement.VerScrollBG);
h=g.X;g=g.Y;k=d.HtmlElement.VerScrollBG.clientWidth;l=d.HtmlElement.VerScrollBG.clientHeight;if(a<h||a>h+k||f<g||f>g+l)d.m_nVerScrollBlurTimerId=setTimeout(c,10)};this.private_OnDragHorScroll=function(a,b){a-=2;var c=d.m_oMap.Get_Width()+1,e=d.m_oImageData.W;d.m_oOffset.X=-(a/(e-4-d.HtmlElement.ScrollW)*(20+24*c-e));d.private_DrawMap()};this.private_OnDragVerScroll=function(a,b){b-=2;var c=d.m_oMap.Get_Height()+1,e=d.m_oImageData.H;d.m_oOffset.Y=-(b/(e-4-d.HtmlElement.ScrollH)*(20+24*c-e));d.private_DrawMap()}}
CDrawingNavigator.prototype.Init=function(a,b){this.m_oDrawing&&this.m_oDrawing.Register_Navigator(this);this.m_oGameTree=b;this.m_oGameTree.Set_DrawingNavigator(this);this.m_oMap.Set_GameTree(b);this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement,d=this.HtmlElement.Control,e=a+"_Board",f=a+"_Selection",g=a+"_Current",h=a+"_Lines",k=a+"_Shadows",l=a+"_Nodes",m=a+"_Events";this.private_CreateCanvasElement(c,e);this.private_CreateCanvasElement(c,f);this.private_CreateCanvasElement(c,
g);this.private_CreateCanvasElement(c,h);this.private_CreateCanvasElement(c,k);this.private_CreateCanvasElement(c,l);var n=this.private_CreateDivElement(c,m);this.HtmlElement.HorScrollBG=this.private_CreateDivElement(c,a+"HorScroll_BG");this.HtmlElement.HorScroll=this.private_CreateDivElement(c,a+"HorScroll");this.HtmlElement.VerScrollBG=this.private_CreateDivElement(c,a+"VerScroll_BG");this.HtmlElement.VerScroll=this.private_CreateDivElement(c,a+"VerScroll");this.HtmlElement.HorScrollBG.style.background=
"rgb(0,0,0)";this.HtmlElement.HorScrollBG.style.opacity="0";this.HtmlElement.VerScrollBG.style.background="rgb(0,0,0)";this.HtmlElement.VerScrollBG.style.opacity="0";this.HtmlElement.HorScrollBG.onmousedown=this.private_OnMouseDownHorScrollBG;this.HtmlElement.HorScrollBG.onmouseup=this.private_OnMouseUpHorScrollBG;this.HtmlElement.HorScrollBG.onmouseover=this.private_OnMouseOverHorScrollBG;this.HtmlElement.HorScrollBG.onmouseout=this.private_OnMouseOutHorScrollBG;this.HtmlElement.VerScrollBG.onmousedown=
this.private_OnMouseDownVerScrollBG;this.HtmlElement.VerScrollBG.onmouseup=this.private_OnMouseUpVerScrollBG;this.HtmlElement.VerScrollBG.onmouseover=this.private_OnMouseOverVerScrollBG;this.HtmlElement.VerScrollBG.onmouseout=this.private_OnMouseOutVerScrollBG;this.HtmlElement.HorScroll.onmouseover=this.private_OnMouseOverHorScroll;this.HtmlElement.HorScroll.onmouseout=this.private_OnMouseOutHorScroll;this.HtmlElement.VerScroll.onmouseover=this.private_OnMouseOverVerScroll;this.HtmlElement.VerScroll.onmouseout=
this.private_OnMouseOutVerScroll;c=CreateControlContainer(a+"HorScroll_BG");c.Bounds.SetParams(2,0,2,4,!0,!1,!0,!0,-1,8);c.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(c);c=CreateControlContainer(a+"VerScroll_BG");c.Bounds.SetParams(0,2,4,2,!1,!0,!0,!0,8,-1);c.Anchor=g_anchor_top|g_anchor_bottom|g_anchor_right;d.AddControl(c);this.private_FillHtmlElement(this.HtmlElement.Board,d,e);this.private_FillHtmlElement(this.HtmlElement.Selection,d,f);this.private_FillHtmlElement(this.HtmlElement.Current,
d,g);this.private_FillHtmlElement(this.HtmlElement.Lines,d,h);this.private_FillHtmlElement(this.HtmlElement.Shadows,d,k);this.private_FillHtmlElement(this.HtmlElement.Nodes,d,l);this.private_FillHtmlElement(this.HtmlElement.Events,d,m);n.onmousedown=this.private_OnMouseDown;n.onmousemove=this.private_OnMouseMove;n.onmouseout=this.private_OnMouseOut;n.onmousewheel=this.private_OnMouseWheel;n.addEventListener&&n.addEventListener("DOMMouseScroll",this.private_OnMouseWheel,!1);n.onfocus=this.private_OnFocus;
n.tabIndex=-1;n.style.hidefocus=!0;n.style.outline=0;this.private_CreateTrueColorStones();this.private_CreateLines();this.private_CreateTarget();this.private_CreateShadows()};CDrawingNavigator.prototype.Update_All=function(){this.private_CreateTrueColorStones();this.private_CreateLines();this.private_CreateTarget();this.private_CreateShadows();this.Update_Size(!0)};
CDrawingNavigator.prototype.Update_Size=function(a){var b=this.HtmlElement.Control.HtmlElement.clientWidth,c=this.HtmlElement.Control.HtmlElement.clientHeight;this.HtmlElement.Control.Resize(b,c);this.private_OnResize(b,c,a)};
CDrawingNavigator.prototype.Update=function(){if(!(0>=this.m_oImageData.W||0>=this.m_oImageData.H)){var a=this.m_oMap.Get_Width()+1,b=this.m_oMap.Get_Height()+1,c=this.m_oImageData.W,d=this.m_oImageData.H;a=20+24*a;b=20+24*b;a>c?(this.HtmlElement.ScrollW=Math.max(50,c*c/a),this.HtmlElement.HorScroll.style.width=Math.max(50,c*c/a)+"px",this.HtmlElement.HorScroll.style.display="block",this.HtmlElement.HorScroll.style.position="absolute",this.HtmlElement.HorScroll.style.top=d-12+"px",this.HtmlElement.HorScroll.style.height=
"8px",this.HtmlElement.HorScroll.style.background=this.private_GetSettings_DarkBoard()?"rgb(220, 220, 220)":"rgb(0,0,0)",this.HtmlElement.HorScroll.style.opacity=0,Common_DragHandler.Init(this.HtmlElement.HorScroll,null,2,c-this.HtmlElement.ScrollW-2,d-12,d-12),this.HtmlElement.HorScroll.onDrag=this.private_OnDragHorScroll,this.HtmlElement.HorScroll.onDragStart=this.private_OnDragStartScroll,this.HtmlElement.HorScroll.onDragEnd=this.private_OnDragEndScroll,this.HtmlElement.HorScrollBG.style.display=
"block"):(this.HtmlElement.HorScrollBG.style.display="none",this.HtmlElement.HorScroll.style.display="none");b>d?(this.HtmlElement.ScrollH=Math.max(50,d*d/b),this.HtmlElement.VerScroll.style.height=Math.max(50,d*d/b)+"px",this.HtmlElement.VerScroll.style.display="block",this.HtmlElement.VerScroll.style.position="absolute",this.HtmlElement.VerScroll.style.left=c-12+"px",this.HtmlElement.VerScroll.style.width="8px",this.HtmlElement.VerScroll.style.background=this.private_GetSettings_DarkBoard()?"rgb(220, 220, 220)":
"rgb(0,0,0)",this.HtmlElement.VerScroll.style.opacity=0,Common_DragHandler.Init(this.HtmlElement.VerScroll,null,c-12,c-12,2,d-this.HtmlElement.ScrollH-2),this.HtmlElement.VerScroll.onDrag=this.private_OnDragVerScroll,this.HtmlElement.VerScroll.onDragStart=this.private_OnDragStartScroll,this.HtmlElement.VerScroll.onDragEnd=this.private_OnDragEndScroll,this.HtmlElement.VerScrollBG.style.display="block"):(this.HtmlElement.VerScrollBG.style.display="none",this.HtmlElement.VerScroll.style.display="none");
this.m_oLastDrawMap.H=-1;this.m_oLastDrawMap.W=-1;this.private_DrawMap();this.private_UpdateScrollsPos()}};CDrawingNavigator.prototype.Create_FromGameTree=function(){this.m_oMap.Create_FromGameTree();this.m_oLastDrawMap.H=-1;this.m_oLastDrawMap.W=-1};
CDrawingNavigator.prototype.Update_Current=function(a){this.m_bNeedRedrawCurrent=!0;var b=this.m_oImageData.W,c=this.m_oImageData.H;if(!(0>=b||0>=c)){var d=this.m_oGameTree.Get_CurNode().Get_NavigatorInfo(),e=d.X;d=d.Y;var f=10+this.m_oOffset.X+24*e,g=10+this.m_oOffset.Y+24*d;if(0!=a&&!0===this.m_bNavigatorScroll&&(10>=f||f>=b-10||10>=g||g>=c-10)){a=20+24*(this.m_oMap.Get_Height()+1)-c;var h=this.m_oMap.Get_Width()+1;10>=f?this.m_oOffset.X=24*-e:f>=b-10&&(this.m_oOffset.X=b-24-10-10-24*e);10>=g?this.m_oOffset.Y=
24*-d:g>=c-10&&(this.m_oOffset.Y=c-24-10-10-24*d);this.m_oOffset.X=Math.min(0,Math.max(this.m_oOffset.X,-(20+24*h-b)));this.m_oOffset.Y=Math.min(0,Math.max(this.m_oOffset.Y,-a));this.private_UpdateScrollsPos();this.private_DrawMap()}}};CDrawingNavigator.prototype.Update_GameCurrent=function(){this.m_bNeedRedrawGameCurrent=!0};
CDrawingNavigator.prototype.Draw=function(){this.m_bNeedRedrawCurrent&&this.private_DrawCurrentOnTimer();this.m_bNeedRedrawMap&&this.private_DrawMapOnTimer();this.m_bNeedRedrawGameCurrent&&this.private_DrawGameCurrentOnTimer()};CDrawingNavigator.prototype.Need_Redraw=function(){return this.m_bNeedRedrawCurrent||this.m_bNeedRedrawMap?!0:!1};
CDrawingNavigator.prototype.private_CreateCanvasElement=function(a,b){var c=document.createElement("canvas");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CDrawingNavigator.prototype.private_CreateDivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};CDrawingNavigator.prototype.private_FillHtmlElement=function(a,b,c){a.Control=CreateControlContainer(c);a=a.Control;a.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;b.AddControl(a)};
CDrawingNavigator.prototype.private_OnResize=function(a,b,c){this.private_DrawBackground(a,b,c);this.Update();this.Update_Current(!0);this.Update_GameCurrent()};
CDrawingNavigator.prototype.private_DrawBackground=function(a,b,c){var d=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");a!==this.m_oImageData.W||b!==this.m_oImageData.H||null===this.m_oImageData.Board||null!==this.m_oCreateWoodyId||!0===c?(this.m_oImageData.W=a,this.m_oImageData.H=b,d.fillStyle=this.private_GetSettings_BoardColor().ToString(),d.fillRect(0,0,a,b),null!==this.m_oCreateWoodyId&&clearTimeout(this.m_oCreateWoodyId),this.m_oCreateWoodyId=this.private_StartDrawingTimer()):d.drawImage(this.m_oImageData.Board,
0,0)};
CDrawingNavigator.prototype.private_CreateTrueColorBoard=function(){this.m_oCreateWoodyId=null;var a=this.m_oImageData.W,b=this.m_oImageData.H,c=this.HtmlElement.Board.Control.HtmlElement.getContext("2d");if(0!==a&&0!==b){var d=c.createImageData(a,b),e=this.private_GetSettings_BoardColor(),f=e.r,g=e.g;e=e.b;for(var h=Array(a),k=0;k<a;k++)h[k]=(Math.tan(300*k/a)+1)/2+(Math.tan(100*k/a)+1)/10;for(var l=Array(b),m=0;m<b;m++)l[m]=.02*Math.tan(m/b);k=this.private_GetSettings_LinesColor();if(!0===this.private_GetSettings_TrueColorBoard())for(m=
0;m<b;m++)for(k=0;k<a;k++){var n=40*(h[k]+l[m])+.5;n-=Math.floor(n);n=.2>n?1-n/2:.4>n?1-(.4-n)/2:1;if(m==b-1||m==b-2&&k<a-2||k>=a-1||k==a-2&&m<b-1)n/=2;if(0==m||1==m&&1<k||0==k||1==k&&1<m){var p=128+f*n/2;var q=128+g*n/2;n=128+e*n/2}else p=f*n,q=g*n,n*=e;var t=4*(k+m*a);d.data[t+0]=p;d.data[t+1]=q;d.data[t+2]=n;d.data[t+3]=255}else for(h=0;h<b;h++)for(l=0;l<a;l++)0==h||0==l||h===b-1||l===a-1?(p=k.r,q=k.g,n=k.b):(p=f,q=g,n=e),t=4*(l+h*a),d.data[t+0]=p,d.data[t+1]=q,d.data[t+2]=n,d.data[t+3]=255;this.m_oImageData.Board=
this.private_CreateCanvas(a,b,d);c.drawImage(this.m_oImageData.Board,0,0)}};
CDrawingNavigator.prototype.private_CreateTrueColorStones=function(){var a=this.HtmlElement.Nodes.Control.HtmlElement.getContext("2d"),b=a.createImageData(20,20),c=a.createImageData(20,20),d=a.createImageData(20,20);a=a.createImageData(20,20);var e=b.data,f=c.data,g=d.data,h=a.data,k=this.private_GetSettings_WhiteColor(),l=this.private_GetSettings_BlackColor(),m=this.private_GetSettings_DarkBoard();if(!0===this.private_GetSettings_TrueColorStones()){var n=9.5,p=n-.2;k=Math.sqrt(3);for(var q=0;20>
q;q++)for(var t=0;20>t;t++){var r=q-n,A=t-n,y=p-Math.sqrt(r*r+A*A),w=4*(20*q+20-t-1);if(0<=y){var x=p*p-r*r-A*A;x=0<x?Math.sqrt(x)*k:0;m=r;var v=A;l=Math.sqrt(6*(m*m+v*v+x*x));l=(2*x-m+v)/l;m=0;.9<l&&(m=10*(l-.9));x=255;.8>=y&&(y=(.8-y)/.8,x=.7,r-A<p/3&&(x=1),x=parseInt(255*(1-y*x)));r=parseInt(10+10*l+140*m);e[w+0]=r;e[w+1]=r;e[w+2]=r;e[w+3]=x;g[w+0]=r;g[w+1]=r;g[w+2]=r;g[w+3]=parseInt(.5*x);r=parseInt(200+10*l+45*m);f[w+0]=r;f[w+1]=r;f[w+2]=r;f[w+3]=x;h[w+0]=r;h[w+1]=r;h[w+2]=r;h[w+3]=parseInt(.7*
x)}else e[w+0]=0,e[w+1]=0,e[w+2]=0,e[w+3]=0,h[w+0]=0,h[w+1]=0,h[w+2]=0,h[w+3]=0}}else for(n=9.5,p=n-.2,q=0;20>q;q++)for(t=0;20>t;t++)if(r=q-n,A=t-n,y=p-Math.sqrt(r*r+A*A),w=4*(20*q+20-t-1),0<=y){x=255;if(.8>=y){var B=(.8-y)/.8;x=.7;r-A<p/3&&(x=1);x=parseInt(255*(1-B*x))}else 1.6>=y&&.8<=y&&!0===m&&(B=(1.6-y)/.8,x=.7,r-A<p/3&&(x=1),x=parseInt(B*x*255));v=!1;1.6>=y&&(v=!0);!1===v||!1===m?(e[w+0]=l.r,e[w+1]=l.g,e[w+2]=l.b,e[w+3]=x,g[w+0]=l.r,g[w+1]=l.g,g[w+2]=l.b):(e[w+0]=k.r,e[w+1]=k.g,e[w+2]=k.b,e[w+
3]=x,g[w+0]=k.r,g[w+1]=k.g,g[w+2]=k.b);g[w+3]=parseInt(.5*x);x=255;.8>=y?(B=(.8-y)/.8,x=.7,r-A<p/3&&(x=1),x=parseInt(255*(1-B*x))):1.6>=y&&.8<=y&&!1===m&&(B=(1.6-y)/.8,x=.7,r-A<p/3&&(x=1),x=parseInt(B*x*255));!1===v||!0===m?(f[w+0]=k.r,f[w+1]=k.g,f[w+2]=k.b,f[w+3]=x,h[w+0]=k.r,h[w+1]=k.g,h[w+2]=k.b):(f[w+0]=l.r,f[w+1]=l.g,f[w+2]=l.b,f[w+3]=x,h[w+0]=l.r,h[w+1]=l.g,h[w+2]=l.b);h[w+3]=parseInt(x/2)}else e[w+0]=0,e[w+1]=0,e[w+2]=0,e[w+3]=0,g[w+0]=0,g[w+1]=0,g[w+2]=0,g[w+3]=0,f[w+0]=0,f[w+1]=0,f[w+2]=
0,f[w+3]=0,h[w+0]=0,h[w+1]=0,h[w+2]=0,h[w+3]=0;this.m_oImageData.Black=this.private_CreateCanvas(20,20,b);this.m_oImageData.White=this.private_CreateCanvas(20,20,c);this.m_oImageData.BlackT=this.private_CreateCanvas(20,20,d);this.m_oImageData.WhiteT=this.private_CreateCanvas(20,20,a)};
CDrawingNavigator.prototype.private_CreateLines=function(){var a=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),b=a.createImageData(24,24),c=a.createImageData(24,24),d=a.createImageData(24,24),e=a.createImageData(24,24),f=a.createImageData(24,24),g=a.createImageData(24,24),h=a.createImageData(24,24),k=a.createImageData(24,24),l=a.createImageData(24,24),m=a.createImageData(24,24),n=a.createImageData(24,24),p=a.createImageData(24,24),q=a.createImageData(24,24),t=a.createImageData(24,24),
r=a.createImageData(24,24),A=a.createImageData(24,24),y=a.createImageData(24,24),w=a.createImageData(24,24),x=a.createImageData(24,24),v=a.createImageData(24,24),B=a.createImageData(24,24);a=a.createImageData(24,24);for(var L=b.data,E=c.data,H=d.data,I=e.data,D=f.data,C=g.data,K=h.data,S=k.data,J=l.data,M=m.data,N=n.data,V=p.data,W=q.data,O=t.data,R=r.data,T=A.data,Z=y.data,aa=w.data,P=x.data,Q=v.data,ba=B.data,ca=a.data,U=!0===this.private_GetSettings_DarkBoard()?200:28,z=new CColor(U,U,U,255),F=
0;24>F;F++)for(var G=0;24>G;G++){var u=4*(24*F+G);12<=G&&(11===F||12===F)?(L[u+0]=z.r,L[u+1]=z.b,L[u+2]=z.g,L[u+3]=255,J[u+0]=z.r,J[u+1]=z.b,J[u+2]=z.g,J[u+3]=96):(L[u+3]=0,J[u+3]=0);11<=G&&(11===F||12===F)||12<=F&&(11===G||12===G)?(E[u+0]=z.r,E[u+1]=z.b,E[u+2]=z.g,E[u+3]=255,V[u+0]=z.r,V[u+1]=z.b,V[u+2]=z.g,V[u+3]=96):(E[u+3]=0,V[u+3]=0);11<=G&&(11===F||12===F)?(M[u+0]=z.r,M[u+1]=z.b,M[u+2]=z.g,M[u+3]=255):12<=F&&(11===G||12===G)?(M[u+0]=z.r,M[u+1]=z.b,M[u+2]=z.g,M[u+3]=96):M[u+3]=0;12<=F&&(11===
G||12===G)?(N[u+0]=z.r,N[u+1]=z.b,N[u+2]=z.g,N[u+3]=255):11<=G&&(11===F||12===F)?(N[u+0]=z.r,N[u+1]=z.b,N[u+2]=z.g,N[u+3]=96):N[u+3]=0;11===F||12===F?(H[u+0]=z.r,H[u+1]=z.b,H[u+2]=z.g,H[u+3]=255,W[u+0]=z.r,W[u+1]=z.b,W[u+2]=z.g,W[u+3]=96):(H[u+3]=0,W[u+3]=0);11===F||12===F||12<=F&&(11===G||12===G)?(I[u+0]=z.r,I[u+1]=z.b,I[u+2]=z.g,I[u+3]=255,T[u+0]=z.r,T[u+1]=z.b,T[u+2]=z.g,T[u+3]=96):(I[u+3]=0,T[u+3]=0);11===F||12===F?(O[u+0]=z.r,O[u+1]=z.b,O[u+2]=z.g,O[u+3]=255):12<=F&&(11===G||12===G)?(O[u+0]=
z.r,O[u+1]=z.b,O[u+2]=z.g,O[u+3]=96):O[u+3]=0;(11===F||12===F)&&12>=G||12<=F&&(11===G||12===G)?(R[u+0]=z.r,R[u+1]=z.b,R[u+2]=z.g,R[u+3]=255):(11===F||12===F)&&12<G?(R[u+0]=z.r,R[u+1]=z.b,R[u+2]=z.g,R[u+3]=96):(I[u+3]=0,T[u+3]=0);11>=G&&(11===F||12===F)?(D[u+0]=z.r,D[u+1]=z.b,D[u+2]=z.g,D[u+3]=255,Z[u+0]=z.r,Z[u+1]=z.b,Z[u+2]=z.g,Z[u+3]=96):(D[u+3]=0,Z[u+3]=0);11===G||12===G?(C[u+0]=z.r,C[u+1]=z.b,C[u+2]=z.g,C[u+3]=255,aa[u+0]=z.r,aa[u+1]=z.b,aa[u+2]=z.g,aa[u+3]=96):(C[u+3]=0,aa[u+3]=0);11===G||12===
G||12<=G&&(11===F||12===F)?(K[u+0]=z.r,K[u+1]=z.b,K[u+2]=z.g,K[u+3]=255,ba[u+0]=z.r,ba[u+1]=z.b,ba[u+2]=z.g,ba[u+3]=96):(K[u+3]=0,ba[u+3]=0);(11===G||12===G)&&12>=F||12<=G&&(11===F||12===F)?(P[u+0]=z.r,P[u+1]=z.b,P[u+2]=z.g,P[u+3]=255):(11===G||12===G)&&12<F?(P[u+0]=z.r,P[u+1]=z.b,P[u+2]=z.g,P[u+3]=96):P[u+3]=0;11===G||12===G?(Q[u+0]=z.r,Q[u+1]=z.b,Q[u+2]=z.g,Q[u+3]=255):12<G&&(11===F||12===F)?(Q[u+0]=z.r,Q[u+1]=z.b,Q[u+2]=z.g,Q[u+3]=96):Q[u+3]=0;11>=F&&(11===G||12===G)||11<=G&&(11===F||12===F)?(S[u+
0]=z.r,S[u+1]=z.b,S[u+2]=z.g,S[u+3]=255,ca[u+0]=z.r,ca[u+1]=z.b,ca[u+2]=z.g,ca[u+3]=96):(S[u+3]=0,ca[u+3]=0)}this.m_oImageData.Hor_Start=this.private_CreateCanvas(24,24,b);this.m_oImageData.Hor_Start2=this.private_CreateCanvas(24,24,c);this.m_oImageData.Hor=this.private_CreateCanvas(24,24,d);this.m_oImageData.Hor2=this.private_CreateCanvas(24,24,e);this.m_oImageData.Hor_End=this.private_CreateCanvas(24,24,f);this.m_oImageData.Ver=this.private_CreateCanvas(24,24,g);this.m_oImageData.Ver2=this.private_CreateCanvas(24,
24,h);this.m_oImageData.Ver3=this.private_CreateCanvas(24,24,k);this.m_oImageData.Hor_Start_T=this.private_CreateCanvas(24,24,l);this.m_oImageData.Hor_Start2_T=this.private_CreateCanvas(24,24,m);this.m_oImageData.Hor_Start2_T_2=this.private_CreateCanvas(24,24,n);this.m_oImageData.Hor_Start2_T_3=this.private_CreateCanvas(24,24,p);this.m_oImageData.Hor_T=this.private_CreateCanvas(24,24,q);this.m_oImageData.Hor2_T=this.private_CreateCanvas(24,24,t);this.m_oImageData.Hor2_T_2=this.private_CreateCanvas(24,
24,r);this.m_oImageData.Hor2_T_3=this.private_CreateCanvas(24,24,A);this.m_oImageData.Hor_End_T=this.private_CreateCanvas(24,24,y);this.m_oImageData.Ver_T=this.private_CreateCanvas(24,24,w);this.m_oImageData.Ver2_T=this.private_CreateCanvas(24,24,x);this.m_oImageData.Ver2_T_2=this.private_CreateCanvas(24,24,v);this.m_oImageData.Ver2_T_3=this.private_CreateCanvas(24,24,B);this.m_oImageData.Ver3_T=this.private_CreateCanvas(24,24,a);this.m_oImageData.Triangle=this.private_DrawTriangle(20,20,20*.07,z,
1,null);this.m_oImageData.Triangle_T=this.private_DrawTriangle(20,20,20*.07,new CColor(U,U,U,96),1,null);this.m_oImageData.Triangle_B=this.private_DrawTriangle(20,20,1.2,new CColor(255,255,255,255),1,this.m_oImageData.Black);this.m_oImageData.Triangle_W=this.private_DrawTriangle(20,20,1.2,new CColor(0,0,0,255),1,this.m_oImageData.White);this.m_oImageData.Triangle_BT=this.private_DrawTriangle(20,20,1.2,new CColor(255,255,255,96),1,this.m_oImageData.BlackT);this.m_oImageData.Triangle_WT=this.private_DrawTriangle(20,
20,1.2,new CColor(0,0,0,96),1,this.m_oImageData.WhiteT)};
CDrawingNavigator.prototype.private_CreateTarget=function(){for(var a=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d"),b=a.createImageData(24,24),c=a.createImageData(24,24),d=a.createImageData(24,24),e=b.data,f=c.data,g=d.data,h=0;24>h;h++)for(var k=0;24>k;k++){var l=4*(k+24*h);e[l+3]=255;f[l+3]=255;g[l+3]=255;0===k&&23===h||23===k&&0===h?(e[l+0]=135,e[l+1]=125,e[l+2]=135,f[l+0]=216,f[l+1]=0,f[l+2]=0,g[l+0]=216/255*42|0,g[l+1]=216/255*117|0,g[l+2]=216/255*243|0):23===k||23===h?(e[l+
0]=89,e[l+1]=89,e[l+2]=89,f[l+0]=178,f[l+1]=0,f[l+2]=0,g[l+0]=178/255*42|0,g[l+1]=178/255*117|0,g[l+2]=178/255*243|0):(0===h||0===k?(e[l+0]=182,e[l+1]=182,e[l+2]=182):(e[l+0]=128,e[l+1]=128,e[l+2]=128),f[l+0]=255,f[l+1]=0,f[l+2]=0,g[l+0]=42,g[l+1]=117,g[l+2]=243)}this.m_oImageData.Target=this.private_CreateCanvas(24,24,b);this.m_oImageData.Current=this.private_CreateCanvas(24,24,c);this.m_oImageData.GameCurrent=this.private_CreateCanvas(24,24,d);a.drawImage(this.m_oImageData.Target,0,0);a.drawImage(this.m_oImageData.Current,
0,30);a.drawImage(this.m_oImageData.GameCurrent,0,60)};
CDrawingNavigator.prototype.private_DrawTriangle=function(a,b,c,d,e,f){void 0===e&&(e=1);var g=document.createElement("canvas"),h=g.getContext("2d");h.clearRect(0,0,a,b);null!==f&&h.drawImage(f,0,0);h.globalAlpha=e;h.strokeStyle=d.ToString();h.fillStyle=d.ToString();h.lineWidth=c;d=a/2;c=3*b/4;e=.1*a;b=Math.sqrt(d*d-(c-d)*(c-d))+d-e;d=-Math.sqrt(d*d-(c-d)*(c-d))+d+e;null!==f&&(b=Math.floor(b-.5),d=Math.ceil(d+.5),e=Math.ceil(e+.5),c=Math.floor(c-.5));h.beginPath();h.moveTo(a/2,e);h.lineTo(b,c);h.lineTo(d,
c);h.closePath();h.stroke();return g};CDrawingNavigator.prototype.private_CreateShadows=function(){var a=this.HtmlElement.Shadows.Control.HtmlElement.getContext("2d").createImageData(20,20),b=a.data;this.m_oImageData.ShadowOff=Math.max(3,3);for(var c=0;20>c;c++)for(var d=0;20>d;d++){var e=Math.abs(c-8.5),f=Math.abs(d-8.5);e=Math.sqrt(f*f+e*e)/8.5;e=1>e?.15+.75*(1-e):0;f=4*(20*c+d);b[f+0]=0;b[f+1]=0;b[f+2]=0;b[f+3]=parseInt(255*e)}this.m_oImageData.Shadow=this.private_CreateCanvas(20,20,a)};
CDrawingNavigator.prototype.private_DrawMap=function(){this.m_bNeedRedrawMap=!0;this.Update_Current(!1)};CDrawingNavigator.prototype.private_UpdateMousePos=function(a,b){var c=Common_FindPosition(this.HtmlElement.Board.Control.HtmlElement);return{X:(a-c.X-10-this.m_oOffset.X)/24|0,Y:(b-c.Y-10-this.m_oOffset.Y)/24|0}};
CDrawingNavigator.prototype.private_UpdateTarget=function(a,b){var c=this.m_oImageData.W,d=this.m_oImageData.H;if(!(0>=c||0>=d)){var e=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d");e.clearRect(0,0,c,d);0<=a&&0<=b&&(c=10+this.m_oOffset.X+24*a,d=10+this.m_oOffset.Y+24*b,this.m_oMap.Get(a,b).Is_Node()&&e.drawImage(this.m_oImageData.Target,c,d))}};
CDrawingNavigator.prototype.private_UpdateScrollsPos=function(){var a=-this.m_oOffset.X,b=this.m_oMap.Get_Width()+1,c=this.m_oImageData.W;a=a/(20+24*b-c)*(c-4-this.HtmlElement.ScrollW)+2;b=-this.m_oOffset.Y;c=this.m_oMap.Get_Height()+1;var d=this.HtmlElement.ScrollH,e=this.m_oImageData.H;this.HtmlElement.HorScroll.style.left=a+"px";this.HtmlElement.VerScroll.style.top=b/(20+24*c-e)*(e-4-d)+2+"px"};
CDrawingNavigator.prototype.private_DrawMapOnTimer=function(){var a=this.m_oImageData.W,b=this.m_oImageData.H;if(0!==a&&0!==b){if(!(this.m_oLastDrawMap.W===a&&this.m_oLastDrawMap.H===b&&1>Math.abs(this.m_oOffset.X-this.m_oLastDrawMap.X)&&1>Math.abs(this.m_oOffset.Y-this.m_oLastDrawMap.Y))){this.m_oLastDrawMap.W=a;this.m_oLastDrawMap.H=b;this.m_oLastDrawMap.X=this.m_oOffset.X;this.m_oLastDrawMap.Y=this.m_oOffset.Y;var c=this.HtmlElement.Lines.Control.HtmlElement.getContext("2d"),d=this.HtmlElement.Shadows.Control.HtmlElement.getContext("2d"),
e=this.HtmlElement.Nodes.Control.HtmlElement.getContext("2d"),f=this.HtmlElement.Selection.Control.HtmlElement.getContext("2d");e.clearRect(0,0,a,b);d.clearRect(0,0,a,b);c.clearRect(0,0,a,b);f.clearRect(0,0,a,b);f=10+this.m_oOffset.X;for(var g=10+this.m_oOffset.Y,h=this.m_oMap.Get_Height(),k=this.private_GetSettings_Shadows(),l=0;l<=h-1;l++){var m=g+24*l;if(-24<=m&&m<=b+24)for(var n=this.m_oMap.Get_LineWidth(l),p=0;p<=n;p++){var q=f+24*p;if(-24<=q&&q<=a+24){var t=this.m_oMap.Get(p,l);if(!1===t.Is_Node()){var r=
t.Get_Type();t=t.Is_OnCurrentVariant();c.clearRect(q,m,24,24);switch(r){case ENavigatorElementType.Line_Ver:t.bResult?c.drawImage(this.m_oImageData.Ver,q,m):c.drawImage(this.m_oImageData.Ver_T,q,m);break;case ENavigatorElementType.Line_Ver_Con:t.bResult?1===t.Temp?c.drawImage(this.m_oImageData.Ver2_T,q,m):c.drawImage(this.m_oImageData.Ver2_T_2,q,m):c.drawImage(this.m_oImageData.Ver2_T_3,q,m);break;case ENavigatorElementType.Line_Ver_End:t.bResult?c.drawImage(this.m_oImageData.Ver3,q,m):c.drawImage(this.m_oImageData.Ver3_T,
q,m)}}else{r=t.Is_OnCurrentVariant();var A=t.Get_Move(),y=A.Get_Type(),w=t.Get_Comment(),x="",v=0;switch(g_oGlobalSettings.Get_NavigatorLabel()){case ESettingsNavigatorLabels.Empty:x="";break;case ESettingsNavigatorLabels.MoveNumbers:x=""+t.Get_NavigatorInfo().Num;2>=x.length?e.font="bold 10px sans-serif":(e.font="bold 9px sans-serif",v=-1);break;case ESettingsNavigatorLabels.MoveNumbersCurrentVariant:x=r?""+t.Get_NavigatorInfo().Num:"";2>=x.length?e.font="bold 10px sans-serif":(e.font="bold 9px sans-serif",
v=-1);break;case ESettingsNavigatorLabels.MoveCoordinates:x=this.m_oGameTree.Get_Board().Get_Size(),x=Common_PosValueToString(A.Get_Value(),x.X,x.Y),e.font=2>=x.length?"bold 10px sans-serif":"bold 8px sans-serif"}A=e.measureText(x).width;BOARD_BLACK===y?(r&&!0===k&&(d.clearRect(q+this.m_oImageData.ShadowOff,m+this.m_oImageData.ShadowOff,24,24),d.drawImage(this.m_oImageData.Shadow,q+2+this.m_oImageData.ShadowOff,m+2+this.m_oImageData.ShadowOff)),e.clearRect(q,m,24,24),e.drawImage(r?this.m_oImageData.Black:
this.m_oImageData.BlackT,q+2,m+2),""===w?""!==x&&(e.fillStyle=r?"#CCC":"rgb(192, 192, 192)",e.fillText(x,q+12-A/2+v,m+12+3)):e.drawImage(r?this.m_oImageData.Triangle_B:this.m_oImageData.Triangle_BT,q+2,m+2)):BOARD_WHITE===y?(r&&!0===k&&(d.clearRect(q+this.m_oImageData.ShadowOff,m+this.m_oImageData.ShadowOff,24,24),d.drawImage(this.m_oImageData.Shadow,q+2+this.m_oImageData.ShadowOff,m+2+this.m_oImageData.ShadowOff)),e.clearRect(q,m,24,24),e.drawImage(r?this.m_oImageData.White:this.m_oImageData.WhiteT,
q+2,m+2),""===w?""!==x&&(e.fillStyle=r?"#000":"rgb(56, 56, 56)",e.fillText(x,q+12-A/2+v,m+12+3)):e.drawImage(r?this.m_oImageData.Triangle_W:this.m_oImageData.Triangle_WT,q+2,m+2)):(e.clearRect(q,m,24,24),e.drawImage(r?this.m_oImageData.Triangle:this.m_oImageData.Triangle_T,q+2,m+2));w=t.Get_NextsCount();t=t.Get_NextCur();c.clearRect(q,m,24,24);0===p?0!==w&&(1===w?r?c.drawImage(this.m_oImageData.Hor_Start,q,m):c.drawImage(this.m_oImageData.Hor_Start_T,q,m):r?0==t?c.drawImage(this.m_oImageData.Hor_Start2_T,
q,m):c.drawImage(this.m_oImageData.Hor_Start2_T_2,q,m):c.drawImage(this.m_oImageData.Hor_Start2_T_3,q,m)):0===w?r?c.drawImage(this.m_oImageData.Hor_End,q,m):c.drawImage(this.m_oImageData.Hor_End_T,q,m):1===w?r?c.drawImage(this.m_oImageData.Hor,q,m):c.drawImage(this.m_oImageData.Hor_T,q,m):r?0===t?c.drawImage(this.m_oImageData.Hor2_T,q,m):c.drawImage(this.m_oImageData.Hor2_T_2,q,m):c.drawImage(this.m_oImageData.Hor2_T_3,q,m);BOARD_BLACK!==y&&BOARD_WHITE!==y||c.clearRect(q+3,m+3,18,18)}}}}}this.m_bNeedRedrawMap=
!1}};
CDrawingNavigator.prototype.private_DrawCurrentOnTimer=function(){if(this.m_oGameTree){var a=this.m_oImageData.W,b=this.m_oImageData.H;if(!(0>=a||0>=b)){var c=this.m_oGameTree.Get_CurNode().Get_NavigatorInfo(),d=10+this.m_oOffset.X+24*c.X;c=10+this.m_oOffset.Y+24*c.Y;var e=this.HtmlElement.Current.Control.HtmlElement.getContext("2d");e.clearRect(0,0,a,b);-24<=d&&d<=a+24&&-24<=c&&c<=b+24&&e.drawImage(this.m_oImageData.Current,d,c);this.private_DrawGameCurrentOnTimer();this.m_bNeedRedrawCurrent=!1}}};
CDrawingNavigator.prototype.private_DrawGameCurrentOnTimer=function(){if(this.m_oGameTree){var a=this.m_oImageData.W,b=this.m_oImageData.H;if(!(0>=a||0>=b)){this.m_bNeedRedrawGameCurrent=!1;var c=this.m_oGameTree.Get_CurNode(),d=this.m_oGameTree.Get_GameCurNode();if(null!==d&&d!==c){d=d.Get_NavigatorInfo();c=10+this.m_oOffset.X+24*d.X;d=10+this.m_oOffset.Y+24*d.Y;var e=this.HtmlElement.Current.Control.HtmlElement.getContext("2d");-24<=c&&c<=a+24&&-24<=d&&d<=b+24&&e.drawImage(this.m_oImageData.GameCurrent,
c,d)}}}};CDrawingNavigator.prototype.private_GetSettings_TrueColorBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorTrueColorBoard()};CDrawingNavigator.prototype.private_GetSettings_TrueColorStones=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorTrueColorStones()};CDrawingNavigator.prototype.private_GetSettings_Shadows=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorShadows()};CDrawingNavigator.prototype.private_GetSettings_WhiteColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorWhiteColor()};
CDrawingNavigator.prototype.private_GetSettings_BlackColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorBlackColor()};CDrawingNavigator.prototype.private_GetSettings_BoardColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorBoardColor()};CDrawingNavigator.prototype.private_GetSettings_LinesColor=function(){return this.m_oGameTree.Get_LocalSettings().Get_NavigatorLinesColor()};CDrawingNavigator.prototype.private_GetSettings_DarkBoard=function(){return this.m_oGameTree.Get_LocalSettings().Is_NavigatorDarkBoard()};
CDrawingNavigator.prototype.private_CreateCanvas=function(a,b,c){var d=document.createElement("canvas");d.width=a;d.height=b;d.getContext("2d").putImageData(c,0,0);return d};var ENavigatorElementType={Empty:-10,Line_Ver:-9,Line_Ver_Con:-8,Line_Ver_End:-7};function CNavigatorElement(a,b,c){this.m_nType=a;this.m_oPrev=b;this.m_oNext=c}CNavigatorElement.prototype.Is_Node=function(){return!1};CNavigatorElement.prototype.Get_Type=function(){return this.m_nType};CNavigatorElement.prototype.Get_Next=function(){return this.m_oNext};CNavigatorElement.prototype.Get_Prev=function(){return this.m_oPrev};
CNavigatorElement.prototype.Is_OnCurrentVariant=function(){if(ENavigatorElementType.Empty!==this.m_nType)if(ENavigatorElementType.Line_Ver===this.m_nType){if(this.m_oPrev.Is_OnCurrentVariant()&&0<this.m_oPrev.Get_NextsCount()&&this.m_oPrev.Get_Next().Get_NavigatorInfo().Y>=this.m_oNext.Get_NavigatorInfo().Y)return{bResult:!0}}else if(ENavigatorElementType.Line_Ver_Con===this.m_nType){if(!this.m_oPrev.Is_OnCurrentVariant())return{bResult:!1};var a=this.m_oNext.Get_NavigatorInfo().Y,b=this.m_oPrev.Get_Next().Get_NavigatorInfo().Y;
if(a<b)return{bResult:!0,Temp:0};if(a===b)return{bResult:!0,Temp:1}}else if(ENavigatorElementType.Line_Ver_End===this.m_nType)return{bResult:this.m_oNext.Is_OnCurrentVariant()};return{bResult:!1}};function CNavigatorMap(){this.m_oMap=[];this.m_oGameTree=null;this.m_nMove=0}CNavigatorMap.prototype.Set_GameTree=function(a){this.m_oGameTree=a};CNavigatorMap.prototype.Clear=function(){this.m_oMap=[];this.m_nMove=0};
CNavigatorMap.prototype.Create_FromGameTree=function(){this.m_oGameTree&&(this.Clear(),this.Create_FromCurNode(this.m_oGameTree.Get_FirstNode(),0,0))};
CNavigatorMap.prototype.Create_FromCurNode=function(a,b,c){for(var d=a.Get_MainVariantLen();!this.private_CheckNodeMainVariant(b,c,d);)c++;this.private_FillNodeMainVariant(a,b,c);var e=a.Get_LastNodeInMainVariant();b+=d-1;for(d={VY:c};;){for(var f=c,g=this.m_nMove,h=e.Get_NextsCount(),k=1;k<h;k++){this.m_nMove=g;var l=c,m=this.Create_FromCurNode(e.Get_Next(k),b+1,c+1);c=m.Y;for(l+=1;l<=c;l++)if(l===m.VY)if(h-1===k){this.Set(b,l,new CNavigatorElement(ENavigatorElementType.Line_Ver_End,e,e.Get_Next(k)));
break}else this.Set(b,l,new CNavigatorElement(ENavigatorElementType.Line_Ver_Con,e,e.Get_Next(k)));else l<m.VY?this.Set(b,l,new CNavigatorElement(ENavigatorElementType.Line_Ver,e,e.Get_Next(k))):this.Set(b,l,new CNavigatorElement(ENavigatorElementType.Line_Ver,e,e.Get_Next(k+1)))}this.m_nMove=g;if(e===a)break;e.Have_Move()&&this.m_nMove--;e=e.Get_Prev();b--;c=f}d.Y=c;return d};
CNavigatorMap.prototype.Get=function(a,b){return void 0===this.m_oMap[b]||void 0===this.m_oMap[b][a]?new CNavigatorElement(ENavigatorElementType.Empty,null,null):this.m_oMap[b][a]};CNavigatorMap.prototype.Set=function(a,b,c){void 0===this.m_oMap[b]&&(this.m_oMap[b]=[]);c.Is_Node()&&(c.Have_Move()?(this.m_nMove++,c.Set_NavigatorInfo(a,b,this.m_nMove)):c.Set_NavigatorInfo(a,b,-1));this.m_oMap[b][a]=c};
CNavigatorMap.prototype.Is_Empty=function(a,b){return void 0===this.m_oMap[b]||void 0===this.m_oMap[b][a]||ENavigatorElementType.Empty===this.m_oMap[b][a].Get_Type()?!0:!1};CNavigatorMap.prototype.private_CheckNodeMainVariant=function(a,b,c){for(var d=0;d<c;d++)if(!1===this.Is_Empty(a+d,b))return!1;return!0};CNavigatorMap.prototype.private_FillNodeMainVariant=function(a,b,c){var d=a;for(this.Set(b,c,a);0<d.Get_NextsCount();)b++,d=d.Get_Next(0),this.Set(b,c,d)};CNavigatorMap.prototype.Get_Height=function(){return this.m_oMap.length};
CNavigatorMap.prototype.Get_Width=function(){for(var a=0,b=this.Get_Height(),c=0;c<b;c++){var d=this.Get_LineWidth(c);d>a&&(a=d)}return a};CNavigatorMap.prototype.Get_LineWidth=function(a){return this.m_oMap[a].length-1};var ESlideState={Message:0,Sgf:1};function CPresentation(a){(this.m_oGameTree=a)&&a.Set_Drawing(this);this.m_oControl=null;this.m_aElements=[];this.HtmlElement={MessageElement:null,TextElement:null,PrevButton:null,NextButton:null,NextSgf:null,PrevSgf:null,BoardDisabler:null};this.m_nSlideState=this.m_nSlidesCount=this.m_nCurSlide=0}
CPresentation.prototype.Init=function(a,b){this.private_LoadSlides(b);var c=this.m_oGameTree,d=CreateControlContainer(a),e=a+"_Board",f=a+"_Message",g=a+"_Next";this.private_CreateDiv(d.HtmlElement,e);var h=this.private_CreateDiv(d.HtmlElement,g),k=this.private_CreateDiv(d.HtmlElement,f);k.style.backgroundColor="rgb(255,255,255)";k.style["border-radius"]="6px";k.style["-webkit-border-radius"]="6px";k.style["-moz-border-radius"]="5px";k.style["-khtml-border-radius"]="10px";k.style.borderColor="#e3e3e3";
k.style.borderWidth="5px";k.style.borderStyle="ridge";k.style.display="block";var l=CreateControlContainer(e);l.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);l.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;d.AddControl(l);this.private_CreateDiv(l.HtmlElement,e+"_Centred");var m=CreateControlContainer(e);l.Set_Type(2);l.AddControl(m);l=CreateControlContainer(f);l.Bounds.SetParams(350,350,650,650,!1,!1,!1,!1,-1,-1);l.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;
d.AddControl(l);m=new CDrawingBoard(this);m.Init(e,c);m.Set_Presentation(this);var n=CreateControlContainer(g);n.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);n.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;d.AddControl(n);c=g+"_Centred";this.private_CreateDiv(n.HtmlElement,c);e=CreateControlContainer(c);n.Set_Type(2);n.AddControl(e);n=c+"_Next";g=this.private_CreateButton(e.HtmlElement,n);g.value="\u0414\u0430\u043b\u0435\u0435";g.style.display="none";var p=c+"_Prev";c=this.private_CreateButton(e.HtmlElement,
p);c.value="\u041d\u0430\u0437\u0430\u0434";c.style.display="none";var q=this;g.addEventListener("click",function(){q.HtmlElement.NextSgf.style.display="none";q.HtmlElement.PrevSgf.style.display="none";q.private_NextStep()},!1);c.addEventListener("click",function(){q.HtmlElement.NextSgf.style.display="none";q.HtmlElement.PrevSgf.style.display="none";q.private_PrevStep()},!1);n=CreateControlContainer(n);n.Bounds.SetParams(501,0,2,2,!1,!1,!0,!0,-1,25);n.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom;
e.AddControl(n);n=CreateControlContainer(p);n.Bounds.SetParams(2,0,499,2,!0,!1,!1,!0,-1,25);n.Anchor=g_anchor_left|g_anchor_right|g_anchor_bottom;e.AddControl(n);var t=f+"_Text";p=f+"_Next";var r=f+"_Prev";f=this.private_CreateDiv(k,t);f.style.fontFamily="verdana";f.style.textAlign="justify";f.style.alignItems="center";f.style.overflowY="scroll";e=this.private_CreateButton(k,p);n=this.private_CreateButton(k,r);n.addEventListener("click",function(){q.private_PrevStep()},!1);e.addEventListener("click",
function(){q.private_NextStep()},!1);t=CreateControlContainer(t);t.Bounds.SetParams(0,0,1E3,35,!1,!1,!1,!0,-1,-1);t.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;l.AddControl(t);p=CreateControlContainer(p);p.Bounds.SetParams(0,0,5,5,!1,!1,!0,!0,100,25);p.Anchor=g_anchor_bottom|g_anchor_right;l.AddControl(p);p=CreateControlContainer(r);p.Bounds.SetParams(5,0,0,5,!0,!1,!1,!0,100,25);p.Anchor=g_anchor_bottom|g_anchor_left;l.AddControl(p);this.HtmlElement.MessageElement=k;this.HtmlElement.TextElement=
f;this.HtmlElement.PrevButton=n;this.HtmlElement.NextButton=e;this.HtmlElement.NextSgf=g;this.HtmlElement.PrevSgf=c;this.HtmlElement.BoardDisabler=h;this.m_aElements.push(m);this.m_oControl=d;this.Update_Size();this.private_GoToStep(0,0)};CPresentation.prototype.Update_Size=function(a){this.m_oControl&&this.m_oControl.Resize(this.m_oControl.HtmlElement.clientWidth,this.m_oControl.HtmlElement.clientHeight);for(var b=0,c=this.m_aElements.length;b<c;b++)this.m_aElements[b].Update_Size(a)};
CPresentation.prototype.Get_NodesCountInSlide=function(){return null===this.m_aSlides[this.m_nCurSlide].SgfPr||void 0===this.m_aSlides[this.m_nCurSlide].SgfPr.Count?0:this.m_aSlides[this.m_nCurSlide].SgfPr.Count};
CPresentation.prototype.On_EndSgfSlide=function(){null!==this.m_aSlides[this.m_nCurSlide].SgfPr&&!0===this.m_aSlides[this.m_nCurSlide].SgfPr.WaitOnEnd?(this.HtmlElement.BoardDisabler.style.display="block",this.HtmlElement.NextSgf.style.display="block",this.HtmlElement.PrevSgf.style.display="block"):this.private_GoToPresentationStep(this.m_nCurSlide,2)};CPresentation.prototype.Register_Board=function(a){};CPresentation.prototype.Update_Comments=function(a){};
CPresentation.prototype.Update_InterfaceState=function(){};CPresentation.prototype.Update_BlackName=function(){};CPresentation.prototype.Update_WhiteName=function(){};CPresentation.prototype.Update_BlackRank=function(){};CPresentation.prototype.Update_WhiteRank=function(){};CPresentation.prototype.Update_Scores=function(){};CPresentation.prototype.Update_Captured=function(){};CPresentation.prototype.On_StopAutoPlay=function(){};CPresentation.prototype.On_StartAutoPlay=function(){};
CPresentation.prototype.private_LoadSlides=function(a){var b=a.length;this.m_nSlidesCount=b;this.m_aSlides=[];for(var c=0;c<b;c++)this.m_aSlides[c]={},this.m_aSlides[c].Sgf=a[c].Sgf,this.m_aSlides[c].Before=a[c].Before,this.m_aSlides[c].After=a[c].After,this.m_aSlides[c].Message=a[c].Message,null===a[c].SgfPr?this.m_aSlides[c].SgfPr=null:(this.m_aSlides[c].SgfPr={},this.m_aSlides[c].SgfPr.Count=a[c].SgfPr.Count,this.m_aSlides[c].SgfPr.WaitOnEnd=a[c].SgfPr.WaitOnEnd,this.m_aSlides[c].SgfPr.Flags={},
a[c].SgfPr.Flags&&(this.m_aSlides[c].SgfPr.Flags.NewNode=a[c].SgfPr.Flags.NewNode,this.m_aSlides[c].SgfPr.Flags.Move=a[c].SgfPr.Flags.Move,this.m_aSlides[c].SgfPr.Flags.ChangeBoardMode=a[c].SgfPr.Flags.ChangeBoardMode,this.m_aSlides[c].SgfPr.Flags.LoadFile=a[c].SgfPr.Flags.LoadFile))};
CPresentation.prototype.private_NextStep=function(){var a=this.m_nCurSlide;ESlideState.Message===this.m_nSlideState?null!==this.m_aSlides[a].Sgf?this.private_GoToStep(a,ESlideState.Sgf):(this.m_nSlideState=ESlideState.Sgf,this.private_NextStep()):ESlideState.Sgf!==this.m_nSlideState||a>=this.m_nSlidesCount-1||(null!==this.m_aSlides[a+1].Message?this.private_GoToStep(a+1,ESlideState.Message):(this.m_nCurSlide++,this.m_nSlideState=ESlideState.Message,this.private_NextStep()))};
CPresentation.prototype.private_PrevStep=function(){var a=this.m_nCurSlide;ESlideState.Message===this.m_nSlideState?0>=a||(null!==this.m_aSlides[a-1].Sgf?this.private_GoToStep(a-1,ESlideState.Sgf):(this.m_nCurSlide--,this.m_nSlideState=ESlideState.Sgf,this.private_PrevStep())):ESlideState.Sgf===this.m_nSlideState&&(null!==this.m_aSlides[a].Message?this.private_GoToStep(a,ESlideState.Message):(this.m_nSlideState=ESlideState.Message,this.private_PrevStep()))};
CPresentation.prototype.private_GoToStep=function(a,b){if(!(0>a||a>=this.m_nSlidesCount)){this.m_nCurSlide=a;this.m_nSlideState=b;var c=this.m_aSlides[a].Sgf,d=this.m_aSlides[a].SgfPr,e=this.m_aSlides[a].Message;ESlideState.Message===b?(this.HtmlElement.BoardDisabler.style.display="block",null!==e?this.private_ShowMessage(e,0===a?null:"\u041d\u0430\u0437\u0430\u0434",a===this.m_nSlidesCount-1&&null===c?null:"\u0414\u0430\u043b\u0435\u0435"):this.private_NextStep()):ESlideState.Sgf===b&&(this.HtmlElement.BoardDisabler.style.display=
"none",null!==c?(this.private_HideMessage(),this.m_oGameTree.Reset_EditingFlags(),this.m_oGameTree.Load_Sgf(c),this.m_oGameTree.Set_EditingFlags(d.Flags),this.m_oGameTree.Focus()):this.private_NextStep())}};CPresentation.prototype.private_CreateDiv=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CPresentation.prototype.private_CreateButton=function(a,b){var c=document.createElement("input");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("type","button");a.appendChild(c);return c};
CPresentation.prototype.private_ShowMessage=function(a,b,c){var d=this.HtmlElement.PrevButton,e=this.HtmlElement.NextButton;for(this.HtmlElement.MessageElement.style.display="block";this.HtmlElement.TextElement.firstChild;)this.HtmlElement.TextElement.removeChild(this.HtmlElement.TextElement.firstChild);Common.Set_InnerTextToElement(this.HtmlElement.TextElement,"");"string"===typeof a?Common.Set_InnerTextToElement(this.HtmlElement.TextElement,a):this.HtmlElement.TextElement.appendChild(a);null===
b?d.style.display="none":(d.style.display="block",d.value=b);null===c?e.style.display="none":(e.style.display="block",e.value=c)};CPresentation.prototype.private_HideMessage=function(){this.HtmlElement.MessageElement.style.display="none"};var EDrawingSliderType={Unknown:0,AutoPlaySpeed:0,Timeline:1};
function CDrawingSlider(a,b){this.m_oDrawing=a;this.m_oGameTree=null;this.m_nType=b?b:EDrawingSliderType.Unknown;this.HtmlElement={Control:null,Left:null,Right:null,Slider:null};this.m_oBackColor=new CColor(217,217,217,255);this.m_oLeftColor=new CColor(80,80,80,255);this.m_oRightColor=new CColor(190,190,190,255);this.m_oSliderColor=new CColor(80,80,80,255);this.m_oSliderFocusColor=new CColor(130,130,130,255);this.m_nSize=this.m_dPos=this.m_nW=0;this.m_nOffsetX=this.m_nOffsetY=17;this.m_bPosLock=!1;
var c=this;this.private_OnDrag=function(a,b){var d=c.m_nW-c.m_nSize;0!==d&&(c.private_UpdatePos((a-c.m_nOffsetX)/d,!1),c.private_HandleOnChange(!1))};this.private_OnDragStart=function(a,b){c.m_bPosLock=!0;c.private_HandleOnChange(!1)};this.private_OnDragEnd=function(a,b){c.m_bPosLock=!1;var d=c.m_nW-c.m_nSize;0!==d&&(c.private_UpdatePos((a-c.m_nOffsetX)/d,!1),c.private_HandleOnChange(!0))}}
CDrawingSlider.prototype.Init=function(a){this.m_oGameTree=this.m_oDrawing?this.m_oDrawing.Get_GameTree():null;switch(this.m_nType){case EDrawingSliderType.AutoPlaySpeed:this.m_oDrawing.Register_AutoPlaySpeed(this);break;case EDrawingSliderType.Timeline:this.m_oDrawing.Register_TimeLine(this)}this.HtmlElement.Control=CreateControlContainer(a);var b=this.HtmlElement.Control.HtmlElement;b.style.backgroundColor=this.m_oBackColor.ToString();b.style.textDecorationColor=(new CColor(255,255,255,255)).ToString();
var c=a+"_Left",d=a+"_Right";a+="_Slider";this.HtmlElement.Right=this.private_CreateDivElement(b,d);this.HtmlElement.Left=this.private_CreateDivElement(b,c);this.HtmlElement.Slider=this.private_CreateDivElement(b,a);var e=this;this.HtmlElement.Slider.onmouseover=function(){this.style.backgroundColor=e.m_oSliderFocusColor.ToString()};this.HtmlElement.Slider.onmouseout=function(){this.style.backgroundColor=e.m_oSliderColor.ToString()};b=CreateControlContainer(d);b.Bounds.SetParams(this.m_nOffsetX,this.m_nOffsetY-
1,this.m_nOffsetX,this.m_nOffsetY-1,!0,!0,!0,!0,-1,-1);b.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;this.HtmlElement.Control.AddControl(b);b.HtmlElement.style.background=this.m_oRightColor.ToString();c=CreateControlContainer(c);c.Bounds.SetParams(this.m_nOffsetX,this.m_nOffsetY,500,this.m_nOffsetY,!0,!0,!1,!0,-1,-1);c.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;this.HtmlElement.Control.AddControl(c);c.HtmlElement.style.background=this.m_oLeftColor.ToString();
this.Update_Size();this.private_UpdatePos(0)};CDrawingSlider.prototype.Update_Size=function(){var a=this.HtmlElement.Control.HtmlElement.clientWidth,b=this.HtmlElement.Control.HtmlElement.clientHeight;this.m_nW=a-2*this.m_nOffsetX;this.HtmlElement.Control.Resize(a,b);this.private_OnResize(a,b);this.private_UpdatePos(this.m_dPos,!0)};CDrawingSlider.prototype.Update_Pos=function(a){!0!==this.m_bPosLock&&this.private_UpdatePos(a,!0)};
CDrawingSlider.prototype.private_OnResize=function(a,b){var c=32;switch(this.m_nType){case EDrawingSliderType.AutoPlaySpeed:c=45;break;case EDrawingSliderType.Timeline:c=32}this.m_nSize=c;var d=this.HtmlElement.Slider;d.style.width=c+"px";d.style.height="12px";d.style.display="block";d.style.position="absolute";d.style.backgroundColor=this.m_oSliderColor.ToString();d.style.top=this.m_nOffsetY-5+"px";d.style.left=this.m_nOffsetX+"px";d.style.borderRadius="5px";Common_DragHandler.Init(d,null,this.m_nOffsetX,
a-this.m_nOffsetX-c,this.m_nOffsetY-5,this.m_nOffsetY-5);d.onDrag=this.private_OnDrag;d.onDragStart=this.private_OnDragStart;d.onDragEnd=this.private_OnDragEnd;d.style.fontSize="12px";d.style.lineHeight="12px";d.style.color="rgb(255,255,255)";d.style.textOverflow="clip";d.style.overflow="hidden";d.style.textAlign="center";d.style.cursor="default";d.style.transitionProperty="background";d.style.transitionDuration="0.25s";d.style.fontFamily='"Times New Roman", Times, serif'};
CDrawingSlider.prototype.private_CreateDivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CDrawingSlider.prototype.private_UpdatePos=function(a,b){this.m_dPos=Math.min(1,Math.max(a,0));this.HtmlElement.Left.style.width=this.m_dPos*this.m_nW+"px";!1!==b&&(this.HtmlElement.Slider.style.left=this.m_dPos*(this.m_nW-this.m_nSize)+this.m_nOffsetX+"px")};
CDrawingSlider.prototype.private_HandleOnChange=function(a){if(this.m_oGameTree)switch(this.m_nType){case EDrawingSliderType.AutoPlaySpeed:this.m_oGameTree.Set_AutoPlaySpeed(this.m_dPos);a?Common.Set_InnerTextToElement(this.HtmlElement.Slider,""):(a=(this.m_oGameTree.Get_AutoPlayInterval()/1E3*1E3|0)/1E3,Common.Set_InnerTextToElement(this.HtmlElement.Slider,a+" s"));break;case EDrawingSliderType.Timeline:this.m_oGameTree.GoTo_NodeByTimeLine(this.m_dPos)}};function CBoardSound(){this.PrevCountDownTime=this.Challenger=this.BeepBeep=this.Beep=this.TickLast3=this.Tick=this.Feemale1=this.Feemale2=this.Feemale3=this.Feemale4=this.Feemale5=this.Feemale6=this.Feemale7=this.Feemale8=this.Feemale9=this.Feemale10=this.NewMessage=this.CaptureN=this.Capture5=this.Capture3=this.Capture1=this.PlaceStone=null;this.m_bIE=!1;this.m_bOn=!0}
CBoardSound.prototype.Init=function(a,b){var c=document.getElementsByTagName("body");0>=c.length||(this.m_bOn=!0,"IE"===Common.Get_Browser()&&(this.m_bIE=!0),c=c[0],this.PlaceStone=this.private_AddSound(c,"GoBoardApiSoundPlaceStone",a+"/Stone.mp3"),this.Capture1=this.private_AddSound(c,"GoBoardApiSoundCapture1",a+"/Capture1.mp3"),this.Capture3=this.private_AddSound(c,"GoBoardApiSoundCapture3",a+"/Capture3.mp3"),this.Capture5=this.private_AddSound(c,"GoBoardApiSoundCapture5",a+"/Capture5.mp3"),this.CaptureN=
this.private_AddSound(c,"GoBoardApiSoundCaptureN",a+"/CaptureN.mp3"),this.NewMessage=this.private_AddSound(c,"GoBoardApiSoundNewMessage",a+"/NewMessage.mp3"),this.Feemale10=this.private_AddSound(c,"GoBoardApiSoundFemale10",""),this.Feemale9=this.private_AddSound(c,"GoBoardApiSoundFemale9",""),this.Feemale8=this.private_AddSound(c,"GoBoardApiSoundFemale8",""),this.Feemale7=this.private_AddSound(c,"GoBoardApiSoundFemale7",""),this.Feemale6=this.private_AddSound(c,"GoBoardApiSoundFemale6",""),this.Feemale5=
this.private_AddSound(c,"GoBoardApiSoundFemale5",""),this.Feemale4=this.private_AddSound(c,"GoBoardApiSoundFemale4",""),this.Feemale3=this.private_AddSound(c,"GoBoardApiSoundFemale3",""),this.Feemale2=this.private_AddSound(c,"GoBoardApiSoundFemale2",""),this.Feemale1=this.private_AddSound(c,"GoBoardApiSoundFemale1",""),this.Tick=this.private_AddSound(c,"GoBoardApiSoundTick","/Src/Files/Tick.ogg"),this.TickLast3=this.private_AddSound(c,"GoBoardApiSoundTickLast3","/Src/Files/TickLast3.ogg"),this.Beep=
this.private_AddSound(c,"GoBoardApiSoundBeep","/Src/Files/Beep.wav"),this.BeepBeep=this.private_AddSound(c,"GoBoardApiSoundBeepBeep","/Src/Files/BeepBeep.wav"),this.Challenger=this.private_AddSound(c,"GoBoardApiSoundChallenger","/Src/Files/Challenger.wav"))};CBoardSound.prototype.Play_PlaceStone=function(){this.private_PlaySound(this.PlaceStone)};
CBoardSound.prototype.Play_CaptureStones=function(a){1>=a?this.private_PlaySound(this.Capture1):3>=a?this.private_PlaySound(this.Capture3):5>=a?this.private_PlaySound(this.Capture5):this.private_PlaySound(this.CaptureN)};CBoardSound.prototype.Play_NewMessage=function(){this.private_PlaySound(this.NewMessage)};CBoardSound.prototype.On=function(){this.m_bOn=!0};CBoardSound.prototype.Off=function(){this.m_bOn=!1};
CBoardSound.prototype.private_AddSound=function(a,b,c){var d=document.getElementById(b);d||(d=document.createElement("audio"),d.id=b,d.preload="preload",d.src=c,a.appendChild(d));return d};CBoardSound.prototype.private_PlaySound=function(a){if(a&&this.m_bOn&&g_oGlobalSettings.Is_SoundOn())try{this.m_bIE?(a.setActive(),a.click(),a.autoplay="",a.autoplay="autoplay"):a.play()}catch(b){}};CBoardSound.prototype.private_PlayCountDown=function(a){3<a?this.private_PlaySound(this.Tick):3===a&&this.private_PlaySound(this.TickLast3)};
CBoardSound.prototype.PlayCountDown=function(a,b){!(null===this.PrevCountDownTime&&.1<Math.abs(a-parseInt(a)))&&a<b+1.05&&(null===this.PrevCountDownTime||a>this.PrevCountDownTime||.99<Math.abs(this.PrevCountDownTime-a))&&(this.PrevCountDownTime=a,this.private_PlayCountDown(parseInt(a+.5)))};CBoardSound.prototype.ResetCountDown=function(){this.PrevCountDownTime=null};
CBoardSound.prototype.StopCountDown=function(){this.Tick.pause();this.Tick.currentTime=0;this.TickLast3.pause();this.TickLast3.currentTime=0};CBoardSound.prototype.PlayBeep=function(){this.private_PlaySound(this.Beep)};CBoardSound.prototype.PlayBeepBeep=function(){this.private_PlaySound(this.BeepBeep)};CBoardSound.prototype.PlayChallenger=function(){this.private_PlaySound(this.Challenger)};function CDrawingToolbar(a){this.m_oDrawing=a;this.m_oGameTree=null;this.HtmlElement={Control:null};this.m_oBColor=new CColor(217,217,217,255);this.m_aControls=[];this.m_aDrawingControls=[]}CDrawingToolbar.prototype.Add_Control=function(a,b,c,d){this.m_aDrawingControls.push(new CDrawingToolbarItem(a,b,c,d))};
CDrawingToolbar.prototype.Init=function(a,b){this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);var c=this.HtmlElement.Control.HtmlElement,d=this.HtmlElement.Control;c.style.backgroundColor=this.m_oBColor.ToString();for(var e=0,f=0,g=0,h=this.m_aDrawingControls.length;g<h;++g){var k=this.m_aDrawingControls[g],l=k.Get_Control();if(null!==l){var m=a+g;this.private_CreateDivElement(c,m);EToolbarFloat.Left===k.Get_Align()?(this.private_FillHtmlElement(d,m,e,k.Get_W(),!0),e+=k.Get_W()+
k.Get_Space()):(this.private_FillHtmlElement(d,m,f,k.Get_W(),!1),f+=k.Get_W()+k.Get_Space());l.Init(m,b);this.m_aControls.push(l)}}this.Update_Size()};CDrawingToolbar.prototype.Update_Size=function(){this.HtmlElement.Control.Resize(this.HtmlElement.Control.HtmlElement.clientWidth,this.HtmlElement.Control.HtmlElement.clientHeight);for(var a=0,b=this.m_aControls.length;a<b;a++)this.m_aControls[a].Update_Size()};
CDrawingToolbar.prototype.Get_MinWidth=function(){for(var a=0,b=0,c=this.m_aDrawingControls.length;b<c;++b){var d=this.m_aDrawingControls[b],e=d.Get_W();-1===e&&(e=16777215);a+=e+d.Get_Space()}return a};CDrawingToolbar.prototype.private_CreateDivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CDrawingToolbar.prototype.private_FillHtmlElement=function(a,b,c,d,e){b=CreateControlContainer(b);e?(b.Bounds.SetParams(c,0,1E3,1E3,!0,!1,!1,!1,d,-1),b.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom):(b.Bounds.SetParams(0,0,c,1E3,!1,!1,!0,!1,d,-1),b.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom);a.AddControl(b)};
function CDrawingNavigatorCommentsTabs(a){this.m_oDrawing=a;this.m_oGameTree=null;this.HtmlElement={Control:null,Comments:{Control:null},Navgiator:{Control:null}};this.m_oBColor=new CColor(217,217,217,255);this.m_oCommentsDiv=this.m_oNavigatorDiv=this.m_oCommentsButton=this.m_oNavigatorButton=null;this.m_aControls=[]}
CDrawingNavigatorCommentsTabs.prototype.Init=function(a,b,c,d){this.m_oGameTree=b;this.HtmlElement.Control=CreateControlContainer(a);var e=this.HtmlElement.Control.HtmlElement,f=this.HtmlElement.Control;e.style.backgroundColor=this.m_oBColor.ToString();var g=new CDrawingButtonTabComments(this.m_oDrawing),h=a+"C";this.private_CreateDivElement(e,h);this.private_FillHtmlElement(f,h,0);g.Init(h,b);this.m_oCommentsButton=g;g=new CDrawingButtonTabNavigator(this.m_oDrawing);a+="N";this.private_CreateDivElement(e,
a);this.private_FillHtmlElement(f,a,1);g.Init(a,b);this.m_oNavigatorButton=g;this.m_oNavigatorButton.m_oParent=this;this.m_oCommentsButton.m_oParent=this;this.m_oNavigatorDiv=document.getElementById(c);this.m_oCommentsDiv=document.getElementById(d);this.Select(this.m_oCommentsButton);this.Update_Size()};
CDrawingNavigatorCommentsTabs.prototype.Update_Size=function(){this.HtmlElement.Control.Resize(this.HtmlElement.Control.HtmlElement.clientWidth,this.HtmlElement.Control.HtmlElement.clientHeight);this.m_oNavigatorButton.Update_Size();this.m_oCommentsButton.Update_Size()};
CDrawingNavigatorCommentsTabs.prototype.private_CreateDivElement=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};CDrawingNavigatorCommentsTabs.prototype.private_FillHtmlElement=function(a,b,c){b=CreateControlContainer(b);b.Bounds.SetParams(0,36*c+c,1E3,0,!1,!0,!1,!1,-1,36);b.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;a.AddControl(b)};
CDrawingNavigatorCommentsTabs.prototype.Select=function(a){a===this.m_oNavigatorButton?(this.m_oNavigatorButton.Set_Selected(!0),this.m_oCommentsButton.Set_Selected(!1),this.m_oNavigatorDiv.style.visibility="visible",this.m_oCommentsDiv.style.visibility="hidden"):a===this.m_oCommentsButton?(this.m_oNavigatorButton.Set_Selected(!1),this.m_oCommentsButton.Set_Selected(!0),this.m_oNavigatorDiv.style.visibility="hidden",this.m_oCommentsDiv.style.visibility="visible"):(this.m_oNavigatorButton.Set_Selected(!1),
this.m_oCommentsButton.Set_Selected(!1),this.m_oNavigatorDiv.style.visibility="hidden",this.m_oCommentsDiv.style.visibility="hidden")};var EToolbarFloat={Left:1,Right:2};function CDrawingToolbarItem(a,b,c,d){this.m_oControl=a;this.m_nW=b;this.m_nSpace=c;this.m_eAlign=d}CDrawingToolbarItem.prototype.Get_Control=function(){return this.m_oControl};CDrawingToolbarItem.prototype.Get_W=function(){return this.m_nW};CDrawingToolbarItem.prototype.Get_Space=function(){return this.m_nSpace};
CDrawingToolbarItem.prototype.Get_Align=function(){return this.m_eAlign};
function CDrawingMultiLevelToolbar(a){this.m_oDrawing=a;this.HtmlElement={Control:null,SettingsControl:null,SettingsElement:null,GeneralControl:null,GeneralElement:null,AutoPlayControl:null,AutoPlayElement:null,TimelineControl:null,TimelineElement:null,GeneralNavigationElement:null,GeneralNavigationControl:null,TreeNavigationControl:null,TreeNavigationElement:null,KifuModeElement:null,KifuModeControl:null};this.m_bGeneralNavigation=g_oGlobalSettings.Is_MultiLevelToolbarMainNavigation();this.m_bTreeNavigation=
g_oGlobalSettings.Is_MultiLevelToolbarTreeNavigation();this.m_bGeneralToolbar=g_oGlobalSettings.Is_MultiLevelToolbarGeneral();this.m_bAutoPlayToolbar=g_oGlobalSettings.Is_MultiLevelToolbarAutoPlay();this.m_bTimelimeToolbar=g_oGlobalSettings.Is_MultiLevelToolbarTimeline();this.m_bKifuModeToolbar=g_oGlobalSettings.Is_MultiLevelToolbarKifuMode();this.m_nH=this.m_nW=-1;this.m_nLineHeight=36;this.m_nLineSpace=1;this.m_nSettingsWidth=110;this.m_oSettingsToolbar=new CDrawingToolbar(a);this.m_oSettingsToolbar.Add_Control(new CDrawingButtonAbout(a),
36,1,EToolbarFloat.Left);this.m_oDrawing&&this.m_oDrawing.Get_GameTree()&&!0!==this.m_oDrawing.Get_GameTree().Get_LocalSettings().Is_Embedding()?this.m_oSettingsToolbar.Add_Control(new CDrawingButtonSettings(a),36,1,EToolbarFloat.Left):this.m_nSettingsWidth=73;this.m_oSettingsToolbar.Add_Control(new CDrawingButtonToolbarCustomize(a,this),36,1,EToolbarFloat.Left);this.m_oGeneralNavigation=new CDrawingToolbar(a);this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackwardToStart(a),36,1,EToolbarFloat.Left);
this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackward5(a),36,1,EToolbarFloat.Left);this.m_oGeneralNavigation.Add_Control(new CDrawingButtonBackward(a),36,1,EToolbarFloat.Left);this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForward(a),36,1,EToolbarFloat.Left);this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForward5(a),36,1,EToolbarFloat.Left);this.m_oGeneralNavigation.Add_Control(new CDrawingButtonForwardToEnd(a),36,1,EToolbarFloat.Left);this.m_oTreeNavigation=new CDrawingToolbar(a);
this.m_oTreeNavigation.Add_Control(new CDrawingButtonNextVariant(a),36,1,EToolbarFloat.Left);this.m_oTreeNavigation.Add_Control(new CDrawingButtonPrevVariant(a),36,1,EToolbarFloat.Left);this.m_oGeneralToolbar=new CDrawingToolbar(a);this.m_oGeneralToolbar.Add_Control(new CDrawingButtonPass(a),73,1,EToolbarFloat.Left);this.m_oGeneralToolbar.Add_Control(new CDrawingButtonBoardMode(a),36,1,EToolbarFloat.Left);this.m_oGeneralToolbar.Add_Control(new CDrawingButtonGameInfo(a),36,1,EToolbarFloat.Left);this.m_oAutoPlayToolbar=
new CDrawingToolbar(a);this.m_oAutoPlayToolbar.Add_Control(new CDrawingButtonAutoPlay(a),36,1,EToolbarFloat.Left);this.m_oAutoPlayToolbar.Add_Control(new CDrawingSlider(a,EDrawingSliderType.AutoPlaySpeed),-1,1,EToolbarFloat.Left);this.m_oTimelineToolbar=new CDrawingToolbar(a);this.m_oTimelineToolbar.Add_Control(new CDrawingSlider(a,EDrawingSliderType.Timeline),-1,1,EToolbarFloat.Left);this.m_oKifuToolbar=new CDrawingToolbar(a);this.m_oKifuToolbar.Add_Control(new CDrawingButtonKifuWindow(a),36,1,EToolbarFloat.Left);
this.m_oKifuToolbar.Add_Control(new CDrawingButtonKifuMode(a),36,1,EToolbarFloat.Left);this.m_nLevelsCount=1;this.m_aElements=[];this.m_pOnChangeCallback=null}
CDrawingMultiLevelToolbar.prototype.Init=function(a){this.HtmlElement.Control=CreateControlContainer(a);var b=this.HtmlElement.Control.HtmlElement,c=this.HtmlElement.Control,d=a+"SS",e=a+"GN",f=a+"TN",g=a+"GL",h=a+"AP",k=a+"TL";a+="KF";this.HtmlElement.SettingsElement=Common.Create_DivElement(b,d);this.HtmlElement.GeneralNavigationElement=Common.Create_DivElement(b,e);this.HtmlElement.TreeNavigationElement=Common.Create_DivElement(b,f);this.HtmlElement.GeneralElement=Common.Create_DivElement(b,g);
this.HtmlElement.AutoPlayElement=Common.Create_DivElement(b,h);this.HtmlElement.TimelineElement=Common.Create_DivElement(b,k);this.HtmlElement.KifuModeElement=Common.Create_DivElement(b,a);this.HtmlElement.SettingsControl=CreateControlContainer(d);c.AddControl(this.HtmlElement.SettingsControl);this.m_oSettingsToolbar.Init(d,this.m_oDrawing.Get_GameTree());this.HtmlElement.GeneralNavigationControl=CreateControlContainer(e);c.AddControl(this.HtmlElement.GeneralNavigationControl);this.m_oGeneralNavigation.Init(e,
this.m_oDrawing.Get_GameTree());this.HtmlElement.TreeNavigationControl=CreateControlContainer(f);c.AddControl(this.HtmlElement.TreeNavigationControl);this.m_oTreeNavigation.Init(f,this.m_oDrawing.Get_GameTree());this.HtmlElement.GeneralControl=CreateControlContainer(g);c.AddControl(this.HtmlElement.GeneralControl);this.m_oGeneralToolbar.Init(g,this.m_oDrawing.Get_GameTree());this.HtmlElement.AutoPlayControl=CreateControlContainer(h);c.AddControl(this.HtmlElement.AutoPlayControl);this.m_oAutoPlayToolbar.Init(h,
this.m_oDrawing.Get_GameTree());this.HtmlElement.TimelineControl=CreateControlContainer(k);c.AddControl(this.HtmlElement.TimelineControl);this.m_oTimelineToolbar.Init(k,this.m_oDrawing.Get_GameTree());this.HtmlElement.KifuModeControl=CreateControlContainer(a);c.AddControl(this.HtmlElement.KifuModeControl);this.m_oKifuToolbar.Init(a,this.m_oDrawing.Get_GameTree());this.private_UpdateElements();this.private_UpdateControls()};
CDrawingMultiLevelToolbar.prototype.Get_Height=function(){var a=Math.max(this.m_nLevelsCount,1);return a*this.m_nLineHeight+(a-1)*this.m_nLineSpace};
CDrawingMultiLevelToolbar.prototype.Update_Size=function(a){var b=this.HtmlElement.Control.HtmlElement.clientWidth,c=this.HtmlElement.Control.HtmlElement.clientHeight;if(b!==this.m_nW||c!==this.m_nH||!0===a)for(this.m_nW=b,this.m_nH=c,this.private_Update(),this.HtmlElement.Control.Resize(b,c),this.m_oSettingsToolbar.Update_Size(),a=0,b=this.m_aElements.length;a<b;++a)this.m_aElements[a].Update_Size()};CDrawingMultiLevelToolbar.prototype.Set_OnChangeCallback=function(a){this.m_pOnChangeCallback=a};
CDrawingMultiLevelToolbar.prototype.Set_MainNavigation=function(a){this.m_bGeneralNavigation=a;this.private_Update();this.Update_Size(!0)};CDrawingMultiLevelToolbar.prototype.Set_TreeNavigation=function(a){this.m_bTreeNavigation=a;this.private_Update();this.Update_Size(!0)};CDrawingMultiLevelToolbar.prototype.Set_General=function(a){this.m_bGeneralToolbar=a;this.private_Update();this.Update_Size(!0)};
CDrawingMultiLevelToolbar.prototype.Set_AutoPlay=function(a){this.m_bAutoPlayToolbar=a;this.private_Update();this.Update_Size(!0)};CDrawingMultiLevelToolbar.prototype.Set_Timeline=function(a){this.m_bTimelimeToolbar=a;this.private_Update();this.Update_Size(!0)};CDrawingMultiLevelToolbar.prototype.Set_KifuMode=function(a){this.m_bKifuModeToolbar=a;this.private_Update();this.Update_Size(!0)};
CDrawingMultiLevelToolbar.prototype.private_Update=function(){this.private_UpdateElements();this.private_UpdateControls();this.m_pOnChangeCallback&&this.m_pOnChangeCallback()};
CDrawingMultiLevelToolbar.prototype.private_UpdateElements=function(){this.m_aElements=[];this.private_UpdateElement(this.m_bGeneralNavigation,this.m_oGeneralNavigation,this.HtmlElement.GeneralNavigationElement);this.private_UpdateElement(this.m_bTreeNavigation,this.m_oTreeNavigation,this.HtmlElement.TreeNavigationElement);this.private_UpdateElement(this.m_bGeneralToolbar,this.m_oGeneralToolbar,this.HtmlElement.GeneralElement);this.private_UpdateElement(this.m_bAutoPlayToolbar,this.m_oAutoPlayToolbar,
this.HtmlElement.AutoPlayElement);this.private_UpdateElement(this.m_bTimelimeToolbar,this.m_oTimelineToolbar,this.HtmlElement.TimelineElement);this.private_UpdateElement(this.m_bKifuModeToolbar,this.m_oKifuToolbar,this.HtmlElement.KifuModeElement)};CDrawingMultiLevelToolbar.prototype.private_UpdateElement=function(a,b,c){!0===a?(this.m_aElements.push(b),c.style.display="block"):c.style.display="none"};
CDrawingMultiLevelToolbar.prototype.private_UpdateControls=function(){var a=this.HtmlElement.Control.HtmlElement.clientWidth;this.m_nLevelsCount=1;var b=this.HtmlElement.SettingsControl;b.Bounds.SetParams(0,0,0,1E3,!1,!0,!0,!1,this.m_nSettingsWidth,this.m_nLineHeight);b.Anchor=g_anchor_top|g_anchor_right;b=a-this.m_oSettingsToolbar.Get_MinWidth();for(var c=0,d=0,e=0,f=this.m_aElements.length;e<f;++e){var g=this.m_aElements[e],h=g.Get_MinWidth();if(g=this.private_GetHtmlControlByControl(g)).1>=c||
c+h<b?g.Bounds.SetParams(c,d,1E3,1E3,!0,!0,!0,!1,Math.min(h,b),this.m_nLineHeight):(b=a,this.m_nLevelsCount++,c=0,d+=this.m_nLineHeight+this.m_nLineSpace,g.Bounds.SetParams(c,d,1E3,1E3,!0,!0,!0,!1,Math.min(h,b-c),this.m_nLineHeight)),g.Anchor=g_anchor_top|g_anchor_left,c+=h}};
CDrawingMultiLevelToolbar.prototype.private_GetHtmlControlByControl=function(a){var b=null;a===this.m_oGeneralNavigation?b=this.HtmlElement.GeneralNavigationControl:a===this.m_oTreeNavigation?b=this.HtmlElement.TreeNavigationControl:a===this.m_oGeneralToolbar?b=this.HtmlElement.GeneralControl:a===this.m_oAutoPlayToolbar?b=this.HtmlElement.AutoPlayControl:a===this.m_oTimelineToolbar?b=this.HtmlElement.TimelineControl:a===this.m_oKifuToolbar&&(b=this.HtmlElement.KifuModeControl);return b};function CDrawingVerticalTabs(){this.m_aTabs=[];this.m_oCurTab=null;this.m_aContens=[]}
CDrawingVerticalTabs.prototype.Init=function(a,b,c,d){var e=d?d:200,f=document.getElementById(a);a=document.createElement("div");a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.bottom="0px";a.style.width=e-1+"px";a.style.borderRight="1px solid #cbcbcb";f.appendChild(a);d=document.createElement("div");d.style.position="absolute";d.style.left=e+"px";d.style.top="0px";d.style.bottom="0px";d.style.right="0px";f.appendChild(d);e=0;for(f=b.length;e<f;e++)this.private_CreateTabHeader(a,
b[e],d);(b=this.m_aTabs[c?c:0])&&this.private_SelectTab(b)};CDrawingVerticalTabs.prototype.Get_TabContent=function(a){return this.m_aContens[a]};
CDrawingVerticalTabs.prototype.private_CreateTabHeader=function(a,b,c){var d=document.createElement("div");a.appendChild(d);d.style.color="rgb(68, 68, 68)";var e=this;d.addEventListener("mouseenter",function(){e.m_oCurTab!==this&&(this.style.backgroundColor="rgb(241, 241, 241)")},!1);d.addEventListener("mouseleave",function(){e.m_oCurTab!==this&&(this.style.backgroundColor="")},!1);d.addEventListener("click",function(){e.private_SelectTab(this)},!1);a=document.createElement("div");d.appendChild(a);
a.style.padding="7px 2px 7px 20px";var f=document.createElement("div");a.appendChild(f);f.style["-webkit-user-select"]="none";f.style.borderCollapse="collapse";f.style.boxSizing="border-box";f.style.cursor="pointer";f.style.display="block";f.style.fontFamily="Helvetica Neue', Helvetica, Arial, sans-serif";f.style.fontSize="16px";f.style.height="17px";f.style.lineHeight="17.142858505249px";f.style.width="177px";Common.Set_InnerTextToElement(f,b);f=document.createElement("div");f.style.display="none";
f.style.width="100%";f.style.height="100%";c.appendChild(f);this.m_aContens.push(f);this.m_aTabs.push(d)};
CDrawingVerticalTabs.prototype.private_SelectTab=function(a){if(this.m_oCurTab!==a){if(null!==this.m_oCurTab){this.m_oCurTab.style.backgroundColor="";this.m_oCurTab.style.color="rgb(68, 68, 68)";var b=this.private_GetTabIndex(this.m_oCurTab);this.m_aContens[b]&&(this.m_aContens[b].style.display="none")}this.m_oCurTab=a;a.style.backgroundColor="#7d858c";a.style.color="#fff";a=this.private_GetTabIndex(this.m_oCurTab);this.m_aContens[a]&&(this.m_aContens[a].style.display="block")}};
CDrawingVerticalTabs.prototype.private_GetTabIndex=function(a){for(var b=0,c=this.m_aTabs.length;b<c;b++)if(a===this.m_aTabs[b])return b;return-1};function CDrawingWindow(){this.HtmlElement={Control:null,InnerDiv:null,InnerControl:null,CloseButton:null,Caption:null,CaptionText:null,CaptionTextControl:null,HandlerL:null,HandlerR:null,HandlerB:null,HandlerT:null,HandlerLT:null,HandlerRT:null,HandlerLB:null,HandlerRB:null};this.m_oOuterBorderColor=new CColor(166,166,166,255);this.m_oInnerBorderColor=new CColor(185,185,185,255);this.m_oBackColor=new CColor(217,217,217,255);this.m_oDrawing=null;this.m_nH=this.m_nW=-1;this.m_bVisible=!1;this.m_sWindowId=
null;var a=this;this.private_OnDragLeftHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.left),c=parseInt(a.HtmlElement.Control.HtmlElement.style.width),d=parseInt(a.HtmlElement.HandlerL.style.left);60>c-d||(a.HtmlElement.Control.HtmlElement.style.left=b+d+"px",a.HtmlElement.Control.HtmlElement.style.width=c-d+"px");a.HtmlElement.HandlerL.style.left="0px";a.Update_Size()};this.private_OnDragRightHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.width),
c=parseInt(a.HtmlElement.HandlerR.style.left)+6-b;60>b+c?a.HtmlElement.HandlerR.style.left=b-6+"px":(a.HtmlElement.Control.HtmlElement.style.width=b+c+"px",a.HtmlElement.HandlerR.style.left=b+c-6+"px",a.Update_Size())};this.private_OnDragBottomHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.height),c=parseInt(a.HtmlElement.HandlerB.style.top)+6-b;60>b+c?a.HtmlElement.HandlerB.style.top=b-6+"px":(a.HtmlElement.Control.HtmlElement.style.height=b+c+"px",a.HtmlElement.HandlerB.style.top=
b+c-6+"px",a.Update_Size())};this.private_OnDragTopHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.top),c=parseInt(a.HtmlElement.Control.HtmlElement.style.height),d=parseInt(a.HtmlElement.HandlerT.style.top);60>c-d?a.HtmlElement.HandlerT.style.top="0px":(a.HtmlElement.Control.HtmlElement.style.top=b+d+"px",a.HtmlElement.Control.HtmlElement.style.height=c-d+"px",a.HtmlElement.HandlerT.style.top="0px",a.Update_Size())};this.private_OnDragLeftTopHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.top),
c=parseInt(a.HtmlElement.Control.HtmlElement.style.height),d=parseInt(a.HtmlElement.HandlerLT.style.top);60>c-d||(a.HtmlElement.Control.HtmlElement.style.top=b+d+"px",a.HtmlElement.Control.HtmlElement.style.height=c-d+"px");a.HtmlElement.HandlerLT.style.top="0px";b=parseInt(a.HtmlElement.Control.HtmlElement.style.left);c=parseInt(a.HtmlElement.Control.HtmlElement.style.width);d=parseInt(a.HtmlElement.HandlerLT.style.left);60>c-d||(a.HtmlElement.Control.HtmlElement.style.left=b+d+"px",a.HtmlElement.Control.HtmlElement.style.width=
c-d+"px");a.HtmlElement.HandlerLT.style.left="0px";a.Update_Size()};this.private_OnDragRightTopHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.top),c=parseInt(a.HtmlElement.Control.HtmlElement.style.height),d=parseInt(a.HtmlElement.HandlerRT.style.top);60>c-d||(a.HtmlElement.Control.HtmlElement.style.top=b+d+"px",a.HtmlElement.Control.HtmlElement.style.height=c-d+"px");a.HtmlElement.HandlerRT.style.top="0px";b=parseInt(a.HtmlElement.Control.HtmlElement.style.width);c=parseInt(a.HtmlElement.HandlerRT.style.left)+
6-b;60>b+c?a.HtmlElement.HandlerRT.style.left=b-6+"px":(a.HtmlElement.Control.HtmlElement.style.width=b+c+"px",a.HtmlElement.HandlerRT.style.left=b+c-6+"px");a.Update_Size()};this.private_OnDragLeftBottomHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.left),c=parseInt(a.HtmlElement.Control.HtmlElement.style.width),d=parseInt(a.HtmlElement.HandlerLB.style.left);60>c-d||(a.HtmlElement.Control.HtmlElement.style.left=b+d+"px",a.HtmlElement.Control.HtmlElement.style.width=c-d+
"px");a.HtmlElement.HandlerLB.style.left="0px";b=parseInt(a.HtmlElement.Control.HtmlElement.style.height);c=parseInt(a.HtmlElement.HandlerLB.style.top)+6-b;60>b+c?a.HtmlElement.HandlerLB.style.top=b-6+"px":(a.HtmlElement.Control.HtmlElement.style.height=b+c+"px",a.HtmlElement.HandlerLB.style.top=b+c-6+"px");a.Update_Size()};this.private_OnDragRightBottomHandler=function(){var b=parseInt(a.HtmlElement.Control.HtmlElement.style.width),c=parseInt(a.HtmlElement.HandlerRB.style.left)+6-b;60>b+c?a.HtmlElement.HandlerRB.style.left=
b-6+"px":(a.HtmlElement.Control.HtmlElement.style.width=b+c+"px",a.HtmlElement.HandlerRB.style.left=b+c-6+"px");b=parseInt(a.HtmlElement.Control.HtmlElement.style.height);c=parseInt(a.HtmlElement.HandlerRB.style.top)+6-b;60>b+c?a.HtmlElement.HandlerRB.style.top=b-6+"px":(a.HtmlElement.Control.HtmlElement.style.height=b+c+"px",a.HtmlElement.HandlerRB.style.top=b+c-6+"px");a.Update_Size()}}
CDrawingWindow.prototype.Init=function(a,b){function c(){global_mouseEvent.LockMouse()}function d(){global_mouseEvent.UnLockMouse()}var e=this;this.m_bVisible=!0;this.m_sWindowId=a;this.HtmlElement.Control=CreateControlContainer(a);var f=this.HtmlElement.Control.HtmlElement,g=this.HtmlElement.Control;f.style.border="1px solid "+this.m_oOuterBorderColor.ToString();f.style.backgroundColor=this.m_oBackColor.ToString();f.style.boxSizing="content-box";f.style.boxShadow="0px 1px 15px rgba(0,0,0,0.8)";f.addEventListener("mousedown",
function(){e.private_OnFocus()},!1);var h=a+"_Inner",k=this.protected_CreateDivElement(f,h);h=CreateControlContainer(h);h.Bounds.SetParams(6,29,8,8,!0,!0,!0,!0,-1,-1);h.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;g.AddControl(h);k.style.border="1px solid "+this.m_oInnerBorderColor.ToString();k.style.backgroundColor=(new CColor(255,255,255,255)).ToString();k.style.overflow="hidden";this.HtmlElement.InnerDiv=k;this.HtmlElement.InnerControl=h;h=a+"_Caption";this.protected_CreateDivElement(f,
h);k=CreateControlContainer(h);k.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,30);k.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;g.AddControl(k);var l=h+"_Text";h=this.protected_CreateDivElement(f,l);l=CreateControlContainer(l);l.Bounds.SetParams(15,0,55,1E3,!0,!1,!0,!1,-1,30);l.Anchor=g_anchor_top|g_anchor_left|g_anchor_right|g_anchor_bottom;k.AddControl(l);h.style.fontFamily="Tahoma, Sans serif";h.style.fontSize="13pt";h.style.textAlign="center";h.style.height="29px";h.style.lineHeight="29px";
h.style.overflow="hidden";h.style.textOverflow="ellipsis";h.style["-o-text-overflow"]="ellipsis";h.style.cursor="default";Common.Set_InnerTextToElement(h,"Caption");this.HtmlElement.CaptionText=h;this.HtmlElement.CaptionTextControl=l;h=a+"_Caption2";k=this.protected_CreateDivElement(f,h);h=CreateControlContainer(h);h.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,30);h.Anchor=g_anchor_top|g_anchor_left|g_anchor_right;g.AddControl(h);this.HtmlElement.Caption=k;Common_DragHandler.Init(k,null);k.onDrag=
function(a,b){var c=parseInt(e.HtmlElement.Control.HtmlElement.style.left),d=parseInt(e.HtmlElement.Control.HtmlElement.style.top),f=parseInt(e.HtmlElement.Caption.style.left),g=parseInt(e.HtmlElement.Caption.style.top);e.HtmlElement.Control.HtmlElement.style.left=c+f+"px";e.HtmlElement.Control.HtmlElement.style.top=d+g+"px";e.HtmlElement.Caption.style.left="0px";e.HtmlElement.Caption.style.top="0px";e.Update_Size()};k.onDragStart=c;k.onDragEnd=d;!1!==b&&(h=a+"_LeftHandler",k=this.protected_CreateDivElement(f,
h),h=CreateControlContainer(h),h.Bounds.SetParams(0,6,1E3,6,!1,!0,!1,!0,6,-1),h.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom,g.AddControl(h),k.style.cursor="w-resize",this.HtmlElement.HandlerL=k,h=a+"_RightHandler",k=this.protected_CreateDivElement(f,h),h=CreateControlContainer(h),h.Bounds.SetParams(0,6,0,6,!1,!0,!0,!0,6,-1),h.Anchor=g_anchor_top|g_anchor_right|g_anchor_bottom,g.AddControl(h),k.style.cursor="w-resize",this.HtmlElement.HandlerR=k,h=a+"_BottomHandler",k=this.protected_CreateDivElement(f,
h),h=CreateControlContainer(h),h.Bounds.SetParams(6,0,6,0,!0,!1,!0,!0,-1,6),h.Anchor=g_anchor_bottom|g_anchor_right|g_anchor_left,g.AddControl(h),k.style.cursor="s-resize",this.HtmlElement.HandlerB=k,h=a+"_TopHandler",k=this.protected_CreateDivElement(f,h),h=CreateControlContainer(h),h.Bounds.SetParams(6,0,6,1E3,!0,!0,!0,!1,-1,6),h.Anchor=g_anchor_top|g_anchor_right|g_anchor_left,g.AddControl(h),k.style.cursor="s-resize",this.HtmlElement.HandlerT=k,h=a+"_LeftTopHandler",k=this.protected_CreateDivElement(f,
h),h=CreateControlContainer(h),h.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,6,6),h.Anchor=g_anchor_top|g_anchor_left,g.AddControl(h),k.style.cursor="se-resize",this.HtmlElement.HandlerLT=k,h=a+"_RightTopHandler",k=this.protected_CreateDivElement(f,h),h=CreateControlContainer(h),h.Bounds.SetParams(0,0,0,1E3,!1,!1,!0,!1,6,6),h.Anchor=g_anchor_top|g_anchor_right,g.AddControl(h),k.style.cursor="ne-resize",this.HtmlElement.HandlerRT=k,h=a+"_LeftBottomHandler",k=this.protected_CreateDivElement(f,h),h=CreateControlContainer(h),
h.Bounds.SetParams(0,0,0,1E3,!1,!1,!1,!1,6,6),h.Anchor=g_anchor_bottom|g_anchor_left,g.AddControl(h),k.style.cursor="ne-resize",this.HtmlElement.HandlerLB=k,h=a+"_RightBottomHandler",k=this.protected_CreateDivElement(f,h),h=CreateControlContainer(h),h.Bounds.SetParams(0,0,0,1E3,!1,!1,!0,!1,6,6),h.Anchor=g_anchor_bottom|g_anchor_right,g.AddControl(h),k.style.cursor="se-resize",this.HtmlElement.HandlerRB=k,Common_DragHandler.Init(this.HtmlElement.HandlerL,null,null,null,null,null),this.HtmlElement.HandlerL.onDrag=
this.private_OnDragLeftHandler,this.HtmlElement.HandlerL.onDragStart=c,this.HtmlElement.HandlerL.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerR,null,null,null,null,null),this.HtmlElement.HandlerR.onDrag=this.private_OnDragRightHandler,this.HtmlElement.HandlerR.onDragStart=c,this.HtmlElement.HandlerR.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerT,null,null,null,null,null),this.HtmlElement.HandlerT.onDrag=this.private_OnDragTopHandler,this.HtmlElement.HandlerT.onDragStart=
c,this.HtmlElement.HandlerT.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerB,null,null,null,null,null),this.HtmlElement.HandlerB.onDrag=this.private_OnDragBottomHandler,this.HtmlElement.HandlerB.onDragStart=c,this.HtmlElement.HandlerB.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerLT,null,null,null,null,null),this.HtmlElement.HandlerLT.onDrag=this.private_OnDragLeftTopHandler,this.HtmlElement.HandlerLT.onDragStart=c,this.HtmlElement.HandlerLT.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerRT,
null,null,null,null,null),this.HtmlElement.HandlerRT.onDrag=this.private_OnDragRightTopHandler,this.HtmlElement.HandlerRT.onDragStart=c,this.HtmlElement.HandlerRT.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerLB,null,null,null,null,null),this.HtmlElement.HandlerLB.onDrag=this.private_OnDragLeftBottomHandler,this.HtmlElement.HandlerLB.onDragStart=c,this.HtmlElement.HandlerLB.onDragEnd=d,Common_DragHandler.Init(this.HtmlElement.HandlerRB,null,null,null,null,null),this.HtmlElement.HandlerRB.onDrag=
this.private_OnDragRightBottomHandler,this.HtmlElement.HandlerRB.onDragStart=c,this.HtmlElement.HandlerRB.onDragEnd=d);k=a+"_Close";f=this.protected_CreateDivElement(f,k);h=CreateControlContainer(k);h.Bounds.SetParams(0,0,6,1E3,!1,!0,!0,!1,45,20);h.Anchor=g_anchor_top|g_anchor_right;g.AddControl(h);f.style.backgroundColor=(new CColor(255,0,0,255)).ToString();g=new CDrawingButtonClose(this.m_oDrawing);g.Init(k,this);g.m_oNormaFColor=new CColor(199,80,80,255);g.m_oHoverFColor=new CColor(224,67,67,255);
g.m_oActiveFColor=new CColor(153,61,61,255);this.HtmlElement.CloseButton=g;this.private_UpdateSize()};CDrawingWindow.prototype.Get_Id=function(){return this.m_sWindowId};CDrawingWindow.prototype.Update_Size=function(a){var b=this.HtmlElement.Control.HtmlElement.clientWidth,c=this.HtmlElement.Control.HtmlElement.clientHeight;if(b!==this.m_nW||c!==this.m_nH||!0===a)this.m_nW=b,this.m_nH=c,this.HtmlElement.Control.Resize(b,c),this.HtmlElement.CloseButton.Update_Size();this.private_CheckPosition()};
CDrawingWindow.prototype.Close=function(){this.m_bVisible=!1;this.HtmlElement.Control.HtmlElement.style.display="none";this.m_oGameTree&&this.m_oGameTree.Focus()};
CDrawingWindow.prototype.Show=function(a){this.m_bVisible=!0;var b=this.HtmlElement.Control.HtmlElement;b.style.display="block";var c=parseInt(b.style.left),d=parseInt(b.style.top);if(a&&a.Drawing){var e=a.Drawing;a=e.Get_Width();e=e.Get_Height();d>e-100&&(b.style.top=e-100+"px");c>a-100&&(b.style.left=a-100+"px")}0>c&&(b.style.left="0px");0>d&&(b.style.top="0px")};CDrawingWindow.prototype.Focus=function(){};
CDrawingWindow.prototype.Set_Caption=function(a){Common.Set_InnerTextToElement(this.HtmlElement.CaptionText,a)};CDrawingWindow.prototype.protected_CreateDivElement=function(a,b,c){c=document.createElement(c?c:"div");b&&c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};
CDrawingWindow.prototype.protected_UpdateSizeAndPosition=function(a){if(a){this.m_oDrawing=a;a=this.HtmlElement.Control.HtmlElement;var b=parseInt(a.style.width),c=parseInt(a.style.height);b=Math.max(0,(this.m_oDrawing.Get_Width()-b)/2);c=Math.max(0,(this.m_oDrawing.Get_Height()-c)/2);a.style.left=b+"px";a.style.top=c+"px"}};
CDrawingWindow.prototype.private_UpdateSize=function(){var a=this.HtmlElement.Control.HtmlElement,b=this.Get_DefaultWindowSize();null!==b&&void 0!==b&&(a.style.width=b.W+"px",a.style.height=b.H+"px")};CDrawingWindow.prototype.Get_DefaultWindowSize=function(){return null};CDrawingWindow.prototype.Is_Visible=function(){return this.m_bVisible};CDrawingWindow.prototype.Update=function(){};CDrawingWindow.prototype.private_OnFocus=function(){};
CDrawingWindow.prototype.private_CheckPosition=function(){var a=this.HtmlElement.Control.HtmlElement.parentNode;if(a){var b=parseInt(a.clientWidth);a=parseInt(a.clientHeight);var c=parseInt(this.HtmlElement.Control.HtmlElement.style.left),d=parseInt(this.HtmlElement.Control.HtmlElement.style.top),e=parseInt(this.HtmlElement.Control.HtmlElement.style.width),f=parseInt(this.HtmlElement.Control.HtmlElement.style.height);e>b+1||f>a+1?(e>b+1&&(this.HtmlElement.Control.HtmlElement.style.width=b+"px"),f>
a+1&&(this.HtmlElement.Control.HtmlElement.style.height=a+"px"),this.Update_Size()):(c+e>b&&(this.HtmlElement.Control.HtmlElement.style.left=b-e+"px"),0>=c&&(this.HtmlElement.Control.HtmlElement.style.left="0px"),d+f>a&&(this.HtmlElement.Control.HtmlElement.style.top=a-f+"px"),0>=d&&(this.HtmlElement.Control.HtmlElement.style.top="0px"))}};
function CDrawingConfirmWindow(){CDrawingConfirmWindow.superclass.constructor.call(this);this.HtmlElement.OKButton=null;this.HtmlElement.CancelButton=null;this.HtmlElement.OkButtonControl=null;this.HtmlElement.CancelButtonControl=null;this.HtmlElement.OkCancelDiv=null;this.HtmlElement.ConfirmInnerDiv=null;this.HtmlElement.ConfirmInnerControl=null}CommonExtend(CDrawingConfirmWindow,CDrawingWindow);
CDrawingConfirmWindow.prototype.Init=function(a,b){CDrawingConfirmWindow.superclass.Init.call(this,a,b);var c=this.HtmlElement.InnerDiv,d=this.HtmlElement.InnerControl,e=c.id,f=e+"Content";e+="Buttons";var g=this.protected_CreateDivElement(c,f);c=this.protected_CreateDivElement(c,e);f=CreateControlContainer(f);f.Bounds.SetParams(0,0,0,40,!0,!0,!0,!0,-1,-1);f.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom|g_anchor_right;d.AddControl(f);var h=CreateControlContainer(e);h.Bounds.SetParams(0,0,0,0,
!0,!1,!0,!0,-1,40);h.Anchor=g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(h);this.HtmlElement.ConfirmInnerControl=f;this.HtmlElement.ConfirmInnerDiv=g;c.style.borderTop="1px solid rgb(172,172,172)";c.style.backgroundColor="rgb(240,240,240)";this.HtmlElement.OkCancelDiv=c;g=e+"OK";this.protected_CreateDivElement(c,g);f=CreateControlContainer(g);f.Bounds.SetParams(0,9,85,1E3,!1,!0,!0,!1,66,21);f.Anchor=g_anchor_top|g_anchor_right;d.AddControl(f);h=new CDrawingButtonOK(this.m_oDrawing);h.Init(g,
this);this.HtmlElement.OKButton=h;this.HtmlElement.OkButtonControl=f;h.m_oNormaBColor=new CColor(234,234,234,255);h.m_oNormaFColor=new CColor(172,172,172,255);h.m_oHoverBColor=new CColor(227,240,252,255);h.m_oHoverFColor=new CColor(126,180,234,255);h.m_oActiveBColor=new CColor(207,230,252,255);h.m_oActiveFColor=new CColor(86,157,229,255);h.m_oDisabledBColor=new CColor(239,239,239,255);h.m_oDisabledFColor=new CColor(217,217,217,255);e+="Cancel";this.protected_CreateDivElement(c,e);c=CreateControlContainer(e);
c.Bounds.SetParams(0,9,11,1E3,!1,!0,!0,!1,66,21);c.Anchor=g_anchor_top|g_anchor_right;d.AddControl(c);d=new CDrawingButtonCancel(this.m_oDrawing);d.Init(e,this);this.HtmlElement.CancelButton=d;this.HtmlElement.CancelButtonControl=c;d.m_oNormaBColor=new CColor(234,234,234,255);d.m_oNormaFColor=new CColor(172,172,172,255);d.m_oHoverBColor=new CColor(227,240,252,255);d.m_oHoverFColor=new CColor(126,180,234,255);d.m_oActiveBColor=new CColor(207,230,252,255);d.m_oActiveFColor=new CColor(86,157,229,255);
d.m_oDisabledBColor=new CColor(239,239,239,255);d.m_oDisabledFColor=new CColor(217,217,217,255)};CDrawingConfirmWindow.prototype.Update_Size=function(a){CDrawingConfirmWindow.superclass.Update_Size.call(this,a);this.HtmlElement.OKButton&&this.HtmlElement.OKButton.Update_Size();this.HtmlElement.CancelButton&&this.HtmlElement.CancelButton.Update_Size()};CDrawingConfirmWindow.prototype.Handle_Cancel=function(){this.Close()};CDrawingConfirmWindow.prototype.Handle_OK=function(){this.Close()};
function CDrawingInfoWindow(){CDrawingInfoWindow.superclass.constructor.call(this);this.HtmlElement2={};this.m_oGameTree=null;this.m_nBottomOffset=10;this.m_nRowHeight=20;this.m_nLineSpacing=5;this.m_nLeftWidth=100}CommonExtend(CDrawingInfoWindow,CDrawingConfirmWindow);
CDrawingInfoWindow.prototype.Init=function(a,b){CDrawingInfoWindow.superclass.Init.call(this,a);var c=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.caption:"Game info",d=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.gameName:"Game name",e=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.result:"Result",f=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.rules:"Rules",g=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.komi:
"Komi",h=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.handicap:"Handicap",k=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.timeSettings:"Time settings",l=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.black:"Black",m=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.blackRank:"Black rank",n=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.white:"White",p=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.whiteRank:
"White rank",q=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.copyright:"Copyright",t=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.date:"Date",r=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.event:"Event",A=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.round:"Round",y=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.place:"Place",w=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.annotator:
"Annotator",x=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.fuseki:"Fuseki",v=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.source:"Source",B=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.transcriber:"Transcriber",L=window.g_oLocalization?window.g_oLocalization.gameRoom.window.gameInfo.gameInfo:"Game info";window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'"),this.m_nLeftWidth=Math.max(window.g_oTextMeasurer.Measure(d),
window.g_oTextMeasurer.Measure(e),window.g_oTextMeasurer.Measure(f),window.g_oTextMeasurer.Measure(g),window.g_oTextMeasurer.Measure(h),window.g_oTextMeasurer.Measure(k),window.g_oTextMeasurer.Measure(l),window.g_oTextMeasurer.Measure(m),window.g_oTextMeasurer.Measure(n),window.g_oTextMeasurer.Measure(p),window.g_oTextMeasurer.Measure(q),window.g_oTextMeasurer.Measure(t),window.g_oTextMeasurer.Measure(r),window.g_oTextMeasurer.Measure(A),window.g_oTextMeasurer.Measure(y),window.g_oTextMeasurer.Measure(w),
window.g_oTextMeasurer.Measure(x),window.g_oTextMeasurer.Measure(v),window.g_oTextMeasurer.Measure(B),window.g_oTextMeasurer.Measure(L))+12);this.protected_UpdateSizeAndPosition(b.Drawing);var E=b.GameTree;this.m_oGameTree=E;!0!==E.Can_EditGameInfo()&&this.HtmlElement.OKButton.Set_Enabled(!1);this.Set_Caption(c);c=this.HtmlElement.ConfirmInnerControl;var H=this.HtmlElement.ConfirmInnerDiv,I=this.HtmlElement.ConfirmInnerDiv.id;H.style.overflowX="hidden";H.style.overflowY="scroll";var D=this.m_nRowHeight,
C=10,K=this.m_nLineSpacing,S=this.m_nBottomOffset,J=E.Can_EditGameInfo();this.HtmlElement2.GameName=this.private_CreateInfoElement(H,c,I,d,E.Get_GameName(),C,D,J);C+=D+K;this.HtmlElement2.Result=this.private_CreateInfoElement(H,c,I,e,E.Get_Result(),C,D,J);C+=D+K;this.HtmlElement2.Rules=this.private_CreateInfoElement(H,c,I,f,E.Get_Rules(),C,D,J);C+=D+K;this.HtmlElement2.Komi=this.private_CreateInfoElement(H,c,I,g,E.Get_Komi(),C,D,J);C+=D+K;this.HtmlElement2.Handicap=this.private_CreateInfoElement(H,
c,I,h,E.Get_Handicap(),C,D,J);C+=D+K;this.HtmlElement2.TimeSettings=this.private_CreateInfoElement(H,c,I,k,E.Get_TimeLimit()+(""===E.Get_OverTime()?"":" + "+E.Get_OverTime()),C,D,J);C+=D+K;this.HtmlElement2.BlackName=this.private_CreateInfoElement(H,c,I,l,E.Get_BlackName(),C,D,J);C+=D+K;this.HtmlElement2.BlackRank=this.private_CreateInfoElement(H,c,I,m,E.Get_BlackRating(),C,D,J);C+=D+K;this.HtmlElement2.WhiteName=this.private_CreateInfoElement(H,c,I,n,E.Get_WhiteName(),C,D,J);C+=D+K;this.HtmlElement2.WhiteRank=
this.private_CreateInfoElement(H,c,I,p,E.Get_WhiteRating(),C,D,J);C+=D+K;this.HtmlElement2.Copyright=this.private_CreateInfoElement(H,c,I,q,E.Get_Copyright(),C,D,J);C+=D+K;this.HtmlElement2.Date=this.private_CreateInfoElement(H,c,I,t,E.Get_DateTime(),C,D,J);C+=D+K;this.HtmlElement2.Event=this.private_CreateInfoElement(H,c,I,r,E.Get_GameEvent(),C,D,J);C+=D+K;this.HtmlElement2.Round=this.private_CreateInfoElement(H,c,I,A,E.Get_GameRound(),C,D,J);C+=D+K;this.HtmlElement2.Place=this.private_CreateInfoElement(H,
c,I,y,E.Get_GamePlace(),C,D,J);C+=D+K;this.HtmlElement2.Annotator=this.private_CreateInfoElement(H,c,I,w,E.Get_GameAnnotator(),C,D,J);C+=D+K;this.HtmlElement2.Fuseki=this.private_CreateInfoElement(H,c,I,x,E.Get_GameFuseki(),C,D,J);C+=D+K;this.HtmlElement2.Source=this.private_CreateInfoElement(H,c,I,v,E.Get_GameSource(),C,D,J);C+=D+K;this.HtmlElement2.Transcriber=this.private_CreateInfoElement(H,c,I,B,E.Get_GameTranscriber(),C,D,J);C+=D+K;this.HtmlElement2.GameInfo=this.private_CreateInfoAreaElement(H,
c,I,L,E.Get_GameInfo(),C,D,J);C+=3*D;this.protected_CreateDivElement(H,I+"Bottom");d=CreateControlContainer(I+"Bottom");d.Bounds.SetParams(0,C,1E3,1E3,!0,!0,!1,!1,0,S);d.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;c.AddControl(d)};
CDrawingInfoWindow.prototype.Update_Size=function(a){CDrawingInfoWindow.superclass.Update_Size.call(this,a);this.HtmlElement.OKButton&&this.HtmlElement.OKButton.Update_Size();this.HtmlElement.CancelButton&&this.HtmlElement.CancelButton.Update_Size();var b=parseInt(this.HtmlElement.ConfirmInnerDiv.style.height)|0;a=parseInt(this.HtmlElement2.GameInfo.style.top)|0;b-=this.m_nBottomOffset;this.HtmlElement2.GameInfo.style.height=b-a<3*this.m_nRowHeight?3*this.m_nRowHeight+"px":b-a+"px"};
CDrawingInfoWindow.prototype.Handle_Cancel=function(){this.Close()};
CDrawingInfoWindow.prototype.Handle_OK=function(){this.m_oGameTree&&(this.m_oGameTree.Set_GameName(this.HtmlElement2.GameName.value),this.m_oGameTree.Set_Result(this.HtmlElement2.Result.value),this.m_oGameTree.Set_Rules(this.HtmlElement2.Rules.value),this.m_oGameTree.Set_Komi(parseFloat(this.HtmlElement2.Komi.value)),this.m_oGameTree.Set_Handicap(this.HtmlElement2.Handicap.value),this.m_oGameTree.Set_TimeLimit(this.HtmlElement2.TimeSettings.value),this.m_oGameTree.Set_Black(this.HtmlElement2.BlackName.value),
this.m_oGameTree.Set_BlackRating(this.HtmlElement2.BlackRank.value),this.m_oGameTree.Set_White(this.HtmlElement2.WhiteName.value),this.m_oGameTree.Set_WhiteRating(this.HtmlElement2.WhiteRank.value),this.m_oGameTree.Set_Copyright(this.HtmlElement2.Copyright.value),this.m_oGameTree.Set_GameInfo(this.HtmlElement2.GameInfo.value),this.m_oGameTree.Set_DateTime(this.HtmlElement2.Date.value),this.m_oGameTree.Set_GameEvent(this.HtmlElement2.Event.value),this.m_oGameTree.Set_GameRound(this.HtmlElement2.Round.value),
this.m_oGameTree.Set_GamePlace(this.HtmlElement2.Place.value),this.m_oGameTree.Set_GameAnnotator(this.HtmlElement2.Annotator.value),this.m_oGameTree.Set_GameFuseki(this.HtmlElement2.Fuseki.value),this.m_oGameTree.Set_GameSource(this.HtmlElement2.Source.value),this.m_oGameTree.Set_GameTranscriber(this.HtmlElement2.Transcriber.value));this.Close()};
CDrawingInfoWindow.prototype.private_CreateDivElement=function(a,b,c){var d=document.createElement("div");d.setAttribute("id",b);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize=15*c/20+"px";d.style.lineHeight=c+"px";d.style.height=c+"px";a.appendChild(d);return d};
CDrawingInfoWindow.prototype.private_CreateInputElement=function(a,b,c){var d=document.createElement("input");d.setAttribute("id",b);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.setAttribute("type","text");d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize="10pt";d.style.outline="none";d.style.border="1px solid rgb(169,169,169)";!1===c&&(d.disabled="disabled");a.appendChild(d);return d};
CDrawingInfoWindow.prototype.private_CreateInfoElement=function(a,b,c,d,e,f,g,h){var k=this.m_nLeftWidth;c+=d;var l=this.private_CreateDivElement(a,c,g),m=CreateControlContainer(c);m.Bounds.SetParams(10,f,1E3,1E3,!0,!0,!1,!1,k,g);m.Anchor=g_anchor_left|g_anchor_top;b.AddControl(m);Common.Set_InnerTextToElement(l,d);d=c+"Value";a=this.private_CreateInputElement(a,d,h);h=CreateControlContainer(d);h.Bounds.SetParams(10+k,f+1,30,1E3,!0,!0,!0,!1,-1,g-2);h.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;
b.AddControl(h);a.value=e;return a};
CDrawingInfoWindow.prototype.private_CreateInfoAreaElement=function(a,b,c,d,e,f,g,h){var k=this.m_nLeftWidth;c+=d;var l=this.private_CreateDivElement(a,c,g),m=CreateControlContainer(c);m.Bounds.SetParams(10,f,1E3,1E3,!0,!0,!1,!1,k,g);m.Anchor=g_anchor_left|g_anchor_top;b.AddControl(m);Common.Set_InnerTextToElement(l,d);c+="Value";d=document.createElement("textarea");d.setAttribute("id",c);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");
d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize="10pt";d.style.resize="none";d.style.outline="none";d.style.border="1px solid rgb(169,169,169)";d.style.height=3*g+"px";this.HtmlElement2.GameInfo=d;!1===h&&(d.disabled="disabled");a.appendChild(d);a=CreateControlContainer(c);a.Bounds.SetParams(10+k,f+1,30,1E3,!0,!0,!0,!1,-1,3*g);a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;b.AddControl(a);d.value=e;return d};
CDrawingInfoWindow.prototype.Show=function(a){CDrawingInfoWindow.superclass.Show.call(this,a);a=this.m_oGameTree;this.HtmlElement2.GameName.value=a.Get_GameName();this.HtmlElement2.Result.value=a.Get_Result();this.HtmlElement2.Rules.value=a.Get_Rules();this.HtmlElement2.Komi.value=a.Get_Komi();this.HtmlElement2.Handicap.value=a.Get_Handicap();this.HtmlElement2.TimeSettings.value=a.Get_TimeLimit()+(""===a.Get_OverTime()?"":" + "+a.Get_OverTime());this.HtmlElement2.BlackName.value=a.Get_BlackName();
this.HtmlElement2.BlackRank.value=a.Get_BlackRating();this.HtmlElement2.WhiteName.value=a.Get_WhiteName();this.HtmlElement2.WhiteRank.value=a.Get_WhiteRating();this.HtmlElement2.Copyright.value=a.Get_Copyright();this.HtmlElement2.Date.value=a.Get_DateTime();this.HtmlElement2.Event.value=a.Get_GameEvent();this.HtmlElement2.Round.value=a.Get_GameRound();this.HtmlElement2.Place.value=a.Get_GamePlace();this.HtmlElement2.Annotator.value=a.Get_GameAnnotator();this.HtmlElement2.Fuseki.value=a.Get_GameFuseki();
this.HtmlElement2.Source.value=a.Get_GameSource();this.HtmlElement2.Transcriber.value=a.Get_GameTranscriber();this.HtmlElement2.GameInfo.value=a.Get_GameInfo()};function CDrawingErrorWindow(){CDrawingErrorWindow.superclass.constructor.call(this);this.m_nW=300;this.m_nH=100;this.m_oMainElement=null}CommonExtend(CDrawingErrorWindow,CDrawingWindow);
CDrawingErrorWindow.prototype.Init=function(a,b){CDrawingErrorWindow.superclass.Init.call(this,a,!1);this.protected_UpdateSizeAndPosition(b.Drawing);var c=window.g_oLocalization?window.g_oLocalization.gameRoom.window.error.caption:"Error";this.Set_Caption(b.Caption?b.Caption:c);this.m_oGameTree=b.GameTree;this.m_oDrawing=b.Drawing;c=this.HtmlElement.InnerControl;var d=a+"E",e=this.private_CreateDivElement(this.HtmlElement.InnerDiv,d,20);d=CreateControlContainer(d);d.Bounds.SetParams(10,5,10,5,!0,
!0,!0,!0,-1,-1);d.Anchor=g_anchor_left|g_anchor_top|g_anchor_bottom|g_anchor_right;c.AddControl(d);this.m_oMainElement=e;this.Show(b)};CDrawingErrorWindow.prototype.Close=function(){this.m_oDrawing&&this.m_oDrawing.Enable();CDrawingInfoWindow.superclass.Close.call(this)};
CDrawingErrorWindow.prototype.Show=function(a){CDrawingErrorWindow.superclass.Show.call(this,a);this.m_nW=a.W;this.m_nH=a.H;Common.Set_InnerTextToElement(this.m_oMainElement,a.ErrorText);window.g_oTextMeasurer&&0<this.m_nW-14&&(window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'"),a=window.g_oTextMeasurer.Measure(a.ErrorText),a=20*Math.ceil(a/(this.m_nW-14)+.5)+47,this.m_nH<a&&(this.m_nH=a),this.Update_Size(!0));this.m_oDrawing&&(this.m_oDrawing.Disable(),this.protected_UpdateSizeAndPosition(this.m_oDrawing),
this.Update_Size(!0))};CDrawingErrorWindow.prototype.private_CreateDivElement=function(a,b,c){var d=document.createElement("div");d.setAttribute("id",b);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize=15*c/20+"px";d.style.lineHeight=c+"px";d.style.height=c+"px";a.appendChild(d);return d};CDrawingErrorWindow.prototype.Get_DefaultWindowSize=function(){return{W:this.m_nW,H:this.m_nH}};
function CDrawingSettingsWindow(){CDrawingSettingsWindow.superclass.constructor.call(this);this.m_oGameTree=null;this.HtmlElement2={Theme:{TrueColor:null,SimpleColor:null,BookStyle:null,Dark:null},Sound:null,LoadUnfinishedSgf:null,NavigatorLabel:null,CycleThroughVariants:null,LoadShowVariants:null,ShowTarget:null}}CommonExtend(CDrawingSettingsWindow,CDrawingConfirmWindow);
CDrawingSettingsWindow.prototype.Init=function(a,b){CDrawingSettingsWindow.superclass.Init.call(this,a,!1);this.protected_UpdateSizeAndPosition(b.Drawing);this.m_oGameTree=b.GameTree;this.Set_Caption("Settings");var c=new CDrawingVerticalTabs;c.Init(this.HtmlElement.ConfirmInnerDiv.id,["Appearance","Color Scheme","Loading Settings"],0,150);this.private_CreateAppearancePage(c.Get_TabContent(0),b);this.private_CreateColorSchemePage(c.Get_TabContent(1),b);this.private_CreateLoadingSettingsPage(c.Get_TabContent(2),
b)};CDrawingSettingsWindow.prototype.Get_DefaultWindowSize=function(){return{W:400,H:210}};
CDrawingSettingsWindow.prototype.Show=function(a){CDrawingSettingsWindow.superclass.Show.call(this,a);this.HtmlElement2.CycleThroughVariants.checked=this.m_oGameTree.Is_CycleThroughVariants();this.HtmlElement2.Sound.checked=this.m_oGameTree.Is_SoundOn();this.HtmlElement2.NavigatorLabel.selectedIndex=this.m_oGameTree.Get_NavigatorLabel();this.private_CheckColorTheme();this.HtmlElement2.LoadUnfinishedSgf.checked=this.m_oGameTree.Is_LoadUnfinishedFilesOnLastNode();this.HtmlElement2.LoadShowVariants.selectedIndex=
this.m_oGameTree.Get_LoadShowVariants()};CDrawingSettingsWindow.prototype.private_CreatePage=function(a){var b=document.createElement("div");a.appendChild(b);b.style.margin="0";b.style.padding="10px 20px";b.style.fontFamily="Tahoma, Arial, Verdana";b.style.fontSize="10px";b.style.color="#666";b.style.background="#fff";return b};
CDrawingSettingsWindow.prototype.private_CreateAppearancePage=function(a,b){var c=this.private_CreatePage(a),d=this.HtmlElement.ConfirmInnerDiv.id+"A";this.HtmlElement2.ShowTarget=this.private_CreateCheckBox(c,d+"T",this.m_oGameTree.Is_ShowTarget(),"Show target");this.HtmlElement2.CycleThroughVariants=this.private_CreateCheckBox(c,d+"C",this.m_oGameTree.Is_CycleThroughVariants(),"Cycle through variants");this.HtmlElement2.Sound=this.private_CreateCheckBox(c,d+"S",this.m_oGameTree.Is_SoundOn(),"Sound");
this.HtmlElement2.NavigatorLabel=this.private_CreateSelect(c,d+"N",this.m_oGameTree.Get_NavigatorLabel(),["No labels","Move numbers","Move numbers current variant only","Move coordinates"],"Labels in navigator")};
CDrawingSettingsWindow.prototype.private_CreateColorSchemePage=function(a,b){var c=this.private_CreatePage(a),d=this.HtmlElement.ConfirmInnerDiv.id+"CS";this.HtmlElement2.Theme.TrueColor=this.private_CreateRadioButton(c,d+"TC","ThemeId","TrueColor");this.HtmlElement2.Theme.SimpleColor=this.private_CreateRadioButton(c,d+"SC","ThemeId","SimpleColor");this.HtmlElement2.Theme.BookStyle=this.private_CreateRadioButton(c,d+"BS","ThemeId","BookStyle");this.HtmlElement2.Theme.Dark=this.private_CreateRadioButton(c,
d+"D","ThemeId","Dark");this.private_CheckColorTheme()};
CDrawingSettingsWindow.prototype.private_CreateLoadingSettingsPage=function(a,b){var c=this.private_CreatePage(a),d=this.HtmlElement.ConfirmInnerDiv.id+"LS";this.HtmlElement2.LoadUnfinishedSgf=this.private_CreateCheckBox(c,d+"U",this.m_oGameTree.Is_LoadUnfinishedFilesOnLastNode(),"Load unfinished files on the last node");this.HtmlElement2.LoadShowVariants=this.private_CreateSelect(c,d+"V",this.m_oGameTree.Get_LoadShowVariants(),["Don't show variants","Show variations of current node   (siblings)",
"Show variations of successor node (children)","Load option from file"],"Show variants")};
CDrawingSettingsWindow.prototype.Handle_OK=function(){var a=g_oGlobalSettings.Set_ColorScheme(this.HtmlElement2.Theme.SimpleColor.checked?EColorScheme.SimpleColor:this.HtmlElement2.Theme.BookStyle.checked?EColorScheme.BookStyle:this.HtmlElement2.Theme.Dark.checked?EColorScheme.Dark:EColorScheme.TrueColor);this.m_oGameTree.Toggle_Sound(this.HtmlElement2.Sound.checked?!0:!1,!1);this.m_oGameTree.Set_ShowTarget(this.HtmlElement2.ShowTarget.checked?!0:!1);this.m_oGameTree.Set_LoadUnfinishedFilesOnLastNode(this.HtmlElement2.LoadUnfinishedSgf.checked?
!0:!1);this.m_oGameTree.Set_NavigatorLabel(this.HtmlElement2.NavigatorLabel.selectedIndex);this.m_oGameTree.Set_CycleThroughVariants(this.HtmlElement2.CycleThroughVariants.checked?!0:!1);this.m_oGameTree.Set_LoadShowVariants(this.HtmlElement2.LoadShowVariants.selectedIndex);var b=this.m_oGameTree.Get_DrawingBoard(),c=this.m_oGameTree.Get_DrawingNavigator();b&&!0===a.Board&&b.Update_Size(!0);c&&!0===a.Navigator&&c.Update_All();this.Close()};
CDrawingSettingsWindow.prototype.private_CreateRadioButton=function(a,b,c,d){var e=document.createElement("div");e.style.paddingLeft="10px";e.style.paddingBottom="5px";a.appendChild(e);var f=document.createElement("input");f.type="radio";f.name=c;f.value=d;f.setAttribute("id",b);e.appendChild(f);a=document.createElement("span");a.setAttribute("oncontextmenu","return false;");a.style.fontFamily="Tahoma, Sans serif";Common.Set_InnerTextToElement(a,d);a.style.fontFamily="Tahoma, Sans serif";a.style.fontSize=
"12pt";a.style.height="15px";a.style.lineHeight="15px";a.style.cursor="default";e.appendChild(a);a.addEventListener("click",function(){f.checked=!0},!1);return f};
CDrawingSettingsWindow.prototype.private_CreateCheckBox=function(a,b,c,d){var e=document.createElement("div");e.style.paddingLeft="10px";e.style.paddingBottom="5px";a.appendChild(e);var f=document.createElement("input");f.type="checkbox";f.checked=c;f.setAttribute("id",b);e.appendChild(f);a=document.createElement("span");a.setAttribute("oncontextmenu","return false;");a.style.fontFamily="Tahoma, Sans serif";Common.Set_InnerTextToElement(a,d);a.style.fontFamily="Tahoma, Sans serif";a.style.fontSize=
"12pt";a.style.height="15px";a.style.lineHeight="15px";a.style.cursor="default";e.appendChild(a);a.addEventListener("click",function(){f.checked=!f.checked},!1);return f};
CDrawingSettingsWindow.prototype.private_CreateSelect=function(a,b,c,d,e){b=document.createElement("div");b.style.paddingLeft="10px";b.style.paddingBottom="5px";b.style.fontFamily="Tahoma, Sans serif";b.style.fontSize="9pt";b.style.height="12px";b.style.lineHeight="12px";a.appendChild(b);a=document.createElement("div");Common.Set_InnerTextToElement(a,e);a.style.paddingBottom="5px";b.appendChild(a);e=document.createElement("select");e.style.width="170px";a=0;for(var f=d.length;a<f;a++){var g=document.createElement("option");
g.value=d[a];Common.Set_InnerTextToElement(g,d[a]);e.appendChild(g)}e.selectedIndex=c;b.appendChild(e);return e};
CDrawingSettingsWindow.prototype.private_CheckColorTheme=function(){var a=g_oGlobalSettings.m_oBoardPr.oBoardColor.r;231===a?g_oGlobalSettings.m_oBoardPr.bTrueColorBoard?this.HtmlElement2.Theme.TrueColor.checked=!0:this.HtmlElement2.Theme.SimpleColor.checked=!0:255===a?this.HtmlElement2.Theme.BookStyle.checked=!0:30===a?this.HtmlElement2.Theme.Dark.checked=!0:this.HtmlElement2.Theme.TrueColor.checked=!0};
function CDrawingScoreEstimateWindow(){CDrawingScoreEstimateWindow.superclass.constructor.call(this);this.m_oDrawingBoard=null}CommonExtend(CDrawingScoreEstimateWindow,CDrawingWindow);
CDrawingScoreEstimateWindow.prototype.Init=function(a,b){CDrawingScoreEstimateWindow.superclass.Init.call(this,a,!0);this.protected_UpdateSizeAndPosition(b.Drawing);this.m_oGameTree=b.GameTree;this.Set_Caption("Score estimate");var c=this.HtmlElement.InnerDiv,d=this.HtmlElement.InnerControl,e=this.HtmlElement.InnerDiv.id;c.style.background="url('"+g_sBackground+"')";var f=new CDrawingBoard;d.Set_Type(2,f);e+="B";c=this.protected_CreateDivElement(c,e);var g=CreateControlContainer(e);g.Bounds.SetParams(0,
0,1E3,1E3,!0,!0,!1,!1,-1,-1);g.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(g);this.m_oBoardDiv=c;this.m_oBoardControl=g;f.Init(e,this.m_oGameTree.Copy_ForScoreEstimate());f.Set_EstimateMode(this);this.m_oDrawingBoard=f};CDrawingScoreEstimateWindow.prototype.Update_Size=function(a){CDrawingScoreEstimateWindow.superclass.Update_Size.call(this,a);this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Size(a)};
CDrawingScoreEstimateWindow.prototype.On_EstimateEnd=function(a,b,c,d,e){this.Set_Caption(window.g_oLocalization?window.g_oLocalization.common.shortBlack+" "+a+"("+c+") "+window.g_oLocalization.common.shortWhite+" "+b+"("+d+") "+(0<e?window.g_oLocalization.common.shortBlack+"+"+e:0>e?window.g_oLocalization.common.shortWhite+"+"+Math.abs(e):window.g_oLocalization.common.gameResult.even):"B "+a+"("+c+") W "+b+"("+d+") "+(0<e?"B+"+e:0>e?"W+"+Math.abs(e):"Even"))};
CDrawingScoreEstimateWindow.prototype.Show=function(a){for(;this.m_oBoardDiv.firstChild;)this.m_oBoardDiv.removeChild(this.m_oBoardDiv.firstChild);this.m_oBoardControl&&this.m_oBoardControl.Clear();var b=new CDrawingBoard;b.Init(this.m_oBoardDiv.id,a.GameTree.Copy_ForScoreEstimate());b.Set_EstimateMode(this);this.m_oDrawingBoard=b;CDrawingScoreEstimateWindow.superclass.Show.apply(this,arguments);this.Update_Size(!0)};
function CDrawingCountColorsWindow(){CDrawingCountColorsWindow.superclass.constructor.call(this);this.m_nLeftWidth=100}CommonExtend(CDrawingCountColorsWindow,CDrawingWindow);
CDrawingCountColorsWindow.prototype.Init=function(a,b){CDrawingCountColorsWindow.superclass.Init.call(this,a,!1);var c=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.caption:"Counter of colors",d=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.red:"Red",e=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.blue:"Blue",f=window.g_oLocalization?window.g_oLocalization.gameRoom.window.colorsCounter.green:"Green",g=window.g_oLocalization?
window.g_oLocalization.gameRoom.window.colorsCounter.gray:"Gray";window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("15px Tahoma, 'Sans serif'"),this.m_nLeftWidth=Math.max(window.g_oTextMeasurer.Measure(d),window.g_oTextMeasurer.Measure(e),window.g_oTextMeasurer.Measure(f),window.g_oTextMeasurer.Measure(g))+12);this.m_oGameTree=b.GameTree;this.m_oDrawingBoard=b.DrawingBoard;this.protected_UpdateSizeAndPosition(b.Drawing);this.Set_Caption(c);var h=this.HtmlElement.InnerDiv;c=this.HtmlElement.InnerControl;
var k=this.HtmlElement.InnerDiv.id;h.style.overflowX="hidden";h.style.overflowY="hidden";var l=10,m=b.DrawingBoard.m_oColorMarks,n=[0,0,0,0],p=[0,0,0,0],q=[0,0,0,0],t=[0,0,0,0],r;for(r in m){var A=m[r],y=-1;0!==A.r&&0!==A.g&&0!==A.b?y=3:0!==A.r?y=0:0!==A.g?y=1:0!==A.b&&(y=2);A=50>=A.a?0:100>=A.a?1:150>=A.a?2:3;switch(y){case 0:n[A]++;break;case 1:p[A]++;break;case 2:q[A]++;break;case 3:t[A]++}}this.Red=this.private_CreateInfoElement(h,c,k,d,"4 x "+n[3]+"+ 3 x "+n[2]+" + 2 x "+n[1]+" + 1 x "+n[0]+
" ="+(4*n[3]+3*n[2]+2*n[1]+n[0]),l,20);l+=25;this.Green=this.private_CreateInfoElement(h,c,k,f,"4 x "+p[3]+"+ 3 x "+p[2]+" + 2 x "+p[1]+" + 1 x "+p[0]+" ="+(4*p[3]+3*p[2]+2*p[1]+p[0]),l,20);l+=25;this.Blue=this.private_CreateInfoElement(h,c,k,e,"4 x "+q[3]+"+ 3 x "+q[2]+" + 2 x "+q[1]+" + 1 x "+q[0]+" ="+(4*q[3]+3*q[2]+2*q[1]+q[0]),l,20);l+=25;this.Gray=this.private_CreateInfoElement(h,c,k,g,"4 x "+t[3]+"+ 3 x "+t[2]+" + 2 x "+t[1]+" + 1 x "+t[0]+" ="+(4*t[3]+3*t[2]+2*t[1]+t[0]),l,20);l+=25;this.protected_CreateDivElement(h,
k+"Bottom");d=CreateControlContainer(k+"Bottom");d.Bounds.SetParams(0,l,1E3,1E3,!0,!0,!1,!1,0,10);d.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;c.AddControl(d)};
CDrawingCountColorsWindow.prototype.private_CreateDivElement=function(a,b,c){var d=document.createElement("div");d.setAttribute("id",b);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize=15*c/20+"px";d.style.lineHeight=c+"px";d.style.height=c+"px";a.appendChild(d);return d};
CDrawingCountColorsWindow.prototype.private_CreateInputElement=function(a,b){var c=document.createElement("input");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");c.setAttribute("type","text");c.style.fontFamily="Tahoma, Sans serif";c.style.fontSize="10pt";c.style.outline="none";c.disabled="disabled";a.appendChild(c);return c};
CDrawingCountColorsWindow.prototype.private_CreateInfoElement=function(a,b,c,d,e,f,g,h){var k=this.m_nLeftWidth;c+=d;var l=this.private_CreateDivElement(a,c,g),m=CreateControlContainer(c);m.Bounds.SetParams(10,f,1E3,1E3,!0,!0,!1,!1,k,g);m.Anchor=g_anchor_left|g_anchor_top;b.AddControl(m);Common.Set_InnerTextToElement(l,d);d=c+"Value";a=this.private_CreateInputElement(a,d,h);h=CreateControlContainer(d);h.Bounds.SetParams(10+k,f+1,30,1E3,!0,!0,!0,!1,-1,g-2);h.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;
b.AddControl(h);a.value=e;return a};CDrawingCountColorsWindow.prototype.Show=function(a){CDrawingCountColorsWindow.superclass.Show.call(this,a);this.m_oGameTree=a.GameTree;this.m_oDrawingBoard=a.DrawingBoard;this.Update()};
CDrawingCountColorsWindow.prototype.Update=function(a){if(this.Is_Visible()&&this.m_oDrawingBoard){a=this.m_oDrawingBoard.m_oColorMarks;var b=[0,0,0,0],c=[0,0,0,0],d=[0,0,0,0],e=[0,0,0,0],f;for(f in a){var g=a[f],h=-1;0!==g.r&&0!==g.g&&0!==g.b?h=3:0!==g.r?h=0:0!==g.g?h=1:0!==g.b&&(h=2);g=50>=g.a?0:100>=g.a?1:150>=g.a?2:3;switch(h){case 0:b[g]++;break;case 1:c[g]++;break;case 2:d[g]++;break;case 3:e[g]++}}this.Red.value="4 x "+b[3]+"+ 3 x "+b[2]+" + 2 x "+b[1]+" + 1 x "+b[0]+" ="+(4*b[3]+3*b[2]+2*
b[1]+b[0]);this.Green.value="4 x "+c[3]+"+ 3 x "+c[2]+" + 2 x "+c[1]+" + 1 x "+c[0]+" ="+(4*c[3]+3*c[2]+2*c[1]+c[0]);this.Blue.value="4 x "+d[3]+"+ 3 x "+d[2]+" + 2 x "+d[1]+" + 1 x "+d[0]+" ="+(4*d[3]+3*d[2]+2*d[1]+d[0]);this.Gray.value="4 x "+e[3]+"+ 3 x "+e[2]+" + 2 x "+e[1]+" + 1 x "+e[0]+" ="+(4*e[3]+3*e[2]+2*e[1]+e[0])}};CDrawingCountColorsWindow.prototype.Get_DefaultWindowSize=function(){return{W:410,H:160}};
function CDrawingGifWriterWindow(){CDrawingGifWriterWindow.superclass.constructor.call(this);this.m_oGameTree=this.m_oDrawing=this.m_oProgressValueElement=this.m_oProgressSliderElement=null}CommonExtend(CDrawingGifWriterWindow,CDrawingWindow);
CDrawingGifWriterWindow.prototype.Init=function(a,b){CDrawingGifWriterWindow.superclass.Init.call(this,a,!1);this.protected_UpdateSizeAndPosition(b.Drawing);this.Set_Caption(window.g_oLocalization?window.g_oLocalization.gameRoom.window.creatingGIF.caption:"Creating Gif file...");b.GameTree&&(this.m_oGameTree=b.GameTree);var c=this.HtmlElement.InnerDiv,d=this.HtmlElement.InnerControl,e=this.HtmlElement.InnerDiv.id,f=e+"PB",g=this.protected_CreateDivElement(c,f);f=CreateControlContainer(f);f.Bounds.SetParams(6,
30,8,8,!0,!0,!0,!0,-1,-1);f.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(f);g.style.border="1px solid rgb(221,221,221)";g.style.backgroundColor="rgb(140, 140, 140)";f=e+"P";g=this.protected_CreateDivElement(c,f);f=CreateControlContainer(f);f.Bounds.SetParams(7,31,0,7,!0,!0,!1,!0,10,-1);f.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom;d.AddControl(f);g.style.backgroundColor="rgb(54, 101, 179)";this.m_oProgressSliderElement=g;e+="PV";c=this.protected_CreateDivElement(c,
e);e=CreateControlContainer(e);e.Bounds.SetParams(0,7,1E3,32,!1,!1,!1,!0,-1,-1);e.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom;d.AddControl(e);c.style.fontFamily="Tahoma, Sans serif";c.style.fontSize="15px";c.style.lineHeight="20px";c.style.height="20px";c.style.color="rgb(0, 0, 0)";c.style.textAlign="center";this.m_oProgressValueElement=c};CDrawingGifWriterWindow.prototype.Get_DefaultWindowSize=function(){return{W:240,H:100}};
CDrawingGifWriterWindow.prototype.On_Progress=function(a){this.m_oProgressSliderElement.style.width=a/100*214+"px";Common.Set_InnerTextToElement(this.m_oProgressValueElement,(100*a|0)/100+"%")};CDrawingGifWriterWindow.prototype.On_Start=function(){this.On_Progress(0);this.m_oDrawing&&this.m_oDrawing.Disable()};CDrawingGifWriterWindow.prototype.On_End=function(){this.On_Progress(100);var a=this;setTimeout(function(){a.Close(!0)},300)};
CDrawingGifWriterWindow.prototype.Close=function(a){!0!==a&&this.m_oGameTree&&this.m_oGameTree.Abort_DownloadGid();this.m_oDrawing&&this.m_oDrawing.Enable();CDrawingGifWriterWindow.superclass.Close.apply(this)};function CDrawingAboutWindow(){CDrawingAboutWindow.superclass.constructor.call(this);this.m_oDrawingBoard=null}CommonExtend(CDrawingAboutWindow,CDrawingWindow);
CDrawingAboutWindow.prototype.Init=function(a,b){CDrawingGifWriterWindow.superclass.Init.call(this,a,!0);this.protected_UpdateSizeAndPosition(b.Drawing);this.Set_Caption("About");this.m_oGameTree=b.GameTree;var c=new CDrawingVerticalTabs;c.Init(this.HtmlElement.InnerDiv.id,["About Web Go Board","Keyboard Shortcuts"],0);this.private_InitAboutPage(c.Get_TabContent(0));this.private_InitKeyBoardShortcutsPage(c.Get_TabContent(1),b)};
CDrawingAboutWindow.prototype.Get_DefaultWindowSize=function(){if(this.m_oDrawing){var a=this.m_oDrawing.Get_Width(),b=this.m_oDrawing.Get_Height();return{W:Math.max(100,Math.min(700,.9*a)),H:Math.max(100,Math.min(600,.9*b))}}return null};
CDrawingAboutWindow.prototype.private_InitAboutPage=function(a){var b=document.createElement("div");a.appendChild(b);a.style.overflowX="hidden";a.style.overflowY="scroll";b.style.margin="0";b.style.padding="10px 20px";b.style.fontFamily="Tahoma, Arial, Verdana";b.style.fontSize="12px";b.style.color="#666";b.style.background="#fff";a=document.createElement("img");a.src=g_sLogo100;a.width=100;a.height=100;a.style["float"]="left";b.appendChild(a);a=document.createElement("div");a.style.width="10px";
a.style.height="100px";a.style["float"]="left";b.appendChild(a);a=document.createElement("h1");b.appendChild(a);Common.Set_InnerTextToElement(a,"Web Go/Baduk Board");a=document.createElement("div");b.appendChild(a);Common.Set_InnerTextToElement(a,"Version "+GoBoardApi.Get_Version());a=document.createElement("div");a.style.paddingTop="40px";b.appendChild(a);Common.Set_InnerTextToElement(a,"Visit our Github project for feedback and issue reports:");a=document.createElement("a");a.target="_blank";a.href=
"https://github.com/IlyaKirillov/GoProject";b.appendChild(a);Common.Set_InnerTextToElement(a,"https://github.com/IlyaKirillov/GoProject");a=document.createElement("div");a.style.paddingTop="20px";b.appendChild(a);Common.Set_InnerTextToElement(a,"Our site:");a=document.createElement("a");a.target="_blank";a.href="http://webgoboard.com/";b.appendChild(a);Common.Set_InnerTextToElement(a,"http://webgoboard.com/");a=document.createElement("div");a.style.paddingTop="20px";b.appendChild(a);Common.Set_InnerTextToElement(a,
"Discussions:");a=document.createElement("a");a.target="_blank";a.href="http://www.lifein19x19.com/forum/viewtopic.php?f=18&t=11239";b.appendChild(a);Common.Set_InnerTextToElement(a,"http://www.lifein19x19.com/");b.appendChild(document.createElement("br"));a=document.createElement("a");a.target="_blank";a.href="http://kido.com.ru/253-web-go-doska";b.appendChild(a);Common.Set_InnerTextToElement(a,"http://kido.com.ru/");a=document.createElement("div");a.style.paddingTop="20px";b.appendChild(a);Common.Set_InnerTextToElement(a,
"Browsers extension:");a=document.createElement("a");a.target="_blank";a.href="https://chrome.google.com/webstore/detail/web-go-board/cdmhoehokaoghadonjfdbhieajggfbmd";b.appendChild(a);Common.Set_InnerTextToElement(a,"Chrome and OperaNext");b.appendChild(document.createElement("br"));a=document.createElement("a");a.target="_blank";a.href="https://addons.mozilla.org/ru/firefox/addon/web-gobaduk-board/";b.appendChild(a);Common.Set_InnerTextToElement(a,"FireFox");a=document.createElement("div");a.style.paddingTop=
"30px";b.appendChild(a);Common.Set_InnerTextToElement(a,"\u00a9 Ilya Kirillov, 2014-2016. All rights reserved.")};
CDrawingAboutWindow.prototype.private_InitKeyBoardShortcutsPage=function(a,b){a.style.overflowX="hidden";a.style.overflowY="scroll";var c=document.createElement("div");a.appendChild(c);c.style.margin="0";c.style.padding="10px 20px";c.style.fontFamily="Tahoma, Arial, Verdana";c.style.fontSize="12px";c.style.color="#666";c.style.background="#fff";var d=document.createElement("h1");c.appendChild(d);Common.Set_InnerTextToElement(d,"Keyboard Shortcuts");d.style.fontSize="16px";d.style.fontWeight="bold";
d=document.createElement("table");c.appendChild(d);d.style.margin="20px 0";d.style.width="100%";c=document.createElement("tbody");d.appendChild(c);this.m_oDrawingBoard=null;b.GameTree&&(this.m_oDrawingBoard=b.GameTree.Get_DrawingBoard());this.private_AppendTableHeading1(c,"Working with Files");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:79,ShiftKey:!1},"Open Sgf/Gib/Ngf","Ctrl+O","Open the Sgf/Gib/Ngf file from disk. (Not in color mode, see below)");this.private_AppendTableCommonString(c,
{CtrlKey:!0,KeyCode:79,ShiftKey:!0},"Open Sgf","Ctrl+Shift+O","Open the Sgf file from source. (Not in color mode, see below)");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:67,ShiftKey:!1},"Create new","Ctrl+C","Create new empty board. (not in color mode see below)");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:83,ShiftKey:!1},"Save Sgf","Ctrl+S","Save Sgf file.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:72,ShiftKey:!1},"Save png shot","Ctrl+H","Save board shot in png format.");
this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:72,ShiftKey:!0},"Save gif shot","Ctrl+Shift+H","Save board shot in gif format.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:73,ShiftKey:!1},"Save multipage gif file.","Ctrl+I","Save gif file for current variant.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:73,ShiftKey:!0},"Save multipage gif file.","Ctrl+Shift+I","Save gif file for all branches with comment RIGHT (for problem mode).");this.private_AppendTableHeading1(c,
"Navigation");this.private_AppendTableCommonString(c,{CtrlKey:!1,KeyCode:39,ShiftKey:!1},"Next node","Right arrow","Jump to next node.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:39,ShiftKey:!1},"Next 5 node","Ctrl+Right arrow","Jump over 5 nodes.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:39,ShiftKey:!0},"End of the variant","Ctrl+Shift+Right arrow","Jump to the end of the current variant.");this.private_AppendTableCommonString(c,{CtrlKey:!1,KeyCode:37,ShiftKey:!1},
"Previous node","Left arrow","Jump to previous node.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:37,ShiftKey:!1},"Previous 5 node","Shift+Left arrow","Jump back over 5 nodes.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:37,ShiftKey:!0},"Start of the file","Ctrl+Shift+Right arrow","Jump to the start of the file.");this.private_AppendTableCommonString(c,{CtrlKey:!1,KeyCode:38,ShiftKey:!1},"Previous variant","Up arrow","Jump to previous variant.");this.private_AppendTableCommonString(c,
{CtrlKey:!1,KeyCode:40,ShiftKey:!1},"Next variant","Down arrow","Jump to next variant.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:36,ShiftKey:!0},"Start node","Ctrl+Shift+Home",'Jump to the start node of the file. This node can be different from the first node. See "load unfinished files" checkbox in settings.');this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:112,ShiftKey:!1},"Play mode","F1");this.private_AppendTableCommonString(c,{},"Add move","Left mouse click","Set sequentially stones.");
this.private_AppendTableCommonString(c,{},"Add alternative move","Right mouse click","Create new brunch and add alternative move.");this.private_AppendTableCommonString(c,{},"Go to the point","Shift+Left mouse click onto a board position","Teleports you to the moment of the game forth or back, when the stone on this position has been played.");this.private_AppendTableCommonString(c,{},"Change move order","Ctrl+Shift+Left mouse click","When sequentially stones are entered: changes the colour of the next stone to be set. What stone will appear on the board is shown by the tools field (useful e.g. after a problem has been set up).");
this.private_AppendTableCommonString(c,{},"Add comment with coordinates","Ctrl+Left mouse click","Add comment with coordinates.");this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:113,ShiftKey:!1},"Count scores","F2");this.private_AppendTableCommonString(c,{},"Mark dead groups","Left mouse click","Mark dead groups.");this.private_AppendTableCommonString(c,{},"End count scores","Ctrl+Left mouse click onto board","Return to play mode.");this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:114,
ShiftKey:!1},"Set up a board position","F3");this.private_AppendTableCommonString(c,{},"Add black stone or remove stone","Left mouse click","Add black stone or remove stone.");this.private_AppendTableCommonString(c,{},"Add white stone or remove stone","Shift+Left mouse click","Add white stone or remove stone.");this.private_AppendTableHeading3(c,{CtrlKey:!1,KeyCode:115,ShiftKey:!1},"Triangles","F4","Add triangles.");this.private_AppendTableHeading3(c,{CtrlKey:!1,KeyCode:116,ShiftKey:!1},"Squares",
"F5","Add squares.");this.private_AppendTableHeading3(c,{CtrlKey:!1,KeyCode:117,ShiftKey:!1},"Circles","F6","Add circles.");this.private_AppendTableHeading3(c,{CtrlKey:!1,KeyCode:118,ShiftKey:!1},"X mark","F7",'Add "X" mark.');this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:119,ShiftKey:!1},"Text label","F8");this.private_AppendTableCommonString(c,{},"Letter","Left mouse click","Add letter.");this.private_AppendTableCommonString(c,{},"Text","Shift+Left mouse click","Add text entered by the user.");
this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:120,ShiftKey:!1},"Numeric label","F9");this.private_AppendTableCommonString(c,{},"Number","Left mouse click","Add the smallest positive number.");this.private_AppendTableCommonString(c,{},"Move number","Shift+Left mouse click","Add number of the first move which was played here.");this.private_AppendTableHeading2(c,{CtrlKey:!1,KeyCode:121,ShiftKey:!1},"Color mode","F10");this.private_AppendTableCommonString(c,{},"Blue region","Left mouse click",
"Add blue region.");this.private_AppendTableCommonString(c,{},"Green region","Shift+Left mouse click","Add green region.");this.private_AppendTableCommonString(c,{},"Red region","Ctrl+Left mouse click","Add red region.");this.private_AppendTableCommonString(c,{},"Gray region","Ctrl+Shift+Left mouse click","Add gray region.");this.private_AppendTableCommonString(c,{},"Clear region","Right mouse click","Clear region.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:67,ShiftKey:!1},"Continue",
"Ctrl+C","Copy all colors from previous node.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:79,ShiftKey:!1},"Count colors","Ctrl+O","Count all colors with depth.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:82,ShiftKey:!1},"Clear colors","Ctrl+R","Clear all colors in the current node.");this.private_AppendTableHeading1(c,"Miscellaneous");this.private_AppendTableCommonString(c,{CtrlKey:!1,KeyCode:8,ShiftKey:!1},"Remove node","Backspace/Delete","Deletes the current node and all of the following brunches.");
this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:69,ShiftKey:!1},"Score estimator","Ctrl+E","Show window with score estimator (you can mark dead groups by click on them).");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:86,ShiftKey:!1},"View mode change of the next move","Ctrl+V","There are 3 mods: Show all next move variants, show all alternative variants of the current move, show nothing.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:82,ShiftKey:!1},"Show/Hide coordinates",
"Ctrl+R","Show/Hide coordinates. (Not in color mode, see above)");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:77,ShiftKey:!0},"Make the current variant mainly","Ctrl+Shift+M","Make the current variant mainly by uplifting it to the root of the game tree.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:85,ShiftKey:!0},"Lift up the current variant","Ctrl+Shift+U","Lift up the current variant.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:68,ShiftKey:!0},"Lower down the current variant",
"Ctrl+Shift+D","Lower down the current variant.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:86,ShiftKey:!0},"Setting up view port","Ctrl+Shift+V","Setting up visible part of the board.");this.private_AppendTableCommonString(c,{CtrlKey:!0,KeyCode:68,ShiftKey:!1},"Ascii Diagram","Ctrl+D","Make ascii diagram by current position.")};
CDrawingAboutWindow.prototype.private_AppendTR=function(a){var b=document.createElement("tr");a.appendChild(b);b.style.borderLeft="0";b.style.borderRight="0";b.style.borderBottom="solid 1px #E4E4E4";b.style.borderCollapse="collapse";b.style.padding="8px";b.style.fontSize="12px";b.style.textAlign="left";b.style.cursor="default";return b};
CDrawingAboutWindow.prototype.private_AppendTD=function(a,b){var c=document.createElement("td");a.appendChild(c);Common.Set_InnerTextToElement(c,b);c.style.borderLeft="0";c.style.borderRight="0";c.style.borderBottom="solid 1px #E4E4E4";c.style.borderCollapse="collapse";c.style.padding="8px";c.style.fontSize="12px";c.style.textAlign="left";c.style.cursor="default";return c};
CDrawingAboutWindow.prototype.private_SetEventListener=function(a,b){var c=this.m_oDrawingBoard;c&&b.KeyCode&&(a.title="Click to do it",a.style.cursor="pointer",a.style.textDecoration="underline",a.addEventListener("click",function(){c.private_HandleKeyDown(b)},!1))};CDrawingAboutWindow.prototype.private_AppendTableHeading1=function(a,b){var c=this.private_AppendTR(a);c=this.private_AppendTD(c,b);c.colSpan="3";c.style.fontSize="14px";c.style.fontWeight="bold";c.style.paddingTop="20px"};
CDrawingAboutWindow.prototype.private_AppendTableHeading2=function(a,b,c,d){a=this.private_AppendTR(a);this.private_AppendTD(a,c).style.fontWeight="bold";c=this.private_AppendTD(a,d);this.private_SetEventListener(c,b);c.colSpan="2"};CDrawingAboutWindow.prototype.private_AppendTableHeading3=function(a,b,c,d,e){a=this.private_AppendTR(a);this.private_AppendTD(a,c).style.fontWeight="bold";c=this.private_AppendTD(a,d);this.private_SetEventListener(c,b);this.private_AppendTD(a,e)};
CDrawingAboutWindow.prototype.private_AppendTableCommonString=function(a,b,c,d,e){a=this.private_AppendTR(a);this.private_AppendTD(a,c).style.width="35%";c=this.private_AppendTD(a,d);c.style.width="15%";this.private_SetEventListener(c,b);this.private_AppendTD(a,e).style.width="50%"};function CDrawingDiagramSLWindow(){CDrawingDiagramSLWindow.superclass.constructor.call(this);this.m_oTextArea=null}CommonExtend(CDrawingDiagramSLWindow,CDrawingWindow);
CDrawingDiagramSLWindow.prototype.Init=function(a,b){CDrawingDiagramSLWindow.superclass.Init.call(this,a,!0);this.Set_Caption(window.g_oLocalization?window.g_oLocalization.gameRoom.window.asciiDiagram.caption:"ASCII diagram");var c=this.HtmlElement.InnerDiv,d=this.HtmlElement.InnerControl,e=this.HtmlElement.InnerDiv.id;this.m_oGameTree=b.GameTree;this.private_CreateInfoAreaElement(c,d,e);this.private_FillTextArea(b.GameTree);this.m_oTextArea.select()};
CDrawingDiagramSLWindow.prototype.Show=function(a){CDrawingDiagramSLWindow.superclass.Show.call(this,a);this.private_FillTextArea(a.GameTree);this.m_oTextArea.select()};
CDrawingDiagramSLWindow.prototype.private_CreateInfoAreaElement=function(a,b,c){var d=document.createElement("textarea");c+="TA";d.setAttribute("id",c);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Courier New, monospacef";d.style.fontSize="10pt";d.style.resize="none";d.style.outline="none";d.style.border="1px solid rgb(169,169,169)";d.style.height="100%";d.style.width="100%";this.m_oTextArea=d;a.appendChild(d);
a=CreateControlContainer(c);a.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom;b.AddControl(a);return d};
CDrawingDiagramSLWindow.prototype.private_FillTextArea=function(a){this.m_oTextArea.value="";if(void 0!==a){var b=a.Get_DrawingBoard();a=a.Get_Board();if(b&&a){var c="",d=a.Get_Size().X,e=a.Get_Size().Y,f=b.Get_ViewPort(),g=f.X0,h=f.Y0,k=f.X1;f=f.Y1;var l=0==g?!0:!1,m=d-1==k?!0:!1;d=0==h?!0:!1;e=e-1==f?!0:!1;for(var n=[],p=h;p<f;p++)for(var q=g;q<k;q++){var t=b.Get_Mark(q+1,p+1),r=null!=t?t.Get_Type():EDrawingMark.Lm;t=null!=t?t.Get_Text():"";r==EDrawingMark.Tx&&Common_IsInt(t)&&(r=parseInt(t),t=
{Number:r,Value:a.Get(q+1,p+1)},BOARD_EMPTY!=t.Value&&n.push(t))}p=!0;r=b.Get_Rulers();var A=-1;if(0<n.length){q=-1;for(var y=BOARD_EMPTY,w=-1,x=0,v=n.length;x<v;x++){t=n[x];if(-1==q||t.Number<q)q=t.Number,y=t.Value;if(-1==w||t.Number>w)w=t.Number}if(10>w-q){w=!0;x=0;for(v=n.length;x<v;x++){t=n[x];var B=(t.Number-q)%2;if(0==B&&y!=t.Value||1==B&&y==t.Value){w=!1;break}}!0===w&&(A=q,p=BOARD_BLACK===y?!0:!1)}}n=l?"$$  --":"$$ -";for(q=g+1;q<=k;q++)n+="--";n+=m?"- \n":"\n";l=l?"$$ |":"$$";m=m?" |\n":
"\n";c=p?c+"$$B":c+"$$W";r&&(c+="c");-1!=A&&(c+="m"+A);c+="\n";d&&(c+=n);for(p=h;p<=f;p++){c+=l;for(q=g;q<=k;q++)t=b.Get_Mark(q+1,p+1),r=null!=t?t.Get_Type():EDrawingMark.Lm,t=null!=t?t.Get_Text():"",h=a.Get(q+1,p+1),BOARD_EMPTY==h?c=EDrawingMark.Tr===r?c+" T":EDrawingMark.Cr===r?c+" C":EDrawingMark.Sq===r?c+" S":EDrawingMark.X===r?c+" M":EDrawingMark.Tx===r&&1===t.length&&97<=t.charCodeAt(0)&&122>=t.charCodeAt(0)?c+String.fromCharCode(32,t.charCodeAt(0)):EDrawingMark.Tx===r&&1===t.length&&65<=t.charCodeAt(0)&&
90>=t.charCodeAt(0)?c+String.fromCharCode(32,t.charCodeAt(0)+32):a.Is_HandiPoint(q+1,p+1)?c+" ,":c+" .":-1!==A&&r==EDrawingMark.Tx&&Common_IsInt(t)?(r=parseInt(t)-A+1,c=10==r?c+" 0":c+(" "+r)):BOARD_BLACK==h?c=EDrawingMark.Tr===r?c+" Y":EDrawingMark.Cr===r?c+" B":EDrawingMark.Sq===r?c+" #":EDrawingMark.X===r?c+" Z":c+" X":BOARD_WHITE==h&&(c=EDrawingMark.Tr===r?c+" Q":EDrawingMark.Cr===r?c+" W":EDrawingMark.Sq===r?c+" @":EDrawingMark.X===r?c+" P":c+" O");c+=m}e&&(c+=n);this.m_oTextArea.value=c}}};
function CDrawingViewPortWindow(){CDrawingViewPortWindow.superclass.constructor.call(this);this.m_oButtonReset=null}CommonExtend(CDrawingViewPortWindow,CDrawingConfirmWindow);
CDrawingViewPortWindow.prototype.Init=function(a,b){CDrawingViewPortWindow.superclass.Init.call(this,a,!0);this.protected_UpdateSizeAndPosition(b.Drawing);this.m_oGameTree=b.GameTree;this.m_oDrawing=b.Drawing;this.Set_Caption(window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.caption:"Crop the board...");var c=this.HtmlElement.ConfirmInnerDiv,d=this.HtmlElement.ConfirmInnerControl,e=this.HtmlElement.ConfirmInnerDiv.id;c.style.background="url('"+g_sBackground+"')";var f=new CDrawingBoard;
d.Set_Type(2,f);var g=e+"B";c=this.protected_CreateDivElement(c,g);var h=CreateControlContainer(g);h.Bounds.SetParams(0,0,1E3,1E3,!0,!0,!1,!1,-1,-1);h.Anchor=g_anchor_top|g_anchor_left|g_anchor_bottom|g_anchor_right;d.AddControl(h);this.m_oBoardDiv=c;this.m_oBoardControl=h;f.Init(g,this.m_oGameTree.Copy_ForScoreEstimate());f.Set_ViewPortMode(this);this.m_oDrawingBoard=f;g=this.HtmlElement.OkCancelDiv;d=window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.buttonReset:"Reset";
f=100;window.g_oTextMeasurer&&(window.g_oTextMeasurer.SetFont("16px 'Segoe UI', Helvetica, Tahoma, Geneva, Verdana, sans-serif"),f=window.g_oTextMeasurer.Measure(d)+10);e+="R";g=this.protected_CreateDivElement(g,e);g=CreateControlContainerByElement(g);g.Bounds.SetParams(0,9,159,1E3,!1,!0,!0,!1,f+10,21);g.Anchor=g_anchor_top|g_anchor_right;this.HtmlElement.InnerControl.AddControl(g);var k=this;d=new CDrawingButtonSimpleText(d,function(){var a=k.m_oGameTree.Get_DrawingBoard();a&&(a.Reset_ViewPort(),
k.m_oDrawing.Update_Size(!0),k.Close())},"");d.Init(e,this);this.m_oButtonReset=d;this.private_UpdateSelectionOnShow()};CDrawingViewPortWindow.prototype.Update_Size=function(a){CDrawingViewPortWindow.superclass.Update_Size.call(this,a);this.m_oDrawingBoard&&this.m_oDrawingBoard.Update_Size(a);this.m_oButtonReset&&this.m_oButtonReset.Update_Size(a)};
CDrawingViewPortWindow.prototype.Show=function(a){for(;this.m_oBoardDiv.firstChild;)this.m_oBoardDiv.removeChild(this.m_oBoardDiv.firstChild);this.m_oBoardControl&&this.m_oBoardControl.Clear();var b=new CDrawingBoard;b.Init(this.m_oBoardDiv.id,a.GameTree.Copy_ForScoreEstimate());b.Set_ViewPortMode(this);this.m_oDrawingBoard=b;CDrawingViewPortWindow.superclass.Show.apply(this,arguments);this.Update_Size(!0);this.private_UpdateSelectionOnShow()};
CDrawingViewPortWindow.prototype.Handle_OK=function(){if(this.m_oGameTree){var a=this.m_oGameTree.Get_DrawingBoard();if(a){var b=this.m_oDrawingBoard.Get_SelectedViewPort();if(b.X1===b.X0&&b.Y1===b.Y0)a.Reset_ViewPort();else{if(3>b.X1-b.X0||3>b.Y1-b.Y0){a=this.m_oGameTree;if(b=this.m_oDrawing){var c=window.g_oLocalization?window.g_oLocalization.gameRoom.window.boardCropping.errorMessage:"Sorry, the cropped part can't be so small.";CreateWindow(b.Get_MainDiv().id,EWindowType.Error,{GameTree:a,Drawing:b,
ErrorText:c,W:270,H:80})}return}a.Set_ViewPort(b.X0-1,b.Y0-1,b.X1-1,b.Y1-1)}this.m_oDrawing.Update_Size(!0)}}this.Close()};CDrawingViewPortWindow.prototype.private_UpdateSelectionOnShow=function(){var a=this.m_oGameTree.Get_DrawingBoard();if(a&&this.m_oDrawingBoard){a=a.Get_ViewPort();var b=this.m_oGameTree.Get_Board().Get_Size();0!==a.X0||0!==a.Y0||b.X-1!==a.X1||b.Y-1!==a.Y1?this.m_oDrawingBoard.Set_ViewPortSelection(a.X0,a.Y0,a.X1,a.Y1):this.m_oDrawingBoard.Set_ViewPortSelection(-1,-1,-1,-1)}};
function CDrawingCreateNewWindow(){CDrawingCreateNewWindow.superclass.constructor.call(this)}CommonExtend(CDrawingCreateNewWindow,CDrawingConfirmWindow);
CDrawingCreateNewWindow.prototype.Init=function(a,b){CDrawingViewPortWindow.superclass.Init.call(this,a,!1);this.protected_UpdateSizeAndPosition(b.Drawing);this.m_oGameTree=b.GameTree;this.m_oDrawing=b.Drawing;this.Set_Caption("Create new");var c=this.HtmlElement.ConfirmInnerDiv,d=this.HtmlElement.ConfirmInnerControl,e=this.HtmlElement.ConfirmInnerDiv.id,f=5;this.BlackPlayer=this.private_CreateInfoElement(c,d,e,"Black","Black",f,20);f+=50;this.WhitePlayer=this.private_CreateInfoElement(c,d,e,"White",
"White",f,20);f+=50;this.BoardSize=this.private_CreateInfoElement(c,d,e,"Board size","19",f,20);f+=50;this.Handicap=this.private_CreateInfoElement(c,d,e,"Handicap","0",f,20);this.Komi=this.private_CreateInfoElement(c,d,e,"Komi","6.5",f+50,20)};
CDrawingCreateNewWindow.prototype.private_CreateDivElement=function(a,b,c){var d=document.createElement("div");d.setAttribute("id",b);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Tahoma, Sans serif";d.style.fontSize=15*c/20+"px";d.style.lineHeight=c+"px";d.style.height=c+"px";d.style.fontWeight=550;a.appendChild(d);return d};
CDrawingCreateNewWindow.prototype.private_CreateInputElement=function(a,b){var c=document.createElement("input");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");c.setAttribute("type","text");c.style.fontFamily="Tahoma, Sans serif";c.style.fontSize="10pt";c.style.outline="none";c.style.border="1px solid rgb(169,169,169)";a.appendChild(c);return c};
CDrawingCreateNewWindow.prototype.private_CreateInfoElement=function(a,b,c,d,e,f,g){c+=d;var h=this.private_CreateDivElement(a,c,g),k=CreateControlContainer(c);k.Bounds.SetParams(20,f,10,1E3,!0,!0,!1,!1,-1,g);k.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;b.AddControl(k);Common.Set_InnerTextToElement(h,d);f+=g;d=c+"Value";a=this.private_CreateInputElement(a,d);d=CreateControlContainer(d);d.Bounds.SetParams(10,f+1,10,1E3,!0,!0,!0,!1,-1,g-2);d.Anchor=g_anchor_left|g_anchor_top|g_anchor_right;b.AddControl(d);
a.value=e;return a};CDrawingCreateNewWindow.prototype.Get_DefaultWindowSize=function(){return{W:195,H:340}};
CDrawingCreateNewWindow.prototype.Handle_OK=function(){var a=this.BoardSize.value,b,c;if(-1==(c=a.indexOf(":")))var d=b=Math.min(52,Math.max(parseInt(a),2));else b=parseInt(a.substr(0,c)),d=parseInt(a.substr(c+1,a.length-c-1));if(isNaN(b)||2>b||52<b||isNaN(d)||2>d||52<d)CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Size value must be an integer number from 2 to 52, or pair of such numbers separated by ':' character.",W:300,
H:115});else{var e=parseInt(this.Handicap.value);if(isNaN(e)||0>e||9<e)CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Handicap value must be an integer number from 0 to 9.",W:300,H:95});else if(0!=e&&(6>=d||6>=b||b!==d))CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Handicap value must be 0 for this board size.",W:300,H:95});else if(5<e&&(10>=
b||10>=d))CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Handicap value must be an integer number from 0 to 5 for this board size.",W:300,H:95});else if(a=parseFloat(this.Komi.value),isNaN(a)||.001<Math.abs(2*a-(2*a|0)))CreateWindow(this.m_oDrawing.Get_MainDiv().id,EWindowType.Error,{GameTree:this.m_oGameTree,Drawing:this.m_oDrawing,ErrorText:"Invalid komi value.",W:175,H:85});else{if(this.m_oGameTree){a="(;FF[4]"+("SZ["+
(b===d?b:b+":"+d)+"]")+("KM["+a+"]")+("PB["+this.BlackPlayer.value+"]");a+="PW["+this.WhitePlayer.value+"]";a+="HA["+e+"]";c=[];if(b===d){var f=b;b=10>f?2:3;d=((f+1)/2|0)-1;f=10>f?f-3:f-4;switch(e){case 2:c.push([f,b]);c.push([b,f]);break;case 3:c.push([f,f]);c.push([b,f]);c.push([f,b]);break;case 4:c.push([b,b]);c.push([f,f]);c.push([b,f]);c.push([f,b]);break;case 5:c.push([b,b]);c.push([b,f]);c.push([f,b]);c.push([f,f]);c.push([d,d]);break;case 6:c.push([b,b]);c.push([b,f]);c.push([f,b]);c.push([f,
f]);c.push([b,d]);c.push([f,d]);break;case 7:c.push([b,b]);c.push([b,f]);c.push([f,b]);c.push([f,f]);c.push([b,d]);c.push([f,d]);c.push([d,d]);break;case 8:c.push([b,b]);c.push([b,f]);c.push([f,b]);c.push([f,f]);c.push([b,d]);c.push([f,d]);c.push([d,b]);c.push([d,f]);break;case 9:c.push([b,b]),c.push([b,f]),c.push([f,b]),c.push([f,f]),c.push([b,d]),c.push([f,d]),c.push([d,b]),c.push([d,f]),c.push([d,d])}}if(0<c.length)for(a+="AB",e=0,b=c.length;e<b;e++)d=c[e][0],f=c[e][1],d+=25>=d?97:39,f+=25>=f?
97:39,a+=String.fromCharCode(91,d,f,93);a+=")";this.m_oGameTree.Load_Sgf(a,null,null,"sgf")}this.Close()}}};function CDrawingClipboardWindow(){CDrawingClipboardWindow.superclass.constructor.call(this);this.m_oTextArea=null}CommonExtend(CDrawingClipboardWindow,CDrawingConfirmWindow);
CDrawingClipboardWindow.prototype.Init=function(a,b){CDrawingClipboardWindow.superclass.Init.call(this,a,!0);this.protected_UpdateSizeAndPosition(b.Drawing);this.Set_Caption("Load file from clipboard");var c=this.HtmlElement.ConfirmInnerDiv,d=this.HtmlElement.ConfirmInnerControl,e=this.HtmlElement.ConfirmInnerDiv.id;this.m_oGameTree=b.GameTree;this.private_CreateInfoAreaElement(c,d,e);this.private_FillTextArea(b.GameTree);this.m_oTextArea.select()};
CDrawingClipboardWindow.prototype.Show=function(a){CDrawingClipboardWindow.superclass.Show.call(this,a);this.private_FillTextArea();this.m_oTextArea.select()};
CDrawingClipboardWindow.prototype.private_CreateInfoAreaElement=function(a,b,c){var d=document.createElement("textarea");c+="TA";d.setAttribute("id",c);d.setAttribute("style","position:absolute;padding:0;margin:0;");d.setAttribute("oncontextmenu","return false;");d.style.fontFamily="Courier New, monospacef";d.style.fontSize="10pt";d.style.resize="none";d.style.outline="none";d.style.border="1px solid rgb(169,169,169)";d.style.height="100%";d.style.width="100%";this.m_oTextArea=d;a.appendChild(d);
a=CreateControlContainer(c);a.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom;b.AddControl(a);return d};CDrawingClipboardWindow.prototype.private_FillTextArea=function(a){this.m_oTextArea.value="";window.clipboardData&&(this.m_oTextArea.value=window.clipboardData.getData("Text"))};CDrawingClipboardWindow.prototype.Handle_OK=function(){var a=this.m_oTextArea.value;a&&""!==a&&this.m_oGameTree.Load_Sgf(a,null,null,null);this.Close()};
CDrawingClipboardWindow.prototype.Get_DefaultWindowSize=function(){return{W:300,H:200}};function CDrawingKifuWindow(){CDrawingKifuWindow.superclass.constructor.call(this);this.m_nMoveMax=this.m_nMoveMin=this.m_nKifuH=this.m_nKifuW=-1;this.m_nNextW=72}CommonExtend(CDrawingKifuWindow,CDrawingWindow);
CDrawingKifuWindow.prototype.Init=function(a,b){CDrawingKifuWindow.superclass.Init.call(this,a,b);this.protected_UpdateSizeAndPosition(b.Drawing);this.Set_Caption(window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.caption:"Kifu");this.HtmlElement.Canvas=this.private_CreateCanvasElement(this.HtmlElement.InnerDiv,this.HtmlElement.InnerControl,a);this.m_oGameTree=b.GameTree;(this.m_oDrawing=b.Drawing)&&this.m_oDrawing.Register_KifuWindow&&this.m_oDrawing.Register_KifuWindow(this)};
CDrawingKifuWindow.prototype.Get_DefaultWindowSize=function(){return{W:650,H:730}};CDrawingKifuWindow.prototype.private_CreateCanvasElement=function(a,b,c){var d=document.createElement("canvas");c+="C";d.setAttribute("style","position:absolute;padding:0;margin:0;");d.id=c;a.appendChild(d);a=CreateControlContainer(c);a.Bounds.SetParams(0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.Anchor=g_anchor_left|g_anchor_top|g_anchor_right|g_anchor_bottom;b.AddControl(a);return d};
CDrawingKifuWindow.prototype.private_DrawLogicBoard=function(a,b,c,d){a.clearRect(0,0,b,c);a.strokeStyle="rgba(0, 0, 0, 1)";a.fillStyle="rgba(0, 0, 0, 1)";var e=this.private_DrawRepetitions(a,0,b,d,30,!1),f=Math.max(50,Math.min(b,c-30-e));f=this.private_DrawBoard(a,d,(b-f)/2|0,30,f);this.private_DrawKifuCaption(a,b,"("+f.Min+" ~ "+f.Max+")");this.private_DrawRepetitions(a,c-e,b,d,30,!0);this.private_DrawNextMove(a,25)};
CDrawingKifuWindow.prototype.Show=function(a){CDrawingKifuWindow.superclass.Show.call(this,a);a=this.HtmlElement.InnerDiv.clientWidth;var b=this.HtmlElement.InnerDiv.clientHeight;this.private_DrawLogicBoard(this.HtmlElement.Canvas.getContext("2d"),a,b,this.m_oGameTree.Get_LogicBoardForKifu())};
CDrawingKifuWindow.prototype.Update_Size=function(a){CDrawingKifuWindow.superclass.Update_Size.call(this,a);var b=this.HtmlElement.InnerDiv.clientWidth,c=this.HtmlElement.InnerDiv.clientHeight;if(!0===a||.001<Math.abs(b-this.m_nKifuW)||.001<Math.abs(c-this.m_nKifuH))this.m_nKifuW=b,this.m_nKifuH=c,this.private_DrawLogicBoard(this.HtmlElement.Canvas.getContext("2d"),b,c,this.m_oGameTree.Get_LogicBoardForKifu())};
CDrawingKifuWindow.prototype.private_DrawStone=function(a,b,c,d,e){BOARD_BLACK===b?(a.fillStyle="rgb(0, 0, 0)",a.beginPath(),a.arc(c,d,e,0,2*Math.PI),a.fill()):BOARD_WHITE===b&&(a.fillStyle="rgb(255, 255, 255)",a.beginPath(),a.arc(c,d,e,0,2*Math.PI),a.fill(),a.stroke())};
CDrawingKifuWindow.prototype.private_DrawMoveNumber=function(a,b,c,d,e,f){if(-1!==f){f=""+f;var g=Common_IsInt(f)?"Arial":"Helvetica, Arial, Verdana";a.fillStyle=b===BOARD_WHITE?"rgb(0,0,0)":"rgb(255,255,255)";a.font=e+"px "+g;b=e/3+.15*e;e=2<f.length?(2*e-a.measureText(f).width)/2-e:(2*e-1.4*a.measureText(f).width)/2-e;2<f.length?a.setTransform(1,0,0,1.4,c+e,d+b):a.setTransform(1.4,0,0,1.4,c+e,d+b);a.fillText(f,0,0);a.setTransform(1,0,0,1,0,0)}};
CDrawingKifuWindow.prototype.private_DrawBoard=function(a,b,c,d,e){var f=b.Get_Size(),g=(f.X-1)*g_dBoardCellW+2*g_dBoardHorOffset,h=e/g*g_dBoardHorOffset|0;e=e/g*g_dBoardCellW|0;c=h+c;d=h+d;a.lineWidth=2;a.beginPath();a.moveTo(c,d);a.lineTo(c+(f.X-1)*e,d);a.lineTo(c+(f.X-1)*e,d+(f.Y-1)*e);a.lineTo(c,d+(f.Y-1)*e);a.closePath();a.stroke();a.lineWidth=1;a.beginPath();for(h=0;h<f.X;++h)a.moveTo(c+h*e+.5,d+.5),a.lineTo(c+h*e+.5,d+(f.Y-1)*e+.5);for(g=0;g<f.Y;++g)a.moveTo(c+.5,d+g*e+.5),a.lineTo(c+(f.X-
1)*e+.5,d+g*e+.5);a.stroke();a.beginPath();h=b.Get_HandiPoints();g=0;for(var k=h.length;g<k;++g)a.rect(h[g][0]*e+c-3,h[g][1]*e+d-3,7,7);a.fill();k=e/2|0;var l=-1,m=-1;for(g=0;g<f.Y;++g)for(h=0;h<f.X;++h){var n=b.Get(h+1,g+1),p=b.Get_Num(h+1,g+1),q=h*e+c,t=g*e+d;this.private_DrawStone(a,n,q,t,k);if(-1!==p){this.private_DrawMoveNumber(a,n,q,t,k,p);if(-1===l||l>p)l=p;if(-1===m||m<p)m=p}}this.m_nMoveMin=l;this.m_nMoveMax=m;return{Min:l,Max:m}};
CDrawingKifuWindow.prototype.private_DrawKifuCaption=function(a,b,c){a.fillStyle="rgb(0,0,0)";a.font="16px Arial";b=(b-a.measureText(c).width)/2;a.fillText(c,b,20)};
CDrawingKifuWindow.prototype.private_DrawRepetitions=function(a,b,c,d,e,f){function g(a){if(p+a<m||!0===q)return q=!1,!0;p=h;q=!1;n+=e+5;return!1}var h=e/2|0,k=e/2|0,l=e|0,m=c-h,n=5+b;b=e/2|0;var p=h;if(d.m_aRepetitions){n+=e/2|0;var q=!0;c=0;for(var t=d.m_aRepetitions.length;c<t;++c){var r=d.m_aRepetitions[c];if(!(0>=r.aReps.length)){for(var A=0,y=r.aReps.length;A<y;++A){var w=r.aReps[A];g(e);!0===f&&(this.private_DrawStone(a,w.nValue,p+b,n,b),this.private_DrawMoveNumber(a,w.nValue,p+b,n,b,w.nMoveNumber));
p+=e}g(l);!0===f&&this.private_DrawDots(a,p+b,n,e);p+=l;g(e);!0===f&&(this.private_DrawStone(a,r.nValue,p+b,n,b),this.private_DrawMoveNumber(a,r.nValue,p+b,n,b,r.nMoveNumber));p+=e+k}}n+=e/2|0}return n+=5};CDrawingKifuWindow.prototype.private_DrawDots=function(a,b,c,d){b=b-d/2|0;var e=d/15|0,f=d/10*3|0;d=d/5|0;a.fillStyle="rgb(0,0,0)";a.beginPath();a.arc(b+d,c,e,0,2*Math.PI);a.arc(b+d+f,c,e,0,2*Math.PI);a.arc(b+d+2*f,c,e,0,2*Math.PI);a.fill()};
CDrawingKifuWindow.prototype.private_DrawNextMove=function(a,b){if(this.m_oGameTree){var c=this.m_oGameTree.Get_MovesCount()+1,d=this.m_oGameTree.Get_NextMove(),e=b/2|0;a.clearRect(0,0,this.m_nNextW,30);if(0<c&&c<=this.m_nMoveMax){var f=window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.next:"Next";a.fillStyle="rgb(0,0,0)";a.font="16px Arial";a.fillText(f,20,20);var g=20;window.g_oTextMeasurer?(window.g_oTextMeasurer.SetFont("16px Arial"),g+=window.g_oTextMeasurer.Measure(f)+5):g+=
50;this.private_DrawStone(a,d,g+e,28-e,e);this.private_DrawMoveNumber(a,d,g+e,28-e,e,c);this.m_nNextW=g+2*e+2}else 0<c&&(f=window.g_oLocalization?window.g_oLocalization.gameRoom.window.kifu.end:"End",a.fillStyle="rgb(0,0,0)",a.font="16px Arial",a.fillText(f,20,20),this.m_nNextW=100)}};CDrawingKifuWindow.prototype.Update_NextMove=function(){this.private_DrawNextMove(this.HtmlElement.Canvas.getContext("2d"),25)};
var EWindowType={Common:0,Confirm:1,Error:2,GameInfo:3,Settings:4,ScoreEstimate:5,CountColors:6,GifWriter:7,About:8,DiagramSL:9,ViewPort:10,CreateNew:11,Clipboard:12,Kifu:13},g_aWindows={};
function CreateWindow(a,b,c){g_aWindows[a]||(g_aWindows[a]={});var d=g_aWindows[a];if(d[b]){var e=d[b];e.Show(c);return e}e="unknownwindow";switch(b){case EWindowType.GameInfo:e="Info";break;case EWindowType.Settings:e="Settings";break;case EWindowType.Error:e="Error";break;case EWindowType.ScoreEstimate:e="ScoreEstimate";break;case EWindowType.CountColors:e="CountColors";break;case EWindowType.GifWriter:e="GifWriter";break;case EWindowType.About:e="About";break;case EWindowType.DiagramSL:e="DiagramSL";
break;case EWindowType.ViewPort:e="ViewPort";break;case EWindowType.CreateNew:e="CreateNew";break;case EWindowType.Clipboard:e="Clipboard";break;case EWindowType.Kifu:e="Kifu"}a=a+e+GoBoardApi.Get_Version();e=document.createElement("div");e.setAttribute("id",a);e.setAttribute("style","position:absolute;padding:0;margin:0;width:500px;height:500px;left:300px;top:300px;");e.setAttribute("oncontextmenu","return false;");if(c.Drawing){c.Drawing.Get_MainDiv().appendChild(e);e=null;switch(b){case EWindowType.GameInfo:e=
new CDrawingInfoWindow;break;case EWindowType.Settings:e=new CDrawingSettingsWindow;break;case EWindowType.Error:e=new CDrawingErrorWindow;break;case EWindowType.ScoreEstimate:e=new CDrawingScoreEstimateWindow;break;case EWindowType.CountColors:e=new CDrawingCountColorsWindow;break;case EWindowType.GifWriter:e=new CDrawingGifWriterWindow;break;case EWindowType.About:e=new CDrawingAboutWindow;break;case EWindowType.DiagramSL:e=new CDrawingDiagramSLWindow;break;case EWindowType.ViewPort:e=new CDrawingViewPortWindow;
break;case EWindowType.CreateNew:e=new CDrawingCreateNewWindow;break;case EWindowType.Clipboard:e=new CDrawingClipboardWindow;break;case EWindowType.Kifu:e=new CDrawingKifuWindow}d[b]=e;null!==e&&(e.Init(a,c),e.Update_Size(!0));return e}return null};